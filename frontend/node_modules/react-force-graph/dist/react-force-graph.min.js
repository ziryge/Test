// Version 1.47.6 react-force-graph - https://github.com/vasturiano/react-force-graph
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ForceGraph={},t.React)}(this,(function(e,n){"use strict";function r(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return l(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.useEffect,r=n.useRef(),i=n.useRef(!1),s=n.useRef(!1),o=u(n.useState(0),2);o[0];var a=o[1];i.current&&(s.current=!0),e((function(){return i.current||(r.current=t(),i.current=!0),a((function(t){return t+1})),function(){s.current&&r.current&&r.current()}}),[])}function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function f(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var m,g,y,v,_,b,x,w={};function M(){return y?g:(y=1,g=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16}))}function S(){if(x)return b;x=1;const t=M(),e=(_||(_=1,v=function(t,e,n){this.type=t,this.index=e,this.pressed=n.pressed,this.value=n.value}),v),n=.2,r="left",i="right",s=1,o=2;return b=AFRAME.registerComponent("gamepad-controls",{GamepadButton:t,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const t=this.el.sceneEl;this.system=t.systems["tracked-controls"]||t.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const e=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=e.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=e.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,t.addBehavior(this)},update:function(){this.tick()},tick:function(t,e){this.updateButtonState(),this.updateRotation(e)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const t=this._dpadVector,e=this._moveVector;this.getDpad(t),this.getJoystick(s,e);const r=t.x||e.x,i=t.y||e.y;return Math.abs(r)>n||Math.abs(i)>n},getVelocityDelta:function(){const t=this._dpadVector,e=this._moveVector;this.getDpad(t),this.getJoystick(s,e);const r=t.x||e.x,i=t.y||e.y,o=new THREE.Vector3;return Math.abs(r)>n&&(o.x+=r),Math.abs(i)>n&&(o.z+=i),o},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const t=this._lookVector;return this.getJoystick(o,t),Math.abs(t.x)>n||Math.abs(t.y)>n},updateRotation:function(t){if(!this.isRotationActive())return;const e=this.data,r=this.yaw,i=this.pitch;r.rotation.y=this.el.object3D.rotation.y,i.rotation.x=this.el.object3D.rotation.x;const s=this._lookVector;this.getJoystick(o,s),Math.abs(s.x)<=n&&(s.x=0),Math.abs(s.y)<=n&&(s.y=0),s.multiplyScalar(e.rotationSensitivity*t/1e3),r.rotation.y-=s.x,i.rotation.x-=s.y,i.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,i.rotation.x)),this.el.object3D.rotation.set(i.rotation.x,r.rotation.y,0)},updateButtonState:function(){const t=this.getGamepad(i);if(this.data.enabled&&t)for(var n=0;n<t.buttons.length;n++)t.buttons[n].pressed&&!this.buttons[n]?this.emit(new e("gamepadbuttondown",n,t.buttons[n])):!t.buttons[n].pressed&&this.buttons[n]&&this.emit(new e("gamepadbuttonup",n,t.buttons[n])),this.buttons[n]=t.buttons[n].pressed;else for(const t in this.buttons)this.buttons[t]=!1},emit:function(t){this.el.emit(t.type,t),this.el.emit(t.type+":"+t.index,new e(t.type,t.index,t))},getGamepad:function(){const t=[],e=[];return function(n){const r=this.el.sceneEl.components["proxy-controls"],i=r&&r.isConnected()&&r.getGamepad(0);if(i)return i;t.length=0;for(let e=0;e<this.system.controllers.length;e++){const r=this.system.controllers[e],i=r?r.gamepad:null;if(t.push(i),i&&r.handedness===n)return i}const s=navigator.getGamepads?navigator.getGamepads():e;for(let t=0;t<s.length;t++){const e=s[t];if(e&&e.hand===n)return e}return t[0]||s[0]}}(),getButton:function(t){return this.getGamepad(i).buttons[t]},getAxis:function(t){return this.getGamepad(t>1?i:r).axes[t]},getJoystick:function(t,e){const n=this.getGamepad(t===s?r:i);if(!n)return e.set(0,0);if("xr-standard"===n.mapping)switch(t){case s:return e.set(n.axes[2],n.axes[3]);case o:return e.set(n.axes[2],0)}else switch(t){case s:return e.set(n.axes[0],n.axes[1]);case o:return e.set(n.axes[2],n.axes[3])}throw new Error('Unexpected joystick index "%d".',t)},getDpad:function(e){const n=this.getGamepad(r);return n&&n.buttons[t.DPAD_RIGHT]?e.set((n.buttons[t.DPAD_RIGHT].pressed?1:0)+(n.buttons[t.DPAD_LEFT].pressed?-1:0),(n.buttons[t.DPAD_UP].pressed?-1:0)+(n.buttons[t.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){const t=this.getGamepad(r);return!(!t||!t.connected)},getID:function(){return this.getGamepad(r).id}}),b}var T,E,A,C,R,N,P,k={};function O(){return T||(T=1,function(t){var e="KeyboardEvent"in t;e||(t.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in t.KeyboardEvent||(t.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in t.KeyboardEvent||(t.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in t.KeyboardEvent||(t.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in t.KeyboardEvent||(t.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var n=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,r=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,i=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,s=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function o(t,e){return-1!==String(t).indexOf(e)}var a=o(navigator.platform,"Win")?"win":o(navigator.platform,"Mac")?"mac":o(navigator.platform,"CrOS")?"cros":o(navigator.platform,"Linux")?"linux":o(navigator.userAgent,"iPad")||o(navigator.platform,"iPod")||o(navigator.platform,"iPhone")?"ios":"",l=o(navigator.userAgent,"Chrome/")?"chrome":o(navigator.vendor,"Apple")?"safari":o(navigator.userAgent,"MSIE")?"ie":o(navigator.userAgent,"Gecko/")?"moz":o(navigator.userAgent,"Opera/")?"opera":"",u=l+"-"+a;function h(t,e,n){u!==e&&l!==e&&a!==e||Object.keys(n).forEach((function(e){t[e]=n[e]}))}var c={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:r},92:{code:"OSRight",location:i},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:s},97:{code:"Numpad1",keyCap:"1",location:s},98:{code:"Numpad2",keyCap:"2",location:s},99:{code:"Numpad3",keyCap:"3",location:s},100:{code:"Numpad4",keyCap:"4",location:s},101:{code:"Numpad5",keyCap:"5",location:s},102:{code:"Numpad6",keyCap:"6",location:s},103:{code:"Numpad7",keyCap:"7",location:s},104:{code:"Numpad8",keyCap:"8",location:s},105:{code:"Numpad9",keyCap:"9",location:s},106:{code:"NumpadMultiply",keyCap:"*",location:s},107:{code:"NumpadAdd",keyCap:"+",location:s},108:{code:"NumpadComma",keyCap:",",location:s},109:{code:"NumpadSubtract",keyCap:"-",location:s},110:{code:"NumpadDecimal",keyCap:".",location:s},111:{code:"NumpadDivide",keyCap:"/",location:s},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:s},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:r},161:{code:"ShiftRight",location:i},162:{code:"ControlLeft",location:r},163:{code:"ControlRight",location:i},164:{code:"AltLeft",location:r},165:{code:"AltRight",location:i},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};h(c,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:s},189:{code:"NumpadSubtract",keyCap:"-",location:s}}),h(c,"moz-mac",{12:{code:"NumLock",location:s},173:{code:"Minus",keyCap:"-"}}),h(c,"moz-win",{173:{code:"Minus",keyCap:"-"}}),h(c,"chrome-mac",{93:{code:"OSRight",location:i}}),h(c,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),h(c,"ios",{10:{code:"Enter",location:n}}),h(c,"safari-mac",{91:{code:"OSLeft",location:r},93:{code:"OSRight",location:i},229:{code:"KeyQ",keyCap:"Q"}});var d={};"cros"===a&&(d["U+00A0"]={code:"ShiftLeft",location:r},d["U+00A1"]={code:"ShiftRight",location:i},d["U+00A2"]={code:"ControlLeft",location:r},d["U+00A3"]={code:"ControlRight",location:i},d["U+00A4"]={code:"AltLeft",location:r},d["U+00A5"]={code:"AltRight",location:i}),"chrome-mac"===u&&(d["U+0010"]={code:"ContextMenu"}),"safari-mac"===u&&(d["U+0010"]={code:"ContextMenu"}),"ios"===a&&(d["U+0010"]={code:"Function"},d["U+001C"]={code:"ArrowLeft"},d["U+001D"]={code:"ArrowRight"},d["U+001E"]={code:"ArrowUp"},d["U+001F"]={code:"ArrowDown"},d["U+0001"]={code:"Home"},d["U+0004"]={code:"End"},d["U+000B"]={code:"PageUp"},d["U+000C"]={code:"PageDown"});var p=[];p[r]={16:{code:"ShiftLeft",location:r},17:{code:"ControlLeft",location:r},18:{code:"AltLeft",location:r}},p[i]={16:{code:"ShiftRight",location:i},17:{code:"ControlRight",location:i},18:{code:"AltRight",location:i}},p[s]={13:{code:"NumpadEnter",location:s}},h(p[s],"moz",{109:{code:"NumpadSubtract",location:s},107:{code:"NumpadAdd",location:s}}),h(p[r],"moz-mac",{224:{code:"OSLeft",location:r}}),h(p[i],"moz-mac",{224:{code:"OSRight",location:i}}),h(p[i],"moz-win",{91:{code:"OSRight",location:i}}),h(p[i],"mac",{93:{code:"OSRight",location:i}}),h(p[s],"chrome-mac",{12:{code:"NumLock",location:s}}),h(p[s],"safari-mac",{12:{code:"NumLock",location:s},187:{code:"NumpadAdd",location:s},189:{code:"NumpadSubtract",location:s},190:{code:"NumpadDecimal",location:s},191:{code:"NumpadDivide",location:s}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};h(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},g=function(t,e){var n={};return Object.keys(t).forEach((function(r){var i=t[r];e in i&&(n[i[e]]=i)})),n}(c,"code");try{var y=e&&"location"in new KeyboardEvent("")}catch(t){}function v(t){var e="keyCode"in t?t.keyCode:"which"in t?t.which:0,n=function(){if(y||"keyLocation"in t){var n=y?t.location:t.keyLocation;if(n&&e in p[n])return p[n][e]}return"keyIdentifier"in t&&t.keyIdentifier in d?d[t.keyIdentifier]:e in c?c[e]:null}();if(!n)return null;var r,i=(r=f[n.code])?t.shiftKey&&"shiftKey"in r?r.shiftKey:r.key:n.code;return{code:n.code,key:i,location:n.location,keyCap:n.keyCap}}"KeyboardEvent"in t&&"defineProperty"in Object&&function(){function t(t,e,n){e in t||Object.defineProperty(t,e,n)}if(t(KeyboardEvent.prototype,"code",{get:function(){var t=v(this);return t?t.code:""}}),"key"in KeyboardEvent.prototype){var e=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var t=e.get.call(this);return m.hasOwnProperty(t)?m[t]:t}})}t(KeyboardEvent.prototype,"key",{get:function(){var t=v(this);return t&&"key"in t?t.key:"Unidentified"}}),t(KeyboardEvent.prototype,"location",{get:function(){var t=v(this);return t&&"location"in t?t.location:n}}),t(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in t.KeyboardEvent||(t.KeyboardEvent.queryKeyCap=function(t,e){if(t=String(t),!g.hasOwnProperty(t))return"Undefined";if(e&&"en-us"!==String(e).toLowerCase())throw Error("Unsupported locale");var n=g[t];return n.keyCap||n.code||"Undefined"}),t.identifyKey=function(t){if(!("code"in t)){var e=v(t);t.code=e?e.code:"",t.key=e&&"key"in e?e.key:"Unidentified",t.location="location"in t?t.location:"keyLocation"in t?t.keyLocation:e&&"location"in e?e.location:n,t.locale=""}}}(window)),k}const I=(t,e)=>{const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},D=t=>t*(Math.PI/180),L=t=>t*(180/Math.PI),U=new Map,F=t=>{U.has(t)&&clearTimeout(U.get(t)),U.set(t,setTimeout(t,100))},z=(t,e,n)=>{const r=e.split(/[ ,]+/g);let i;for(let e=0;e<r.length;e+=1)i=r[e],t.addEventListener?t.addEventListener(i,n,!1):t.attachEvent&&t.attachEvent(i,n)},B=(t,e,n)=>{const r=e.split(/[ ,]+/g);let i;for(let e=0;e<r.length;e+=1)i=r[e],t.removeEventListener?t.removeEventListener(i,n):t.detachEvent&&t.detachEvent(i,n)},j=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),V=()=>({x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}),G=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},H=(t,e,n)=>{const r=W(t);for(let t in r)if(r.hasOwnProperty(t))if("string"==typeof e)r[t]=e+" "+n;else{let i="";for(let t=0,r=e.length;t<r;t+=1)i+=e[t]+" "+n+", ";r[t]=i.slice(0,-2)}return r},W=t=>{const e={};e[t]="";return["webkit","Moz","o"].forEach((function(n){e[n+t.charAt(0).toUpperCase()+t.slice(1)]=""})),e},q=(t,e)=>{for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},$=(t,e)=>{if(t.length)for(let n=0,r=t.length;n<r;n+=1)e(t[n]);else e(t)};var X,Y=!!("ontouchstart"in window),K=!!window.PointerEvent,Z=!!window.MSPointerEvent,J={start:"mousedown",move:"mousemove",end:"mouseup"},Q={};function tt(){}function et(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=et.id,et.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function nt(t,e){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=t,n.id=nt.id,nt.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(e),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);const r=getComputedStyle(n.options.zone.parentElement);return r&&"flex"===r.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.bindings(),n.begin(),n.nipples}function rt(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=V(),e.config(t),e.prepareCollections();var n=function(){var t;e.collections.forEach((function(n){n.forEach((function(n){t=n.el.getBoundingClientRect(),n.position={x:e.scroll.x+t.left,y:e.scroll.y+t.top}}))}))};z(window,"resize",(function(){F(n)}));var r=function(){e.scroll=V()};return z(window,"scroll",(function(){F(r)})),e.collections}K?X={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Z?X={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Y?(X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},Q=J):X=J,tt.prototype.on=function(t,e){var n,r=this,i=t.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var s=0;s<i.length;s+=1)n=i[s],r._handlers_[n]=r._handlers_[n]||[],r._handlers_[n].push(e);return r},tt.prototype.off=function(t,e){var n=this;return n._handlers_=n._handlers_||{},void 0===t?n._handlers_={}:void 0===e?n._handlers_[t]=null:n._handlers_[t]&&n._handlers_[t].indexOf(e)>=0&&n._handlers_[t].splice(n._handlers_[t].indexOf(e),1),n},tt.prototype.trigger=function(t,e){var n,r=this,i=t.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var s=0;s<i.length;s+=1)n=i[s],r._handlers_[n]&&r._handlers_[n].length&&r._handlers_[n].forEach((function(t){t.call(r,{type:n,target:r},e)}))},tt.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=((t,e)=>{const n={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?n[r]=e[r]:t.hasOwnProperty(r)&&(n[r]=t[r]);return n})(e.options,t))},tt.prototype.bindEvt=function(t,e){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[e]=function(){"function"==typeof n["on"+e]?n["on"+e].apply(n,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},z(t,X[e],n._domHandlers_[e]),Q[e]&&z(t,Q[e],n._domHandlers_[e]),n},tt.prototype.unbindEvt=function(t,e){var n=this;return n._domHandlers_=n._domHandlers_||{},B(t,X[e],n._domHandlers_[e]),Q[e]&&B(t,Q[e],n._domHandlers_[e]),delete n._domHandlers_[e],this},et.prototype=new tt,et.constructor=et,et.id=0,et.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},et.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=((t,e)=>{const n=W(t);for(let t in n)n.hasOwnProperty(t)&&(n[t]=e);return n})("borderRadius","50%"),n=H("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},q(r.el,n),"circle"===this.options.shape&&q(r.back,e),q(r.front,e),this.applyStyles(r),this},et.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var n in t[e])this.ui[e].style[n]=t[e][n];return this},et.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},et.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},et.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},et.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout((function(){e.ui.el.style.opacity=1}),0),e.showTimeout=setTimeout((function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)}),e.options.fadeTime)),e},et.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout((function(){var n="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=n,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)}),e.options.fadeTime),e.options.restJoystick){const n=e.options.restJoystick,r={};r.x=!0===n||!1!==n.x?0:e.instance.frontPosition.x,r.y=!0===n||!1!==n.y?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e},et.prototype.setPosition=function(t,e){var n=this;n.frontPosition={x:e.x,y:e.y};var r=n.options.fadeTime+"ms",i={};i.front=H("transition",["transform"],r);var s={front:{}};s.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(i),n.applyStyles(s),n.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(n),n.restCallback()}),n.options.fadeTime)},et.prototype.restCallback=function(){var t=this,e={};e.front=H("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)},et.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},et.prototype.computeDirection=function(t){var e,n,r,i=t.angle.radian,s=Math.PI/4,o=Math.PI/2;if(i>s&&i<3*s&&!t.lockX?e="up":i>-s&&i<=s&&!t.lockY?e="left":i>3*-s&&i<=-s&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(n=i>-o&&i<o?"left":"right"),t.lockX||(r=i>0?"up":"down"),t.force>this.options.threshold){var a,l={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(l[a]=this.direction[a]);var u={};for(a in this.direction={x:n,y:r,angle:e},t.direction=this.direction,l)l[a]===this.direction[a]&&(u[a]=!0);if(u.x&&u.y&&u.angle)return t;u.x&&u.y||this.trigger("plain",t),u.x||this.trigger("plain:"+n,t),u.y||this.trigger("plain:"+r,t),u.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t},nt.prototype=new tt,nt.constructor=nt,nt.id=0,nt.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(t){if(void 0===t)return e[0];for(var n=0,r=e.length;n<r;n+=1)if(e[n].identifier===t)return e[n];return!1}},nt.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},nt.prototype.begin=function(){var t=this,e=t.options;if("static"===e.mode){var n=t.createNipple(e.position,t.manager.getIdentifier());n.add(),t.idles.push(n)}},nt.prototype.createNipple=function(t,e){var n=this,r=n.manager.scroll,i={},s=n.options,o=n.parentIsFlex?r.x:r.x+n.box.left,a=n.parentIsFlex?r.y:r.y+n.box.top;if(t.x&&t.y)i={x:t.x-o,y:t.y-a};else if(t.top||t.right||t.bottom||t.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=t.top,l.style.right=t.right,l.style.bottom=t.bottom,l.style.left=t.left,l.style.position="absolute",s.zone.appendChild(l);var u=l.getBoundingClientRect();s.zone.removeChild(l),i=t,t={x:u.left+r.x,y:u.top+r.y}}var h=new et(n,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(G(h.ui.el,i),G(h.ui.front,h.frontPosition)),n.nipples.push(h),n.trigger("added "+h.identifier+":added",h),n.manager.trigger("added "+h.identifier+":added",h),n.bindNipple(h),h},nt.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},nt.prototype.bindNipple=function(t){var e,n=this,r=function(t,r){e=t.type+" "+r.id+":"+t.type,n.trigger(e,r)};t.on("destroyed",n.onDestroyed.bind(n)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)},nt.prototype.pressureFn=function(t,e,n){var r=this,i=0;clearInterval(r.pressureIntervals[n]),r.pressureIntervals[n]=setInterval(function(){var n=t.force||t.pressure||t.webkitForce||0;n!==i&&(e.trigger("pressure",n),r.trigger("pressure "+e.identifier+":pressure",n),i=n)}.bind(r),100)},nt.prototype.onstart=function(t){var e=this,n=e.options,r=t;t=j(t),e.updateBox();return $(t,(function(i){e.actives.length<n.maxNumberOfNipples?e.processOnStart(i):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach((function(n){if(Object.values(r.touches).findIndex((function(t){return t.identifier===n}))<0){var i=[t[0]];i.identifier=n,e.processOnEnd(i)}})),e.actives.length<n.maxNumberOfNipples&&e.processOnStart(i))})),e.manager.bindDocument(),!1},nt.prototype.processOnStart=function(t){var e,n=this,r=n.options,i=n.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,o={x:t.pageX,y:t.pageY},a=n.getOrCreate(i,o);a.identifier!==i&&n.manager.removeIdentifier(a.identifier),a.identifier=i;var l=function(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),s>0&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)};if((e=n.idles.indexOf(a))>=0&&n.idles.splice(e,1),n.actives.push(a),n.ids.push(a.identifier),"semi"!==r.mode)l(a);else{if(!(I(o,a.position)<=r.catchDistance))return a.destroy(),void n.processOnStart(t);l(a)}return a},nt.prototype.getOrCreate=function(t,e){var n,r=this,i=r.options;return/(semi|static)/.test(i.mode)?(n=r.idles[0])?(r.idles.splice(0,1),n):"semi"===i.mode?r.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):n=r.createNipple(e,t)},nt.prototype.processOnMove=function(t){var e=this,n=e.options,r=e.manager.getIdentifier(t),i=e.nipples.get(r),s=e.manager.scroll;if((t=>isNaN(t.buttons)?0!==t.pressure:0!==t.buttons)(t)){if(!i)return console.error("Found zombie joystick with ID "+r),void e.manager.removeIdentifier(r);if(n.dynamicPage){var o=i.el.getBoundingClientRect();i.position={x:s.x+o.left,y:s.y+o.top}}i.identifier=r;var a=i.options.size/2,l={x:t.pageX,y:t.pageY};n.lockX&&(l.y=i.position.y),n.lockY&&(l.x=i.position.x);var u,h,c=I(l,i.position),d=((t,e)=>{const n=e.x-t.x,r=e.y-t.y;return L(Math.atan2(r,n))})(l,i.position),p=D(d),f=c/a,m={distance:c,position:l};if("circle"===i.options.shape?(u=Math.min(c,a),h=((t,e,n)=>{const r={x:0,y:0};return n=D(n),r.x=t.x-e*Math.cos(n),r.y=t.y-e*Math.sin(n),r})(i.position,u,d)):(h=((t,e,n)=>({x:Math.min(Math.max(t.x,e.x-n),e.x+n),y:Math.min(Math.max(t.y,e.y-n),e.y+n)}))(l,i.position,a),u=I(h,i.position)),n.follow){if(c>a){let t=l.x-h.x,n=l.y-h.y;i.position.x+=t,i.position.y+=n,i.el.style.top=i.position.y-(e.box.top+s.y)+"px",i.el.style.left=i.position.x-(e.box.left+s.x)+"px",c=I(l,i.position)}}else l=h,c=u;var g=l.x-i.position.x,y=l.y-i.position.y;i.frontPosition={x:g,y:y},n.dataOnly||(i.ui.front.style.transform="translate("+g+"px,"+y+"px)");var v={identifier:i.identifier,position:l,force:f,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:p,degree:d},vector:{x:g/a,y:-y/a},raw:m,instance:i,lockX:n.lockX,lockY:n.lockY};(v=i.computeDirection(v)).angle={radian:D(180-d),degree:180-d},i.trigger("move",v),e.trigger("move "+i.id+":move",v)}else this.processOnEnd(t)},nt.prototype.processOnEnd=function(t){var e=this,n=e.options,r=e.manager.getIdentifier(t),i=e.nipples.get(r),s=e.manager.removeIdentifier(i.identifier);i&&(n.dataOnly||i.hide((function(){"dynamic"===n.mode&&(i.trigger("removed",i),e.trigger("removed "+i.id+":removed",i),e.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(e.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),e.trigger("end "+i.id+":end",i),e.ids.indexOf(i.identifier)>=0&&e.ids.splice(e.ids.indexOf(i.identifier),1),e.actives.indexOf(i)>=0&&e.actives.splice(e.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?e.idles.push(i):e.nipples.indexOf(i)>=0&&e.nipples.splice(e.nipples.indexOf(i),1),e.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(e.manager.ids[s.id]=s.identifier))},nt.prototype.onDestroyed=function(t,e){var n=this;n.nipples.indexOf(e)>=0&&n.nipples.splice(n.nipples.indexOf(e),1),n.actives.indexOf(e)>=0&&n.actives.splice(n.actives.indexOf(e),1),n.idles.indexOf(e)>=0&&n.idles.splice(n.idles.indexOf(e),1),n.ids.indexOf(e.identifier)>=0&&n.ids.splice(n.ids.indexOf(e.identifier),1),n.manager.removeIdentifier(e.identifier),n.manager.unbindDocument()},nt.prototype.destroy=function(){var t=this;for(var e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},rt.prototype=new tt,rt.constructor=rt,rt.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var n;return t.collections.every((function(t){return!(n=t.get(e))})),n}},rt.prototype.create=function(t){return this.createCollection(t)},rt.prototype.createCollection=function(t){var e=this,n=new nt(e,t);return e.bindCollection(n),e.collections.push(n),n},rt.prototype.bindCollection=function(t){var e,n=this,r=function(t,r){e=t.type+" "+r.id+":"+t.type,n.trigger(e,r)};t.on("destroyed",n.onDestroyed.bind(n)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)},rt.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},rt.prototype.unbindDocument=function(t){var e=this;Object.keys(e.ids).length&&!0!==t||(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)},rt.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},rt.prototype.removeIdentifier=function(t){var e={};for(var n in this.ids)if(this.ids[n]===t){e.id=n,e.identifier=this.ids[n],delete this.ids[n];break}return e},rt.prototype.onmove=function(t){return this.onAny("move",t),!1},rt.prototype.onend=function(t){return this.onAny("end",t),!1},rt.prototype.oncancel=function(t){return this.onAny("end",t),!1},rt.prototype.onAny=function(t,e){var n,r=this,i="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=j(e);var s=function(t,e,n){n.ids.indexOf(e)>=0&&(n[i](t),t._found_=!0)};return $(e,(function(t){n=r.getIdentifier(t),$(r.collections,s.bind(null,t,n)),t._found_||r.removeIdentifier(n)})),!1},rt.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},rt.prototype.onDestroyed=function(t,e){var n=this;if(n.collections.indexOf(e)<0)return!1;n.collections.splice(n.collections.indexOf(e),1)};const it=new rt;var st,ot=function(t){return it.create(t)};function at(){return st||(st=1,m||(m=1,AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(t){const e=this.el;this.active&&this.checkpoint!==t&&(this.checkpoint&&e.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=t,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(e.emit("navigation-start",{checkpoint:t}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,e.emit("navigation-end",{checkpoint:t}),e.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(!this.active)return;const t=this.data,e=this.offset,n=this.position,r=this.targetPosition,i=this.checkpoint;return this.sync(),n.distanceTo(r)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:i}),e.set(0,0,0)):(e.setLength(t.animateSpeed),e)},sync:function(){const t=this.offset,e=this.position,n=this.targetPosition;e.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(n),n.add(this.checkpoint.components.checkpoint.getOffset()),t.copy(n).sub(e)}})),S(),function(){if(A)return E;A=1,O();const t=window.KeyboardEvent;E=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const t=this.data,e=this.getKeys();return this.dVelocity.set(0,0,0),t.enabled&&((e.KeyW||e.ArrowUp)&&(this.dVelocity.z-=1),(e.KeyA||e.ArrowLeft)&&(this.dVelocity.x-=1),(e.KeyS||e.ArrowDown)&&(this.dVelocity.z+=1),(e.KeyD||e.ArrowRight)&&(this.dVelocity.x+=1),e.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const t in this.localKeys)this.localKeys.hasOwnProperty(t)&&delete this.localKeys[t]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(t){AFRAME.utils.shouldCaptureKeyEvent(t)&&(this.localKeys[t.code]=!0,this.emit(t))},onKeyUp:function(t){AFRAME.utils.shouldCaptureKeyEvent(t)&&(delete this.localKeys[t.code],this.emit(t))},onBlur:function(){for(const t in this.localKeys)this.localKeys.hasOwnProperty(t)&&delete this.localKeys[t]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new t(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(t){return t in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const t=this.el.sceneEl.components["proxy-controls"];return t&&t.isConnected()}})}(),C||(C=1,AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const t=this.el.sceneEl,e=t.canvas;if(!e)return void t.addEventListener("render-target-loaded",this.addEventListeners.bind(this));e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd,{passive:!0});const n=t.getAttribute("vr-mode-ui");n&&n.cardboardModeEnabled&&t.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const t=this.el.sceneEl&&this.el.sceneEl.canvas;t&&(t.removeEventListener("touchstart",this.onTouchStart),t.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(t){this.direction=-1,this.data.reverseEnabled&&t.touches&&2===t.touches.length&&(this.direction=1),t.preventDefault()},onTouchEnd:function(t){this.direction=0,t.preventDefault()},onEnterVR:function(){const t=this.el.sceneEl.xrSession;t&&(t.addEventListener("selectstart",this.onTouchStart),t.addEventListener("selectend",this.onTouchEnd))}})),function(){if(N)return R;N=1;const t="-controls";R=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const t=this.el;this.data.camera||(this.data.camera=t.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,t.sceneEl.hasLoaded?this.injectControls():t.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){const n=this.el,r=this.data,i=n.sceneEl.systems.nav;if(n.sceneEl.hasLoaded&&this.injectControls(),i&&r.constrainToNavMesh!==e.constrainToNavMesh&&(r.constrainToNavMesh?i.addAgent(this):i.removeAgent(this)),r.enabled!==e.enabled)for(let e=0;e<r.controls.length;e++){const n=r.controls[e]+t;this.el.setAttribute(n,{enabled:this.data.enabled})}},injectControls:function(){const e=this.data;for(let n=0;n<e.controls.length;n++){const r=e.controls[n]+t;this.el.setAttribute(r,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3;return function(r,i){if(!i)return;const s=this.el,o=this.data;if(!o.enabled)return;this.updateVelocityCtrl();const a=this.velocityCtrl,l=this.velocity;if(a)if(i/1e3>.2?l.set(0,0,0):this.updateVelocity(i),o.constrainToNavMesh&&!1!==a.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;t.copy(s.object3D.position),e.copy(l).multiplyScalar(i/1e3).add(t);const r=s.sceneEl.systems.nav;this.navGroup=null===this.navGroup?r.getGroup(t):this.navGroup,this.navNode=this.navNode||r.getNode(t,this.navGroup),this.navNode=r.clampStep(t,e,this.navGroup,this.navNode,n),s.object3D.position.copy(n)}else s.hasAttribute("velocity")?s.setAttribute("velocity",l):(s.object3D.position.x+=l.x*i/1e3,s.object3D.position.y+=l.y*i/1e3,s.object3D.position.z+=l.z*i/1e3)}}(),updateVelocityCtrl:function(){const e=this.data;if(e.enabled){for(let n=0,r=e.controls.length;n<r;n++){const r=this.el.components[e.controls[n]+t];if(r&&r.isVelocityActive())return void(this.velocityCtrl=r)}this.velocityCtrl=null}},updateVelocity:function(){const t=new THREE.Vector2,e=new THREE.Quaternion;return function(n){let r;const i=this.el,s=this.velocityCtrl,o=this.velocity,a=this.data;if(s){if(!s.getVelocityDelta){if(s.getVelocity)return void o.copy(s.getVelocity());if(s.getPositionDelta)return void o.copy(s.getPositionDelta(n).multiplyScalar(1e3/n));throw new Error("Incompatible movement controls: ",s)}r=s.getVelocityDelta(n)}if(i.hasAttribute("velocity")&&!a.constrainToNavMesh&&o.copy(this.el.getAttribute("velocity")),r&&a.enabled){const n=a.camera;e.copy(n.object3D.quaternion),e.premultiply(i.object3D.quaternion),r.applyQuaternion(e);const s=r.length();a.fly?(o.copy(r),o.multiplyScalar(16.66667*this.data.speed)):(t.set(r.x,r.z),t.setLength(s*this.data.speed*16.66667),o.x=t.x,o.y=0,o.z=t.y),0===o.x&&0===o.y&&0===o.z||(this.eventDetail.velocity=o,this.el.emit("moved",this.eventDetail))}}}()})}(),P||(P=1,AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const t=this.data,e=this.el.sceneEl;switch(e.addEventListener("axismove",this.onAxisMove),t.mode){case"swipe":case"touch":e.addEventListener("trackpadtouchstart",this.onTouchStart),e.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":e.addEventListener("trackpaddown",this.onTouchStart),e.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){const t=this.el.sceneEl;t.removeEventListener("axismove",this.onAxisMove),t.removeEventListener("trackpadtouchstart",this.onTouchStart),t.removeEventListener("trackpadtouchend",this.onTouchEnd),t.removeEventListener("trackpaddown",this.onTouchStart),t.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(t){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}t.preventDefault()},onTouchEnd:function(t){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,t.preventDefault()},onAxisMove:function(t){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(t);case"touch":case"press":return this.handleTouchAxis(t)}},handleSwipeAxis:function(t){const e=this.data,n=t.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=n[0],this.startingAxisData[1]=n[1]),this.startingAxisData.length>0){let t=0,r=0;e.enableNegX&&n[0]<this.startingAxisData[0]&&(t=-1),e.enablePosX&&n[0]>this.startingAxisData[0]&&(t=1),e.enablePosZ&&n[1]>this.startingAxisData[1]&&(r=-1),e.enableNegZ&&n[1]<this.startingAxisData[1]&&(r=1);const i=Math.abs(this.startingAxisData[1]-n[1]);Math.abs(this.startingAxisData[0]-n[0])>i?(this.zVel=0,this.xVel=t,this.isMoving=!0):(this.xVel=0,this.zVel=r,this.isMoving=!0)}},handleTouchAxis:function(t){const e=this.data,n=t.detail.axis;let r=0,i=0;e.enableNegX&&n[0]<0&&(r=-1),e.enablePosX&&n[0]>0&&(r=1),e.enablePosZ&&n[1]>0&&(i=-1),e.enableNegZ&&n[1]<0&&(i=1),Math.abs(n[0])>Math.abs(n[1])?(this.zVel=0,this.xVel=r):(this.xVel=0,this.zVel=i)}}))),w}AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const t=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=t.pitchObject,this.yawObject=t.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(t){this.data.moveJoystickPosition===t.moveJoystickPosition&&this.data.sideMargin===t.sideMargin&&this.data.bottomMargin===t.bottomMargin&&this.data.mode===t.mode||this.removeMoveJoystick(),this.data.lookJoystickPosition===t.lookJoystickPosition&&this.data.sideMargin===t.sideMargin&&this.data.bottomMargin===t.bottomMargin&&this.data.mode===t.mode||this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const t=this.moveData.force<1?this.moveData.force:1,e=this.moveData.angle.radian,n=Math.cos(e)*t,r=-Math.sin(e)*t;this.dVelocity.set(n,0,r)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(t){if(!this.isRotationActive())return;const e=this.lookData.force<1?this.lookData.force:1,n=this.lookData.angle.radian,r=this.lookVector;r.x=Math.cos(n)*e,r.y=Math.sin(n)*e,r.multiplyScalar(this.data.rotationSensitivity*t/1e3),this.yawObject.rotation.y-=r.x;let i=this.pitchObject.rotation.x+r.y;i=Math.max(-Math.PI/2,Math.min(Math.PI/2,i)),this.pitchObject.rotation.x=i},tick:function(t,e){this.updateRotation(e)},initLeftZone(){const t=document.createElement("div");t.setAttribute("id","joystickLeftZone"),t.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(t),this.leftZone=t},initRightZone(){const t=document.createElement("div");t.setAttribute("id","joystickRightZone"),t.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(t),this.rightZone=t},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const t={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",t.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=ot(t),this.moveJoystick.on("move",((t,e)=>{this.moveData=e,this.moving=!0})),this.moveJoystick.on("end",((t,e)=>{this.moving=!1}))},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const t={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",t.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=ot(t),this.lookJoystick.on("move",((t,e)=>{this.lookData=e,this.rotating=!0})),this.lookJoystick.on("end",((t,e)=>{this.rotating=!1}))},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}});var lt,ut,ht={};function ct(){if(ut)return lt;ut=1;const t={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function e(t){return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}return lt=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(t)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const t=this.el.getObject3D("mesh");t?this.load(t):this.el.addEventListener("model-loaded",(t=>{this.load(t.detail.model)}))},load:function(t){const e=this.el;this.model=t,this.mixer=new THREE.AnimationMixer(t),this.mixer.addEventListener("loop",(t=>{e.emit("animation-loop",{action:t.action,loopDelta:t.loopDelta})})),this.mixer.addEventListener("finished",(t=>{e.emit("animation-finished",{action:t.action,direction:t.direction})})),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;const n=this.data,r=AFRAME.utils.diff(n,e);if("clip"in r)return this.stopAction(),void(n.clip&&this.playAction());this.activeActions.forEach((e=>{"duration"in r&&n.duration&&e.setDuration(n.duration),"clampWhenFinished"in r&&(e.clampWhenFinished=n.clampWhenFinished),("loop"in r||"repetitions"in r)&&e.setLoop(t[n.loop],n.repetitions),"timeScale"in r&&e.setEffectiveTimeScale(n.timeScale)}))},stopAction:function(){const t=this.data;for(let e=0;e<this.activeActions.length;e++)t.crossFadeDuration?this.activeActions[e].fadeOut(t.crossFadeDuration):this.activeActions[e].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const n=this.model,r=this.data,i=n.animations||(n.geometry||{}).animations||[];if(!i.length)return;const s=r.useRegExp?r.clip:function(t){return new RegExp("^"+t.split(/\*+/).map(e).join(".*")+"$")}(r.clip);for(let e,o=0;e=i[o];o++)if(e.name.match(s)){const i=this.mixer.clipAction(e,n);i.enabled=!0,i.clampWhenFinished=r.clampWhenFinished,r.duration&&i.setDuration(r.duration),1!==r.timeScale&&i.setEffectiveTimeScale(r.timeScale),i.startAt(this.mixer.time-r.startAt/1e3),i.setLoop(t[r.loop],r.repetitions).fadeIn(r.crossFadeDuration).play(),this.activeActions.push(i)}},tick:function(t,e){this.mixer&&!isNaN(e)&&this.mixer.update(e/1e3)}}),lt}const dt="attached",pt=1e3,ft=1001,mt=1003,gt=1006,yt=1008,vt=1026,_t=2300,bt=2301,xt=2302,wt="srgb",Mt="srgb-linear",St="display-p3",Tt="display-p3-linear",Et="linear",At="srgb",Ct="rec709",Rt=7680,Nt=2e3,Pt=2001;let kt=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}};const Ot=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let It=1234567;const Dt=Math.PI/180,Lt=180/Math.PI;function Ut(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ot[255&t]+Ot[t>>8&255]+Ot[t>>16&255]+Ot[t>>24&255]+"-"+Ot[255&e]+Ot[e>>8&255]+"-"+Ot[e>>16&15|64]+Ot[e>>24&255]+"-"+Ot[63&n|128]+Ot[n>>8&255]+"-"+Ot[n>>16&255]+Ot[n>>24&255]+Ot[255&r]+Ot[r>>8&255]+Ot[r>>16&255]+Ot[r>>24&255]).toLowerCase()}function Ft(t,e,n){return Math.max(e,Math.min(n,t))}function zt(t,e){return(t%e+e)%e}function Bt(t,e,n){return(1-n)*t+n*e}function jt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Vt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Gt={DEG2RAD:Dt,RAD2DEG:Lt,generateUUID:Ut,clamp:Ft,euclideanModulo:zt,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Bt,damp:function(t,e,n,r){return Bt(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(zt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(It=t);let e=It+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Dt},radToDeg:function(t){return t*Lt},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),u=s((e+r)/2),h=o((e+r)/2),c=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*h,l*c,l*d,a*u);break;case"YZY":t.set(l*d,a*h,l*c,a*u);break;case"ZXZ":t.set(l*c,l*d,a*h,a*u);break;case"XZX":t.set(a*h,l*f,l*p,a*u);break;case"YXY":t.set(l*p,a*h,l*f,a*u);break;case"ZYZ":t.set(l*f,l*p,a*h,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Vt,denormalize:jt};let Ht=class t{constructor(e=0,n=0){t.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ft(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Wt=class t{constructor(e,n,r,i,s,o,a,l,u){t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,u)}set(t,e,n,r,i,s,o,a,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],u=n[4],h=n[7],c=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*y+a*b,i[3]=s*m+o*v+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+u*y+h*b,i[4]=l*m+u*v+h*x,i[7]=l*g+u*_+h*w,i[2]=c*f+d*y+p*b,i[5]=c*m+d*v+p*x,i[8]=c*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8];return e*s*u-e*o*l-n*i*u+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=u*s-o*l,c=o*a-u*i,d=l*i-s*a,p=e*h+n*c+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(r*l-u*n)*f,t[2]=(o*n-r*s)*f,t[3]=c*f,t[4]=(u*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(qt.makeScale(t,e)),this}rotate(t){return this.premultiply(qt.makeRotation(-t)),this}translate(t,e){return this.premultiply(qt.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}};const qt=new Wt;function $t(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const Xt={};const Yt=(new Wt).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Kt=(new Wt).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Zt={[Mt]:{transfer:Et,primaries:Ct,toReference:t=>t,fromReference:t=>t},[wt]:{transfer:At,primaries:Ct,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Tt]:{transfer:Et,primaries:"p3",toReference:t=>t.applyMatrix3(Kt),fromReference:t=>t.applyMatrix3(Yt)},[St]:{transfer:At,primaries:"p3",toReference:t=>t.convertSRGBToLinear().applyMatrix3(Kt),fromReference:t=>t.applyMatrix3(Yt).convertLinearToSRGB()}},Jt=new Set([Mt,Tt]),Qt={enabled:!0,_workingColorSpace:Mt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Jt.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const r=Zt[e].toReference;return(0,Zt[n].fromReference)(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Zt[t].primaries},getTransfer:function(t){return""===t?Et:Zt[t].transfer}};function te(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ee(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let ne,re=class{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ne&&(ne=$t("canvas")),ne.width=t.width,ne.height=t.height;const n=ne.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=ne}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=$t("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*te(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*te(e[t]/255)):e[t]=te(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},ie=0,se=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ie++}),this.uuid=Ut(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(oe(r[e].image)):t.push(oe(r[e]))}else t=oe(r);n.url=t}return e||(t.images[this.uuid]=n),n}};function oe(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?re.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ae=0,le=class t extends kt{constructor(e=t.DEFAULT_IMAGE,n=t.DEFAULT_MAPPING,r=1001,i=1001,s=1006,o=1008,a=1023,l=1009,u=t.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ae++}),this.uuid=Ut(),this.name="",this.source=new se(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case pt:t.x=t.x-Math.floor(t.x);break;case ft:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case pt:t.y=t.y-Math.floor(t.y);break;case ft:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}};le.DEFAULT_IMAGE=null,le.DEFAULT_MAPPING=300,le.DEFAULT_ANISOTROPY=1;let ue=class t{constructor(e=0,n=0,r=0,i=1){t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],u=a[4],h=a[8],c=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-c)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+c)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(u+c)/4,_=(h+f)/4,b=(p+m)/4;return t>a&&t>y?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=v/n,i=_/n):a>y?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=b/r):y<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=b/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(c-u)*(c-u));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(h-f)/y,this.z=(c-u)/y,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},he=class{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],u=n[r+2],h=n[r+3];const c=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=u,void(t[e+3]=h);if(1===o)return t[e+0]=c,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==c||l!==d||u!==p){let t=1-o;const e=a*c+l*d+u*p+h*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+c*i,l=l*t+d*i,u=u*t+p*i,h=h*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+u*u+h*h);a*=t,l*=t,u*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=u,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],u=n[r+3],h=i[s],c=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+u*h+a*d-l*c,t[e+1]=a*p+u*c+l*h-o*d,t[e+2]=l*p+u*d+o*c-a*h,t[e+3]=u*p-o*h-a*c-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),u=o(r/2),h=o(i/2),c=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"YXZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"ZXY":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"ZYX":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"YZX":this._x=c*u*h+l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h-c*d*p;break;case"XZY":this._x=c*u*h-l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],u=e[6],h=e[10],c=n+o+h;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(u-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>h){const t=2*Math.sqrt(1+n-o-h);this._w=(u-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-n-h);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+h-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ft(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,u=e._w;return this._x=n*u+s*o+r*l-i*a,this._y=r*u+s*a+i*o-n*l,this._z=i*u+s*l+n*a-r*o,this._w=s*u-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,o),h=Math.sin((1-e)*u)/l,c=Math.sin(e*u)/l;return this._w=s*h+this._w*c,this._x=n*h+this._x*c,this._y=r*h+this._y*c,this._z=i*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},ce=class t{constructor(e=0,n=0,r=0){t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(pe.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(pe.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),u=2*(o*e-i*r),h=2*(i*n-s*e);return this.x=e+a*l+s*h-o*u,this.y=n+a*u+o*l-i*h,this.z=r+a*h+i*u-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return de.copy(this).projectOnVector(t),this.sub(de)}reflect(t){return this.sub(de.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ft(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const de=new ce,pe=new he;let fe=class{constructor(t=new ce(1/0,1/0,1/0),e=new ce(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(ge.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(ge.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=ge.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,ge):ge.fromBufferAttribute(r,e),ge.applyMatrix4(t.matrixWorld),this.expandByPoint(ge);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),ye.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ye.copy(n.boundingBox)),ye.applyMatrix4(t.matrixWorld),this.union(ye)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ge),ge.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Se),Te.subVectors(this.max,Se),ve.subVectors(t.a,Se),_e.subVectors(t.b,Se),be.subVectors(t.c,Se),xe.subVectors(_e,ve),we.subVectors(be,_e),Me.subVectors(ve,be);let e=[0,-xe.z,xe.y,0,-we.z,we.y,0,-Me.z,Me.y,xe.z,0,-xe.x,we.z,0,-we.x,Me.z,0,-Me.x,-xe.y,xe.x,0,-we.y,we.x,0,-Me.y,Me.x,0];return!!Ce(e,ve,_e,be,Te)&&(e=[1,0,0,0,1,0,0,0,1],!!Ce(e,ve,_e,be,Te)&&(Ee.crossVectors(xe,we),e=[Ee.x,Ee.y,Ee.z],Ce(e,ve,_e,be,Te)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,ge).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(ge).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(me[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),me[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),me[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),me[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),me[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),me[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),me[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),me[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(me)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};const me=[new ce,new ce,new ce,new ce,new ce,new ce,new ce,new ce],ge=new ce,ye=new fe,ve=new ce,_e=new ce,be=new ce,xe=new ce,we=new ce,Me=new ce,Se=new ce,Te=new ce,Ee=new ce,Ae=new ce;function Ce(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Ae.fromArray(t,s);const o=i.x*Math.abs(Ae.x)+i.y*Math.abs(Ae.y)+i.z*Math.abs(Ae.z),a=e.dot(Ae),l=n.dot(Ae),u=r.dot(Ae);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>o)return!1}return!0}const Re=new fe,Ne=new ce,Pe=new ce;let ke=class{constructor(t=new ce,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Re.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ne.subVectors(t,this.center);const e=Ne.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Ne,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Pe.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ne.copy(t.center).add(Pe)),this.expandByPoint(Ne.copy(t.center).sub(Pe))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}};const Oe=new ce,Ie=new ce,De=new ce,Le=new ce,Ue=new ce,Fe=new ce,ze=new ce;let Be=class{constructor(t=new ce,e=new ce(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Oe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Oe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Oe.copy(this.origin).addScaledVector(this.direction,e),Oe.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){Ie.copy(t).add(e).multiplyScalar(.5),De.copy(e).sub(t).normalize(),Le.copy(this.origin).sub(Ie);const i=.5*t.distanceTo(e),s=-this.direction.dot(De),o=Le.dot(this.direction),a=-Le.dot(De),l=Le.lengthSq(),u=Math.abs(1-s*s);let h,c,d,p;if(u>0)if(h=s*a-o,c=s*o-a,p=i*u,h>=0)if(c>=-p)if(c<=p){const t=1/u;h*=t,c*=t,d=h*(h+s*c+2*o)+c*(s*h+c+2*a)+l}else c=i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c=-i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c<=-p?(h=Math.max(0,-(-s*i+o)),c=h>0?-i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l):c<=p?(h=0,c=Math.min(Math.max(-i,-a),i),d=c*(c+2*a)+l):(h=Math.max(0,-(s*i+o)),c=h>0?i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l);else c=s>0?-i:i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(Ie).addScaledVector(De,c),d}intersectSphere(t,e){Oe.subVectors(t.center,this.origin);const n=Oe.dot(this.direction),r=Oe.dot(Oe)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(n=(t.min.x-c.x)*l,r=(t.max.x-c.x)*l):(n=(t.max.x-c.x)*l,r=(t.min.x-c.x)*l),u>=0?(i=(t.min.y-c.y)*u,s=(t.max.y-c.y)*u):(i=(t.max.y-c.y)*u,s=(t.min.y-c.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),h>=0?(o=(t.min.z-c.z)*h,a=(t.max.z-c.z)*h):(o=(t.max.z-c.z)*h,a=(t.min.z-c.z)*h),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Oe)}intersectTriangle(t,e,n,r,i){Ue.subVectors(e,t),Fe.subVectors(n,t),ze.crossVectors(Ue,Fe);let s,o=this.direction.dot(ze);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Le.subVectors(this.origin,t);const a=s*this.direction.dot(Fe.crossVectors(Le,Fe));if(a<0)return null;const l=s*this.direction.dot(Ue.cross(Le));if(l<0)return null;if(a+l>o)return null;const u=-s*Le.dot(ze);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},je=class t{constructor(e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g){t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g)}set(t,e,n,r,i,s,o,a,l,u,h,c,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=u,g[10]=h,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Ve.setFromMatrixColumn(t,0).length(),i=1/Ve.setFromMatrixColumn(t,1).length(),s=1/Ve.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=-a*h,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*h,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t-i*o,e[4]=-s*h,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*h,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=i-t*h,e[8]=r*h+n,e[1]=h,e[5]=s*u,e[9]=-o*u,e[2]=-l*u,e[6]=n*h+r,e[10]=t-i*h}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=-h,e[8]=l*u,e[1]=t*h+i,e[5]=s*u,e[9]=n*h-r,e[2]=r*h-n,e[6]=o*u,e[10]=i*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(He,t,We)}lookAt(t,e,n){const r=this.elements;return Xe.subVectors(t,e),0===Xe.lengthSq()&&(Xe.z=1),Xe.normalize(),qe.crossVectors(n,Xe),0===qe.lengthSq()&&(1===Math.abs(n.z)?Xe.x+=1e-4:Xe.z+=1e-4,Xe.normalize(),qe.crossVectors(n,Xe)),qe.normalize(),$e.crossVectors(Xe,qe),r[0]=qe.x,r[4]=$e.x,r[8]=Xe.x,r[1]=qe.y,r[5]=$e.y,r[9]=Xe.y,r[2]=qe.z,r[6]=$e.z,r[10]=Xe.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],u=n[1],h=n[5],c=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],b=n[15],x=r[0],w=r[4],M=r[8],S=r[12],T=r[1],E=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],k=r[14],O=r[3],I=r[7],D=r[11],L=r[15];return i[0]=s*x+o*T+a*R+l*O,i[4]=s*w+o*E+a*N+l*I,i[8]=s*M+o*A+a*P+l*D,i[12]=s*S+o*C+a*k+l*L,i[1]=u*x+h*T+c*R+d*O,i[5]=u*w+h*E+c*N+d*I,i[9]=u*M+h*A+c*P+d*D,i[13]=u*S+h*C+c*k+d*L,i[2]=p*x+f*T+m*R+g*O,i[6]=p*w+f*E+m*N+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*S+f*C+m*k+g*L,i[3]=y*x+v*T+_*R+b*O,i[7]=y*w+v*E+_*N+b*I,i[11]=y*M+v*A+_*P+b*D,i[15]=y*S+v*C+_*k+b*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],u=t[2],h=t[6],c=t[10],d=t[14];return t[3]*(+i*a*h-r*l*h-i*o*c+n*l*c+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*c+i*s*c-r*s*d+r*l*u-i*a*u)+t[11]*(+e*l*h-e*o*d-i*s*h+n*s*d+i*o*u-n*l*u)+t[15]*(-r*o*u-e*a*h+e*o*c+r*s*h-n*s*c+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=h*m*l-f*c*l+f*a*d-o*m*d-h*a*g+o*c*g,v=p*c*l-u*m*l-p*a*d+s*m*d+u*a*g-s*c*g,_=u*f*l-p*h*l+p*o*d-s*f*d-u*o*g+s*h*g,b=p*h*a-u*f*a-p*o*c+s*f*c+u*o*m-s*h*m,x=e*y+n*v+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=y*w,t[1]=(f*c*i-h*m*i-f*r*d+n*m*d+h*r*g-n*c*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(h*a*i-o*c*i-h*r*l+n*c*l+o*r*d-n*a*d)*w,t[4]=v*w,t[5]=(u*m*i-p*c*i+p*r*d-e*m*d-u*r*g+e*c*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*c*i-u*a*i+u*r*l-e*c*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*h*i-u*f*i-p*n*d+e*f*d+u*n*g-e*h*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(u*o*i-s*h*i-u*n*l+e*h*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(u*f*r-p*h*r+p*n*c-e*f*c-u*n*m+e*h*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*h*r-u*o*r+u*n*a-e*h*a-s*n*c+e*o*c)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,u=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,u*o+n,u*a-r*s,0,l*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,u=s+s,h=o+o,c=i*l,d=i*u,p=i*h,f=s*u,m=s*h,g=o*h,y=a*l,v=a*u,_=a*h,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-v)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(c+g))*x,r[6]=(m+y)*x,r[7]=0,r[8]=(p+v)*w,r[9]=(m-y)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Ve.set(r[0],r[1],r[2]).length();const s=Ve.set(r[4],r[5],r[6]).length(),o=Ve.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Ge.copy(this);const a=1/i,l=1/s,u=1/o;return Ge.elements[0]*=a,Ge.elements[1]*=a,Ge.elements[2]*=a,Ge.elements[4]*=l,Ge.elements[5]*=l,Ge.elements[6]*=l,Ge.elements[8]*=u,Ge.elements[9]*=u,Ge.elements[10]*=u,e.setFromRotationMatrix(Ge),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s,o=2e3){const a=this.elements,l=2*i/(e-t),u=2*i/(n-r),h=(e+t)/(e-t),c=(n+r)/(n-r);let d,p;if(o===Nt)d=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(o!==Pt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-i),p=-s*i/(s-i)}return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,s,o=2e3){const a=this.elements,l=1/(e-t),u=1/(n-r),h=1/(s-i),c=(e+t)*l,d=(n+r)*u;let p,f;if(o===Nt)p=(s+i)*h,f=-2*h;else{if(o!==Pt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*h,f=-1*h}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};const Ve=new ce,Ge=new je,He=new ce(0,0,0),We=new ce(1,1,1),qe=new ce,$e=new ce,Xe=new ce,Ye=new je,Ke=new he;let Ze=class t{constructor(e=0,n=0,r=0,i=t.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],u=r[9],h=r[2],c=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(Ft(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ft(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ft(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Ft(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Ft(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Ft(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Ye.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ye,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ke.setFromEuler(this),this.setFromQuaternion(Ke,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ze.DEFAULT_ORDER="XYZ";let Je=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}},Qe=0;const tn=new ce,en=new he,nn=new je,rn=new ce,sn=new ce,on=new ce,an=new he,ln=new ce(1,0,0),un=new ce(0,1,0),hn=new ce(0,0,1),cn={type:"added"},dn={type:"removed"},pn={type:"childadded",child:null},fn={type:"childremoved",child:null};let mn=class t extends kt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Qe++}),this.uuid=Ut(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DEFAULT_UP.clone();const e=new ce,n=new Ze,r=new he,i=new ce(1,1,1);n._onChange((function(){r.setFromEuler(n,!1)})),r._onChange((function(){n.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new je},normalMatrix:{value:new Wt}}),this.matrix=new je,this.matrixWorld=new je,this.matrixAutoUpdate=t.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=t.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Je,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return en.setFromAxisAngle(t,e),this.quaternion.multiply(en),this}rotateOnWorldAxis(t,e){return en.setFromAxisAngle(t,e),this.quaternion.premultiply(en),this}rotateX(t){return this.rotateOnAxis(ln,t)}rotateY(t){return this.rotateOnAxis(un,t)}rotateZ(t){return this.rotateOnAxis(hn,t)}translateOnAxis(t,e){return tn.copy(t).applyQuaternion(this.quaternion),this.position.add(tn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ln,t)}translateY(t){return this.translateOnAxis(un,t)}translateZ(t){return this.translateOnAxis(hn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(nn.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?rn.copy(t):rn.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),sn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nn.lookAt(sn,rn,this.up):nn.lookAt(rn,sn,this.up),this.quaternion.setFromRotationMatrix(nn),r&&(nn.extractRotation(r.matrixWorld),en.setFromRotationMatrix(nn),this.quaternion.premultiply(en.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(cn),pn.child=t,this.dispatchEvent(pn),pn.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(dn),fn.child=t,this.dispatchEvent(fn),fn.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),nn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),nn.multiply(t.parent.matrixWorld)),t.applyMatrix4(nn),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(cn),pn.child=t,this.dispatchEvent(pn),pn.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sn,t,on),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sn,an,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){const r=e[n];!0!==r.matrixWorldAutoUpdate&&!0!==t||r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),u=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),h.length>0&&(n.nodes=h)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}};mn.DEFAULT_UP=new ce(0,1,0),mn.DEFAULT_MATRIX_AUTO_UPDATE=!0,mn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const gn=new ce,yn=new ce,vn=new ce,_n=new ce,bn=new ce,xn=new ce,wn=new ce,Mn=new ce,Sn=new ce,Tn=new ce;let En=class t{constructor(t=new ce,e=new ce,n=new ce){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),gn.subVectors(t,e),r.cross(gn);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){gn.subVectors(r,e),yn.subVectors(n,e),vn.subVectors(t,e);const s=gn.dot(gn),o=gn.dot(yn),a=gn.dot(vn),l=yn.dot(yn),u=yn.dot(vn),h=s*l-o*o;if(0===h)return i.set(0,0,0),null;const c=1/h,d=(l*a-o*u)*c,p=(s*u-o*a)*c;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,_n)&&(_n.x>=0&&_n.y>=0&&_n.x+_n.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,_n)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,_n.x),a.addScaledVector(s,_n.y),a.addScaledVector(o,_n.z),a)}static isFrontFacing(t,e,n,r){return gn.subVectors(n,e),yn.subVectors(t,e),gn.cross(yn).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return gn.subVectors(this.c,this.b),yn.subVectors(this.a,this.b),.5*gn.cross(yn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return t.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;bn.subVectors(r,n),xn.subVectors(i,n),Mn.subVectors(t,n);const a=bn.dot(Mn),l=xn.dot(Mn);if(a<=0&&l<=0)return e.copy(n);Sn.subVectors(t,r);const u=bn.dot(Sn),h=xn.dot(Sn);if(u>=0&&h<=u)return e.copy(r);const c=a*h-u*l;if(c<=0&&a>=0&&u<=0)return s=a/(a-u),e.copy(n).addScaledVector(bn,s);Tn.subVectors(t,i);const d=bn.dot(Tn),p=xn.dot(Tn);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(xn,o);const m=u*p-d*h;if(m<=0&&h-u>=0&&d-p>=0)return wn.subVectors(i,r),o=(h-u)/(h-u+(d-p)),e.copy(r).addScaledVector(wn,o);const g=1/(m+f+c);return s=f*g,o=c*g,e.copy(n).addScaledVector(bn,s).addScaledVector(xn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};const An={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cn={h:0,s:0,l:0},Rn={h:0,s:0,l:0};function Nn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}let Pn=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=wt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Qt.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=Qt.workingColorSpace){return this.r=t,this.g=e,this.b=n,Qt.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=Qt.workingColorSpace){if(t=zt(t,1),e=Ft(e,0,1),n=Ft(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Nn(i,r,t+1/3),this.g=Nn(i,r,t),this.b=Nn(i,r,t-1/3)}return Qt.toWorkingColorSpace(this,r),this}setStyle(t,e=wt){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=wt){const n=An[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=te(t.r),this.g=te(t.g),this.b=te(t.b),this}copyLinearToSRGB(t){return this.r=ee(t.r),this.g=ee(t.g),this.b=ee(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=wt){return Qt.fromWorkingColorSpace(kn.copy(this),t),65536*Math.round(Ft(255*kn.r,0,255))+256*Math.round(Ft(255*kn.g,0,255))+Math.round(Ft(255*kn.b,0,255))}getHexString(t=wt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Qt.workingColorSpace){Qt.fromWorkingColorSpace(kn.copy(this),e);const n=kn.r,r=kn.g,i=kn.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const u=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=u<=.5?t/(s+o):t/(2-s-o),s){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=u,t}getRGB(t,e=Qt.workingColorSpace){return Qt.fromWorkingColorSpace(kn.copy(this),e),t.r=kn.r,t.g=kn.g,t.b=kn.b,t}getStyle(t=wt){Qt.fromWorkingColorSpace(kn.copy(this),t);const e=kn.r,n=kn.g,r=kn.b;return t!==wt?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Cn),this.setHSL(Cn.h+t,Cn.s+e,Cn.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Cn),t.getHSL(Rn);const n=Bt(Cn.h,Rn.h,e),r=Bt(Cn.s,Rn.s,e),i=Bt(Cn.l,Rn.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const kn=new Pn;Pn.NAMES=An;let On=0,In=class extends kt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:On++}),this.uuid=Ut(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Pn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rt,this.stencilZFail=Rt,this.stencilZPass=Rt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Rt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Rt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}},Dn=class extends In{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ze,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};const Ln=new ce,Un=new Ht;let Fn=class{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){var t;return(t="THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.")in Xt||(Xt[t]=!0,console.warn(t)),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Un.fromBufferAttribute(this,e),Un.applyMatrix3(t),this.setXY(e,Un.x,Un.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyMatrix3(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyMatrix4(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.applyNormalMatrix(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ln.fromBufferAttribute(this,e),Ln.transformDirection(t),this.setXYZ(e,Ln.x,Ln.y,Ln.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=jt(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Vt(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=jt(e,this.array)),e}setX(t,e){return this.normalized&&(e=Vt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=jt(e,this.array)),e}setY(t,e){return this.normalized&&(e=Vt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=jt(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Vt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=jt(e,this.array)),e}setW(t,e){return this.normalized&&(e=Vt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Vt(e,this.array),n=Vt(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Vt(e,this.array),n=Vt(n,this.array),r=Vt(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Vt(e,this.array),n=Vt(n,this.array),r=Vt(r,this.array),i=Vt(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}},zn=class extends Fn{constructor(t,e,n){super(new Uint16Array(t),e,n)}},Bn=class extends Fn{constructor(t,e,n){super(new Uint32Array(t),e,n)}},jn=class extends Fn{constructor(t,e,n){super(new Float32Array(t),e,n)}},Vn=0;const Gn=new je,Hn=new mn,Wn=new ce,qn=new fe,$n=new fe,Xn=new ce;let Yn=class t extends kt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vn++}),this.uuid=Ut(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?Bn:zn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Wt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Gn.makeRotationFromQuaternion(t),this.applyMatrix4(Gn),this}rotateX(t){return Gn.makeRotationX(t),this.applyMatrix4(Gn),this}rotateY(t){return Gn.makeRotationY(t),this.applyMatrix4(Gn),this}rotateZ(t){return Gn.makeRotationZ(t),this.applyMatrix4(Gn),this}translate(t,e,n){return Gn.makeTranslation(t,e,n),this.applyMatrix4(Gn),this}scale(t,e,n){return Gn.makeScale(t,e,n),this.applyMatrix4(Gn),this}lookAt(t){return Hn.lookAt(t),Hn.updateMatrix(),this.applyMatrix4(Hn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wn).negate(),this.translate(Wn.x,Wn.y,Wn.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new jn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new fe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new ce(-1/0,-1/0,-1/0),new ce(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];qn.setFromBufferAttribute(n),this.morphTargetsRelative?(Xn.addVectors(this.boundingBox.min,qn.min),this.boundingBox.expandByPoint(Xn),Xn.addVectors(this.boundingBox.max,qn.max),this.boundingBox.expandByPoint(Xn)):(this.boundingBox.expandByPoint(qn.min),this.boundingBox.expandByPoint(qn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ke);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new ce,1/0);if(t){const n=this.boundingSphere.center;if(qn.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];$n.setFromBufferAttribute(n),this.morphTargetsRelative?(Xn.addVectors(qn.min,$n.min),qn.expandByPoint(Xn),Xn.addVectors(qn.max,$n.max),qn.expandByPoint(Xn)):(qn.expandByPoint($n.min),qn.expandByPoint($n.max))}qn.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Xn.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Xn));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)Xn.fromBufferAttribute(s,e),o&&(Wn.fromBufferAttribute(t,e),Xn.add(Wn)),r=Math.max(r,n.distanceToSquared(Xn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Fn(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<n.count;t++)o[t]=new ce,a[t]=new ce;const l=new ce,u=new ce,h=new ce,c=new Ht,d=new Ht,p=new Ht,f=new ce,m=new ce;function g(t,e,r){l.fromBufferAttribute(n,t),u.fromBufferAttribute(n,e),h.fromBufferAttribute(n,r),c.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),u.sub(l),h.sub(l),d.sub(c),p.sub(c);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const v=new ce,_=new ce,b=new ce,x=new ce;function w(t){b.fromBufferAttribute(r,t),x.copy(b);const e=o[t];v.copy(e),v.sub(b.multiplyScalar(b.dot(e))).normalize(),_.crossVectors(x,e);const n=_.dot(a[t])<0?-1:1;s.setXYZW(t,v.x,v.y,v.z,n)}for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Fn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new ce,i=new ce,s=new ce,o=new ce,a=new ce,l=new ce,u=new ce,h=new ce;if(t)for(let c=0,d=t.count;c<d;c+=3){const d=t.getX(c+0),p=t.getX(c+1),f=t.getX(c+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),a.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),n.setXYZ(t+0,u.x,u.y,u.z),n.setXYZ(t+1,u.x,u.y,u.z),n.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Xn.fromBufferAttribute(t,e),Xn.normalize(),t.setXYZ(e,Xn.x,Xn.y,Xn.z)}toNonIndexed(){function e(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Fn(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new t,r=this.index.array,i=this.attributes;for(const t in i){const s=e(i[t],r);n.setAttribute(t,s)}const s=this.morphAttributes;for(const t in s){const i=[],o=s[t];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],r);i.push(n)}n.morphAttributes[t]=i}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];n.addGroup(e.start,e.count,e.materialIndex)}return n}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const Kn=new je,Zn=new Be,Jn=new ke,Qn=new ce,tr=new ce,er=new ce,nr=new ce,rr=new ce,ir=new ce,sr=new Ht,or=new Ht,ar=new Ht,lr=new ce,ur=new ce,hr=new ce,cr=new ce,dr=new ce;let pr=class extends mn{constructor(t=new Yn,e=new Dn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(i&&o){ir.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(rr.fromBufferAttribute(a,t),s?ir.addScaledVector(rr,r):ir.addScaledVector(rr.sub(e),r))}e.add(ir)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Jn.copy(n.boundingSphere),Jn.applyMatrix4(i),Zn.copy(t.ray).recast(t.near),!1===Jn.containsPoint(Zn.origin)){if(null===Zn.intersectSphere(Jn,Qn))return;if(Zn.origin.distanceToSquared(Qn)>(t.far-t.near)**2)return}Kn.copy(i).invert(),Zn.copy(t.ray).applyMatrix4(Kn),null!==n.boundingBox&&!1===Zn.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Zn)}}_computeIntersections(t,e,n){let r;const i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,h=i.attributes.normal,c=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let i=0,a=c.length;i<a;i++){const a=c[i],p=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=fr(this,p,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=fr(this,s,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,o=c.length;i<o;i++){const o=c[i],p=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=fr(this,p,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=fr(this,s,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}};function fr(t,e,n,r,i,s,o,a,l,u){t.getVertexPosition(a,tr),t.getVertexPosition(l,er),t.getVertexPosition(u,nr);const h=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;dr.copy(a),dr.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(dr);return u<n.near||u>n.far?null:{distance:u,point:dr.clone(),object:t}}(t,e,n,r,tr,er,nr,cr);if(h){i&&(sr.fromBufferAttribute(i,a),or.fromBufferAttribute(i,l),ar.fromBufferAttribute(i,u),h.uv=En.getInterpolation(cr,tr,er,nr,sr,or,ar,new Ht)),s&&(sr.fromBufferAttribute(s,a),or.fromBufferAttribute(s,l),ar.fromBufferAttribute(s,u),h.uv1=En.getInterpolation(cr,tr,er,nr,sr,or,ar,new Ht)),o&&(lr.fromBufferAttribute(o,a),ur.fromBufferAttribute(o,l),hr.fromBufferAttribute(o,u),h.normal=En.getInterpolation(cr,tr,er,nr,lr,ur,hr,new ce),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const t={a:a,b:l,c:u,normal:new ce,materialIndex:0};En.getNormal(tr,er,nr,t.normal),h.face=t}return h}let mr=class t extends Yn{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],u=[],h=[];let c=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,y){const v=s/m,_=p/g,b=s/2,x=p/2,w=f/2,M=m+1,S=g+1;let T=0,E=0;const A=new ce;for(let s=0;s<S;s++){const o=s*_-x;for(let a=0;a<M;a++){const c=a*v-b;A[t]=c*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=c+e+M*t,r=c+e+M*(t+1),i=c+(e+1)+M*(t+1),s=c+(e+1)+M*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(d,E,y),d+=E,c+=T}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new jn(l,3)),this.setAttribute("normal",new jn(u,3)),this.setAttribute("uv",new jn(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}},gr=class extends mn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new je,this.projectionMatrix=new je,this.projectionMatrixInverse=new je,this.coordinateSystem=Nt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}};const yr=new ce,vr=new Ht,_r=new Ht;let br=class extends gr{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Lt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Dt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Lt*Math.atan(Math.tan(.5*Dt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){yr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(yr.x,yr.y).multiplyScalar(-t/yr.z),yr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(yr.x,yr.y).multiplyScalar(-t/yr.z)}getViewSize(t,e){return this.getViewBounds(t,vr,_r),e.subVectors(_r,vr)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Dt*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const xr=new ce,wr=new ce,Mr=new Wt;let Sr=class{constructor(t=new ce(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=xr.subVectors(n,e).cross(wr.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(xr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||Mr.getNormalMatrix(t),r=this.coplanarPoint(xr).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}};const Tr=new ke,Er=new ce;let Ar=class{constructor(t=new Sr,e=new Sr,n=new Sr,r=new Sr,i=new Sr,s=new Sr){this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],h=r[6],c=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],y=r[13],v=r[14],_=r[15];if(n[0].setComponents(a-i,c-l,m-d,_-g).normalize(),n[1].setComponents(a+i,c+l,m+d,_+g).normalize(),n[2].setComponents(a+s,c+u,m+p,_+y).normalize(),n[3].setComponents(a-s,c-u,m-p,_-y).normalize(),n[4].setComponents(a-o,c-h,m-f,_-v).normalize(),e===Nt)n[5].setComponents(a+o,c+h,m+f,_+v).normalize();else{if(e!==Pt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,h,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Tr.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Tr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Tr)}intersectsSprite(t){return Tr.center.set(0,0,0),Tr.radius=.7071067811865476,Tr.applyMatrix4(t.matrixWorld),this.intersectsSphere(Tr)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(Er.x=r.normal.x>0?t.max.x:t.min.x,Er.y=r.normal.y>0?t.max.y:t.min.y,Er.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Er)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}},Cr=class extends gr{constructor(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}},Rr=class extends le{constructor(t,e,n,r,i,s,o,a,l,u){if((u=void 0!==u?u:vt)!==vt&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===vt&&(n=1014),void 0===n&&1027===u&&(n=1020),super(null,r,i,s,o,a,u,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:mt,this.minFilter=void 0!==a?a:mt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}};new Rr(1,1).compareFunction=515;let Nr=class extends mn{constructor(){super(),this.isGroup=!0,this.type="Group"}},Pr=class extends mn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ze,this.environmentIntensity=1,this.environmentRotation=new Ze,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}};const kr=new ce,Or=new ue,Ir=new ue,Dr=new ce,Lr=new je,Ur=new ce,Fr=new ke,zr=new je,Br=new Be;class jr extends pr{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=dt,this.bindMatrix=new je,this.bindMatrixInverse=new je,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new fe),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Ur),this.boundingBox.expandByPoint(Ur)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ke),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,Ur),this.boundingSphere.expandByPoint(Ur)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Fr.copy(this.boundingSphere),Fr.applyMatrix4(r),!1!==t.ray.intersectsSphere(Fr)&&(zr.copy(r).invert(),Br.copy(t.ray).applyMatrix4(zr),null!==this.boundingBox&&!1===Br.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Br)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new ue,e=this.geometry.attributes.skinWeight;for(let n=0,r=e.count;n<r;n++){t.fromBufferAttribute(e,n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===dt?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,r=this.geometry;Or.fromBufferAttribute(r.attributes.skinIndex,t),Ir.fromBufferAttribute(r.attributes.skinWeight,t),kr.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const r=Ir.getComponent(t);if(0!==r){const i=Or.getComponent(t);Lr.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(Dr.copy(kr).applyMatrix4(Lr),r)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Vr extends mn{constructor(){super(),this.isBone=!0,this.type="Bone"}}let Gr=class extends le{constructor(t=null,e=1,n=1,r,i,s,o,a,l=1003,u=1003,h,c){super(null,s,o,a,l,u,r,i,h,c),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const Hr=new je,Wr=new je;class qr{constructor(t=[],e=[]){this.uuid=Ut(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new je)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new je;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=t.length;r<i;r++){const i=t[r]?t[r].matrixWorld:Wr;Hr.multiplyMatrices(i,e[r]),Hr.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new qr(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Gr(e,t,t,1023,1015);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,r=t.bones.length;n<r;n++){const r=t.bones[n];let i=e[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Vr),this.bones.push(i),this.boneInverses.push((new je).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const i=e[r];t.bones.push(i.uuid);const s=n[r];t.boneInverses.push(s.toArray())}return t}}let $r=class extends In{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}};const Xr=new ce,Yr=new ce,Kr=new je,Zr=new Be,Jr=new ke,Qr=new ce,ti=new ce;let ei=class extends mn{constructor(t=new Yn,e=new $r){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)Xr.fromBufferAttribute(e,t-1),Yr.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Xr.distanceTo(Yr);t.setAttribute("lineDistance",new jn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Jr.copy(n.boundingSphere),Jr.applyMatrix4(r),Jr.radius+=i,!1===t.ray.intersectsSphere(Jr))return;Kr.copy(r).invert(),Zr.copy(t.ray).applyMatrix4(Kr);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=this.isLineSegments?2:1,u=n.index,h=n.attributes.position;if(null!==u){const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=u.getX(i),r=u.getX(i+1),s=ni(this,t,Zr,a,n,r);s&&e.push(s)}if(this.isLineLoop){const i=u.getX(r-1),s=u.getX(n),o=ni(this,t,Zr,a,i,s);o&&e.push(o)}}else{const n=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=ni(this,t,Zr,a,i,i+1);n&&e.push(n)}if(this.isLineLoop){const i=ni(this,t,Zr,a,r-1,n);i&&e.push(i)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}};function ni(t,e,n,r,i,s){const o=t.geometry.attributes.position;Xr.fromBufferAttribute(o,i),Yr.fromBufferAttribute(o,s);if(n.distanceSqToSegment(Xr,Yr,Qr,ti)>r)return;Qr.applyMatrix4(t.matrixWorld);const a=e.ray.origin.distanceTo(Qr);return a<e.near||a>e.far?void 0:{distance:a,point:ti.clone().applyMatrix4(t.matrixWorld),index:i,face:null,faceIndex:null,object:t}}const ri=new ce,ii=new ce;class si extends ei{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,r=e.count;t<r;t+=2)ri.fromBufferAttribute(e,t),ii.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+ri.distanceTo(ii);t.setAttribute("lineDistance",new jn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}let oi=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const u=n[r];return(r+(s-u)/(n[r+1]-u))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new Ht:new ce);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new ce,r=[],i=[],s=[],o=new ce,a=new je;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new ce)}i[0]=new ce,s[0]=new ce;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),c=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),c<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Ft(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Ft(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},ai=class extends oi{constructor(t=0,e=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new Ht){const n=e,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};function li(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,u=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,u*=o,i(e,n,l,u)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}const ui=new ce,hi=new li,ci=new li,di=new li;function pi(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function fi(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function mi(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}let gi=class extends oi{constructor(t=new ce,e=new ce,n=new ce,r=new ce){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new ce){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(mi(t,r.x,i.x,s.x,o.x),mi(t,r.y,i.y,s.y,o.y),mi(t,r.z,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},yi=class extends oi{constructor(t=new ce,e=new ce,n=new ce){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new ce){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(fi(t,r.x,i.x,s.x),fi(t,r.y,i.y,s.y),fi(t,r.z,i.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}};var vi=Object.freeze({__proto__:null,ArcCurve:class extends ai{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends oi{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new ce){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?o=r[(l-1)%i]:(ui.subVectors(r[0],r[1]).add(r[0]),o=ui);const h=r[l%i],c=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(ui.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=ui),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(c),t),r=Math.pow(c.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),hi.initNonuniformCatmullRom(o.x,h.x,c.x,a.x,e,n,r),ci.initNonuniformCatmullRom(o.y,h.y,c.y,a.y,e,n,r),di.initNonuniformCatmullRom(o.z,h.z,c.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(hi.initCatmullRom(o.x,h.x,c.x,a.x,this.tension),ci.initCatmullRom(o.y,h.y,c.y,a.y,this.tension),di.initCatmullRom(o.z,h.z,c.z,a.z,this.tension));return n.set(hi.calc(u),ci.calc(u),di.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new ce).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:class extends oi{constructor(t=new Ht,e=new Ht,n=new Ht,r=new Ht){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Ht){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(mi(t,r.x,i.x,s.x,o.x),mi(t,r.y,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},CubicBezierCurve3:gi,EllipseCurve:ai,LineCurve:class extends oi{constructor(t=new Ht,e=new Ht){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ht){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Ht){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},LineCurve3:class extends oi{constructor(t=new ce,e=new ce){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new ce){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ce){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:class extends oi{constructor(t=new Ht,e=new Ht,n=new Ht){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Ht){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(fi(t,r.x,i.x,s.x),fi(t,r.y,i.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve3:yi,SplineCurve:class extends oi{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Ht){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return n.set(pi(o,a.x,l.x,u.x,h.x),pi(o,a.y,l.y,u.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Ht).fromArray(n))}return this}}});let _i=class t extends Yn{constructor(t=1,e=1,n=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const u=[],h=[],c=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,s=new Ht,f=new ce;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=r;t++)h.push(0,m*_,0),c.push(0,_,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=v*i,f.y=m*_,f.z=v*n,h.push(f.x,f.y,f.z),c.push(0,_,0),s.x=.5*n+.5,s.y=.5*i*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=b+t;!0===n?u.push(r,r+1,e):u.push(r+1,r,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const s=new ce,y=new ce;let v=0;const _=(e-t)/n;for(let l=0;l<=i;l++){const u=[],g=l/i,v=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);y.x=v*l,y.y=-g*n+m,y.z=v*f,h.push(y.x,y.y,y.z),s.set(l,_,f).normalize(),c.push(s.x,s.y,s.z),d.push(e,1-g),u.push(p++)}f.push(u)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=f[e][t],r=f[e+1][t],i=f[e+1][t+1],s=f[e][t+1];u.push(n,r,s),u.push(r,i,s),v+=6}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new jn(h,3)),this.setAttribute("normal",new jn(c,3)),this.setAttribute("uv",new jn(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}};const bi=function(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let s=xi(t,0,i,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,u,h,c,d,p;if(r&&(s=function(t,e,n,r){const i=[];let s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,u=xi(t,a,l,r,!1),u===u.next&&(u.steiner=!0),i.push(ki(u));for(i.sort(Ci),s=0;s<i.length;s++)n=Ri(i[s],n);return n}(t,e,s,n)),t.length>80*n){a=u=t[0],l=h=t[1];for(let e=n;e<i;e+=n)c=t[e],d=t[e+1],c<a&&(a=c),d<l&&(l=d),c>u&&(u=c),d>h&&(h=d);p=Math.max(u-a,h-l),p=0!==p?32767/p:0}return Mi(s,o,n,a,l,p,0),o};function xi(t,e,n,r,i){let s,o;if(i===function(t,e,n,r){let i=0;for(let s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Vi(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Vi(s,t[s],t[s+1],o);return o&&Li(o,o.next)&&(Gi(o),o=o.next),o}function wi(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!Li(r,r.next)&&0!==Di(r.prev,r,r.next))r=r.next;else{if(Gi(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function Mi(t,e,n,r,i,s,o){if(!t)return;!o&&s&&function(t,e,n,r){let i=t;do{0===i.z&&(i.z=Pi(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,n,r,i,s,o,a,l,u=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<u&&(a++,r=r.nextZ,r);e++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,u*=2}while(o>1)}(i)}(t,r,i,s);let a,l,u=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?Ti(t,r,i,s):Si(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),Gi(t),t=l.next,u=l.next;else if((t=l)===u){o?1===o?Mi(t=Ei(wi(t),e,n),e,n,r,i,s,2):2===o&&Ai(t,e,n,r,i,s):Mi(wi(t),e,n,r,i,s,1);break}}function Si(t){const e=t.prev,n=t,r=t.next;if(Di(e,n,r)>=0)return!1;const i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,u=r.y,h=i<s?i<o?i:o:s<o?s:o,c=a<l?a<u?a:u:l<u?l:u,d=i>s?i>o?i:o:s>o?s:o,p=a>l?a>u?a:u:l>u?l:u;let f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=c&&f.y<=p&&Oi(i,a,s,l,o,u,f.x,f.y)&&Di(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ti(t,e,n,r){const i=t.prev,s=t,o=t.next;if(Di(i,s,o)>=0)return!1;const a=i.x,l=s.x,u=o.x,h=i.y,c=s.y,d=o.y,p=a<l?a<u?a:u:l<u?l:u,f=h<c?h<d?h:d:c<d?c:d,m=a>l?a>u?a:u:l>u?l:u,g=h>c?h>d?h:d:c>d?c:d,y=Pi(p,f,e,n,r),v=Pi(m,g,e,n,r);let _=t.prevZ,b=t.nextZ;for(;_&&_.z>=y&&b&&b.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==o&&Oi(a,h,l,c,u,d,_.x,_.y)&&Di(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&Oi(a,h,l,c,u,d,b.x,b.y)&&Di(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==o&&Oi(a,h,l,c,u,d,_.x,_.y)&&Di(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==o&&Oi(a,h,l,c,u,d,b.x,b.y)&&Di(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Ei(t,e,n){let r=t;do{const i=r.prev,s=r.next.next;!Li(i,s)&&Ui(i,r,r.next,s)&&Bi(i,s)&&Bi(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),Gi(r),Gi(r.next),r=t=s),r=r.next}while(r!==t);return wi(r)}function Ai(t,e,n,r,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Ii(o,t)){let a=ji(o,t);return o=wi(o,o.next),a=wi(a,a.next),Mi(o,e,n,r,i,s,0),void Mi(a,e,n,r,i,s,0)}t=t.next}o=o.next}while(o!==t)}function Ci(t,e){return t.x-e.x}function Ri(t,e){const n=function(t,e){let n,r=e,i=-1/0;const s=t.x,o=t.y;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){const t=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=s&&t>i&&(i=t,n=r.x<r.next.x?r:r.next,t===s))return n}r=r.next}while(r!==e);if(!n)return null;const a=n,l=n.x,u=n.y;let h,c=1/0;r=n;do{s>=r.x&&r.x>=l&&s!==r.x&&Oi(o<u?s:i,o,l,u,o<u?i:s,o,r.x,r.y)&&(h=Math.abs(o-r.y)/(s-r.x),Bi(r,t)&&(h<c||h===c&&(r.x>n.x||r.x===n.x&&Ni(n,r)))&&(n=r,c=h)),r=r.next}while(r!==a);return n}(t,e);if(!n)return e;const r=ji(n,t);return wi(r,r.next),wi(n,n.next)}function Ni(t,e){return Di(t.prev,t,e.prev)<0&&Di(e.next,t,t.next)<0}function Pi(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ki(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Oi(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function Ii(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ui(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Bi(t,e)&&Bi(e,t)&&function(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Di(t.prev,t,e.prev)||Di(t,e.prev,e))||Li(t,e)&&Di(t.prev,t,t.next)>0&&Di(e.prev,e,e.next)>0)}function Di(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Li(t,e){return t.x===e.x&&t.y===e.y}function Ui(t,e,n,r){const i=zi(Di(t,e,n)),s=zi(Di(t,e,r)),o=zi(Di(n,r,t)),a=zi(Di(n,r,e));return i!==s&&o!==a||(!(0!==i||!Fi(t,n,e))||(!(0!==s||!Fi(t,r,e))||(!(0!==o||!Fi(n,t,r))||!(0!==a||!Fi(n,e,r)))))}function Fi(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function zi(t){return t>0?1:t<0?-1:0}function Bi(t,e){return Di(t.prev,t,t.next)<0?Di(t,e,t.next)>=0&&Di(t,t.prev,e)>=0:Di(t,e,t.prev)<0||Di(t,t.next,e)<0}function ji(t,e){const n=new Hi(t.i,t.x,t.y),r=new Hi(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Vi(t,e,n,r){const i=new Hi(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Gi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hi(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Wi{static area(t){const e=t.length;let n=0;for(let r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n}static isClockWise(t){return Wi.area(t)<0}static triangulateShape(t,e){const n=[],r=[],i=[];qi(t),$i(n,t);let s=t.length;e.forEach(qi);for(let t=0;t<e.length;t++)r.push(s),s+=e[t].length,$i(n,e[t]);const o=bi(n,r);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return i}}function qi(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function $i(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}let Xi=class t extends Yn{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const u=[],h=new ce,c=new ce,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let v=0;0===d&&0===s?v=.5/e:d===n&&a===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),h.y=t*Math.cos(s+y*o),h.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),p.push(h.x,h.y,h.z),c.copy(h).normalize(),f.push(c.x,c.y,c.z),m.push(a+v,1-y),g.push(l++)}u.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=u[t][r+1],i=u[t][r],o=u[t+1][r],l=u[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new jn(p,3)),this.setAttribute("normal",new jn(f,3)),this.setAttribute("uv",new jn(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Yi=class extends In{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Pn(16777215),this.specular=new Pn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ze,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}},Ki=class extends In{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Pn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ze,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}};function Zi(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Ji(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n}function Qi(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,o=0;o!==r;++s){const r=n[s]*e;for(let n=0;n!==e;++n)i[o++]=t[r+n]}return i}function ts(t,e,n,r){let i=1,s=t[0];for(;void 0!==s&&void 0===s[r];)s=t[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)}class es{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ns extends es{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=t,o=2*e-n;break;case 2402:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*u,this._offsetNext=s*u}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=this._offsetPrev,h=this._offsetNext,c=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-c*m+2*c*f-c*p,y=(1+c)*m+(-1.5-2*c)*f+(-.5+c)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)i[t]=g*s[u+t]+y*s[l+t]+v*s[a+t]+_*s[h+t];return i}}class rs extends es{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=(n-e)/(r-e),h=1-u;for(let t=0;t!==o;++t)i[t]=s[l+t]*h+s[a+t]*u;return i}}class is extends es{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class ss{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Zi(e,this.TimeBufferType),this.values=Zi(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Zi(t.times,Array),values:Zi(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new is(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new rs(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ns(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case _t:e=this.InterpolantFactoryMethodDiscrete;break;case bt:e=this.InterpolantFactoryMethodLinear;break;case xt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _t;case this.InterpolantFactoryMethodLinear:return bt;case this.InterpolantFactoryMethodSmooth:return xt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&(o=r,ArrayBuffer.isView(o)&&!(o instanceof DataView)))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}var o;return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===xt,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}ss.prototype.TimeBufferType=Float32Array,ss.prototype.ValueBufferType=Float32Array,ss.prototype.DefaultInterpolation=bt;class os extends ss{}os.prototype.ValueTypeName="bool",os.prototype.ValueBufferType=Array,os.prototype.DefaultInterpolation=_t,os.prototype.InterpolantFactoryMethodLinear=void 0,os.prototype.InterpolantFactoryMethodSmooth=void 0;class as extends ss{}as.prototype.ValueTypeName="color";class ls extends ss{}ls.prototype.ValueTypeName="number";class us extends es{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)he.slerpFlat(i,0,s,l-o,s,l,a);return i}}class hs extends ss{InterpolantFactoryMethodLinear(t){return new us(this.times,this.values,this.getValueSize(),t)}}hs.prototype.ValueTypeName="quaternion",hs.prototype.DefaultInterpolation=bt,hs.prototype.InterpolantFactoryMethodSmooth=void 0;class cs extends ss{}cs.prototype.ValueTypeName="string",cs.prototype.ValueBufferType=Array,cs.prototype.DefaultInterpolation=_t,cs.prototype.InterpolantFactoryMethodLinear=void 0,cs.prototype.InterpolantFactoryMethodSmooth=void 0;class ds extends ss{}ds.prototype.ValueTypeName="vector";class ps{constructor(t="",e=-1,n=[],r=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=Ut(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let t=0,i=n.length;t!==i;++t)e.push(fs(n[t]).scale(r));const i=new this(t.name,t.duration,e,t.blendMode);return i.uuid=t.uuid,i}static toJSON(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,r=n.length;t!==r;++t)e.push(ss.toJSON(n[t]));return r}static CreateFromMorphTargetSequence(t,e,n,r){const i=e.length,s=[];for(let t=0;t<i;t++){let o=[],a=[];o.push((t+i-1)%i,t,(t+1)%i),a.push(0,1,0);const l=Ji(o);o=Qi(o,1,l),a=Qi(a,1,l),r||0!==o[0]||(o.push(i),a.push(a[0])),s.push(new ls(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(i);if(s&&s.length>1){const t=s[1];let e=r[t];e||(r[t]=e=[]),e.push(n)}}const s=[];for(const t in r)s.push(this.CreateFromMorphTargetSequence(t,r[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,i){if(0!==n.length){const s=[],o=[];ts(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const i=l[t].keys;if(i&&0!==i.length)if(i[0].morphTargets){const t={};let e;for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let r=0;r!==i[e].morphTargets.length;++r){const r=i[e];t.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new ls(".morphTargetInfluence["+n+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";n(ds,s+".position",i,"pos",r),n(hs,s+".quaternion",i,"rot",r),n(ds,s+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,a,r,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function fs(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ls;case"vector":case"vector2":case"vector3":case"vector4":return ds;case"color":return as;case"quaternion":return hs;case"bool":case"boolean":return os;case"string":return cs}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];ts(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const ms={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};let gs=class{constructor(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}};const ys=new gs;let vs=class{constructor(t){this.manager=void 0!==t?t:ys,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};vs.DEFAULT_MATERIAL_NAME="__DEFAULT";const _s={};class bs extends Error{constructor(t,e){super(t),this.response=e}}class xs extends vs{constructor(t){super(t)}load(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=ms.get(t);if(void 0!==i)return this.manager.itemStart(t),setTimeout((()=>{e&&e(i),this.manager.itemEnd(t)}),0),i;if(void 0!==_s[t])return void _s[t].push({onLoad:e,onProgress:n,onError:r});_s[t]=[],_s[t].push({onLoad:e,onProgress:n,onError:r});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=_s[t],r=e.body.getReader(),i=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=i?parseInt(i):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){r.read().then((({done:r,value:i})=>{if(r)t.close();else{a+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(r)}t.enqueue(i),e()}}))}()}});return new Response(l)}throw new bs(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,r=new TextDecoder(n);return t.arrayBuffer().then((t=>r.decode(t)))}}})).then((e=>{ms.add(t,e);const n=_s[t];delete _s[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onLoad&&r.onLoad(e)}})).catch((e=>{const n=_s[t];if(void 0===n)throw this.manager.itemError(t),e;delete _s[t];for(let t=0,r=n.length;t<r;t++){const r=n[t];r.onError&&r.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}let ws=class extends vs{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=ms.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=$t("img");function a(){u(),ms.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){u(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function u(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}};class Ms extends vs{constructor(t){super(t)}load(t,e,n,r){const i=this,s=new Gr,o=new xs(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){let n;try{n=i.parse(t)}catch(t){if(void 0===r)return void console.error(t);r(t)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:ft,s.wrapT=void 0!==n.wrapT?n.wrapT:ft,s.magFilter=void 0!==n.magFilter?n.magFilter:gt,s.minFilter=void 0!==n.minFilter?n.minFilter:gt,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=yt),1===n.mipmapCount&&(s.minFilter=gt),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n)}),n,r),s}}let Ss=class extends vs{constructor(t){super(t)}load(t,e,n,r){const i=new le,s=new ws(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},Ts=class extends mn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Pn(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}};const Es=new je,As=new ce,Cs=new ce;let Rs=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ht(512,512),this.map=null,this.mapPass=null,this.matrix=new je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ar,this._frameExtents=new Ht(1,1),this._viewportCount=1,this._viewports=[new ue(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;As.setFromMatrixPosition(t.matrixWorld),e.position.copy(As),Cs.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Cs),e.updateMatrixWorld(),Es.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Es),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Es)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},Ns=class extends Rs{constructor(){super(new br(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*Lt*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},Ps=class extends Ts{constructor(t,e,n=0,r=Math.PI/3,i=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(mn.DEFAULT_UP),this.updateMatrix(),this.target=new mn,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new Ns}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};const ks=new je,Os=new ce,Is=new ce;let Ds=class extends Rs{constructor(){super(new br(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ht(4,2),this._viewportCount=6,this._viewports=[new ue(2,1,1,1),new ue(0,1,1,1),new ue(3,1,1,1),new ue(1,1,1,1),new ue(3,0,1,1),new ue(1,0,1,1)],this._cubeDirections=[new ce(1,0,0),new ce(-1,0,0),new ce(0,0,1),new ce(0,0,-1),new ce(0,1,0),new ce(0,-1,0)],this._cubeUps=[new ce(0,1,0),new ce(0,1,0),new ce(0,1,0),new ce(0,1,0),new ce(0,0,1),new ce(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Os.setFromMatrixPosition(t.matrixWorld),n.position.copy(Os),Is.copy(n.position),Is.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Is),n.updateMatrixWorld(),r.makeTranslation(-Os.x,-Os.y,-Os.z),ks.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ks)}},Ls=class extends Ts{constructor(t,e,n=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Ds}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},Us=class extends Rs{constructor(){super(new Cr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Fs=class extends Ts{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(mn.DEFAULT_UP),this.updateMatrix(),this.target=new mn,this.shadow=new Us}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},zs=class extends Ts{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}};class Bs{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}const js="\\[\\]\\.:\\/",Vs=new RegExp("["+js+"]","g"),Gs="[^"+js+"]",Hs="[^"+js.replace("\\.","")+"]",Ws=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Gs)+/(WCOD+)?/.source.replace("WCOD",Hs)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Gs)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Gs)+"$"),qs=["material","materials","bones","map"];class $s{constructor(t,e,n){this.path=e,this.parsedPath=n||$s.parseTrackName(e),this.node=$s.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new $s.Composite(t,e,n):new $s(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Vs,"")}static parseTrackName(t){const e=Ws.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==qs.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=$s.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}$s.Composite=class{constructor(t,e,n){const r=n||$s.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},$s.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$s.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$s.prototype.GetterByBindingType=[$s.prototype._getValue_direct,$s.prototype._getValue_array,$s.prototype._getValue_arrayElement,$s.prototype._getValue_toArray],$s.prototype.SetterByBindingTypeAndVersioning=[[$s.prototype._setValue_direct,$s.prototype._setValue_direct_setNeedsUpdate,$s.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$s.prototype._setValue_array,$s.prototype._setValue_array_setNeedsUpdate,$s.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$s.prototype._setValue_arrayElement,$s.prototype._setValue_arrayElement_setNeedsUpdate,$s.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$s.prototype._setValue_fromArray,$s.prototype._setValue_fromArray_setNeedsUpdate,$s.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"164"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="164");class Xs extends Ms{constructor(t){super(t)}parse(t){const e=0,n=1,r=2,i=3,s=9,o=10,a=11,l=48,u=4,h=0,c=1,d=2,p=3;if(t.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let f=0;const m=new Uint8Array(t),g={id_length:m[f++],colormap_type:m[f++],image_type:m[f++],colormap_index:m[f++]|m[f++]<<8,colormap_length:m[f++]|m[f++]<<8,colormap_size:m[f++],origin:[m[f++]|m[f++]<<8,m[f++]|m[f++]<<8],width:m[f++]|m[f++]<<8,height:m[f++]|m[f++]<<8,pixel_size:m[f++],flags:m[f++]};if(function(t){switch(t.image_type){case n:case s:if(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case i:case o:case a:if(t.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case e:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+t.image_type)}if(t.width<=0||t.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+t.pixel_size)}(g),g.id_length+f>t.length)throw new Error("THREE.TGALoader: No data.");f+=g.id_length;let y=!1,v=!1,_=!1;switch(g.image_type){case s:y=!0,v=!0;break;case n:v=!0;break;case o:y=!0;break;case r:break;case a:y=!0,_=!0;break;case i:_=!0}const b=new Uint8Array(g.width*g.height*4),x=function(t,e,n,r,i){let s,o;const a=n.pixel_size>>3,l=n.width*n.height*a;if(e&&(o=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),t){let t,e,n;s=new Uint8Array(l);let o=0;const u=new Uint8Array(a);for(;o<l;)if(t=i[r++],e=1+(127&t),128&t){for(n=0;n<a;++n)u[n]=i[r++];for(n=0;n<e;++n)s.set(u,o+n*a);o+=a*e}else{for(e*=a,n=0;n<e;++n)s[o+n]=i[r++];o+=e}}else s=i.subarray(r,r+=e?n.width*n.height:l);return{pixel_data:s,palettes:o}}(y,v,g,f,m);return function(t,e,n,r,i){let s,o,a,f,m,y;switch((g.flags&l)>>u){default:case d:s=0,a=1,m=e,o=0,f=1,y=n;break;case h:s=0,a=1,m=e,o=n-1,f=-1,y=-1;break;case p:s=e-1,a=-1,m=-1,o=0,f=1,y=n;break;case c:s=e-1,a=-1,m=-1,o=n-1,f=-1,y=-1}if(_)switch(g.pixel_size){case 8:!function(t,e,n,r,i,s,o,a){let l,u,h,c=0;const d=g.width;for(h=e;h!==r;h+=n)for(u=i;u!==o;u+=s,c++)l=a[c],t[4*(u+d*h)+0]=l,t[4*(u+d*h)+1]=l,t[4*(u+d*h)+2]=l,t[4*(u+d*h)+3]=255}(t,o,f,y,s,a,m,r);break;case 16:!function(t,e,n,r,i,s,o,a){let l,u,h=0;const c=g.width;for(u=e;u!==r;u+=n)for(l=i;l!==o;l+=s,h+=2)t[4*(l+c*u)+0]=a[h+0],t[4*(l+c*u)+1]=a[h+0],t[4*(l+c*u)+2]=a[h+0],t[4*(l+c*u)+3]=a[h+1]}(t,o,f,y,s,a,m,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(t,e,n,r,i,s,o,a,l){const u=l;let h,c,d,p=0;const f=g.width;for(d=e;d!==r;d+=n)for(c=i;c!==o;c+=s,p++)h=a[p],t[4*(c+f*d)+3]=255,t[4*(c+f*d)+2]=u[3*h+0],t[4*(c+f*d)+1]=u[3*h+1],t[4*(c+f*d)+0]=u[3*h+2]}(t,o,f,y,s,a,m,r,i);break;case 16:!function(t,e,n,r,i,s,o,a){let l,u,h,c=0;const d=g.width;for(h=e;h!==r;h+=n)for(u=i;u!==o;u+=s,c+=2)l=a[c+0]+(a[c+1]<<8),t[4*(u+d*h)+0]=(31744&l)>>7,t[4*(u+d*h)+1]=(992&l)>>2,t[4*(u+d*h)+2]=(31&l)<<3,t[4*(u+d*h)+3]=32768&l?0:255}(t,o,f,y,s,a,m,r);break;case 24:!function(t,e,n,r,i,s,o,a){let l,u,h=0;const c=g.width;for(u=e;u!==r;u+=n)for(l=i;l!==o;l+=s,h+=3)t[4*(l+c*u)+3]=255,t[4*(l+c*u)+2]=a[h+0],t[4*(l+c*u)+1]=a[h+1],t[4*(l+c*u)+0]=a[h+2]}(t,o,f,y,s,a,m,r);break;case 32:!function(t,e,n,r,i,s,o,a){let l,u,h=0;const c=g.width;for(u=e;u!==r;u+=n)for(l=i;l!==o;l+=s,h+=4)t[4*(l+c*u)+2]=a[h+0],t[4*(l+c*u)+1]=a[h+1],t[4*(l+c*u)+0]=a[h+2],t[4*(l+c*u)+3]=a[h+3]}(t,o,f,y,s,a,m,r);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(b,g.width,g.height,x.pixel_data,x.palettes),{data:b,width:g.width,height:g.height,flipY:!0,generateMipmaps:!0,minFilter:yt}}}THREE.ColladaLoader=class extends vs{load(t,e,n,r){const i=this,s=""===i.path?Bs.extractUrlBase(t):i.path,o=new xs(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(n,s))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t,e){function n(t,e){const n=[],r=t.childNodes;for(let t=0,i=r.length;t<i;t++){const i=r[t];i.nodeName===e&&n.push(i)}return n}function r(t){if(0===t.length)return[];const e=t.trim().split(/\s+/),n=new Array(e.length);for(let t=0,r=e.length;t<r;t++)n[t]=e[t];return n}function i(t){if(0===t.length)return[];const e=t.trim().split(/\s+/),n=new Array(e.length);for(let t=0,r=e.length;t<r;t++)n[t]=parseFloat(e[t]);return n}function s(t){if(0===t.length)return[];const e=t.trim().split(/\s+/),n=new Array(e.length);for(let t=0,r=e.length;t<r;t++)n[t]=parseInt(e[t]);return n}function o(t){return t.substring(1)}function a(t){return 0===Object.keys(t).length}function l(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function u(t){return void 0!==t?t.textContent:"Y_UP"}function h(t,e,r,i){const s=n(t,e)[0];if(void 0!==s){const t=n(s,r);for(let e=0;e<t.length;e++)i(t[e])}}function c(t,e){for(const n in t){t[n].build=e(t[n])}}function d(t,e){return void 0!==t.build||(t.build=e(t)),t.build}function p(t){const e={inputs:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){const t=o(r.getAttribute("source")),n=r.getAttribute("semantic");e.inputs[n]=t}}return e}function f(t){const e={};let n=t.getAttribute("target").split("/");const r=n.shift();let i=n.shift();const s=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)n=i.split("."),i=n.shift(),e.member=n.shift();else if(s){const t=i.split("(");i=t.shift();for(let e=0;e<t.length;e++)t[e]=parseInt(t[e].replace(/\)/,""));e.indices=t}return e.id=r,e.sid=i,e.arraySyntax=s,e.memberSyntax=a,e.sampler=o(t.getAttribute("source")),e}function m(t){const e=[],n=t.channels,r=t.samplers,i=t.sources;for(const t in n)if(n.hasOwnProperty(t)){const s=n[t],o=r[s.sampler],a=o.inputs.INPUT,l=o.inputs.OUTPUT;x(y(s,i[a],i[l]),e)}return e}function g(t){return d(re.animations[t],m)}function y(t,e,n){const r=re.nodes[t.id],i=Bt(r.id),s=r.transforms[t.sid],o=r.matrix.clone().transpose();let a,l,u,h,c,d;const p={};switch(s){case"matrix":for(u=0,h=e.array.length;u<h;u++)if(a=e.array[u],l=u*n.stride,void 0===p[a]&&(p[a]={}),!0===t.arraySyntax){const e=n.array[l],r=t.indices[0]+4*t.indices[1];p[a][r]=e}else for(c=0,d=n.stride;c<d;c++)p[a][c]=n.array[l+c];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',s)}const f=function(t,e){const n=[];for(const e in t)n.push({time:parseFloat(e),value:t[e]});n.sort(r);for(let t=0;t<16;t++)w(n,t,e.elements[t]);return n;function r(t,e){return t.time-e.time}}(p,o);return{name:i.uuid,keyframes:f}}const v=new ce,_=new ce,b=new he;function x(t,e){const n=t.keyframes,r=t.name,i=[],s=[],o=[],a=[];for(let t=0,e=n.length;t<e;t++){const e=n[t],r=e.time,l=e.value;Rt.fromArray(l).transpose(),Rt.decompose(v,b,_),i.push(r),s.push(v.x,v.y,v.z),o.push(b.x,b.y,b.z,b.w),a.push(_.x,_.y,_.z)}return s.length>0&&e.push(new ds(r+".position",i,s)),o.length>0&&e.push(new hs(r+".quaternion",i,o)),a.length>0&&e.push(new ds(r+".scale",i,a)),e}function w(t,e,n){let r,i,s,o=!0;for(i=0,s=t.length;i<s;i++)r=t[i],void 0===r.value[e]?r.value[e]=null:o=!1;if(!0===o)for(i=0,s=t.length;i<s;i++)r=t[i],r.value[e]=n;else!function(t,e){let n,r;for(let i=0,s=t.length;i<s;i++){const s=t[i];if(null===s.value[e]){if(n=M(t,i,e),r=S(t,i,e),null===n){s.value[e]=r.value[e];continue}if(null===r){s.value[e]=n.value[e];continue}T(s,n,r,e)}}}(t,e)}function M(t,e,n){for(;e>=0;){const r=t[e];if(null!==r.value[n])return r;e--}return null}function S(t,e,n){for(;e<t.length;){const r=t[e];if(null!==r.value[n])return r;e++}return null}function T(t,e,n,r){n.time-e.time!=0?t.value[r]=(t.time-e.time)*(n.value[r]-e.value[r])/(n.time-e.time)+e.value[r]:t.value[r]=e.value[r]}function E(t){const e=[],n=t.name,r=t.end-t.start||-1,i=t.animations;for(let t=0,n=i.length;t<n;t++){const n=g(i[t]);for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return new ps(n,r,e)}function A(t){return d(re.clips[t],E)}function C(t){const e={sources:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=i(r.textContent);break;case"source":const t=r.getAttribute("id");e.sources[t]=ot(r);break;case"joints":e.joints=R(r);break;case"vertex_weights":e.vertexWeights=N(r)}}return e}function R(t){const e={inputs:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){const t=r.getAttribute("semantic"),n=o(r.getAttribute("source"));e.inputs[t]=n}}return e}function N(t){const e={inputs:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const t=r.getAttribute("semantic"),n=o(r.getAttribute("source")),i=parseInt(r.getAttribute("offset"));e.inputs[t]={id:n,offset:i};break;case"vcount":e.vcount=s(r.textContent);break;case"v":e.v=s(r.textContent)}}return e}function P(t){const e={id:t.id},n=re.geometries[e.id];return void 0!==t.skin&&(e.skin=function(t){const e=4,n={joints:[],indices:{array:[],stride:e},weights:{array:[],stride:e}},r=t.sources,i=t.vertexWeights,s=i.vcount,o=i.v,a=i.inputs.JOINT.offset,l=i.inputs.WEIGHT.offset,u=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],c=r[i.inputs.WEIGHT.id].array;let d,p,f,m=0;for(d=0,f=s.length;d<f;d++){const t=s[d],r=[];for(p=0;p<t;p++){const t=o[m+a],e=c[o[m+l]];r.push({index:t,weight:e}),m+=2}for(r.sort(g),p=0;p<e;p++){const t=r[p];void 0!==t?(n.indices.array.push(t.index),n.weights.array.push(t.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}t.bindShapeMatrix?n.bindMatrix=(new je).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new je).identity();for(d=0,f=u.array.length;d<f;d++){const t=u.array[d],e=(new je).fromArray(h.array,d*h.stride).transpose();n.joints.push({name:t,boneInverse:e})}return n;function g(t,e){return e.weight-t.weight}}(t.skin),n.sources.skinIndices=e.skin.indices,n.sources.skinWeights=e.skin.weights),e}function k(t){return d(re.controllers[t],P)}function O(t){return void 0!==t.build?t.build:t.init_from}function I(t){const e=re.images[t];return void 0!==e?d(e,O):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function D(t){const e={surfaces:{},samplers:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"newparam":L(r,e);break;case"technique":e.technique=z(r);break;case"extra":e.extra=W(r)}}return e}function L(t,e){const n=t.getAttribute("sid");for(let r=0,i=t.childNodes.length;r<i;r++){const i=t.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"surface":e.surfaces[n]=U(i);break;case"sampler2D":e.samplers[n]=F(i)}}}function U(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"init_from"===r.nodeName)e.init_from=r.textContent}return e}function F(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"source"===r.nodeName)e.source=r.textContent}return e}function z(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=r.nodeName,e.parameters=B(r);break;case"extra":e.extra=W(r)}}return e}function B(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[r.nodeName]=j(r);break;case"transparent":e[r.nodeName]={opaque:r.hasAttribute("opaque")?r.getAttribute("opaque"):"A_ONE",data:j(r)}}}return e}function j(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":e[r.nodeName]=i(r.textContent);break;case"float":e[r.nodeName]=parseFloat(r.textContent);break;case"texture":e[r.nodeName]={id:r.getAttribute("texture"),extra:V(r)}}}return e}function V(t){const e={technique:{}};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"extra"===r.nodeName)G(r,e)}return e}function G(t,e){for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"technique"===r.nodeName)H(r,e)}}function H(t,e){for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?e.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?e.technique[r.nodeName]=0:e.technique[r.nodeName]=parseInt(r.textContent);break;case"bump":e[r.nodeName]=$(r)}}}function W(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"technique"===r.nodeName)e.technique=q(r)}return e}function q(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"double_sided":e[r.nodeName]=parseInt(r.textContent);break;case"bump":e[r.nodeName]=$(r)}}return e}function $(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"texture"===r.nodeName)e[r.nodeName]={id:r.getAttribute("texture"),texcoord:r.getAttribute("texcoord"),extra:V(r)}}return e}function X(t){return t}function Y(t){const e=function(t){return d(re.effects[t],X)}(t.url),n=e.profile.technique;let r;switch(n.type){case"phong":case"blinn":r=new Yi;break;case"lambert":r=new Ki;break;default:r=new Dn}function i(t,n=null){const r=e.profile.samplers[t.id];let i=null;if(void 0!==r){i=I(e.profile.surfaces[r.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=I(t.id);if(null!==i){const e=function(t){let e,n=t.slice(2+(t.lastIndexOf(".")-1>>>0));n=n.toLowerCase(),e="tga"===n?Jt:Zt;return e}(i);if(void 0!==e){const r=e.load(i),s=t.extra;if(void 0!==s&&void 0!==s.technique&&!1===a(s.technique)){const t=s.technique;r.wrapS=t.wrapU?pt:ft,r.wrapT=t.wrapV?pt:ft,r.offset.set(t.offsetU||0,t.offsetV||0),r.repeat.set(t.repeatU||1,t.repeatV||1)}else r.wrapS=pt,r.wrapT=pt;return null!==n&&(r.colorSpace=n),r}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}r.name=t.name||"";const s=n.parameters;for(const t in s){const e=s[t];switch(t){case"diffuse":e.color&&r.color.fromArray(e.color),e.texture&&(r.map=i(e.texture,wt));break;case"specular":e.color&&r.specular&&r.specular.fromArray(e.color),e.texture&&(r.specularMap=i(e.texture));break;case"bump":e.texture&&(r.normalMap=i(e.texture));break;case"ambient":e.texture&&(r.lightMap=i(e.texture,wt));break;case"shininess":e.float&&r.shininess&&(r.shininess=e.float);break;case"emission":e.color&&r.emissive&&r.emissive.fromArray(e.color),e.texture&&(r.emissiveMap=i(e.texture,wt))}}r.color.convertSRGBToLinear(),r.specular&&r.specular.convertSRGBToLinear(),r.emissive&&r.emissive.convertSRGBToLinear();let o=s.transparent,l=s.transparency;if(void 0===l&&o&&(l={float:1}),void 0===o&&l&&(o={opaque:"A_ONE",data:{color:[1,1,1,1]}}),o&&l)if(o.data.texture)r.transparent=!0;else{const t=o.data.color;switch(o.opaque){case"A_ONE":r.opacity=t[3]*l.float;break;case"RGB_ZERO":r.opacity=1-t[0]*l.float;break;case"A_ZERO":r.opacity=1-t[3]*l.float;break;case"RGB_ONE":r.opacity=t[0]*l.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',o.opaque)}r.opacity<1&&(r.transparent=!0)}if(void 0!==n.extra&&void 0!==n.extra.technique){const t=n.extra.technique;for(const e in t){const n=t[e];switch(e){case"double_sided":r.side=1===n?2:0;break;case"bump":r.normalMap=i(n.texture),r.normalScale=new Ht(1,1)}}}return r}function K(t){return d(re.materials[t],Y)}function Z(t){for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];if("technique_common"===n.nodeName)return J(n)}return{}}function J(t){const e={};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":e.technique=r.nodeName,e.parameters=Q(r)}}return e}function Q(t){const e={};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[r.nodeName]=parseFloat(r.textContent)}}return e}function tt(t){let e;switch(t.optics.technique){case"perspective":e=new br(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let n=t.optics.parameters.ymag,r=t.optics.parameters.xmag;const i=t.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,r*=.5,n*=.5,e=new Cr(-r,r,n,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new br}return e.name=t.name||"",e}function et(t){const e=re.cameras[t];return void 0!==e?d(e,tt):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function nt(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=r.nodeName,e.parameters=rt(r)}}return e}function rt(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":const t=i(r.textContent);e.color=(new Pn).fromArray(t).convertSRGBToLinear();break;case"falloff_angle":e.falloffAngle=parseFloat(r.textContent);break;case"quadratic_attenuation":const n=parseFloat(r.textContent);e.distance=n?Math.sqrt(1/n):0}}return e}function it(t){let e;switch(t.technique){case"directional":e=new Fs;break;case"point":e=new Ls;break;case"spot":e=new Ps;break;case"ambient":e=new zs}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function st(t){const e=re.lights[t];return void 0!==e?d(e,it):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function ot(t){const e={array:[],stride:3};for(let s=0;s<t.childNodes.length;s++){const o=t.childNodes[s];if(1===o.nodeType)switch(o.nodeName){case"float_array":e.array=i(o.textContent);break;case"Name_array":e.array=r(o.textContent);break;case"technique_common":const t=n(o,"accessor")[0];void 0!==t&&(e.stride=parseInt(t.getAttribute("stride")))}}return e}function at(t){const e={};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];1===r.nodeType&&(e[r.getAttribute("semantic")]=o(r.getAttribute("source")))}return e}function lt(t){const e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const t=o(r.getAttribute("source")),n=r.getAttribute("semantic"),i=parseInt(r.getAttribute("offset")),a=parseInt(r.getAttribute("set")),l=a>0?n+a:n;e.inputs[l]={id:t,offset:i},e.stride=Math.max(e.stride,i+1),"TEXCOORD"===n&&(e.hasUV=!0);break;case"vcount":e.vcount=s(r.textContent);break;case"p":e.p=s(r.textContent)}}return e}function ut(t){let e=0;for(let n=0,r=t.length;n<r;n++){!0===t[n].hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function ht(t){const e={},n=t.sources,r=t.vertices,i=t.primitives;if(0===i.length)return{};const s=function(t){const e={};for(let n=0;n<t.length;n++){const r=t[n];void 0===e[r.type]&&(e[r.type]=[]),e[r.type].push(r)}return e}(i);for(const t in s){const i=s[t];ut(i),e[t]=ct(i,n,r)}return e}function ct(t,e,n){const r={},i={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},l={array:[],stride:0},u=[],h=4,c=[],d=4,p=new Yn,f=[];let m=0;for(let r=0;r<t.length;r++){const h=t[r],d=h.inputs;let g=0;switch(h.type){case"lines":case"linestrips":g=2*h.count;break;case"triangles":g=3*h.count;break;case"polylist":for(let t=0;t<h.count;t++){const e=h.vcount[t];switch(e){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(e-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",h.type)}p.addGroup(m,g,r),m+=g,h.material&&f.push(h.material);for(const r in d){const p=d[r];switch(r){case"VERTEX":for(const r in n){const d=n[r];switch(r){case"POSITION":const n=i.array.length;if(dt(h,e[d],p.offset,i.array),i.stride=e[d].stride,e.skinWeights&&e.skinIndices&&(dt(h,e.skinIndices,p.offset,u),dt(h,e.skinWeights,p.offset,c)),!1===h.hasUV&&!0===t.uvsNeedsFix){const t=(i.array.length-n)/i.stride;for(let e=0;e<t;e++)o.array.push(0,0)}break;case"NORMAL":dt(h,e[d],p.offset,s.array),s.stride=e[d].stride;break;case"COLOR":dt(h,e[d],p.offset,l.array),l.stride=e[d].stride;break;case"TEXCOORD":dt(h,e[d],p.offset,o.array),o.stride=e[d].stride;break;case"TEXCOORD1":dt(h,e[d],p.offset,a.array),o.stride=e[d].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',r)}}break;case"NORMAL":dt(h,e[p.id],p.offset,s.array),s.stride=e[p.id].stride;break;case"COLOR":dt(h,e[p.id],p.offset,l.array,!0),l.stride=e[p.id].stride;break;case"TEXCOORD":dt(h,e[p.id],p.offset,o.array),o.stride=e[p.id].stride;break;case"TEXCOORD1":dt(h,e[p.id],p.offset,a.array),a.stride=e[p.id].stride}}}return i.array.length>0&&p.setAttribute("position",new jn(i.array,i.stride)),s.array.length>0&&p.setAttribute("normal",new jn(s.array,s.stride)),l.array.length>0&&p.setAttribute("color",new jn(l.array,l.stride)),o.array.length>0&&p.setAttribute("uv",new jn(o.array,o.stride)),a.array.length>0&&p.setAttribute("uv1",new jn(a.array,a.stride)),u.length>0&&p.setAttribute("skinIndex",new jn(u,h)),c.length>0&&p.setAttribute("skinWeight",new jn(c,d)),r.data=p,r.type=t[0].type,r.materialKeys=f,r}function dt(t,e,n,r,i=!1){const s=t.p,o=t.stride,a=t.vcount;function l(t){let e=s[t+n]*h;const o=e+h;for(;e<o;e++)r.push(u[e]);if(i){const t=r.length-h-1;Qt.setRGB(r[t+0],r[t+1],r[t+2]).convertSRGBToLinear(),r[t+0]=Qt.r,r[t+1]=Qt.g,r[t+2]=Qt.b}}const u=e.array,h=e.stride;if(void 0!==t.vcount){let t=0;for(let e=0,n=a.length;e<n;e++){const n=a[e];if(4===n){const e=t+1*o,n=t+2*o,r=t+3*o;l(t+0*o),l(e),l(r),l(e),l(n),l(r)}else if(3===n){const e=t+1*o,n=t+2*o;l(t+0*o),l(e),l(n)}else if(n>4)for(let e=1,r=n-2;e<=r;e++){const n=t+o*e,r=t+o*(e+1);l(t+0*o),l(n),l(r)}t+=o*n}}else for(let t=0,e=s.length;t<e;t+=o)l(t)}function mt(t){return d(re.geometries[t],ht)}function gt(t){return void 0!==t.build?t.build:t}function yt(t,e){for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":e.joints[r.getAttribute("sid")]=vt(r);break;case"link":e.links.push(bt(r))}}}function vt(t){let e;for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":e=_t(r)}}return e}function _t(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new ce,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":const t=i(r.textContent);e.axis.fromArray(t);break;case"limits":const n=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];e.limits.max=parseFloat(n.textContent),e.limits.min=parseFloat(s.textContent)}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function bt(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":e.attachments.push(xt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Mt(r))}}return e}function xt(t){const e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":e.links.push(bt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Mt(r))}}return e}function Mt(t){const e={type:t.nodeName},n=i(t.textContent);switch(e.type){case"matrix":e.obj=new je,e.obj.fromArray(n).transpose();break;case"translate":e.obj=new ce,e.obj.fromArray(n);break;case"rotate":e.obj=new ce,e.obj.fromArray(n),e.angle=Gt.degToRad(n[3])}return e}function St(t,e){for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType&&"technique_common"===r.nodeName)Tt(r,e)}}function Tt(t,e){for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":e.inertia=i(r.textContent);break;case"mass":e.mass=i(r.textContent)[0]}}}function Et(t){const e={target:t.getAttribute("target").split("/").pop()};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType&&"axis"===r.nodeName){const t=r.getElementsByTagName("param")[0];e.axis=t.textContent;const n=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=n.substring(0,n.length-1)}}return e}function At(t){return void 0!==t.build?t.build:t}function Ct(t){const e=[],n=$t.querySelector('[id="'+t.id+'"]');for(let t=0;t<n.childNodes.length;t++){const r=n.childNodes[t];if(1!==r.nodeType)continue;let s,o;switch(r.nodeName){case"matrix":s=i(r.textContent);const t=(new je).fromArray(s).transpose();e.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:t});break;case"translate":case"scale":s=i(r.textContent),o=(new ce).fromArray(s),e.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:o});break;case"rotate":s=i(r.textContent),o=(new ce).fromArray(s);const n=Gt.degToRad(s[3]);e.push({sid:r.getAttribute("sid"),type:r.nodeName,obj:o,angle:n})}}return e}const Rt=new je,Nt=new ce;function Pt(t){const e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new je,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1!==r.nodeType)continue;let s;switch(r.nodeName){case"node":e.nodes.push(r.getAttribute("id")),Pt(r);break;case"instance_camera":e.instanceCameras.push(o(r.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(kt(r));break;case"instance_light":e.instanceLights.push(o(r.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(kt(r));break;case"instance_node":e.instanceNodes.push(o(r.getAttribute("url")));break;case"matrix":s=i(r.textContent),e.matrix.multiply(Rt.fromArray(s).transpose()),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":s=i(r.textContent),Nt.fromArray(s),e.matrix.multiply(Rt.makeTranslation(Nt.x,Nt.y,Nt.z)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":s=i(r.textContent);const t=Gt.degToRad(s[3]);e.matrix.multiply(Rt.makeRotationAxis(Nt.fromArray(s),t)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":s=i(r.textContent),e.matrix.scale(Nt.fromArray(s)),e.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return zt(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):re.nodes[e.id]=e,e}function kt(t){const e={id:o(t.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];switch(r.nodeName){case"bind_material":const t=r.getElementsByTagName("instance_material");for(let n=0;n<t.length;n++){const r=t[n],i=r.getAttribute("symbol"),s=r.getAttribute("target");e.materials[i]=o(s)}break;case"skeleton":e.skeletons.push(o(r.textContent))}}return e}function Ot(t,e){const n=[],r=[];let i,s,o;for(i=0;i<t.length;i++){const r=t[i];let s;if(zt(r))s=Bt(r),It(s,e,n);else if(Vt(r)){const t=re.visualScenes[r].children;for(let r=0;r<t.length;r++){const i=t[r];if("JOINT"===i.type){It(Bt(i.id),e,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",r)}for(i=0;i<e.length;i++)for(s=0;s<n.length;s++)if(o=n[s],o.bone.name===e[i].name){r[i]=o,o.processed=!0;break}for(i=0;i<n.length;i++)o=n[i],!1===o.processed&&(r.push(o),o.processed=!0);const a=[],l=[];for(i=0;i<r.length;i++)o=r[i],a.push(o.bone),l.push(o.boneInverse);return new qr(a,l)}function It(t,e,n){t.traverse((function(t){if(!0===t.isBone){let r;for(let n=0;n<e.length;n++){const i=e[n];if(i.name===t.name){r=i.boneInverse;break}}void 0===r&&(r=new je),n.push({bone:t,boneInverse:r,processed:!1})}}))}function Dt(t){const e=[],n=t.matrix,r=t.nodes,i=t.type,s=t.instanceCameras,o=t.instanceControllers,a=t.instanceLights,l=t.instanceGeometries,u=t.instanceNodes;for(let t=0,n=r.length;t<n;t++)e.push(Bt(r[t]));for(let t=0,n=s.length;t<n;t++){const n=et(s[t]);null!==n&&e.push(n.clone())}for(let t=0,n=o.length;t<n;t++){const n=o[t],r=k(n.id),i=Ft(mt(r.id),n.materials),s=Ot(n.skeletons,r.skin.joints);for(let t=0,n=i.length;t<n;t++){const n=i[t];n.isSkinnedMesh&&(n.bind(s,r.skin.bindMatrix),n.normalizeSkinWeights()),e.push(n)}}for(let t=0,n=a.length;t<n;t++){const n=st(a[t]);null!==n&&e.push(n.clone())}for(let t=0,n=l.length;t<n;t++){const n=l[t],r=Ft(mt(n.id),n.materials);for(let t=0,n=r.length;t<n;t++)e.push(r[t])}for(let t=0,n=u.length;t<n;t++)e.push(Bt(u[t]).clone());let h;if(0===r.length&&1===e.length)h=e[0];else{h="JOINT"===i?new Vr:new Nr;for(let t=0;t<e.length;t++)h.add(e[t])}return h.name="JOINT"===i?t.sid:t.name,h.matrix.copy(n),h.matrix.decompose(h.position,h.quaternion,h.scale),h}const Lt=new Dn({name:vs.DEFAULT_MATERIAL_NAME,color:16711935});function Ut(t,e){const n=[];for(let r=0,i=t.length;r<i;r++){const i=e[t[r]];void 0===i?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[r]),n.push(Lt)):n.push(K(i))}return n}function Ft(t,e){const n=[];for(const r in t){const i=t[r],s=Ut(i.materialKeys,e);if(0===s.length&&("lines"===r||"linestrips"===r?s.push(new $r):s.push(new Yi)),"lines"===r||"linestrips"===r)for(let t=0,e=s.length;t<e;t++){const e=s[t];if(!0===e.isMeshPhongMaterial||!0===e.isMeshLambertMaterial){const n=new $r;n.color.copy(e.color),n.opacity=e.opacity,n.transparent=e.transparent,s[t]=n}}const o=void 0!==i.data.attributes.skinIndex,a=1===s.length?s[0]:s;let l;switch(r){case"lines":l=new si(i.data,a);break;case"linestrips":l=new ei(i.data,a);break;case"triangles":case"polylist":l=o?new jr(i.data,a):new pr(i.data,a)}n.push(l)}return n}function zt(t){return void 0!==re.nodes[t]}function Bt(t){return d(re.nodes[t],Dt)}function jt(t){const e=new Nr;e.name=t.name;const n=t.children;for(let t=0;t<n.length;t++){const r=n[t];e.add(Bt(r.id))}return e}function Vt(t){return void 0!==re.visualScenes[t]}function Wt(t){return d(re.visualScenes[t],jt)}if(0===t.length)return{scene:new Pr};const qt=(new DOMParser).parseFromString(t,"application/xml"),$t=n(qt,"COLLADA")[0],Xt=qt.getElementsByTagName("parsererror")[0];if(void 0!==Xt){const t=n(Xt,"div")[0];let e;return e=t?t.textContent:function(t){let e="";const n=[t];for(;n.length;){const t=n.shift();t.nodeType===Node.TEXT_NODE?e+=t.textContent:(e+="\n",n.push.apply(n,t.childNodes))}return e.trim()}(Xt),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",e),null}const Yt=$t.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Yt);const Kt=function(t){return{unit:l(n(t,"unit")[0]),upAxis:u(n(t,"up_axis")[0])}}(n($t,"asset")[0]),Zt=new Ss(this.manager);let Jt;Zt.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin),Xs&&(Jt=new Xs(this.manager),Jt.setPath(this.resourcePath||e));const Qt=new Pn,te=[];let ee={},ne=0;const re={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h($t,"library_animations","animation",(function t(e){const n={sources:{},samplers:{},channels:{}};let r=!1;for(let i=0,s=e.childNodes.length;i<s;i++){const s=e.childNodes[i];if(1!==s.nodeType)continue;let o;switch(s.nodeName){case"source":o=s.getAttribute("id"),n.sources[o]=ot(s);break;case"sampler":o=s.getAttribute("id"),n.samplers[o]=p(s);break;case"channel":o=s.getAttribute("target"),n.channels[o]=f(s);break;case"animation":t(s),r=!0;break;default:console.log(s)}}!1===r&&(re.animations[e.getAttribute("id")||Gt.generateUUID()]=n)})),h($t,"library_animation_clips","animation_clip",(function(t){const e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"instance_animation"===r.nodeName)e.animations.push(o(r.getAttribute("url")))}re.clips[t.getAttribute("id")]=e})),h($t,"library_controllers","controller",(function(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"skin":e.id=o(r.getAttribute("source")),e.skin=C(r);break;case"morph":e.id=o(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}re.controllers[t.getAttribute("id")]=e})),h($t,"library_images","image",(function(t){const e={init_from:n(t,"init_from")[0].textContent};re.images[t.getAttribute("id")]=e})),h($t,"library_effects","effect",(function(t){const e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"profile_COMMON"===r.nodeName)e.profile=D(r)}re.effects[t.getAttribute("id")]=e})),h($t,"library_materials","material",(function(t){const e={name:t.getAttribute("name")};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"instance_effect"===r.nodeName)e.url=o(r.getAttribute("url"))}re.materials[t.getAttribute("id")]=e})),h($t,"library_cameras","camera",(function(t){const e={name:t.getAttribute("name")};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"optics"===r.nodeName)e.optics=Z(r)}re.cameras[t.getAttribute("id")]=e})),h($t,"library_lights","light",(function(t){let e={};for(let n=0,r=t.childNodes.length;n<r;n++){const r=t.childNodes[n];if(1===r.nodeType&&"technique_common"===r.nodeName)e=nt(r)}re.lights[t.getAttribute("id")]=e})),h($t,"library_geometries","geometry",(function(t){const e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(t,"mesh")[0];if(void 0!==r){for(let t=0;t<r.childNodes.length;t++){const n=r.childNodes[t];if(1!==n.nodeType)continue;const i=n.getAttribute("id");switch(n.nodeName){case"source":e.sources[i]=ot(n);break;case"vertices":e.vertices=at(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(lt(n));break;default:console.log(n)}}re.geometries[t.getAttribute("id")]=e}})),h($t,"library_nodes","node",Pt),h($t,"library_visual_scenes","visual_scene",(function(t){const e={name:t.getAttribute("name"),children:[]};!function(t){const e=t.getElementsByTagName("node");for(let t=0;t<e.length;t++){const n=e[t];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+ne++)}}(t);const r=n(t,"node");for(let t=0;t<r.length;t++)e.children.push(Pt(r[t]));re.visualScenes[t.getAttribute("id")]=e})),h($t,"library_kinematics_models","kinematics_model",(function(t){const e={name:t.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType&&"technique_common"===r.nodeName)yt(r,e)}re.kinematicsModels[t.getAttribute("id")]=e})),h($t,"library_physics_models","physics_model",(function(t){const e={name:t.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType&&"rigid_body"===r.nodeName)e.rigidBodies[r.getAttribute("name")]={},St(r,e.rigidBodies[r.getAttribute("name")])}re.physicsModels[t.getAttribute("id")]=e})),h($t,"scene","instance_kinematics_scene",(function(t){const e={bindJointAxis:[]};for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1===r.nodeType&&"bind_joint_axis"===r.nodeName)e.bindJointAxis.push(Et(r))}re.kinematicsScenes[o(t.getAttribute("url"))]=e})),c(re.animations,m),c(re.clips,E),c(re.controllers,P),c(re.images,O),c(re.effects,X),c(re.materials,Y),c(re.cameras,tt),c(re.lights,it),c(re.geometries,ht),c(re.visualScenes,jt),function(){const t=re.clips;if(!0===a(t)){if(!1===a(re.animations)){const t=[];for(const e in re.animations){const n=g(e);for(let e=0,r=n.length;e<r;e++)t.push(n[e])}te.push(new ps("default",-1,t))}}else for(const e in t)te.push(A(e))}(),function(){const t=Object.keys(re.kinematicsModels)[0],e=Object.keys(re.kinematicsScenes)[0],n=Object.keys(re.visualScenes)[0];if(void 0===t||void 0===e)return;const r=function(t){return d(re.kinematicsModels[t],gt)}(t),i=function(t){return d(re.kinematicsScenes[t],At)}(e),s=Wt(n),o=i.bindJointAxis,a={};for(let t=0,e=o.length;t<e;t++){const e=o[t],n=$t.querySelector('[sid="'+e.target+'"]');if(n){const t=n.parentElement;l(e.jointIndex,t)}}function l(t,e){const n=e.getAttribute("name"),i=r.joints[t];s.traverse((function(r){r.name===n&&(a[t]={object:r,transforms:Ct(e),joint:i,position:i.zeroPosition})}))}const u=new je;ee={joints:r&&r.joints,getJointValue:function(t){const e=a[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){const n=a[t];if(n){const r=n.joint;if(e>r.limits.max||e<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{const i=n.object,s=r.axis,o=n.transforms;Rt.identity();for(let n=0;n<o.length;n++){const i=o[n];if(i.sid&&-1!==i.sid.indexOf(t))switch(r.type){case"revolute":Rt.multiply(u.makeRotationAxis(s,Gt.degToRad(e)));break;case"prismatic":Rt.multiply(u.makeTranslation(s.x*e,s.y*e,s.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(i.type){case"matrix":Rt.multiply(i.obj);break;case"translate":Rt.multiply(u.makeTranslation(i.obj.x,i.obj.y,i.obj.z));break;case"scale":Rt.scale(i.obj);break;case"rotate":Rt.multiply(u.makeRotationAxis(i.obj,i.angle))}}i.matrix.copy(Rt),i.matrix.decompose(i.position,i.quaternion,i.scale),a[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}();const ie=function(t){return Wt(o(n(t,"instance_visual_scene")[0].getAttribute("url")))}(n($t,"scene")[0]);return ie.animations=te,"Z_UP"===Kt.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),ie.rotation.set(-Math.PI/2,0,0)),ie.scale.multiplyScalar(Kt.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),te},kinematics:ee,library:re,scene:ie}}},AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var t=this,e=this.el,n=this.data,r=this.el.sceneEl.systems.renderer;n&&(this.remove(),this.loader.load(n,(function(n){t.model=n.scene,t.model.traverse((function(t){if(t.isMesh){var e=t.material;e.color&&r.applyColorCorrection(e.color),e.map&&r.applyColorCorrection(e.map),e.emissive&&r.applyColorCorrection(e.emissive),e.emissiveMap&&r.applyColorCorrection(e.emissiveMap)}})),e.setObject3D("mesh",t.model),e.emit("model-loaded",{format:"collada",model:t.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});var Ys=Uint8Array,Ks=Uint16Array,Zs=Int32Array,Js=new Ys([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qs=new Ys([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),to=new Ys([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eo=function(t,e){for(var n=new Ks(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new Zs(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return{b:n,r:i}},no=eo(Js,2),ro=no.b,io=no.r;ro[28]=258,io[258]=28;for(var so=eo(Qs,0).b,oo=new Ks(32768),ao=0;ao<32768;++ao){var lo=(43690&ao)>>1|(21845&ao)<<1;lo=(61680&(lo=(52428&lo)>>2|(13107&lo)<<2))>>4|(3855&lo)<<4,oo[ao]=((65280&lo)>>8|(255&lo)<<8)>>1}var uo=function(t,e,n){for(var r=t.length,i=0,s=new Ks(e);i<r;++i)t[i]&&++s[t[i]-1];var o,a=new Ks(e);for(i=1;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;if(n){o=new Ks(1<<e);var l=15-e;for(i=0;i<r;++i)if(t[i])for(var u=i<<4|t[i],h=e-t[i],c=a[t[i]-1]++<<h,d=c|(1<<h)-1;c<=d;++c)o[oo[c]>>l]=u}else for(o=new Ks(r),i=0;i<r;++i)t[i]&&(o[i]=oo[a[t[i]-1]++]>>15-t[i]);return o},ho=new Ys(288);for(ao=0;ao<144;++ao)ho[ao]=8;for(ao=144;ao<256;++ao)ho[ao]=9;for(ao=256;ao<280;++ao)ho[ao]=7;for(ao=280;ao<288;++ao)ho[ao]=8;var co=new Ys(32);for(ao=0;ao<32;++ao)co[ao]=5;var po=uo(ho,9,1),fo=uo(co,5,1),mo=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},go=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},yo=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},vo=function(t){return(t+7)/8|0},_o=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],bo=function(t,e,n){var r=new Error(e||_o[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,bo),!n)throw r;return r},xo=function(t,e,n,r){var i=t.length;if(!i||e.f&&!e.l)return n||new Ys(0);var s=!n,o=s||2!=e.i,a=e.i;s&&(n=new Ys(3*i));var l=function(t){var e=n.length;if(t>e){var r=new Ys(Math.max(2*e,t));r.set(n),n=r}},u=e.f||0,h=e.p||0,c=e.b||0,d=e.l,p=e.d,f=e.m,m=e.n,g=8*i;do{if(!d){u=go(t,h,1);var y=go(t,h+1,3);if(h+=3,!y){var v=t[(R=vo(h)+4)-4]|t[R-3]<<8,_=R+v;if(_>i){a&&bo(0);break}o&&l(c+v),n.set(t.subarray(R,_),c),e.b=c+=v,e.p=h=8*_,e.f=u;continue}if(1==y)d=po,p=fo,f=9,m=5;else if(2==y){var b=go(t,h,31)+257,x=go(t,h+10,15)+4,w=b+go(t,h+5,31)+1;h+=14;for(var M=new Ys(w),S=new Ys(19),T=0;T<x;++T)S[to[T]]=go(t,h+3*T,7);h+=3*x;var E=mo(S),A=(1<<E)-1,C=uo(S,E,1);for(T=0;T<w;){var R,N=C[go(t,h,A)];if(h+=15&N,(R=N>>4)<16)M[T++]=R;else{var P=0,k=0;for(16==R?(k=3+go(t,h,3),h+=2,P=M[T-1]):17==R?(k=3+go(t,h,7),h+=3):18==R&&(k=11+go(t,h,127),h+=7);k--;)M[T++]=P}}var O=M.subarray(0,b),I=M.subarray(b);f=mo(O),m=mo(I),d=uo(O,f,1),p=uo(I,m,1)}else bo(1);if(h>g){a&&bo(0);break}}o&&l(c+131072);for(var D=(1<<f)-1,L=(1<<m)-1,U=h;;U=h){var F=(P=d[yo(t,h)&D])>>4;if((h+=15&P)>g){a&&bo(0);break}if(P||bo(2),F<256)n[c++]=F;else{if(256==F){U=h,d=null;break}var z=F-254;if(F>264){var B=Js[T=F-257];z=go(t,h,(1<<B)-1)+ro[T],h+=B}var j=p[yo(t,h)&L],V=j>>4;j||bo(3),h+=15&j;I=so[V];if(V>3){B=Qs[V];I+=yo(t,h)&(1<<B)-1,h+=B}if(h>g){a&&bo(0);break}o&&l(c+131072);var G=c+z;if(c<I){var H=0-I,W=Math.min(I,G);for(H+c<0&&bo(3);c<W;++c)n[c]=r[H+c]}for(;c<G;++c)n[c]=n[c-I]}}e.l=d,e.p=U,e.b=c,e.f=u,d&&(u=1,e.m=f,e.d=p,e.n=m)}while(!u);return c!=n.length&&s?function(t,e,n){return(null==n||n>t.length)&&(n=t.length),new Ys(t.subarray(e,n))}(n,0,c):n.subarray(0,c)},wo=new Ys(0);function Mo(t,e){return xo(t.subarray(function(t){return(8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&bo(6,"invalid zlib data"),1==(t[1]>>5&1)&&bo(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)}(t),-4),{i:2},e,e)}var So="undefined"!=typeof TextDecoder&&new TextDecoder;try{So.decode(wo,{stream:!0})}catch(D9){}function To(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let i=t,s=r,o=Math.floor((i+s)/2);for(;e<n[o]||e>=n[o+1];)e<n[o]?s=o:i=o,o=Math.floor((i+s)/2);return o}function Eo(t,e){let n=1;for(let e=2;e<=t;++e)n*=e;let r=1;for(let t=2;t<=e;++t)r*=t;for(let n=2;n<=t-e;++n)r*=n;return n/r}function Ao(t,e,n,r,i){const s=function(t,e,n,r,i){const s=i<t?i:t,o=[],a=To(t,r,e),l=function(t,e,n,r,i){const s=[];for(let t=0;t<=n;++t)s[t]=0;const o=[];for(let t=0;t<=r;++t)o[t]=s.slice(0);const a=[];for(let t=0;t<=n;++t)a[t]=s.slice(0);a[0][0]=1;const l=s.slice(0),u=s.slice(0);for(let r=1;r<=n;++r){l[r]=e-i[t+1-r],u[r]=i[t+r]-e;let n=0;for(let t=0;t<r;++t){const e=u[t+1],i=l[r-t];a[r][t]=e+i;const s=a[t][r-1]/a[r][t];a[t][r]=n+e*s,n=i*s}a[r][r]=n}for(let t=0;t<=n;++t)o[0][t]=a[t][n];for(let t=0;t<=n;++t){let e=0,i=1;const l=[];for(let t=0;t<=n;++t)l[t]=s.slice(0);l[0][0]=1;for(let s=1;s<=r;++s){let r=0;const u=t-s,h=n-s;t>=s&&(l[i][0]=l[e][0]/a[h+1][u],r=l[i][0]*a[u][h]);const c=t-1<=h?s-1:n-t;for(let t=u>=-1?1:-u;t<=c;++t)l[i][t]=(l[e][t]-l[e][t-1])/a[h+1][u+t],r+=l[i][t]*a[u+t][h];t<=h&&(l[i][s]=-l[e][s-1]/a[h+1][t],r+=l[i][s]*a[t][h]),o[s][t]=r;const d=e;e=i,i=d}}let h=n;for(let t=1;t<=r;++t){for(let e=0;e<=n;++e)o[t][e]*=h;h*=n-t}return o}(a,r,t,s,e),u=[];for(let t=0;t<n.length;++t){const e=n[t].clone(),r=e.w;e.x*=r,e.y*=r,e.z*=r,u[t]=e}for(let e=0;e<=s;++e){const n=u[a-t].clone().multiplyScalar(l[e][0]);for(let r=1;r<=t;++r)n.add(u[a-t+r].clone().multiplyScalar(l[e][r]));o[e]=n}for(let t=s+1;t<=i+1;++t)o[t]=new ue(0,0,0);return o}(t,e,n,r,i);return function(t){const e=t.length,n=[],r=[];for(let i=0;i<e;++i){const e=t[i];n[i]=new ce(e.x,e.y,e.z),r[i]=e.w}const i=[];for(let t=0;t<e;++t){const e=n[t].clone();for(let n=1;n<=t;++n)e.sub(i[t-n].clone().multiplyScalar(Eo(t,n)*r[n]));i[t]=e.divideScalar(r[0])}return i}(s)}class Co extends oi{constructor(t,e,n,r,i){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=r||0,this.endKnot=i||this.knots.length-1;for(let t=0;t<n.length;++t){const e=n[t];this.controlPoints[t]=new ue(e.x,e.y,e.z,e.w)}}getPoint(t,e=new ce){const n=e,r=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=function(t,e,n,r){const i=To(t,r,e),s=function(t,e,n,r){const i=[],s=[],o=[];i[0]=1;for(let a=1;a<=n;++a){s[a]=e-r[t+1-a],o[a]=r[t+a]-e;let n=0;for(let t=0;t<a;++t){const e=o[t+1],r=s[a-t],l=i[t]/(e+r);i[t]=n+e*l,n=r*l}i[a]=n}return i}(i,r,t,e),o=new ue(0,0,0,0);for(let e=0;e<=t;++e){const r=n[i-t+e],a=s[e],l=r.w*a;o.x+=r.x*l,o.y+=r.y*l,o.z+=r.z*l,o.w+=r.w*a}return o}(this.degree,this.knots,this.controlPoints,r);return 1!==i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}getTangent(t,e=new ce){const n=e,r=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=Ao(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}
/**
   * Loader loads FBX file and generates Group representing FBX scene.
   * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format
   * Versions lower than this may load but will probably have errors
   *
   * Needs Support:
   *  Morph normals / blend shape normals
   *
   * FBX format references:
   * 	https://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)
   *
   * Binary format specification:
   *	https://code.blender.org/2013/08/fbx-binary-file-format-specification/
   */let Ro,No,Po;class ko{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){No=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),r=this.parseDeformers(),i=(new Oo).parse(r);return this.parseScene(r,i,n),Po}parseConnections(){const t=new Map;if("Connections"in Ro){Ro.Connections.connections.forEach((function(e){const n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const s={ID:r,relationship:i};t.get(n).parents.push(s),t.has(r)||t.set(r,{parents:[],children:[]});const o={ID:n,relationship:i};t.get(r).children.push(o)}))}return t}parseImages(){const t={},e={};if("Video"in Ro.Objects){const n=Ro.Objects.Video;for(const r in n){const i=n[r];if(t[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){const t=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"==typeof i.Content&&""!==i.Content;if(t||s){const t=this.parseImage(n[r]);e[i.RelativeFilename||i.Filename]=t}}}}for(const n in t){const r=t[n];void 0!==e[r]?t[n]=e[r]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof e)return"data:"+i+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:i}))}}parseTextures(t){const e=new Map;if("Texture"in Ro.Objects){const n=Ro.Objects.Texture;for(const r in n){const i=this.parseTexture(n[r],t);e.set(parseInt(r),i)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const r=t.WrapModeU,i=t.WrapModeV,s=void 0!==r?r.value:0,o=void 0!==i?i.value:0;if(n.wrapS=0===s?pt:ft,n.wrapT=0===o?pt:ft,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;n.offset.x=e[0],n.offset.y=e[1]}return n}loadTexture(t,e){let n;const r=this.textureLoader.path,i=No.get(t.id).children;let s;void 0!==i&&i.length>0&&void 0!==e[i[0].ID]&&(n=e[i[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const o=t.FileName.slice(-3).toLowerCase();if("tga"===o){const e=this.manager.getHandler(".tga");null===e?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),s=new le):(e.setPath(this.textureLoader.path),s=e.load(n))}else if("dds"===o){const e=this.manager.getHandler(".dds");null===e?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",t.RelativeFilename),s=new le):(e.setPath(this.textureLoader.path),s=e.load(n))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),s=new le):s=this.textureLoader.load(n);return this.textureLoader.setPath(r),s}parseMaterials(t){const e=new Map;if("Material"in Ro.Objects){const n=Ro.Objects.Material;for(const r in n){const i=this.parseMaterial(n[r],t);null!==i&&e.set(parseInt(r),i)}}return e}parseMaterial(t,e){const n=t.id,r=t.attrName;let i=t.ShadingModel;if("object"==typeof i&&(i=i.value),!No.has(n))return null;const s=this.parseParameters(t,e,n);let o;switch(i.toLowerCase()){case"phong":o=new Yi;break;case"lambert":o=new Ki;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),o=new Yi}return o.setValues(s),o.name=r,o}parseParameters(t,e,n){const r={};t.BumpFactor&&(r.bumpScale=t.BumpFactor.value),t.Diffuse?r.color=(new Pn).fromArray(t.Diffuse.value).convertSRGBToLinear():!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(r.color=(new Pn).fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(r.displacementScale=t.DisplacementFactor.value),t.Emissive?r.emissive=(new Pn).fromArray(t.Emissive.value).convertSRGBToLinear():!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(r.emissive=(new Pn).fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(r.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(r.opacity=parseFloat(t.Opacity.value)),r.opacity<1&&(r.transparent=!0),t.ReflectionFactor&&(r.reflectivity=t.ReflectionFactor.value),t.Shininess&&(r.shininess=t.Shininess.value),t.Specular?r.specular=(new Pn).fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&"Color"===t.SpecularColor.type&&(r.specular=(new Pn).fromArray(t.SpecularColor.value).convertSRGBToLinear());const i=this;return No.get(n).children.forEach((function(t){const n=t.relationship;switch(n){case"Bump":r.bumpMap=i.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(e,t.ID),void 0!==r.map&&(r.map.colorSpace=wt);break;case"DisplacementColor":r.displacementMap=i.getTexture(e,t.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(e,t.ID),void 0!==r.emissiveMap&&(r.emissiveMap.colorSpace=wt);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(e,t.ID);break;case"ReflectionColor":r.envMap=i.getTexture(e,t.ID),void 0!==r.envMap&&(r.envMap.mapping=303,r.envMap.colorSpace=wt);break;case"SpecularColor":r.specularMap=i.getTexture(e,t.ID),void 0!==r.specularMap&&(r.specularMap.colorSpace=wt);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(e,t.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}getTexture(t,e){return"LayeredTexture"in Ro.Objects&&e in Ro.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=No.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in Ro.Objects){const n=Ro.Objects.Deformer;for(const r in n){const i=n[r],s=No.get(parseInt(r));if("Skin"===i.attrType){const e=this.parseSkeleton(s,n);e.ID=r,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=s.parents[0].ID,t[r]=e}else if("BlendShape"===i.attrType){const t={id:r};t.rawTargets=this.parseMorphTargets(s,n),t.id=r,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[r]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach((function(t){const r=e[t.ID];if("Cluster"!==r.attrType)return;const i={ID:t.ID,indices:[],weights:[],transformLink:(new je).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)})),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let r=0;r<t.children.length;r++){const i=t.children[r],s=e[i.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=No.get(parseInt(i.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(o)}return n}parseScene(t,e,n){Po=new Nr;const r=this.parseModels(t.skeletons,e,n),i=Ro.Objects.Model,s=this;r.forEach((function(t){const e=i[t.ID];s.setLookAtProperties(t,e);No.get(t.ID).parents.forEach((function(e){const n=r.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&Po.add(t)})),this.bindSkeleton(t.skeletons,e,r),this.addGlobalSceneSettings(),Po.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=Wo(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const o=(new Io).parse();1===Po.children.length&&Po.children[0].isGroup&&(Po.children[0].animations=o,Po=Po.children[0]),Po.animations=o}parseModels(t,e,n){const r=new Map,i=Ro.Objects.Model;for(const s in i){const o=parseInt(s),a=i[s],l=No.get(o);let u=this.buildSkeleton(l,t,o,a.attrName);if(!u){switch(a.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,e,n);break;case"NurbsCurve":u=this.createCurve(l,e);break;case"LimbNode":case"Root":u=new Vr;break;default:u=new Nr}u.name=a.attrName?$s.sanitizeNodeName(a.attrName):"",u.userData.originalName=a.attrName,u.ID=o}this.getTransformData(u,a),r.set(o,u)}return r}buildSkeleton(t,e,n,r){let i=null;return t.parents.forEach((function(t){for(const s in e){const o=e[s];o.rawBones.forEach((function(e,s){if(e.ID===t.ID){const t=i;i=new Vr,i.matrixWorld.copy(e.transformLink),i.name=r?$s.sanitizeNodeName(r):"",i.userData.originalName=r,i.ID=n,o.bones[s]=i,null!==t&&i.add(t)}}))}})),i}createCamera(t){let e,n;if(t.children.forEach((function(t){const e=Ro.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new mn;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let i=1e3;void 0!==n.FarPlane&&(i=n.FarPlane.value/1e3);let s=window.innerWidth,o=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,o=n.AspectHeight.value);const a=s/o;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:e=new br(l,a,r,i),null!==u&&e.setFocalLength(u);break;case 1:e=new Cr(-s/2,s/2,o/2,-o/2,r,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),e=new mn}}return e}createLight(t){let e,n;if(t.children.forEach((function(t){const e=Ro.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new mn;else{let t;t=void 0===n.LightType?0:n.LightType.value;let r=16777215;void 0!==n.Color&&(r=(new Pn).fromArray(n.Color.value).convertSRGBToLinear());let i=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(i=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const o=1;switch(t){case 0:e=new Ls(r,i,s,o);break;case 1:e=new Fs(r,i);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=Gt.degToRad(n.InnerAngle.value));let a=0;void 0!==n.OuterAngle&&(a=Gt.degToRad(n.OuterAngle.value),a=Math.max(a,1)),e=new Ps(r,i,s,t,a,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new Ls(r,i)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,n){let r,i=null,s=null;const o=[];return t.children.forEach((function(t){e.has(t.ID)&&(i=e.get(t.ID)),n.has(t.ID)&&o.push(n.get(t.ID))})),o.length>1?s=o:o.length>0?s=o[0]:(s=new Yi({name:vs.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(s)),"color"in i.attributes&&o.forEach((function(t){t.vertexColors=!0})),i.FBX_Deformer?(r=new jr(i,s),r.normalizeSkinWeights()):r=new pr(i,s),r}createCurve(t,e){const n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),r=new $r({name:vs.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new ei(n,r)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?qo(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){if("LookAtProperty"in e){No.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){const n=Ro.Objects.Model[e.ID];if("Lcl_Translation"in n){const e=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),Po.add(t.target)):t.lookAt((new ce).fromArray(e))}}}))}}bindSkeleton(t,e,n){const r=this.parsePoseNodes();for(const i in t){const s=t[i];No.get(parseInt(s.ID)).parents.forEach((function(t){if(e.has(t.ID)){const e=t.ID;No.get(e).parents.forEach((function(t){if(n.has(t.ID)){n.get(t.ID).bind(new qr(s.bones),r[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Ro.Objects){const e=Ro.Objects.Pose;for(const n in e)if("BindPose"===e[n].attrType&&e[n].NbPoseNodes>0){const r=e[n].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new je).fromArray(e.Matrix.a)})):t[r.Node]=(new je).fromArray(r.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in Ro){if("AmbientColor"in Ro.GlobalSettings){const t=Ro.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],r=t[2];if(0!==e||0!==n||0!==r){const t=new Pn(e,n,r).convertSRGBToLinear();Po.add(new zs(t,1))}}"UnitScaleFactor"in Ro.GlobalSettings&&(Po.userData.unitScaleFactor=Ro.GlobalSettings.UnitScaleFactor.value)}}}class Oo{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in Ro.Objects){const n=Ro.Objects.Geometry;for(const r in n){const i=No.get(parseInt(r)),s=this.parseGeometry(i,n[r],t);e.set(parseInt(r),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const r=n.skeletons,i=[],s=t.parents.map((function(t){return Ro.Objects.Model[t.ID]}));if(0===s.length)return;const o=t.children.reduce((function(t,e){return void 0!==r[e.ID]&&(t=r[e.ID]),t}),null);t.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&i.push(n.morphTargets[t.ID])}));const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=qo(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const u=Wo(l);return this.genGeometry(e,o,i,u)}genGeometry(t,e,n,r){const i=new Yn;t.attrName&&(i.name=t.attrName);const s=this.parseGeoNode(t,e),o=this.genBuffers(s),a=new jn(o.vertex,3);if(a.applyMatrix4(r),i.setAttribute("position",a),o.colors.length>0&&i.setAttribute("color",new jn(o.colors,3)),e&&(i.setAttribute("skinIndex",new zn(o.weightsIndices,4)),i.setAttribute("skinWeight",new jn(o.vertexWeights,4)),i.FBX_Deformer=e),o.normal.length>0){const t=(new Wt).getNormalMatrix(r),e=new jn(o.normal,3);e.applyNormalMatrix(t),i.setAttribute("normal",e)}if(o.uvs.forEach((function(t,e){const n=0===e?"uv":`uv${e}`;i.setAttribute(n,new jn(o.uvs[e],2))})),s.material&&"AllSame"!==s.material.mappingType){let t=o.materialIndex[0],e=0;if(o.materialIndex.forEach((function(n,r){n!==t&&(i.addGroup(e,r-e,t),t=n,e=r)})),i.groups.length>0){const e=i.groups[i.groups.length-1],n=e.start+e.count;n!==o.materialIndex.length&&i.addGroup(n,o.materialIndex.length-n,t)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,t,n,r),i}parseGeoNode(t,e){const n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[i]})}))}))),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,s=[],o=[],a=[],l=[],u=[],h=[];const c=this;return t.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d=~d,m=!0);let g=[],y=[];if(s.push(3*d,3*d+1,3*d+2),t.color){const e=Vo(p,n,d,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){y.push(t.weight),g.push(t.id)})),y.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const t=[0,0,0,0],e=[0,0,0,0];y.forEach((function(n,r){let i=n,s=g[r];e.forEach((function(e,n,r){if(i>e){r[n]=i,i=e;const o=t[n];t[n]=s,s=o}}))})),g=t,y=e}for(;y.length<4;)y.push(0),g.push(0);for(let t=0;t<4;++t)u.push(y[t]),h.push(g[t])}if(t.normal){const e=Vo(p,n,d,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(f=Vo(p,n,d,t.material)[0],f<0&&(c.negativeMaterialIndices=!0,f=0)),t.uv&&t.uv.forEach((function(t,e){const r=Vo(p,n,d,t);void 0===l[e]&&(l[e]=[]),l[e].push(r[0]),l[e].push(r[1])})),r++,m&&(c.genFace(e,t,s,f,o,a,l,u,h,r),n++,r=0,s=[],o=[],a=[],l=[],u=[],h=[])})),e}getNormalNewell(t){const e=new ce(0,0,0);for(let n=0;n<t.length;n++){const r=t[n],i=t[(n+1)%t.length];e.x+=(r.y-i.y)*(r.z+i.z),e.y+=(r.z-i.z)*(r.x+i.x),e.z+=(r.x-i.x)*(r.y+i.y)}return e.normalize(),e}getNormalTangentAndBitangent(t){const e=this.getNormalNewell(t),n=(Math.abs(e.z)>.5?new ce(0,1,0):new ce(0,0,1)).cross(e).normalize(),r=e.clone().cross(n).normalize();return{normal:e,tangent:n,bitangent:r}}flattenVertex(t,e,n){return new Ht(t.dot(e),t.dot(n))}genFace(t,e,n,r,i,s,o,a,l,u){let h;if(u>3){const t=[];for(let r=0;r<n.length;r+=3)t.push(new ce(e.vertexPositions[n[r]],e.vertexPositions[n[r+1]],e.vertexPositions[n[r+2]]));const{tangent:r,bitangent:i}=this.getNormalTangentAndBitangent(t),s=[];for(const e of t)s.push(this.flattenVertex(e,r,i));h=Wi.triangulateShape(s,[])}else h=[[0,1,2]];for(const[u,c,d]of h)t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),t.vertex.push(e.vertexPositions[n[3*c]]),t.vertex.push(e.vertexPositions[n[3*c+1]]),t.vertex.push(e.vertexPositions[n[3*c+2]]),t.vertex.push(e.vertexPositions[n[3*d]]),t.vertex.push(e.vertexPositions[n[3*d+1]]),t.vertex.push(e.vertexPositions[n[3*d+2]]),e.skeleton&&(t.vertexWeights.push(a[4*u]),t.vertexWeights.push(a[4*u+1]),t.vertexWeights.push(a[4*u+2]),t.vertexWeights.push(a[4*u+3]),t.vertexWeights.push(a[4*c]),t.vertexWeights.push(a[4*c+1]),t.vertexWeights.push(a[4*c+2]),t.vertexWeights.push(a[4*c+3]),t.vertexWeights.push(a[4*d]),t.vertexWeights.push(a[4*d+1]),t.vertexWeights.push(a[4*d+2]),t.vertexWeights.push(a[4*d+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3]),t.weightsIndices.push(l[4*c]),t.weightsIndices.push(l[4*c+1]),t.weightsIndices.push(l[4*c+2]),t.weightsIndices.push(l[4*c+3]),t.weightsIndices.push(l[4*d]),t.weightsIndices.push(l[4*d+1]),t.weightsIndices.push(l[4*d+2]),t.weightsIndices.push(l[4*d+3])),e.color&&(t.colors.push(s[3*u]),t.colors.push(s[3*u+1]),t.colors.push(s[3*u+2]),t.colors.push(s[3*c]),t.colors.push(s[3*c+1]),t.colors.push(s[3*c+2]),t.colors.push(s[3*d]),t.colors.push(s[3*d+1]),t.colors.push(s[3*d+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),e.normal&&(t.normal.push(i[3*u]),t.normal.push(i[3*u+1]),t.normal.push(i[3*u+2]),t.normal.push(i[3*c]),t.normal.push(i[3*c+1]),t.normal.push(i[3*c+2]),t.normal.push(i[3*d]),t.normal.push(i[3*d+1]),t.normal.push(i[3*d+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(o[n][2*u]),t.uvs[n].push(o[n][2*u+1]),t.uvs[n].push(o[n][2*c]),t.uvs[n].push(o[n][2*c+1]),t.uvs[n].push(o[n][2*d]),t.uvs[n].push(o[n][2*d+1])}))}addMorphTargets(t,e,n,r){if(0===n.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const s=Ro.Objects.Geometry[n.geoID];void 0!==s&&i.genMorphGeometry(t,e,s,r,n.name)}))}))}genMorphGeometry(t,e,n,r,i){const s=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],a=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,u=new Float32Array(l);for(let t=0;t<a.length;t++){const e=3*a[t];u[e]=o[3*t],u[e+1]=o[3*t+1],u[e+2]=o[3*t+2]}const h={vertexIndices:s,vertexPositions:u},c=this.genBuffers(h),d=new jn(c.vertex,3);d.name=i||n.attrName,d.applyMatrix4(r),t.morphAttributes.position.push(d)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a;let i=[];return"IndexToDirect"===n&&(i=t.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Colors.a;let i=[];"IndexToDirect"===n&&(i=t.ColorIndex.a);for(let t=0,e=new Pn;t<r.length;t+=4)e.fromArray(r,t).convertSRGBToLinear().toArray(r,t);return{dataSize:4,buffer:r,indices:i,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=t.Materials.a,i=[];for(let t=0;t<r.length;++t)i.push(t);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}}parseNurbsGeometry(t){const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Yn;const n=e-1,r=t.KnotVector.a,i=[],s=t.Points.a;for(let t=0,e=s.length;t<e;t+=4)i.push((new ue).fromArray(s,t));let o,a;if("Closed"===t.Form)i.push(i[0]);else if("Periodic"===t.Form){o=n,a=r.length-1-o;for(let t=0;t<n;++t)i.push(i[t])}const l=new Co(n,r,i,o,a).getPoints(12*i.length);return(new Yn).setFromPoints(l)}}class Io{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const n in e){const r=e[n],i=this.addClip(r);t.push(i)}return t}parseClips(){if(void 0===Ro.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=Ro.Objects.AnimationCurveNode,e=new Map;for(const n in t){const r=t[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const t={id:r.id,attr:r.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=Ro.Objects.AnimationCurve;for(const n in e){const r={id:e[n].id,times:e[n].KeyTime.a.map(Bo),values:e[n].KeyValueFloat.a},i=No.get(r.id);if(void 0!==i){const e=i.parents[0].ID,n=i.parents[0].relationship;n.match(/X/)?t.get(e).curves.x=r:n.match(/Y/)?t.get(e).curves.y=r:n.match(/Z/)?t.get(e).curves.z=r:n.match(/DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=r)}}}parseAnimationLayers(t){const e=Ro.Objects.AnimationLayer,n=new Map;for(const r in e){const e=[],i=No.get(parseInt(r));if(void 0!==i){i.children.forEach((function(n,r){if(t.has(n.ID)){const i=t.get(n.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===e[r]){const t=No.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const i=Ro.Objects.Model[t.toString()];if(void 0===i)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:i.attrName?$s.sanitizeNodeName(i.attrName):"",ID:i.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Po.traverse((function(t){t.ID===i.id&&(s.transform=t.matrix,t.userData.transformData&&(s.eulerOrder=t.userData.transformData.eulerOrder))})),s.transform||(s.transform=new je),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),e[r]=s}}e[r]&&(e[r][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===e[r]){const t=No.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,i=No.get(t).parents[0].ID,s=No.get(i).parents[0].ID,o=No.get(s).parents[0].ID,a=Ro.Objects.Model[o],l={modelName:a.attrName?$s.sanitizeNodeName(a.attrName):"",morphName:Ro.Objects.Deformer[t].attrName};e[r]=l}e[r][i.attr]=i}}})),n.set(parseInt(r),e)}}return n}parseAnimStacks(t){const e=Ro.Objects.AnimationStack,n={};for(const r in e){const i=No.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=t.get(i[0].ID);n[r]={name:e[r].attrName,layer:s}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new ps(t.name,-1,e)}generateTracks(t){const e=[];let n=new ce,r=new ce;if(t.transform&&t.transform.decompose(n,new he,r),n=n.toArray(),r=r.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==r&&e.push(r)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const n=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.S.curves,r,"scale");void 0!==n&&e.push(n)}if(void 0!==t.DeformPercent){const n=this.generateMorphTrack(t);void 0!==n&&e.push(n)}return e}generateVectorTrack(t,e,n,r){const i=this.getTimesForAllAxes(e),s=this.getKeyframeTrackValues(i,e,n);return new ds(t+"."+r,i,s)}generateRotationTrack(t,e,n,r,i){let s,o;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z){const t=this.interpolateRotations(e.x,e.y,e.z,i);s=t[0],o=t[1]}void 0!==n&&((n=n.map(Gt.degToRad)).push(i),n=(new Ze).fromArray(n),n=(new he).setFromEuler(n)),void 0!==r&&((r=r.map(Gt.degToRad)).push(i),r=(new Ze).fromArray(r),r=(new he).setFromEuler(r).invert());const a=new he,l=new Ze,u=[];if(!o||!s)return new hs(t+".quaternion",[0],[0]);for(let t=0;t<o.length;t+=3){if(l.set(o[t],o[t+1],o[t+2],i),a.setFromEuler(l),void 0!==n&&a.premultiply(n),void 0!==r&&a.multiply(r),t>2){(new he).fromArray(u,(t-3)/3*4).dot(a)<0&&a.set(-a.x,-a.y,-a.z,-a.w)}a.toArray(u,t/3*4)}return new hs(t+".quaternion",s,u)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),r=Po.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new ls(t.modelName+".morphTargetInfluences["+r+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,n=e[0];for(let r=1;r<e.length;r++){const i=e[r];i!==n&&(e[t]=i,n=i,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,n){const r=n,i=[];let s=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(s=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==s){const t=e.x.values[s];i.push(t),r[0]=t}else i.push(r[0]);if(-1!==o){const t=e.y.values[o];i.push(t),r[1]=t}else i.push(r[1]);if(-1!==a){const t=e.z.values[a];i.push(t),r[2]=t}else i.push(r[2])})),i}interpolateRotations(t,e,n,r){const i=[],s=[];i.push(t.times[0]),s.push(Gt.degToRad(t.values[0])),s.push(Gt.degToRad(e.values[0])),s.push(Gt.degToRad(n.values[0]));for(let o=1;o<t.values.length;o++){const a=[t.values[o-1],e.values[o-1],n.values[o-1]];if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))continue;const l=a.map(Gt.degToRad),u=[t.values[o],e.values[o],n.values[o]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const h=u.map(Gt.degToRad),c=[u[0]-a[0],u[1]-a[1],u[2]-a[2]],d=[Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){const e=Math.max(...d)/180,n=new Ze(...l,r),a=new Ze(...h,r),u=(new he).setFromEuler(n),c=(new he).setFromEuler(a);u.dot(c)&&c.set(-c.x,-c.y,-c.z,-c.w);const p=t.times[o-1],f=t.times[o]-p,m=new he,g=new Ze;for(let t=0;t<1;t+=1/e)m.copy(u.clone().slerp(c.clone(),t)),i.push(p+t*f),g.setFromQuaternion(m,r),s.push(g.x),s.push(g.y),s.push(g.z)}else i.push(t.times[o]),s.push(Gt.degToRad(t.values[o])),s.push(Gt.degToRad(e.values[o])),s.push(Gt.degToRad(n.values[o]))}return[i,s]}}class Do{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new Fo,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){const i=t.match(/^[\s\t]*;/),s=t.match(/^[\s\t]*$/);if(i||s)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,n[++r]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},s=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==s.id&&(o[n][s.id]=i)):"number"==typeof s.id?(o[n]={},o[n][s.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof s.id&&(i.id=s.id),""!==s.name&&(i.attrName=s.name),""!==s.type&&(i.attrType=s.type),this.pushStack(i)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}}parseNodeProperty(t,e,n){let r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===r){const t=i.split(",").slice(1),e=parseInt(t[0]),n=parseInt(t[1]);let o=i.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),r="connections",i=[e,n],function(t,e){for(let n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}(i,o),void 0===s[r]&&(s[r]=[])}"Node"===r&&(s.id=i),r in s&&Array.isArray(s[r])?s[r].push(i):"a"!==r?s[r]=i:s.a=i,this.setCurrentProp(s,r),"a"===r&&","!==i.slice(-1)&&(s.a=$o(i))}else this.parseNodeSpecialProperty(t,r,i)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=$o(e.a))}parseNodeSpecialProperty(t,e,n){const r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],s=r[1],o=r[2],a=r[3];let l=r[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=$o(l)}this.getPrevNode()[i]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class Lo{parse(t){const e=new Uo(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Fo;for(;!this.endOfContent(e);){const t=this.parseNode(e,n);null!==t&&r.add(t.name,t)}return r}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const s=t.getUint8(),o=t.getString(s);if(0===r)return null;const a=[];for(let e=0;e<i;e++)a.push(this.parseProperty(t));const l=a.length>0?a[0]:"",u=a.length>1?a[1]:"",h=a.length>2?a[2]:"";for(n.singleProperty=1===i&&t.getOffset()===r;r>t.getOffset();){const r=this.parseNode(t,e);null!==r&&this.parseSubNode(o,n,r)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==o&&(n.name=o),n}parseSubNode(t,e,n){if(!0===n.singleProperty){const t=n.propertyList[0];Array.isArray(t)?(e[n.name]=n,n.a=t):e[n.name]=t}else if("Connections"===t&&"C"===n.name){const t=[];n.propertyList.forEach((function(e,n){0!==n&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===n.name){Object.keys(n).forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){let t=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],s=n.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),o="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[t]={type:r,type2:i,flag:s,value:o}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=t.getUint32(),i=t.getUint32(),s=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}const o=Mo(new Uint8Array(t.getArrayBuffer(s))),a=new Uo(o.buffer);switch(e){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class Uo{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let n=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const r=n.indexOf(0);return r>=0&&(n=new Uint8Array(this.dv.buffer,e,r)),this._textDecoder.decode(n)}}class Fo{add(t,e){this[t]=e}}function zo(t){const e=t.match(/FBXVersion: (\d+)/);if(e){return parseInt(e[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Bo(t){return t/46186158e3}const jo=[];function Vo(t,e,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const s=i*r.dataSize,o=s+r.dataSize;return function(t,e,n,r){for(let i=n,s=0;i<r;i++,s++)t[s]=e[i];return t}(jo,r.buffer,s,o)}const Go=new Ze,Ho=new ce;function Wo(t){const e=new je,n=new je,r=new je,i=new je,s=new je,o=new je,a=new je,l=new je,u=new je,h=new je,c=new je,d=new je,p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Ho.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(Gt.degToRad);e.push(t.eulerOrder||Ze.DEFAULT_ORDER),n.makeRotationFromEuler(Go.fromArray(e))}if(t.rotation){const e=t.rotation.map(Gt.degToRad);e.push(t.eulerOrder||Ze.DEFAULT_ORDER),r.makeRotationFromEuler(Go.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(Gt.degToRad);e.push(t.eulerOrder||Ze.DEFAULT_ORDER),i.makeRotationFromEuler(Go.fromArray(e)),i.invert()}t.scale&&s.scale(Ho.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Ho.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Ho.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(Ho.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(Ho.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(c.copy(t.parentMatrix),h.copy(t.parentMatrixWorld));const f=n.clone().multiply(r).multiply(i),m=new je;m.extractRotation(h);const g=new je;g.copyPosition(h);const y=g.clone().invert().multiply(h),v=m.clone().invert().multiply(y),_=s,b=new je;if(0===p)b.copy(m).multiply(f).multiply(v).multiply(_);else if(1===p)b.copy(m).multiply(v).multiply(f).multiply(_);else{const t=(new je).scale((new ce).setFromMatrixScale(c)).clone().invert(),e=v.clone().multiply(t);b.copy(m).multiply(f).multiply(e).multiply(_)}const x=u.clone().invert(),w=o.clone().invert();let M=e.clone().multiply(l).multiply(u).multiply(n).multiply(r).multiply(i).multiply(x).multiply(a).multiply(o).multiply(s).multiply(w);const S=(new je).copyPosition(M),T=h.clone().multiply(S);return d.copyPosition(T),M=d.clone().multiply(b),M.premultiply(h.invert()),M}function qo(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function $o(t){return t.split(",").map((function(t){return parseFloat(t)}))}function Xo(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),(new TextDecoder).decode(new Uint8Array(t,e,n))}var Yo,Ko,Zo,Jo,Qo,ta;function ea(){if(Ko)return Yo;function t(t){const e=document.getElementById(t),n=e.parentNode;try{n&&n.removeChild(e)}catch(t){}}function e(e,n,r){return new r((function(r,i){const s=n.timeout||5e3,o="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),a=function(t,e){var n=document.createElement("script");return n.type="text/javascript",n.async=!0,n.id=e,n.src=t,n}(e,o),l=setTimeout((function(){i(new Error("Script request to "+e+" timed out")),t(o)}),s),u=function(t){clearTimeout(t)};a.addEventListener("load",(function(e){r({ok:!0}),u(l),t(o)})),a.addEventListener("error",(function(n){i(new Error("Script request to "+e+" failed "+n)),u(l),t(o)})),function(t){const e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(a)}))}return Ko=1,Yo=function(t){return t=t||{},function(n,r){return e(n,r=r||{},t.Promise||Promise)}}}function na(){return ta||(ta=1,ct(),function(){if(Jo)return Zo;Jo=1;const t=ea()(),e=function(){let e;return function(){return e=e||t("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js"),e}}();Zo=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=e().then((()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")}))},update:function(){const t=this,e=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then((()=>{this.loader.load(n,(function(n){t.model=n.scene,t.model.animations=n.animations,e.setObject3D("mesh",t.model),e.emit("model-loaded",{format:"gltf",model:t.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})}(),Qo||(Qo=1,AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let t;const e=this.data;e.src&&(this.remove(),t=new THREE.ObjectLoader,e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,(t=>{t.traverse((t=>{t instanceof THREE.SkinnedMesh&&t.material&&(t.material.skinning=!!(t.geometry&&t.geometry.bones||[]).length)})),this.load(t)})))},load:function(t){this.model=t,this.el.setObject3D("mesh",t),this.el.emit("model-loaded",{format:"json",model:t})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}))),ht}THREE.FBXLoader=class extends vs{constructor(t){super(t)}load(t,e,n,r){const i=this,s=""===i.path?Bs.extractUrlBase(t):i.path,o=new xs(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(n,s))}catch(e){r?r(e):console.error(e),i.manager.itemError(t)}}),n,r)}parse(t,e){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Xo(t,0,e.length)}(t))Ro=(new Lo).parse(t);else{const e=Xo(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(e){const r=t[e-1];return t=t.slice(n+e),n++,r}for(let t=0;t<e.length;++t){if(r(1)===e[t])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(zo(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+zo(e));Ro=(new Do).parse(e)}const n=new Ss(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new ko(n,this.manager).parse(Ro)}},AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const t=this.data;if(!t.src)return;this.remove();const e=new THREE.FBXLoader;t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,this.load.bind(this))},load:function(t){this.model=t,this.el.setObject3D("mesh",t),this.el.emit("model-loaded",{format:"fbx",model:t})},remove:function(){this.model&&this.el.removeObject3D("mesh")}});var ra,ia,sa,oa,aa,la,ua,ha={};function ca(){if(sa)return ia;function t(t,e,n,r){t&&(e=e||[],t.traverse((t=>{if(!t.isMesh)return;var i;((i=t.material)?Array.isArray(i)?i:i.materials?i.materials:[i]:[]).forEach((t=>{t&&!("envMap"in t)||e.length&&-1===e.indexOf(t.name)||(t.envMap=n,t.reflectivity=r,t.needsUpdate=!0)}))})))}return sa=1,ia=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const e=this.data;this.texture=(new THREE.CubeTextureLoader).load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),n=this.data;t(e,n.materials,this.texture,n.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){const n=this.data,r=this.el.getObject3D("mesh");let i=[],s=[];if(n.materials.length&&(e.materials?(i=n.materials.filter((t=>!e.materials.includes(t))),s=e.materials.filter((t=>!n.materials.includes(t)))):i=n.materials),i.length&&t(r,i,this.texture,n.reflectivity),s.length&&t(r,s,null,1),e.materials&&n.reflectivity!==e.reflectivity){const i=n.materials.filter((t=>e.materials.includes(t)));i.length&&t(r,i,this.texture,n.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const e=this.el.getObject3D("mesh"),n=this.data;t(e,n.materials,null,1),n.enableBackground&&this.setBackground(null)},setBackground:function(t){this.el.sceneEl.object3D.background=t}}),ia}function da(){return ua||(ua=1,ra||(ra=1,AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const t=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!t)throw new Error("No `checkpoint-controls` component found.");t.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})),ca(),oa||(oa=1,AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const t=this.el;t.addEventListener("hit",this.onHit),t.addEventListener("gripdown",this.onGripClose),t.addEventListener("gripup",this.onGripOpen),t.addEventListener("trackpaddown",this.onGripClose),t.addEventListener("trackpadup",this.onGripOpen),t.addEventListener("triggerdown",this.onGripClose),t.addEventListener("triggerup",this.onGripOpen)},pause:function(){const t=this.el;t.removeEventListener("hit",this.onHit),t.removeEventListener("gripdown",this.onGripClose),t.removeEventListener("gripup",this.onGripOpen),t.removeEventListener("trackpaddown",this.onGripClose),t.removeEventListener("trackpadup",this.onGripOpen),t.removeEventListener("triggerdown",this.onGripClose),t.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const t=this.hitEl;this.grabbing=!1,t&&(t.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(t){const e=t.detail.el;e.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(e.addState(this.GRABBED_STATE),this.hitEl=e,this.constraint=new CANNON.LockConstraint(this.el.body,e.body),this.system.addConstraint(this.constraint))}})),aa||(aa=1,AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse((t=>{t.isMesh&&(t.material=this.material)}))}})),la||(la=1,AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const t=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(t,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const t=this.data;let e;e=t.objects?this.el.sceneEl.querySelectorAll(t.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){const t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Box3,s=[],o=new Map;return function(a){if(!this.data.enabled)return;const l=this.prevCheckTime;if(l&&a-l<this.data.interval)return;this.prevCheckTime=a;const u=this.el,h=this.data;let c;var d;u.getObject3D("mesh")&&(s.length=0,o.clear(),u.object3D.getWorldPosition(t),u.object3D.getWorldScale(n),c=h.radius*(d=n,Math.max(d.x,d.y,d.z)),this.els.forEach((function(n){let a,l,u,h;n.isEntity&&(l=n.getObject3D("mesh"),l&&(i.setFromObject(l).getSize(r),h=Math.max(r.x,r.y,r.z)/2,a=Math.sqrt(2*h*h),i.getCenter(e),a&&(u=t.distanceTo(e),u<a+c&&(s.push(n),o.set(n,u)))))})),s.sort(((t,e)=>o.get(t)>o.get(e)?1:-1)).forEach(this.handleHit),this.collisions.filter((t=>!o.has(t))).forEach(this.handleHitEnd),function(t,e){t.length=0;for(let n=0;n<e.length;n++)t[n]=e[n]}(this.collisions,s))}}(),handleHit:function(t){t.emit("hit"),t.addState(this.data.state),this.eventDetail.el=t,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(t){t.emit("hitend"),t.removeState(this.data.state),this.eventDetail.el=t,this.el.emit("hitend",this.eventDetail)}}))),ha}var pa,fa,ma={};let ga=class{static roundNumber(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}static sample(t){return t[Math.floor(Math.random()*t.length)]}static distanceToSquared(t,e){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i}static isPointInPoly(t,e){for(var n=!1,r=-1,i=t.length,s=i-1;++r<i;s=r)(t[r].z<=e.z&&e.z<t[s].z||t[s].z<=e.z&&e.z<t[r].z)&&e.x<(t[s].x-t[r].x)*(e.z-t[r].z)/(t[s].z-t[r].z)+t[r].x&&(n=!n);return n}static isVectorInPolygon(t,e,n){var r=1e5,i=-1e5,s=[];return e.vertexIds.forEach((t=>{r=Math.min(n[t].y,r),i=Math.max(n[t].y,i),s.push(n[t])})),!!(t.y<i+.5&&t.y>r-.5&&this.isPointInPoly(s,t))}static triarea2(t,e,n){return(n.x-t.x)*(e.z-t.z)-(e.x-t.x)*(n.z-t.z)}static vequal(t,e){return this.distanceToSquared(t,e)<1e-5}static mergeVertices(t,e=1e-4){e=Math.max(e,Number.EPSILON);for(var n={},r=t.getIndex(),i=t.getAttribute("position"),s=r?r.count:i.count,o=0,a=[],l=[],u=Math.log10(1/e),h=Math.pow(10,u),c=0;c<s;c++){var d=r?r.getX(c):c,p="";p+=~~(i.getX(d)*h)+",",p+=~~(i.getY(d)*h)+",",(p+=~~(i.getZ(d)*h)+",")in n?a.push(n[p]):(l.push(i.getX(d)),l.push(i.getY(d)),l.push(i.getZ(d)),n[p]=o,a.push(o),o++)}const f=new Fn(new Float32Array(l),i.itemSize,i.normalized),m=new Yn;return m.setAttribute("position",f),m.setIndex(a),m}},ya=class{constructor(t){this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){const t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){const e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){const e=this.content[t];for(;t>0;){const n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}}bubbleUp(t){const e=this.content.length,n=this.content[t],r=this.scoreFunction(n);for(;;){const i=t+1<<1,s=i-1;let o,a=null;if(s<e&&(o=this.scoreFunction(this.content[s]),o<r&&(a=s)),i<e&&this.scoreFunction(this.content[i])<(null===a?r:o)&&(a=i),null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}},va=class{constructor(){this.portals=[]}push(t,e){void 0===e&&(e=t),this.portals.push({left:t,right:e})}stringPull(){const t=this.portals,e=[];let n,r,i,s=0,o=0,a=0;n=t[0].left,r=t[0].left,i=t[0].right,e.push(n);for(let l=1;l<t.length;l++){const u=t[l].left,h=t[l].right;if(ga.triarea2(n,i,h)<=0){if(!(ga.vequal(n,i)||ga.triarea2(n,r,h)>0)){e.push(r),n=r,s=o,r=n,i=n,o=s,a=s,l=s;continue}i=h,a=l}if(ga.triarea2(n,r,u)>=0){if(!(ga.vequal(n,r)||ga.triarea2(n,i,u)<0)){e.push(i),n=i,s=a,r=n,i=n,o=s,a=s,l=s;continue}r=u,o=l}}return 0!==e.length&&ga.vequal(e[e.length-1],t[t.length-1].left)||e.push(t[t.length-1].left),this.path=e,e}},_a=class{constructor(){this.zones={}}static createZone(t,e=1e-4){return class{static buildZone(t,e){const n=this._buildNavigationMesh(t,e),r={};n.vertices.forEach((t=>{t.x=ga.roundNumber(t.x,2),t.y=ga.roundNumber(t.y,2),t.z=ga.roundNumber(t.z,2)})),r.vertices=n.vertices;const i=this._buildPolygonGroups(n);return r.groups=new Array(i.length),i.forEach(((t,e)=>{const n=new Map;t.forEach(((t,e)=>{n.set(t,e)}));const i=new Array(t.length);t.forEach(((t,e)=>{const s=[];t.neighbours.forEach((t=>s.push(n.get(t))));const o=[];t.neighbours.forEach((e=>o.push(this._getSharedVerticesInOrder(t,e))));const a=new ce(0,0,0);a.add(r.vertices[t.vertexIds[0]]),a.add(r.vertices[t.vertexIds[1]]),a.add(r.vertices[t.vertexIds[2]]),a.divideScalar(3),a.x=ga.roundNumber(a.x,2),a.y=ga.roundNumber(a.y,2),a.z=ga.roundNumber(a.z,2),i[e]={id:e,neighbours:s,vertexIds:t.vertexIds,centroid:a,portals:o}})),r.groups[e]=i})),r}static _buildNavigationMesh(t,e){return t=ga.mergeVertices(t,e),this._buildPolygonsFromGeometry(t)}static _spreadGroupId(t){let e=new Set([t]);for(;e.size>0;){const n=e;e=new Set,n.forEach((n=>{n.group=t.group,n.neighbours.forEach((t=>{void 0===t.group&&e.add(t)}))}))}}static _buildPolygonGroups(t){const e=[];return t.polygons.forEach((t=>{void 0!==t.group?e[t.group].push(t):(t.group=e.length,this._spreadGroupId(t),e.push([t]))})),e}static _buildPolygonNeighbours(t,e){const n=new Set,r=e[t.vertexIds[1]],i=e[t.vertexIds[2]];return e[t.vertexIds[0]].forEach((e=>{e!==t&&(r.includes(e)||i.includes(e))&&n.add(e)})),r.forEach((e=>{e!==t&&i.includes(e)&&n.add(e)})),n}static _buildPolygonsFromGeometry(t){const e=[],n=[],r=t.attributes.position,i=t.index,s=[];for(let t=0;t<r.count;t++)n.push((new ce).fromBufferAttribute(r,t)),s[t]=[];for(let n=0;n<t.index.count;n+=3){const t=i.getX(n),r=i.getX(n+1),o=i.getX(n+2),a={vertexIds:[t,r,o],neighbours:null};e.push(a),s[t].push(a),s[r].push(a),s[o].push(a)}return e.forEach((t=>{t.neighbours=this._buildPolygonNeighbours(t,s)})),{polygons:e,vertices:n}}static _getSharedVerticesInOrder(t,e){const n=t.vertexIds,r=n[0],i=n[1],s=n[2],o=e.vertexIds,a=o.includes(r),l=o.includes(i),u=o.includes(s);return a&&l&&u?Array.from(n):a&&l?[r,i]:l&&u?[i,s]:a&&u?[s,r]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(t,e)}setZoneData(t,e){this.zones[t]=e}getRandomNode(t,e,n,r){if(!this.zones[t])return new ce;n=n||null,r=r||0;const i=[];return this.zones[t].groups[e].forEach((t=>{n&&r?ga.distanceToSquared(n,t.centroid)<r*r&&i.push(t.centroid):i.push(t.centroid)})),ga.sample(i)||new ce}getClosestNode(t,e,n,r=!1){const i=this.zones[e].vertices;let s=null,o=1/0;return this.zones[e].groups[n].forEach((e=>{const n=ga.distanceToSquared(e.centroid,t);n<o&&(!r||ga.isVectorInPolygon(t,e,i))&&(s=e,o=n)})),s}findPath(t,e,n,r){const i=this.zones[n].groups[r],s=this.zones[n].vertices,o=this.getClosestNode(t,n,r,!0),a=this.getClosestNode(e,n,r,!0);if(!o||!a)return null;const l=class{static init(t){for(let e=0;e<t.length;e++){const n=t[e];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}}static cleanUp(t){for(let e=0;e<t.length;e++){const n=t[e];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}}static heap(){return new ya((function(t){return t.f}))}static search(t,e,n){this.init(t);const r=this.heap();for(r.push(e);r.size()>0;){const e=r.pop();if(e===n){let t=e;const n=[];for(;t.parent;)n.push(t),t=t.parent;return this.cleanUp(n),n.reverse()}e.closed=!0;const i=this.neighbours(t,e);for(let t=0,s=i.length;t<s;t++){const s=i[t];if(s.closed)continue;const o=e.g+s.cost,a=s.visited;if(!a||o<s.g){if(s.visited=!0,s.parent=e,!s.centroid||!n.centroid)throw new Error("Unexpected state");s.h=s.h||this.heuristic(s.centroid,n.centroid),s.g=o,s.f=s.g+s.h,a?r.rescoreElement(s):r.push(s)}}}return[]}static heuristic(t,e){return ga.distanceToSquared(t,e)}static neighbours(t,e){const n=[];for(let r=0;r<e.neighbours.length;r++)n.push(t[e.neighbours[r]]);return n}}.search(i,o,a),u=function(t,e){for(var n=0;n<t.neighbours.length;n++)if(t.neighbours[n]===e.id)return t.portals[n]},h=new va;h.push(t);for(let t=0;t<l.length;t++){const e=l[t],n=l[t+1];if(n){const t=u(e,n);h.push(s[t[0]],s[t[1]])}}h.push(e),h.stringPull();const c=h.path.map((t=>new ce(t.x,t.y,t.z)));return c.shift(),c}};_a.prototype.getGroup=function(){const t=new Sr;return function(e,n,r=!1){if(!this.zones[e])return null;let i=null,s=Math.pow(50,2);const o=this.zones[e];for(let e=0;e<o.groups.length;e++){const a=o.groups[e];for(const l of a){if(r&&(t.setFromCoplanarPoints(o.vertices[l.vertexIds[0]],o.vertices[l.vertexIds[1]],o.vertices[l.vertexIds[2]]),Math.abs(t.distanceToPoint(n))<.01)&&ga.isPointInPoly([o.vertices[l.vertexIds[0]],o.vertices[l.vertexIds[1]],o.vertices[l.vertexIds[2]]],n))return e;const a=ga.distanceToSquared(l.centroid,n);a<s&&(i=e,s=a)}}return i}}(),_a.prototype.clampStep=function(){const t=new ce,e=new Sr,n=new En,r=new ce;let i,s,o=new ce;return function(a,l,u,h,c,d){const p=this.zones[h].vertices,f=this.zones[h].groups[c],m=[u],g={};g[u.id]=0,i=void 0,o.set(0,0,0),s=1/0,e.setFromCoplanarPoints(p[u.vertexIds[0]],p[u.vertexIds[1]],p[u.vertexIds[2]]),e.projectPoint(l,t),r.copy(t);for(let e=m.pop();e;e=m.pop()){n.set(p[e.vertexIds[0]],p[e.vertexIds[1]],p[e.vertexIds[2]]),n.closestPointToPoint(r,t),t.distanceToSquared(r)<s&&(i=e,o.copy(t),s=t.distanceToSquared(r));const a=g[e.id];if(!(a>2))for(let t=0;t<e.neighbours.length;t++){const n=f[e.neighbours[t]];n.id in g||(m.push(n),g[n.id]=a+1)}}return d.copy(o),i}}();var ba,xa,wa,Ma=Object.freeze({__proto__:null,Pathfinding:_a,PathfindingHelper:class extends mn{constructor(){super(),this._playerMarker=new pr(new Xi(.25,32,32),new Dn({color:15631215})),this._targetMarker=new pr(new mr(.3,.3,.3),new Dn({color:14469912})),this._nodeMarker=new pr(new mr(.1,.8,.1),new Dn({color:4417387})),this._stepMarker=new pr(new mr(.1,1,.1),new Dn({color:14472114})),this._pathMarker=new mn,this._pathLineMaterial=new $r({color:41903,linewidth:2}),this._pathPointMaterial=new Dn({color:41903}),this._pathPointGeometry=new Xi(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach((t=>{t.visible=!1,this.add(t)}))}setPath(t){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);t=[this._playerMarker.position].concat(t);const e=new Yn;e.setAttribute("position",new Fn(new Float32Array(3*t.length),3));for(let n=0;n<t.length;n++)e.attributes.position.setXYZ(n,t[n].x,t[n].y+.2,t[n].z);this._pathMarker.add(new ei(e,this._pathLineMaterial));for(let e=0;e<t.length-1;e++){const n=new pr(this._pathPointGeometry,this._pathPointMaterial);n.position.copy(t[e]),n.position.y+=.2,this._pathMarker.add(n)}return this._pathMarker.visible=!0,this}setPlayerPosition(t){return this._playerMarker.position.copy(t),this._playerMarker.visible=!0,this}setTargetPosition(t){return this._targetMarker.position.copy(t),this._targetMarker.visible=!0,this}setNodePosition(t){return this._nodeMarker.position.copy(t),this._nodeMarker.visible=!0,this}setStepPosition(t){return this._stepMarker.position.copy(t),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach((t=>{t.visible=!1})),this}}}),Sa=f(Ma);function Ta(){return wa||(wa=1,pa||(pa=1,AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var t=this;const e=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!e)return;let n;if(e.traverse((e=>{!e.isMesh||t.nodeName&&e.name!==t.nodeName||(n=e)})),!n)return;const r=n.geometry.clone();n.updateWorldMatrix(!0,!1),r.applyMatrix4(n.matrixWorld),this.system.setNavMeshGeometry(r),this.hasLoadedNavMesh=!0}})),fa||(fa=1,AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Vector3;return function(r,i){const s=this.el,o=this.data,a=this.raycaster,l=o.speed*i/1e3;if(!o.active)return;if(!this.path.length){const e=this.el.object3D.position;this.group=this.group||this.system.getGroup(e),this.path=this.system.getPath(e,t.copy(o.destination),this.group)||[],s.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",o.destination),this.el.setAttribute("nav-agent",{active:!1}),void s.emit("navigation-end");const u=s.object3D.position,h=this.path[0];let c;if(e.subVectors(h,u),e.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void s.emit("navigation-end");n.copy(u),c=this.path[0]}else n.copy(e.setLength(l)).add(u),c=h;c.y=u.y,s.object3D.lookAt(c),a.ray.origin.copy(n),a.ray.origin.y+=1.5,a.ray.direction={x:0,y:-1,z:0};const d=a.intersectObject(this.system.getNavMesh());d.length?(e.subVectors(d[0].point,u),u.add(e.setLength(l))):u.copy(n)}}()})),function(){if(xa)return ba;xa=1;const{Pathfinding:t}=Sa,e=new t,n="level";ba=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(r){this.navMesh=new THREE.Mesh(r),e.setZoneData(n,t.createZone(r)),Array.from(this.agents).forEach((t=>t.updateNavLocation()))},getNavMesh:function(){return this.navMesh},addAgent:function(t){this.agents.add(t)},removeAgent:function(t){this.agents.delete(t)},getPath:function(t,r,i){return this.navMesh?e.findPath(t,r,n,i):null},getGroup:function(t){return this.navMesh?e.getGroup(n,t):null},getNode:function(t,r){return this.navMesh?e.getClosestNode(t,n,r,!0):null},clampStep:function(t,r,i,s,o){return this.navMesh?s?e.clampStep(t,r,s,n,i,o):(o.copy(r),this.getNode(r,i)):(o.copy(r),null)}})}()),ma}var Ea,Aa={};var Ca,Ra={};var Na,Pa,ka,Oa={};function Ia(){return Pa||(Pa=1,Ea||(Ea=1,AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})),Ca||(Ca=1,Ra.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),Ra.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const t=this.el,e=this.data;let n=t.components.material;const r=new THREE.PlaneGeometry(e.width,e.depth,e.density,e.density);this.waves=[];const i=r.getAttribute("position");for(let t=0;t<i.count;t++)this.waves.push({z:i.getZ(t),ang:Math.random()*Math.PI*2,amp:e.amplitude+Math.random()*e.amplitudeVariance,speed:(e.speed+Math.random()*e.speedVariance)/1e3});n||(n={},n.material=new THREE.MeshPhongMaterial({color:e.color,transparent:e.opacity<1,opacity:e.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(r,n.material),t.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(t,e){if(!e)return;const n=this.mesh.geometry.getAttribute("position");for(let t=0;t<n.count;t++){const r=this.waves[t],i=r.z+Math.sin(r.ang)*r.amp;n.setZ(t,i),r.ang+=r.speed*e}n.needsUpdate=!0}})),Na||(Na=1,Oa.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),Oa.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const t=this.el,e=this.data;let n=t.components.material;if(!e.path.length)return void console.error("[a-tube] `path` property expected but not found.");const r=new THREE.CatmullRomCurve3(e.path.map((function(t){return t=t.split(" "),new THREE.Vector3(Number(t[0]),Number(t[1]),Number(t[2]))}))),i=new THREE.TubeGeometry(r,e.segments,e.radius,e.radialSegments,e.closed);n||(n={},n.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(i,n.material),this.el.setObject3D("mesh",this.mesh)},update:function(t){Object.keys(t).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}}))),Aa}function Da(t,e,n){var r,i=1;function s(){var s,o,a=r.length,l=0,u=0,h=0;for(s=0;s<a;++s)l+=(o=r[s]).x||0,u+=o.y||0,h+=o.z||0;for(l=(l/a-t)*i,u=(u/a-e)*i,h=(h/a-n)*i,s=0;s<a;++s)o=r[s],l&&(o.x-=l),u&&(o.y-=u),h&&(o.z-=h)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t},s.x=function(e){return arguments.length?(t=+e,s):t},s.y=function(t){return arguments.length?(e=+t,s):e},s.z=function(t){return arguments.length?(n=+t,s):n},s.strength=function(t){return arguments.length?(i=+t,s):i},s}function La(t,e,n){if(isNaN(e))return t;var r,i,s,o,a,l,u=t._root,h={data:n},c=t._x0,d=t._x1;if(!u)return t._root=h,t;for(;u.length;)if((o=e>=(i=(c+d)/2))?c=i:d=i,r=u,!(u=u[a=+o]))return r[a]=h,t;if(e===(s=+t._x.call(null,u.data)))return h.next=u,r?r[a]=h:t._root=h,t;do{r=r?r[a]=new Array(2):t._root=new Array(2),(o=e>=(i=(c+d)/2))?c=i:d=i}while((a=+o)==(l=+(s>=i)));return r[l]=u,r[a]=h,t}function Ua(t,e,n){this.node=t,this.x0=e,this.x1=n}function Fa(t){return t[0]}function za(t,e){var n=new Ba(null==e?Fa:e,NaN,NaN);return null==t?n:n.addAll(t)}function Ba(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function ja(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}ka||(ka=1,at(),na(),da(),Ta(),Ia());var Va=za.prototype=Ba.prototype;function Ga(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,h,c,d,p=t._root,f={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o,i=p,!(p=p[c=h<<1|u]))return i[c]=f,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&n===l)return f.next=p,i?i[c]=f:t._root=f,t;do{i=i?i[c]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o}while((c=h<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=p,i[c]=f,t}function Ha(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Wa(t){return t[0]}function qa(t){return t[1]}function $a(t,e,n){var r=new Xa(null==e?Wa:e,null==n?qa:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Xa(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function Ya(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Va.copy=function(){var t,e,n=new Ba(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=ja(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=ja(e));return n},Va.add=function(t){const e=+this._x.call(null,t);return La(this.cover(e),e,t)},Va.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let s,o=0;o<e;++o)isNaN(s=+this._x.call(null,t[o]))||(n[o]=s,s<r&&(r=s),s>i&&(i=s));if(r>i)return this;this.cover(r).cover(i);for(let r=0;r<e;++r)La(this,n[r],t[r]);return this},Va.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,s=n-e||1,o=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=o,o=r,s*=2,i){case 0:n=e+s;break;case 1:e=n-s}this._root&&this._root.length&&(this._root=o)}return this._x0=e,this._x1=n,this},Va.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Va.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},Va.find=function(t,e){var n,r,i,s,o,a=this._x0,l=this._x1,u=[],h=this._root;for(h&&u.push(new Ua(h,a,l)),null==e?e=1/0:(a=t-e,l=t+e);s=u.pop();)if(!(!(h=s.node)||(r=s.x0)>l||(i=s.x1)<a))if(h.length){var c=(r+i)/2;u.push(new Ua(h[1],c,i),new Ua(h[0],r,c)),(o=+(t>=c))&&(s=u[u.length-1],u[u.length-1]=u[u.length-1-o],u[u.length-1-o]=s)}else{var d=Math.abs(t-+this._x.call(null,h.data));d<e&&(e=d,a=t-d,l=t+d,n=h.data)}return n},Va.remove=function(t){if(isNaN(s=+this._x.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h=this._root,c=this._x0,d=this._x1;if(!h)return this;if(h.length)for(;;){if((a=s>=(o=(c+d)/2))?c=o:d=o,e=h,!(h=h[l=+a]))return this;if(!h.length)break;e[l+1&1]&&(n=e,u=l)}for(;h.data!==t;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(h=e[0]||e[1])&&h===(e[1]||e[0])&&!h.length&&(n?n[u]=h:this._root=h),this):(this._root=i,this)},Va.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Va.root=function(){return this._root},Va.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Va.visit=function(t){var e,n,r,i,s=[],o=this._root;for(o&&s.push(new Ua(o,this._x0,this._x1));e=s.pop();)if(!t(o=e.node,r=e.x0,i=e.x1)&&o.length){var a=(r+i)/2;(n=o[1])&&s.push(new Ua(n,a,i)),(n=o[0])&&s.push(new Ua(n,r,a))}return this},Va.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ua(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.x1,l=(o+a)/2;(s=i[0])&&n.push(new Ua(s,o,l)),(s=i[1])&&n.push(new Ua(s,l,a))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},Va.x=function(t){return arguments.length?(this._x=t,this):this._x};var Ka=$a.prototype=Xa.prototype;function Za(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var s,o,a,l,u,h,c,d,p,f,m,g,y=t._root,v={data:i},_=t._x0,b=t._y0,x=t._z0,w=t._x1,M=t._y1,S=t._z1;if(!y)return t._root=v,t;for(;y.length;)if((d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l,s=y,!(y=y[m=f<<2|p<<1|d]))return s[m]=v,t;if(u=+t._x.call(null,y.data),h=+t._y.call(null,y.data),c=+t._z.call(null,y.data),e===u&&n===h&&r===c)return v.next=y,s?s[m]=v:t._root=v,t;do{s=s?s[m]=new Array(8):t._root=new Array(8),(d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l}while((m=f<<2|p<<1|d)==(g=(c>=l)<<2|(h>=a)<<1|u>=o));return s[g]=y,s[m]=v,t}function Ja(t,e,n,r,i,s,o){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=s,this.z1=o}Ka.copy=function(){var t,e,n=new Xa(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Ya(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Ya(e));return n},Ka.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Ga(this.cover(e,n),e,n,t)},Ka.addAll=function(t){var e,n,r,i,s=t.length,o=new Array(s),a=new Array(s),l=1/0,u=1/0,h=-1/0,c=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,a[n]=i,r<l&&(l=r),r>h&&(h=r),i<u&&(u=i),i>c&&(c=i));if(l>h||u>c)return this;for(this.cover(l,u).cover(h,c),n=0;n<s;++n)Ga(this,o[n],a[n],t[n]);return this},Ka.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},Ka.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Ka.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ka.find=function(t,e,n){var r,i,s,o,a,l,u,h=this._x0,c=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new Ha(m,h,c,d,p)),null==n?n=1/0:(h=t-n,c=e-n,d=t+n,p=e+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(s=l.y0)>p||(o=l.x1)<h||(a=l.y1)<c))if(m.length){var g=(i+o)/2,y=(s+a)/2;f.push(new Ha(m[3],g,y,o,a),new Ha(m[2],i,y,g,a),new Ha(m[1],g,s,o,y),new Ha(m[0],i,s,g,y)),(u=(e>=y)<<1|t>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-u],f[f.length-1-u]=l)}else{var v=t-+this._x.call(null,m.data),_=e-+this._y.call(null,m.data),b=v*v+_*_;if(b<n){var x=Math.sqrt(n=b);h=t-x,c=e-x,d=t+x,p=e+x,r=m.data}}return r},Ka.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((u=s>=(a=(f+g)/2))?f=a:g=a,(h=o>=(l=(m+y)/2))?m=l:y=l,e=p,!(p=p[c=h<<1|u]))return this;if(!p.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(n=e,d=c)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[c]=i:delete e[c],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},Ka.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Ka.root=function(){return this._root},Ka.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Ka.visit=function(t){var e,n,r,i,s,o,a=[],l=this._root;for(l&&a.push(new Ha(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,s=e.x1,o=e.y1)&&l.length){var u=(r+s)/2,h=(i+o)/2;(n=l[3])&&a.push(new Ha(n,u,h,s,o)),(n=l[2])&&a.push(new Ha(n,r,h,u,o)),(n=l[1])&&a.push(new Ha(n,u,i,s,h)),(n=l[0])&&a.push(new Ha(n,r,i,u,h))}return this},Ka.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ha(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.x1,u=e.y1,h=(o+l)/2,c=(a+u)/2;(s=i[0])&&n.push(new Ha(s,o,a,h,c)),(s=i[1])&&n.push(new Ha(s,h,a,l,c)),(s=i[2])&&n.push(new Ha(s,o,c,h,u)),(s=i[3])&&n.push(new Ha(s,h,c,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Ka.x=function(t){return arguments.length?(this._x=t,this):this._x},Ka.y=function(t){return arguments.length?(this._y=t,this):this._y};const Qa=(t,e,n,r,i,s)=>Math.sqrt((t-r)**2+(e-i)**2+(n-s)**2);function tl(t){return t[0]}function el(t){return t[1]}function nl(t){return t[2]}function rl(t,e,n,r){var i=new il(null==e?tl:e,null==n?el:n,null==r?nl:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function il(t,e,n,r,i,s,o,a,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function sl(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var ol=rl.prototype=il.prototype;function al(t){return function(){return t}}function ll(t){return 1e-6*(t()-.5)}function ul(t){return t.index}function hl(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function cl(t){var e,n,r,i,s,o,a,l=ul,u=function(t){return 1/Math.min(s[t.source.index],s[t.target.index])},h=al(30),c=1;function d(r){for(var s=0,l=t.length;s<c;++s)for(var u,h,d,p,f,m=0,g=0,y=0,v=0;m<l;++m)h=(u=t[m]).source,g=(d=u.target).x+d.vx-h.x-h.vx||ll(a),i>1&&(y=d.y+d.vy-h.y-h.vy||ll(a)),i>2&&(v=d.z+d.vz-h.z-h.vz||ll(a)),g*=p=((p=Math.sqrt(g*g+y*y+v*v))-n[m])/p*r*e[m],y*=p,v*=p,d.vx-=g*(f=o[m]),i>1&&(d.vy-=y*f),i>2&&(d.vz-=v*f),h.vx+=g*(f=1-f),i>1&&(h.vy+=y*f),i>2&&(h.vz+=v*f)}function p(){if(r){var i,a,u=r.length,h=t.length,c=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(i=0,s=new Array(u);i<h;++i)(a=t[i]).index=i,"object"!=typeof a.source&&(a.source=hl(c,a.source)),"object"!=typeof a.target&&(a.target=hl(c,a.target)),s[a.source.index]=(s[a.source.index]||0)+1,s[a.target.index]=(s[a.target.index]||0)+1;for(i=0,o=new Array(h);i<h;++i)a=t[i],o[i]=s[a.source.index]/(s[a.source.index]+s[a.target.index]);e=new Array(h),f(),n=new Array(h),m()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function m(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,...e){r=t,a=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,p()},d.links=function(e){return arguments.length?(t=e,p(),d):t},d.id=function(t){return arguments.length?(l=t,d):l},d.iterations=function(t){return arguments.length?(c=+t,d):c},d.strength=function(t){return arguments.length?(u="function"==typeof t?t:al(+t),f(),d):u},d.distance=function(t){return arguments.length?(h="function"==typeof t?t:al(+t),m(),d):h},d}ol.copy=function(){var t,e,n=new il(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=sl(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=sl(e));return n},ol.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return Za(this.cover(e,n,r),e,n,r,t)},ol.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c,d,p,f,m=0;m<e;++m)isNaN(d=+this._x.call(null,c=t[m]))||isNaN(p=+this._y.call(null,c))||isNaN(f=+this._z.call(null,c))||(n[m]=d,r[m]=p,i[m]=f,d<s&&(s=d),d>l&&(l=d),p<o&&(o=p),p>u&&(u=p),f<a&&(a=f),f>h&&(h=f));if(s>l||o>u||a>h)return this;this.cover(s,o,a).cover(l,u,h);for(let s=0;s<e;++s)Za(this,n[s],r[s],i[s],t[s]);return this},ol.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(t))+1,a=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var u,h,c=o-r||1,d=this._root;r>t||t>=o||i>e||e>=a||s>n||n>=l;)switch(h=(n<s)<<2|(e<i)<<1|t<r,(u=new Array(8))[h]=d,d=u,c*=2,h){case 0:o=r+c,a=i+c,l=s+c;break;case 1:r=o-c,a=i+c,l=s+c;break;case 2:o=r+c,i=a-c,l=s+c;break;case 3:r=o-c,i=a-c,l=s+c;break;case 4:o=r+c,a=i+c,s=l-c;break;case 5:r=o-c,a=i+c,s=l-c;break;case 6:o=r+c,i=a-c,s=l-c;break;case 7:r=o-c,i=a-c,s=l-c}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this},ol.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ol.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},ol.find=function(t,e,n,r){var i,s,o,a,l,u,h,c,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,y=this._y1,v=this._z1,_=[],b=this._root;for(b&&_.push(new Ja(b,p,f,m,g,y,v)),null==r?r=1/0:(p=t-r,f=e-r,m=n-r,g=t+r,y=e+r,v=n+r,r*=r);c=_.pop();)if(!(!(b=c.node)||(s=c.x0)>g||(o=c.y0)>y||(a=c.z0)>v||(l=c.x1)<p||(u=c.y1)<f||(h=c.z1)<m))if(b.length){var x=(s+l)/2,w=(o+u)/2,M=(a+h)/2;_.push(new Ja(b[7],x,w,M,l,u,h),new Ja(b[6],s,w,M,x,u,h),new Ja(b[5],x,o,M,l,w,h),new Ja(b[4],s,o,M,x,w,h),new Ja(b[3],x,w,a,l,u,M),new Ja(b[2],s,w,a,x,u,M),new Ja(b[1],x,o,a,l,w,M),new Ja(b[0],s,o,a,x,w,M)),(d=(n>=M)<<2|(e>=w)<<1|t>=x)&&(c=_[_.length-1],_[_.length-1]=_[_.length-1-d],_[_.length-1-d]=c)}else{var S=t-+this._x.call(null,b.data),T=e-+this._y.call(null,b.data),E=n-+this._z.call(null,b.data),A=S*S+T*T+E*E;if(A<r){var C=Math.sqrt(r=A);p=t-C,f=e-C,m=n-C,g=t+C,y=e+C,v=n+C,i=b.data}}return i},ol.findAllWithinRadius=function(t,e,n,r){const i=[],s=t-r,o=e-r,a=n-r,l=t+r,u=e+r,h=n+r;return this.visit(((c,d,p,f,m,g,y)=>{if(!c.length)do{const s=c.data;Qa(t,e,n,this._x(s),this._y(s),this._z(s))<=r&&i.push(s)}while(c=c.next);return d>l||p>u||f>h||m<s||g<o||y<a})),i},ol.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(a=+this._z.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g=this._root,y=this._x0,v=this._y0,_=this._z0,b=this._x1,x=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((c=s>=(l=(y+b)/2))?y=l:b=l,(d=o>=(u=(v+x)/2))?v=u:x=u,(p=a>=(h=(_+w)/2))?_=h:w=h,e=g,!(g=g[f=p<<2|d<<1|c]))return this;if(!g.length)break;(e[f+1&7]||e[f+2&7]||e[f+3&7]||e[f+4&7]||e[f+5&7]||e[f+6&7]||e[f+7&7])&&(n=e,m=f)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},ol.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},ol.root=function(){return this._root},ol.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ol.visit=function(t){var e,n,r,i,s,o,a,l,u=[],h=this._root;for(h&&u.push(new Ja(h,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=u.pop();)if(!t(h=e.node,r=e.x0,i=e.y0,s=e.z0,o=e.x1,a=e.y1,l=e.z1)&&h.length){var c=(r+o)/2,d=(i+a)/2,p=(s+l)/2;(n=h[7])&&u.push(new Ja(n,c,d,p,o,a,l)),(n=h[6])&&u.push(new Ja(n,r,d,p,c,a,l)),(n=h[5])&&u.push(new Ja(n,c,i,p,o,d,l)),(n=h[4])&&u.push(new Ja(n,r,i,p,c,d,l)),(n=h[3])&&u.push(new Ja(n,c,d,s,o,a,p)),(n=h[2])&&u.push(new Ja(n,r,d,s,c,a,p)),(n=h[1])&&u.push(new Ja(n,c,i,s,o,d,p)),(n=h[0])&&u.push(new Ja(n,r,i,s,c,d,p))}return this},ol.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ja(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.z0,u=e.x1,h=e.y1,c=e.z1,d=(o+u)/2,p=(a+h)/2,f=(l+c)/2;(s=i[0])&&n.push(new Ja(s,o,a,l,d,p,f)),(s=i[1])&&n.push(new Ja(s,d,a,l,u,p,f)),(s=i[2])&&n.push(new Ja(s,o,p,l,d,h,f)),(s=i[3])&&n.push(new Ja(s,d,p,l,u,h,f)),(s=i[4])&&n.push(new Ja(s,o,a,f,d,p,c)),(s=i[5])&&n.push(new Ja(s,d,a,f,u,p,c)),(s=i[6])&&n.push(new Ja(s,o,p,f,d,h,c)),(s=i[7])&&n.push(new Ja(s,d,p,f,u,h,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},ol.x=function(t){return arguments.length?(this._x=t,this):this._x},ol.y=function(t){return arguments.length?(this._y=t,this):this._y},ol.z=function(t){return arguments.length?(this._z=t,this):this._z};var dl={value:()=>{}};function pl(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new fl(r)}function fl(t){this._=t}function ml(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function gl(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=dl,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}fl.prototype=pl.prototype={constructor:fl,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=gl(i[n],t.name,e);else if(null==e)for(n in i)i[n]=gl(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=ml(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new fl(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};var yl,vl,_l=0,bl=0,xl=0,wl=0,Ml=0,Sl=0,Tl="object"==typeof performance&&performance.now?performance:Date,El="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Al(){return Ml||(El(Cl),Ml=Tl.now()+Sl)}function Cl(){Ml=0}function Rl(){this._call=this._time=this._next=null}function Nl(t,e,n){var r=new Rl;return r.restart(t,e,n),r}function Pl(){Ml=(wl=Tl.now())+Sl,_l=bl=0;try{!function(){Al(),++_l;for(var t,e=yl;e;)(t=Ml-e._time)>=0&&e._call.call(void 0,t),e=e._next;--_l}()}finally{_l=0,function(){var t,e,n=yl,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:yl=e);vl=t,Ol(r)}(),Ml=0}}function kl(){var t=Tl.now(),e=t-wl;e>1e3&&(Sl-=e,wl=t)}function Ol(t){_l||(bl&&(bl=clearTimeout(bl)),t-Ml>24?(t<1/0&&(bl=setTimeout(Pl,t-Tl.now()-Sl)),xl&&(xl=clearInterval(xl))):(xl||(wl=Tl.now(),xl=setInterval(kl,1e3)),_l=1,El(Pl)))}Rl.prototype=Nl.prototype={constructor:Rl,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Al():+n)+(null==e?0:+e),this._next||vl===this||(vl?vl._next=this:yl=this,vl=this),this._call=t,this._time=n,Ol()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ol())}};const Il=4294967296;function Dl(t){return t.x}function Ll(t){return t.y}function Ul(t){return t.z}var Fl,zl,Bl,jl,Vl=Math.PI*(3-Math.sqrt(5)),Gl=20*Math.PI/(9+Math.sqrt(221));function Hl(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,h=Nl(p),c=pl("tick","end"),d=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Il)/Il}();function p(){f(),c.call("tick",n),i<s&&(h.stop(),c.call("end",n))}function f(e){var s,h,c=t.length;void 0===e&&(e=1);for(var d=0;d<e;++d)for(i+=(a-i)*o,u.forEach((function(t){t(i)})),s=0;s<c;++s)null==(h=t[s]).fx?h.x+=h.vx*=l:(h.x=h.fx,h.vx=0),r>1&&(null==h.fy?h.y+=h.vy*=l:(h.y=h.fy,h.vy=0)),r>2&&(null==h.fz?h.z+=h.vz*=l:(h.z=h.fz,h.vz=0));return n}function m(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var s=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),o=n*Vl,a=n*Gl;1===r?e.x=s:2===r?(e.x=s*Math.cos(o),e.y=s*Math.sin(o)):(e.x=s*Math.sin(o)*Math.cos(a),e.y=s*Math.cos(o),e.z=s*Math.sin(o)*Math.sin(a))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,d,r),e}return null==t&&(t=[]),m(),n={tick:f,restart:function(){return h.restart(p),n},stop:function(){return h.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),u.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,m(),u.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(s=+t,n):s},alphaDecay:function(t){return arguments.length?(o=+t,n):+o},alphaTarget:function(t){return arguments.length?(a=+t,n):a},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(d=t,u.forEach(g),n):d},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,g(e)),n):u.get(t)},find:function(){var e,n,i,s,o,a,l=Array.prototype.slice.call(arguments),u=l.shift()||0,h=(r>1?l.shift():null)||0,c=(r>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=t.length;for(d*=d,p=0;p<f;++p)(s=(e=u-(o=t[p]).x)*e+(n=h-(o.y||0))*n+(i=c-(o.z||0))*i)<d&&(a=o,d=s);return a},on:function(t,e){return arguments.length>1?(c.on(t,e),n):c.on(t)}}}function Wl(){var t,e,n,r,i,s,o=al(-30),a=1,l=1/0,u=.81;function h(r){var s,o=t.length,a=(1===e?za(t,Dl):2===e?$a(t,Dl,Ll):3===e?rl(t,Dl,Ll,Ul):null).visitAfter(d);for(i=r,s=0;s<o;++s)n=t[s],a.visit(p)}function c(){if(t){var e,n,r=t.length;for(s=new Array(r),e=0;e<r;++e)n=t[e],s[n.index]=+o(n,e,t)}}function d(t){var n,r,i,o,a,l,u=0,h=0,c=t.length;if(c){for(i=o=a=l=0;l<c;++l)(n=t[l])&&(r=Math.abs(n.value))&&(u+=n.value,h+=r,i+=r*(n.x||0),o+=r*(n.y||0),a+=r*(n.z||0));u*=Math.sqrt(4/c),t.x=i/h,e>1&&(t.y=o/h),e>2&&(t.z=a/h)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{u+=s[n.data.index]}while(n=n.next)}t.value=u}function p(t,o,h,c,d){if(!t.value)return!0;var p=[h,c,d][e-1],f=t.x-n.x,m=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,y=p-o,v=f*f+m*m+g*g;if(y*y/u<v)return v<l&&(0===f&&(v+=(f=ll(r))*f),e>1&&0===m&&(v+=(m=ll(r))*m),e>2&&0===g&&(v+=(g=ll(r))*g),v<a&&(v=Math.sqrt(a*v)),n.vx+=f*t.value*i/v,e>1&&(n.vy+=m*t.value*i/v),e>2&&(n.vz+=g*t.value*i/v)),!0;if(!(t.length||v>=l)){(t.data!==n||t.next)&&(0===f&&(v+=(f=ll(r))*f),e>1&&0===m&&(v+=(m=ll(r))*m),e>2&&0===g&&(v+=(g=ll(r))*g),v<a&&(v=Math.sqrt(a*v)));do{t.data!==n&&(y=s[t.data.index]*i/v,n.vx+=f*y,e>1&&(n.vy+=m*y),e>2&&(n.vz+=g*y))}while(t=t.next)}}return h.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,c()},h.strength=function(t){return arguments.length?(o="function"==typeof t?t:al(+t),c(),h):o},h.distanceMin=function(t){return arguments.length?(a=t*t,h):Math.sqrt(a)},h.distanceMax=function(t){return arguments.length?(l=t*t,h):Math.sqrt(l)},h.theta=function(t){return arguments.length?(u=t*t,h):Math.sqrt(u)},h}function ql(){if(zl)return Fl;return zl=1,Fl=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var s=e[n];return s||(s=e[n]=[]),s.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],s=0;s<i.length;++s)i[s].callback===r&&i.splice(s,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t},Fl}var $l,Xl,Yl,Kl,Zl,Jl=function(){if(jl)return Bl;jl=1,Bl=function(s){"uniqueLinkId"in(s=s||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),s.multigraph=s.uniqueLinkId);void 0===s.multigraph&&(s.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var o=new Map,a=new Map,l={},u=0,h=s.multigraph?function(t,e,n){var s=i(t,e),o=l.hasOwnProperty(s);if(o||T(t,e)){o||(l[s]=0);var a="@"+ ++l[s];s=i(t+a,e+a)}return new r(t,e,n,s)}:function(t,e,n){var s=i(t,e),o=a.get(s);if(o)return o.data=n,o;return new r(t,e,n,s)},c=[],d=E,p=E,f=E,m=E,g={version:20,addNode:_,addLink:function(t,e,r){f();var i=b(t)||_(t),s=b(e)||_(e),o=h(t,e,r),l=a.has(o.id);a.set(o.id,o),n(i,o),t!==e&&n(s,o);return d(o,l?"update":"add"),m(),o},removeLink:function(t,e){void 0!==e&&(t=T(t,e));return S(t)},removeNode:x,getNode:b,getNodeCount:w,getLinkCount:M,getEdgeCount:M,getLinksCount:M,getNodesCount:w,getLinks:function(t){var e=b(t);return e?e.links:null},forEachNode:R,forEachLinkedNode:function(t,e,n){var r=b(t);if(r&&r.links&&"function"==typeof e)return n?function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value;if(s.fromId===e&&n(o.get(s.toId),s))return!0;i=r.next()}}(r.links,t,e):function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value,a=s.fromId===e?s.toId:s.fromId;if(n(o.get(a),s))return!0;i=r.next()}}(r.links,t,e)},forEachLink:function(t){if("function"==typeof t)for(var e=a.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),R((function(t){x(t.id)})),m()},hasLink:T,hasNode:b,getLink:T};return t(g),function(){var t=g.on;function e(){return g.beginUpdate=f=A,g.endUpdate=m=C,d=y,p=v,g.on=t,t.apply(g,arguments)}g.on=e}(),g;function y(t,e){c.push({link:t,changeType:e})}function v(t,e){c.push({node:t,changeType:e})}function _(t,n){if(void 0===t)throw new Error("Invalid node identifier");f();var r=b(t);return r?(r.data=n,p(r,"update")):(r=new e(t,n),p(r,"add")),o.set(t,r),m(),r}function b(t){return o.get(t)}function x(t){var e=b(t);if(!e)return!1;f();var n=e.links;return n&&(n.forEach(S),e.links=null),o.delete(t),p(e,"remove"),m(),!0}function w(){return o.size}function M(){return a.size}function S(t){if(!t)return!1;if(!a.get(t.id))return!1;f(),a.delete(t.id);var e=b(t.fromId),n=b(t.toId);return e&&e.links.delete(t),n&&n.links.delete(t),d(t,"remove"),m(),!0}function T(t,e){if(void 0!==t&&void 0!==e)return a.get(i(t,e))}function E(){}function A(){u+=1}function C(){0===(u-=1)&&c.length>0&&(g.fire("changed",c),c.length=0)}function R(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var e=o.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}}};var t=ql();function e(t,e){this.id=t,this.links=null,this.data=e}function n(t,e){t.links?t.links.add(e):t.links=new Set([e])}function r(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function i(t,e){return t.toString()+" "+e.toString()}return Bl}(),Ql=p(Jl),tu={exports:{}},eu={exports:{}};function nu(){return Xl||(Xl=1,$l=function(t){return 0===t?"x":1===t?"y":2===t?"z":"c"+(t+1)}),$l}function ru(){if(Kl)return Yl;Kl=1;const t=nu();return Yl=function(e){return function(n,r){let i=r&&r.indent||0,s=r&&void 0!==r.join?r.join:"\n",o=Array(i+1).join(" "),a=[];for(let r=0;r<e;++r){let e=t(r),i=0===r?"":o;a.push(i+n.replace(/{var}/g,e))}return a.join(s)}},Yl}var iu,su={exports:{}};var ou,au={exports:{}};var lu,uu={exports:{}};var hu,cu={exports:{}};var du,pu,fu,mu,gu,yu={exports:{}};var vu,_u,bu,xu,wu={exports:{}};function Mu(){if(bu)return _u;bu=1,_u=function(l){var u=(fu||(fu=1,pu=function(t,e,n,r){this.from=t,this.to=e,this.length=n,this.coefficient=r}),pu),h=(gu||(gu=1,mu=function t(e,n){var r;if(e||(e={}),n)for(r in n)if(n.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof n[r];i&&typeof e[r]===s?"object"===s&&(e[r]=t(e[r],n[r])):e[r]=n[r]}return e}),mu),c=ql();if(l){if(void 0!==l.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==l.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}l=h(l,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var d=o[l.dimensions];if(!d){var p=l.dimensions;d={Body:t(p,l.debug),createQuadTree:e(p),createBounds:n(p),createDragForce:r(p),createSpringForce:i(p),integrate:s(p)},o[p]=d}var f=d.Body,m=d.createQuadTree,g=d.createBounds,y=d.createDragForce,v=d.createSpringForce,_=d.integrate,b=function(){if(vu)return wu.exports;function t(t){return new e("number"==typeof t?t:+new Date)}function e(t){this.seed=t}function n(t){return Math.sqrt(2*Math.PI/t)*Math.pow(1/Math.E*(t+1/(12*t-1/(10*t))),t)}function r(){var t=this.seed;return t=4294967295&(3042594569^(t=4251993797+(t=4294967295&(3550635116+(t=374761393+(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+(t<<5)&4294967295)^t<<9))+(t<<3)&4294967295)^t>>>16),this.seed=t,(268435455&t)/268435456}return vu=1,wu.exports=t,wu.exports.random=t,wu.exports.randomIterator=function(e,n){var r=n||t();if("function"!=typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(t){var n,i,s;for(n=e.length-1;n>0;--n)i=r.next(n+1),s=e[i],e[i]=e[n],e[n]=s,t(s);e.length&&t(e[0])},shuffle:function(){var t,n,i;for(t=e.length-1;t>0;--t)n=r.next(t+1),i=e[n],e[n]=e[t],e[t]=i;return e}}},e.prototype.next=function(t){return Math.floor(this.nextDouble()*t)},e.prototype.nextDouble=r,e.prototype.uniform=r,e.prototype.gaussian=function(){var t,e,n;do{t=(e=2*this.nextDouble()-1)*e+(n=2*this.nextDouble()-1)*n}while(t>=1||0===t);return e*Math.sqrt(-2*Math.log(t)/t)},e.prototype.levy=function(){var t=1.5,e=Math.pow(n(2.5)*Math.sin(Math.PI*t/2)/(n(1.25)*t*Math.pow(2,.25)),1/t);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/t)},wu.exports}().random(42),x=[],w=[],M=m(l,b),S=g(x,l,b),T=v(l,b),E=y(l),A=[],C=new Map,R=0;k("nbody",(function(){if(0===x.length)return;M.insertBodies(x);var t=x.length;for(;t--;){var e=x[t];e.isPinned||(e.reset(),M.updateBodyForce(e),E.update(e))}})),k("spring",(function(){var t=w.length;for(;t--;)T.update(w[t])}));var N={bodies:x,quadTree:M,springs:w,settings:l,addForce:k,removeForce:function(t){var e=A.indexOf(C.get(t));if(e<0)return;A.splice(e,1),C.delete(t)},getForces:function(){return C},step:function(){for(var t=0;t<A.length;++t)A[t](R);var e=_(x,l.timeStep,l.adaptiveTimeStepWeight);return R+=1,e},addBody:function(t){if(!t)throw new Error("Body is required");return x.push(t),t},addBodyAt:function(t){if(!t)throw new Error("Body position is required");var e=(t=>new f(t))(t);return x.push(e),e},removeBody:function(t){if(t){var e=x.indexOf(t);if(!(e<0))return x.splice(e,1),0===x.length&&S.reset(),!0}},addSpring:function(t,e,n,r){if(!t||!e)throw new Error("Cannot add null spring to force simulator");"number"!=typeof n&&(n=-1);var i=new u(t,e,n,r>=0?r:-1);return w.push(i),i},getTotalMovement:function(){return 0},removeSpring:function(t){if(t){var e=w.indexOf(t);return e>-1?(w.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(t){return S.getBestNewPosition(t)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(t){return void 0!==t?(l.gravity=t,M.options({gravity:t}),this):l.gravity},theta:function(t){return void 0!==t?(l.theta=t,M.options({theta:t}),this):l.theta},random:b};return function(t,e){for(var n in t)a(t,e,n)}(l,N),c(N),N;function P(){return S.update(),S.box}function k(t,e){if(C.has(t))throw new Error("Force "+t+" is already added");C.set(t,e),A.push(e)}};var t=function(){if(Zl)return eu.exports;Zl=1;const t=ru();function e(t,e){return`\n${r(t,e)}\n${n(t)}\nreturn {Body: Body, Vector: Vector};\n`}function n(e){let n=t(e),r=n("{var}",{join:", "});return`\nfunction Body(${r}) {\n  this.isPinned = false;\n  this.pos = new Vector(${r});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${r}) {\n  ${n("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function r(e,n){let r=t(e),i="";return n&&(i=`${r("\n\t   var v{var};\n\tObject.defineProperty(this, '{var}', {\n\t  set: function(v) { \n\t    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n\t    v{var} = v; \n\t  },\n\t  get: function() { return v{var}; }\n\t});")}`),`function Vector(${r("{var}",{join:", "})}) {\n  ${i}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${r('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${r("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${r('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${r("this.{var} = ",{join:""})}0;\n  };`}return eu.exports=function(t,n){let r=e(t,n),{Body:i}=new Function(r)();return i},eu.exports.generateCreateBodyFunctionBody=e,eu.exports.getVectorCode=r,eu.exports.getBodyCode=n,eu.exports}(),e=function(){if(iu)return su.exports;iu=1;const t=ru(),e=nu();function n(n){let l=t(n),u=Math.pow(2,n),h=`\n${a()}\n${o(n)}\n${r(n)}\n${s(n)}\n${i(n)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(t){let e=[];for(let n=0;n<u;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("      node.")}\n      node.body = null;\n      node.mass = ${l("node.mass_{var} = ",{join:""})}0;\n      ${l("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${l("var d{var};",{indent:4})}\n    var r; \n    ${l("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${l("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${l("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${l("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < , treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${l("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let t=Array(11).join(" "),e=[];for(let n=0;n<u;++n)e.push(t+`if (node.quad${n}) {`),e.push(t+`  queue[pushIdx] = node.quad${n};`),e.push(t+"  queueLength += 1;"),e.push(t+"  pushIdx += 1;"),e.push(t+"}");return e.join("\n")}()}\n        }\n      }\n    }\n\n    ${l("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${l("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${l("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${l("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${l("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${l("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${l("root.min_{var} = {var}min;",{indent:4})}\n    ${l("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${l("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${l("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${l("var min_{var} = node.min_{var};",{indent:8})}\n        ${l("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(){let t=[],r=Array(8+1).join(" ");for(let i=0;i<n;++i)t.push(r+`if (${e(i)} > max_${e(i)}) {`),t.push(r+`  quadIdx = quadIdx + ${Math.pow(2,i)};`),t.push(r+`  min_${e(i)} = max_${e(i)};`),t.push(r+`  max_${e(i)} = node.max_${e(i)};`),t.push(r+"}");return t.join("\n")}()}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${l("child.min_{var} = min_{var};",{indent:10})}\n          ${l("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${l("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${l("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`;return h}function r(e){let n=t(e);return`\n  function isSamePosition(point1, point2) {\n    ${n("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${n("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function i(t){var e=Math.pow(2,t);return`\nfunction setChild(node, idx, child) {\n  ${function(){let t=[];for(let n=0;n<e;++n){let e=0===n?"  ":"  else ";t.push(`${e}if (idx === ${n}) node.quad${n} = child;`)}return t.join("\n")}()}\n}`}function s(t){return`function getChild(node, idx) {\n${function(){let e=[],n=Math.pow(2,t);for(let t=0;t<n;++t)e.push(`  if (idx === ${t}) return node.quad${t};`);return e.join("\n")}()}\n  return null;\n}`}function o(e){let n=t(e),r=Math.pow(2,e);var i=`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(t){let e=[];for(let n=0;n<r;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("  this.")}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${n("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${n("this.min_{var} = 0;",{indent:2})}\n  ${n("this.max_{var} = 0;",{indent:2})}\n}\n`;return i}function a(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}return su.exports=function(t){let e=n(t);return new Function(e)()},su.exports.generateQuadTreeFunctionBody=n,su.exports.getInsertStackCode=a,su.exports.getQuadNodeCode=o,su.exports.isSamePosition=r,su.exports.getChildBodyCode=s,su.exports.setChildBodyCode=i,su.exports}(),n=function(){if(ou)return au.exports;ou=1,au.exports=function(t){let n=e(t);return new Function("bodies","settings","random",n)},au.exports.generateFunctionBody=e;const t=ru();function e(e){let n=t(e);return`\n  var boundingBox = {\n    ${n("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${n("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${n("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${n("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${n("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${n("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${n("var max_{var} = -Infinity;",{indent:4})}\n    ${n("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${n("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${n("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${n("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${n("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${n("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}return au.exports}(),r=function(){if(lu)return uu.exports;lu=1;const t=ru();function e(e){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${t(e)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}return uu.exports=function(t){let n=e(t);return new Function("options",n)},uu.exports.generateCreateDragForceFunctionBody=e,uu.exports}(),i=function(){if(hu)return cu.exports;hu=1;const t=ru();function e(e){let n=t(e);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${n("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${n("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${n("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${n("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}return cu.exports=function(t){let n=e(t);return new Function("options","random",n)},cu.exports.generateCreateSpringForceFunctionBody=e,cu.exports}(),s=function(){if(du)return yu.exports;du=1;const t=ru();function e(e){let n=t(e);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${n("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${n("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${n("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${n("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${n("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${n("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${n("body.pos.{var} += d{var};",{indent:4})}\n\n    ${n("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${n("t{var} * t{var}",{join:" + "})})/length;\n`}return yu.exports=function(t){let n=e(t);return new Function("bodies","timeStep","adaptiveTimeStepWeight",n)},yu.exports.generateIntegratorFunctionBody=e,yu.exports}(),o={};function a(t,e,n){if(t.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=Number.isFinite(t[n]);e[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return t[n]=r,e}return t[n]}:function(r){return void 0!==r?(t[n]=r,e):t[n]}}}return _u}var Su=function(){if(xu)return tu.exports;xu=1,tu.exports=function(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var i=(r&&r.createSimulator||Mu())(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var s=n.version>19?function(t){var e=n.getLinks(t);return e?1+e.size/3:1}:function(t){var e=n.getLinks(t);return e?1+e.length/3:1};r&&"function"==typeof r.nodeMass&&(s=r.nodeMass);var o=new Map,a={},l=0,u=i.settings.springTransform||e;l=0,n.forEachNode((function(t){m(t.id),l+=1})),n.forEachLink(y),n.on("changed",f);var h=!1,c={step:function(){if(0===l)return d(!0),!0;var t=i.step();c.lastMove=t,c.fire("step");var e=t/l<=.01;return d(e),e},getNodePosition:function(t){return b(t).pos},setNodePosition:function(t){var e=b(t);e.setPosition.apply(e,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(t){var e=a[t];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:p,pinNode:function(t,e){b(t.id).isPinned=!!e},isNodePinned:function(t){return b(t.id).isPinned},dispose:function(){n.off("changed",f),c.fire("disposed")},getBody:function(t){return o.get(t)},getSpring:function(t,e){var r;if(void 0===e)r="object"!=typeof t?t:t.id;else{var i=n.hasLink(t,e);if(!i)return;r=i.id}return a[r]},getForceVectorLength:function(){var t=0,e=0;return p((function(n){t+=Math.abs(n.force.x),e+=Math.abs(n.force.y)})),Math.sqrt(t*t+e*e)},simulator:i,graph:n,lastMove:0};return t(c),c;function d(t){var e;h!==t&&(h=t,e=t,c.fire("stable",e))}function p(t){o.forEach(t)}function f(t){for(var e=0;e<t.length;++e){var r=t[e];"add"===r.changeType?(r.node&&m(r.node.id),r.link&&y(r.link)):"remove"===r.changeType&&(r.node&&g(r.node),r.link&&v(r.link))}l=n.getNodesCount()}function m(t){var e=o.get(t);if(!e){var r=n.getNode(t);if(!r)throw new Error("initBody() was called with unknown node id");var s=r.position;if(!s){var a=function(t){var e=[];if(!t.links)return e;for(var n=Math.min(t.links.length,2),r=0;r<n;++r){var i=t.links[r],s=i.fromId!==t.id?o.get(i.fromId):o.get(i.toId);s&&s.pos&&e.push(s)}return e}(r);s=i.getBestNewBodyPosition(a)}(e=i.addBodyAt(s)).id=t,o.set(t,e),_(t),function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)}(r)&&(e.isPinned=!0)}}function g(t){var e=t.id,n=o.get(e);n&&(o.delete(e),i.removeBody(n))}function y(t){_(t.fromId),_(t.toId);var e=o.get(t.fromId),n=o.get(t.toId),r=i.addSpring(e,n,t.length);u(t,r),a[t.id]=r}function v(t){var e=a[t.id];if(e){var r=n.getNode(t.fromId),s=n.getNode(t.toId);r&&_(r.id),s&&_(s.id),delete a[t.id],i.removeSpring(e)}}function _(t){var e=o.get(t);if(e.mass=s(t),Number.isNaN(e.mass))throw new Error("Node mass should be a number")}function b(t){var e=o.get(t);return e||(m(t),e=o.get(t)),e}},tu.exports.simulator=Mu();var t=ql();function e(){}return tu.exports}(),Tu=p(Su);function Eu(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var Au="object"==typeof global&&global&&global.Object===Object&&global,Cu="object"==typeof self&&self&&self.Object===Object&&self,Ru=Au||Cu||Function("return this")(),Nu=function(){return Ru.Date.now()},Pu=/\s/;var ku=/^\s+/;function Ou(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Pu.test(t.charAt(e)););return e}(t)+1).replace(ku,""):t}var Iu=Ru.Symbol,Du=Object.prototype,Lu=Du.hasOwnProperty,Uu=Du.toString,Fu=Iu?Iu.toStringTag:void 0;var zu=Object.prototype.toString;var Bu=Iu?Iu.toStringTag:void 0;function ju(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Bu&&Bu in Object(t)?function(t){var e=Lu.call(t,Fu),n=t[Fu];try{t[Fu]=void 0;var r=!0}catch(t){}var i=Uu.call(t);return r&&(e?t[Fu]=n:delete t[Fu]),i}(t):function(t){return zu.call(t)}(t)}var Vu=/^[-+]0x[0-9a-f]+$/i,Gu=/^0b[01]+$/i,Hu=/^0o[0-7]+$/i,Wu=parseInt;function qu(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==ju(t)}(t))return NaN;if(Eu(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Eu(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ou(t);var n=Gu.test(t);return n||Hu.test(t)?Wu(t.slice(2),n?2:8):Vu.test(t)?NaN:+t}var $u=Math.max,Xu=Math.min;function Yu(t,e,n){var r,i,s,o,a,l,u=0,h=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||c&&t-u>=s}function m(){var t=Nu();if(f(t))return g(t);a=setTimeout(m,function(t){var n=e-(t-l);return c?Xu(n,s-(t-u)):n}(t))}function g(t){return a=void 0,d&&r?p(t):(r=i=void 0,o)}function y(){var t=Nu(),n=f(t);if(r=arguments,i=this,l=t,n){if(void 0===a)return function(t){return u=t,a=setTimeout(m,e),h?p(t):o}(l);if(c)return clearTimeout(a),a=setTimeout(m,e),p(l)}return void 0===a&&(a=setTimeout(m,e)),o}return e=qu(e)||0,Eu(n)&&(h=!!n.leading,s=(c="maxWait"in n)?$u(qu(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=l=i=a=void 0},y.flush=function(){return void 0===a?o:g(Nu())},y}function Ku(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Zu(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function Ju(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ku(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ku(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Qu=Zu((function t(e,n){var r=n.default,i=void 0===r?null:r,s=n.triggerUpdate,o=void 0===s||s,a=n.onChange,l=void 0===a?function(t,e){}:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l}));function th(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,r=t.props,i=void 0===r?{}:r,s=t.methods,o=void 0===s?{}:s,a=t.aliases,l=void 0===a?{}:a,u=t.init,h=void 0===u?function(){}:u,c=t.update,d=void 0===c?function(){}:c,p=Object.keys(i).map((function(t){return new Qu(t,i[t])}));return function t(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var s=!!(this instanceof t?this.constructor:void 0),a=s?r.shift():void 0,u=r[0],c=void 0===u?{}:u,f=Object.assign({},n instanceof Function?n(c):n,{initialised:!1}),m={};function g(t){return y(t,c),v(),g}var y=function(t,e){h.call(g,t,f,e),f.initialised=!0},v=Yu((function(){f.initialised&&(d.call(g,f,m),m={})}),1);return p.forEach((function(t){g[t.name]=function(t){var e=t.name,n=t.triggerUpdate,r=void 0!==n&&n,i=t.onChange,s=void 0===i?function(t,e){}:i,o=t.defaultVal,a=void 0===o?null:o;return function(t){var n=f[e];if(!arguments.length)return n;var i=void 0===t?a:t;return f[e]=i,s.call(g,i,f,n),!m.hasOwnProperty(e)&&(m[e]=n),r&&v(),g}}(t)})),Object.keys(o).forEach((function(t){g[t]=function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=o[t]).call.apply(e,[g,f].concat(r))}})),Object.entries(l).forEach((function(t){var e=Ju(t,2),n=e[0],r=e[1];return g[n]=g[r]})),g.resetProps=function(){return p.forEach((function(t){g[t.name](t.defaultVal)})),g},g.resetProps(),f._rerender=v,s&&a&&g(a),g}}var eh=function(t){return"function"==typeof t?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}};let nh=class extends Map{constructor(t,e=ih){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(rh(this,t))}has(t){return super.has(rh(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(r),t.delete(r));return n}(this,t))}};function rh({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function ih(t){return null!==t&&"object"==typeof t?t.valueOf():t}function sh(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function oh(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function ah(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function lh(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function uh(t,e){return t.get(lh(t,e))}function hh(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function ch(t,e,n){return t.set(lh(t,e),n),n}function dh(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mh(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ph(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||gh(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fh(t){return function(t){if(Array.isArray(t))return ah(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||gh(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mh(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function gh(t,e){if(t){if("string"==typeof t)return ah(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ah(t,e):void 0}}var yh=new WeakMap,vh=new WeakMap,_h=new WeakMap,bh=new WeakMap,xh=new WeakMap,wh=new WeakMap,Mh=function(){return dh((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),hh(this,yh,new Map),hh(this,vh,new Map),hh(this,_h,(function(t){return t})),hh(this,bh,(function(){return{}})),hh(this,xh,(function(){})),hh(this,wh,(function(){}))}),[{key:"getObj",value:function(t){return uh(yh,this).get(uh(_h,this).call(this,t))}},{key:"getData",value:function(t){return uh(vh,this).get(t)}},{key:"entries",value:function(){return fh(uh(vh,this).entries()).map((function(t){var e=ph(t,2),n=e[0];return[e[1],n]}))}},{key:"id",value:function(t){return ch(_h,this,eh(t)),this}},{key:"onCreateObj",value:function(t){return ch(bh,this,t),this}},{key:"onUpdateObj",value:function(t){return ch(xh,this,t),this}},{key:"onRemoveObj",value:function(t){return ch(wh,this,t),this}},{key:"digest",value:function(t){var e=this;t.filter((function(t){return!uh(yh,e).has(uh(_h,e).call(e,t))})).forEach((function(t){var n=uh(bh,e).call(e,t);uh(yh,e).set(uh(_h,e).call(e,t),n),uh(vh,e).set(n,t)}));var n=new Map(t.map((function(t){return[uh(_h,e).call(e,t),t]})));return uh(yh,this).forEach((function(t,r){n.has(r)?uh(xh,e).call(e,t,n.get(r)):(uh(wh,e).call(e,t,r),uh(yh,e).delete(r),uh(vh,e).delete(t))})),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function Sh(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const Th=Symbol("implicit");var Eh=function(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Ah(t){return Ah="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ah(t)}var Ch=/^\s+/,Rh=/\s+$/;function Nh(t,e){if(e=e||{},(t=t||"")instanceof Nh)return t;if(!(this instanceof Nh))return new Nh(t,e);var n=function(t){var e={r:0,g:0,b:0},n=1,r=null,i=null,s=null,o=!1,a=!1;"string"==typeof t&&(t=function(t){t=t.replace(Ch,"").replace(Rh,"").toLowerCase();var e,n=!1;if($h[t])t=$h[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=oc.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=oc.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=oc.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=oc.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=oc.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=oc.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=oc.hex8.exec(t))return{r:Jh(e[1]),g:Jh(e[2]),b:Jh(e[3]),a:nc(e[4]),format:n?"name":"hex8"};if(e=oc.hex6.exec(t))return{r:Jh(e[1]),g:Jh(e[2]),b:Jh(e[3]),format:n?"name":"hex"};if(e=oc.hex4.exec(t))return{r:Jh(e[1]+""+e[1]),g:Jh(e[2]+""+e[2]),b:Jh(e[3]+""+e[3]),a:nc(e[4]+""+e[4]),format:n?"name":"hex8"};if(e=oc.hex3.exec(t))return{r:Jh(e[1]+""+e[1]),g:Jh(e[2]+""+e[2]),b:Jh(e[3]+""+e[3]),format:n?"name":"hex"};return!1}(t));"object"==Ah(t)&&(ac(t.r)&&ac(t.g)&&ac(t.b)?(e=function(t,e,n){return{r:255*Kh(t,255),g:255*Kh(e,255),b:255*Kh(n,255)}}(t.r,t.g,t.b),o=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):ac(t.h)&&ac(t.s)&&ac(t.v)?(r=tc(t.s),i=tc(t.v),e=function(t,e,n){t=6*Kh(t,360),e=Kh(e,100),n=Kh(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6,u=[n,o,s,s,a,n][l],h=[a,n,n,o,s,s][l],c=[s,s,a,n,n,o][l];return{r:255*u,g:255*h,b:255*c}}(t.h,r,i),o=!0,a="hsv"):ac(t.h)&&ac(t.s)&&ac(t.l)&&(r=tc(t.s),s=tc(t.l),e=function(t,e,n){var r,i,s;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=Kh(t,360),e=Kh(e,100),n=Kh(n,100),0===e)r=i=s=n;else{var a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,r,s),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a));return n=Yh(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function Ph(t,e,n){t=Kh(t,255),e=Kh(e,255),n=Kh(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=(s+o)/2;if(s==o)r=i=0;else{var l=s-o;switch(i=a>.5?l/(2-s-o):l/(s+o),s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,l:a}}function kh(t,e,n){t=Kh(t,255),e=Kh(e,255),n=Kh(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=s,l=s-o;if(i=0===s?0:l/s,s==o)r=0;else{switch(s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,v:a}}function Oh(t,e,n,r){var i=[Qh(Math.round(t).toString(16)),Qh(Math.round(e).toString(16)),Qh(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Ih(t,e,n,r){return[Qh(ec(r)),Qh(Math.round(t).toString(16)),Qh(Math.round(e).toString(16)),Qh(Math.round(n).toString(16))].join("")}function Dh(t,e){e=0===e?0:e||10;var n=Nh(t).toHsl();return n.s-=e/100,n.s=Zh(n.s),Nh(n)}function Lh(t,e){e=0===e?0:e||10;var n=Nh(t).toHsl();return n.s+=e/100,n.s=Zh(n.s),Nh(n)}function Uh(t){return Nh(t).desaturate(100)}function Fh(t,e){e=0===e?0:e||10;var n=Nh(t).toHsl();return n.l+=e/100,n.l=Zh(n.l),Nh(n)}function zh(t,e){e=0===e?0:e||10;var n=Nh(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),Nh(n)}function Bh(t,e){e=0===e?0:e||10;var n=Nh(t).toHsl();return n.l-=e/100,n.l=Zh(n.l),Nh(n)}function jh(t,e){var n=Nh(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,Nh(n)}function Vh(t){var e=Nh(t).toHsl();return e.h=(e.h+180)%360,Nh(e)}function Gh(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=Nh(t).toHsl(),r=[Nh(t)],i=360/e,s=1;s<e;s++)r.push(Nh({h:(n.h+s*i)%360,s:n.s,l:n.l}));return r}function Hh(t){var e=Nh(t).toHsl(),n=e.h;return[Nh(t),Nh({h:(n+72)%360,s:e.s,l:e.l}),Nh({h:(n+216)%360,s:e.s,l:e.l})]}function Wh(t,e,n){e=e||6,n=n||30;var r=Nh(t).toHsl(),i=360/n,s=[Nh(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(Nh(r));return s}function qh(t,e){e=e||6;for(var n=Nh(t).toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/e;e--;)o.push(Nh({h:r,s:i,v:s})),s=(s+a)%1;return o}Nh.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=Yh(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=kh(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=kh(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=Ph(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=Ph(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return Oh(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var s=[Qh(Math.round(t).toString(16)),Qh(Math.round(e).toString(16)),Qh(Math.round(n).toString(16)),Qh(ec(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*Kh(this._r,255))+"%",g:Math.round(100*Kh(this._g,255))+"%",b:Math.round(100*Kh(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*Kh(this._r,255))+"%, "+Math.round(100*Kh(this._g,255))+"%, "+Math.round(100*Kh(this._b,255))+"%)":"rgba("+Math.round(100*Kh(this._r,255))+"%, "+Math.round(100*Kh(this._g,255))+"%, "+Math.round(100*Kh(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(Xh[Oh(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+Ih(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=Nh(t);n="#"+Ih(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return Nh(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(Fh,arguments)},brighten:function(){return this._applyModification(zh,arguments)},darken:function(){return this._applyModification(Bh,arguments)},desaturate:function(){return this._applyModification(Dh,arguments)},saturate:function(){return this._applyModification(Lh,arguments)},greyscale:function(){return this._applyModification(Uh,arguments)},spin:function(){return this._applyModification(jh,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(Wh,arguments)},complement:function(){return this._applyCombination(Vh,arguments)},monochromatic:function(){return this._applyCombination(qh,arguments)},splitcomplement:function(){return this._applyCombination(Hh,arguments)},triad:function(){return this._applyCombination(Gh,[3])},tetrad:function(){return this._applyCombination(Gh,[4])}},Nh.fromRatio=function(t,e){if("object"==Ah(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:tc(t[r]));t=n}return Nh(t,e)},Nh.equals=function(t,e){return!(!t||!e)&&Nh(t).toRgbString()==Nh(e).toRgbString()},Nh.random=function(){return Nh.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},Nh.mix=function(t,e,n){n=0===n?0:n||50;var r=Nh(t).toRgb(),i=Nh(e).toRgb(),s=n/100;return Nh({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},
// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)
// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)
Nh.readability=function(t,e){var n=Nh(t),r=Nh(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},Nh.isReadable=function(t,e,n){var r,i,s=Nh.readability(t,e);switch(i=!1,(r=function(t){var e,n;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==n&&"large"!==n&&(n="small");return{level:e,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},Nh.mostReadable=function(t,e,n){var r,i,s,o,a=null,l=0;i=(n=n||{}).includeFallbackColors,s=n.level,o=n.size;for(var u=0;u<e.length;u++)(r=Nh.readability(t,e[u]))>l&&(l=r,a=Nh(e[u]));return Nh.isReadable(t,a,{level:s,size:o})||!i?a:(n.includeFallbackColors=!1,Nh.mostReadable(t,["#fff","#000"],n))};var $h=Nh.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Xh=Nh.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}($h);function Yh(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function Kh(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function Zh(t){return Math.min(1,Math.max(0,t))}function Jh(t){return parseInt(t,16)}function Qh(t){return 1==t.length?"0"+t:""+t}function tc(t){return t<=1&&(t=100*t+"%"),t}function ec(t){return Math.round(255*parseFloat(t)).toString(16)}function nc(t){return Jh(t)/255}var rc,ic,sc,oc=(ic="[\\s|\\(]+("+(rc="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+rc+")[,|\\s]+("+rc+")\\s*\\)?",sc="[\\s|\\(]+("+rc+")[,|\\s]+("+rc+")[,|\\s]+("+rc+")[,|\\s]+("+rc+")\\s*\\)?",{CSS_UNIT:new RegExp(rc),rgb:new RegExp("rgb"+ic),rgba:new RegExp("rgba"+sc),hsl:new RegExp("hsl"+ic),hsla:new RegExp("hsla"+sc),hsv:new RegExp("hsv"+ic),hsva:new RegExp("hsva"+sc),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function ac(t){return!!oc.CSS_UNIT.exec(t)}function lc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function uc(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function hc(t,e,n){return e=_c(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xc()?Reflect.construct(e,n||[],_c(t).constructor):e.apply(t,n))}function cc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dc(t,e){return t.get(uc(t,e))}function pc(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function fc(t,e,n){return t.set(uc(t,e),n),n}function mc(t,e,n){if(xc())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}function gc(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ac(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function yc(t,e,n){return(e=Ac(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vc(){return vc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=_c(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},vc.apply(null,arguments)}function _c(t){return _c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_c(t)}function bc(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mc(t,e)}function xc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xc=function(){return!!t})()}function wc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Mc(t,e){return Mc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mc(t,e)}function Sc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Rc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tc(t,e,n,r){var i=vc(_c(t.prototype),e,n);return"function"==typeof i?function(t){return i.apply(n,t)}:i}function Ec(t){return function(t){if(Array.isArray(t))return lc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Rc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ac(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Cc(t){return Cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cc(t)}function Rc(t,e){if(t){if("string"==typeof t)return lc(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lc(t,e):void 0}}var Nc=function(t){t instanceof Array?t.forEach(Nc):(t.map&&t.map.dispose(),t.dispose())},Pc=function(t){t.geometry&&t.geometry.dispose(),t.material&&Nc(t.material),t.texture&&t.texture.dispose(),t.children&&t.children.forEach(Pc)},kc=function(t){for(;t.children.length;){var e=t.children[0];t.remove(e),Pc(e)}},Oc=new WeakMap,Ic=new WeakMap,Dc=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.dataBindAttr,s=void 0===i?"__data":i,o=r.objBindAttr,a=void 0===o?"__threeObj":o;return cc(this,e),yc(n=hc(this,e),"scene",void 0),pc(n,Oc,void 0),pc(n,Ic,void 0),n.scene=t,fc(Oc,n,s),fc(Ic,n,a),n.onRemoveObj((function(){})),n}return bc(e,t),gc(e,[{key:"onCreateObj",value:function(t){var n=this;return Tc(e,"onCreateObj",this)([function(e){var r=t(e);return e[dc(Ic,n)]=r,r[dc(Oc,n)]=e,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(t){var n=this;return Tc(e,"onRemoveObj",this)([function(r,i){var s=Tc(e,"getData",n)([r]);t(r,i),n.scene.remove(r),kc(r),delete s[dc(Ic,n)]}]),this}}])}(Mh),Lc=function(t){return isNaN(t)?parseInt(Nh(t).toHex(),16):t},Uc=function(t){return isNaN(t)?Nh(t).getAlpha():1},Fc=function t(){var e=new nh,n=[],r=[],i=Th;function s(t){let s=e.get(t);if(void 0===s){if(i!==Th)return i;e.set(t,s=n.push(t)-1)}return r[s%r.length]}return s.domain=function(t){if(!arguments.length)return n.slice();n=[],e=new nh;for(const r of t)e.has(r)||e.set(r,n.push(r)-1);return s},s.range=function(t){return arguments.length?(r=Array.from(t),s):r.slice()},s.unknown=function(t){return arguments.length?(i=t,s):i},s.copy=function(){return t(n,r).unknown(i)},Sh.apply(s,arguments),s}(Eh);function zc(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=Fc(e(t))}))}var Bc=window.THREE?window.THREE:{Group:Nr,Mesh:pr,MeshLambertMaterial:Ki,Color:Pn,BufferGeometry:Yn,BufferAttribute:Fn,Matrix4:je,Vector3:ce,SphereGeometry:Xi,CylinderGeometry:_i,TubeGeometry:class t extends Yn{constructor(t=new yi(new ce(-1,-1,0),new ce(-1,1,0),new ce(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new ce,a=new ce,l=new Ht;let u=new ce;const h=[],c=[],d=[],p=[];function f(i){u=t.getPointAt(i/e,u);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),c.push(a.x,a.y,a.z),o.x=u.x+n*a.x,o.y=u.y+n*a.y,o.z=u.z+n*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new jn(h,3)),this.setAttribute("normal",new jn(c,3)),this.setAttribute("uv",new jn(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(e){return new t((new vi[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},ConeGeometry:class t extends _i{constructor(t=1,e=1,n=32,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(e){return new t(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Line:ei,LineBasicMaterial:$r,QuadraticBezierCurve3:yi,CubicBezierCurve3:gi,Box3:fe},jc={graph:Ql,forcelayout:Tu},Vc=(new Bc.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Gc=(new Bc.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",Hc=th({props:{jsonUrl:{onChange:function(t,e){var n=this;t&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(t).then((function(t){return t.json()})).then((function(t){e.fetchingJson=!1,e.onFinishLoading(t),n.graphData(t)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(t,e){var n=e.d3ForceLayout.force("charge");function r(t,e){t.forEach((function(t){delete t[e],delete t["v".concat(e)]}))}n&&n.strength(t>2?-60:-30),t<3&&r(e.graphData.nodes,"z"),t<2&&r(e.graphData.nodes,"y")}},dagMode:{onChange:function(t,e){!t&&"d3"===e.forceEngine&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=t.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.velocityDecay(t)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(t){return t._flushObjects=!0,t._rerender(),this},d3Force:function(t,e,n){return void 0===n?t.d3ForceLayout.force(e):(t.d3ForceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},tickFrame:function(t){var e,n,r,i,s="ngraph"!==t.forceEngine;return t.engineRunning&&function(){++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||s&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.layout[s?"tick":"step"](),t.onEngineTick());var e=eh(t.nodeThreeObjectExtend);t.nodeDataMapper.entries().forEach((function(n){var r=Sc(n,2),i=r[0],o=r[1];if(o){var a=s?i:t.layout.getNodePosition(i[t.nodeId]),l=e(i);t.nodePositionUpdate&&t.nodePositionUpdate(l?o.children[0]:o,{x:a.x,y:a.y,z:a.z},i)&&!l||(o.position.x=a.x,o.position.y=a.y||0,o.position.z=a.z||0)}}));var n=eh(t.linkWidth),r=eh(t.linkCurvature),i=eh(t.linkCurveRotation),o=eh(t.linkThreeObjectExtend);function a(e){var n=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),o=n[s?"source":"from"],a=n[s?"target":"to"];if(o&&a&&o.hasOwnProperty("x")&&a.hasOwnProperty("x")){var l=r(e);if(l){var u,h=new Bc.Vector3(o.x,o.y||0,o.z||0),c=new Bc.Vector3(a.x,a.y||0,a.z||0),d=h.distanceTo(c),p=i(e);if(d>0){var f=a.x-o.x,m=a.y-o.y||0,g=(new Bc.Vector3).subVectors(c,h),y=g.clone().multiplyScalar(l).cross(0!==f||0!==m?new Bc.Vector3(0,0,1):new Bc.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new Bc.Vector3).addVectors(h,c).divideScalar(2));u=new Bc.QuadraticBezierCurve3(h,y,c)}else{var v=70*l,_=-p,b=_+Math.PI/2;u=new Bc.CubicBezierCurve3(h,new Bc.Vector3(v*Math.cos(b),v*Math.sin(b),0).add(h),new Bc.Vector3(v*Math.cos(_),v*Math.sin(_),0).add(h),c)}e.__curve=u}else e.__curve=null}}t.linkDataMapper.entries().forEach((function(e){var r=Sc(e,2),i=r[0],l=r[1];if(l){var u=s?i:t.layout.getLinkPosition(t.layout.graph.getLink(i.source,i.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){a(i);var d=o(i);if(!t.linkPositionUpdate||!t.linkPositionUpdate(d?l.children[1]:l,{start:{x:h.x,y:h.y,z:h.z},end:{x:c.x,y:c.y,z:c.z}},i)||d){var p=30,f=i.__curve,m=l.children.length?l.children[0]:l;if("Line"===m.type){if(f){var g=f.getPoints(p);m.geometry.getAttribute("position").array.length!==3*g.length&&m.geometry[Vc]("position",new Bc.BufferAttribute(new Float32Array(3*g.length),3)),m.geometry.setFromPoints(g)}else{var y=m.geometry.getAttribute("position");y&&y.array&&6===y.array.length||m.geometry[Vc]("position",y=new Bc.BufferAttribute(new Float32Array(6),3)),y.array[0]=h.x,y.array[1]=h.y||0,y.array[2]=h.z||0,y.array[3]=c.x,y.array[4]=c.y||0,y.array[5]=c.z||0,y.needsUpdate=!0}m.geometry.computeBoundingSphere()}else if("Mesh"===m.type)if(f){m.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1));var v=Math.ceil(10*n(i))/10/2,_=new Bc.TubeGeometry(f,p,v,t.linkResolution,!1);m.geometry.dispose(),m.geometry=_}else{if(!m.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var b=Math.ceil(10*n(i))/10/2,x=new Bc.CylinderGeometry(b,b,1,t.linkResolution,1,!1);x[Gc]((new Bc.Matrix4).makeTranslation(0,.5,0)),x[Gc]((new Bc.Matrix4).makeRotationX(Math.PI/2)),m.geometry.dispose(),m.geometry=x}var w=new Bc.Vector3(h.x,h.y||0,h.z||0),M=new Bc.Vector3(c.x,c.y||0,c.z||0),S=w.distanceTo(M);m.position.x=w.x,m.position.y=w.y,m.position.z=w.z,m.scale.z=S,m.parent.localToWorld(M),m.lookAt(M)}}}}}))}(),e=eh(t.linkDirectionalArrowRelPos),n=eh(t.linkDirectionalArrowLength),r=eh(t.nodeVal),t.arrowDataMapper.entries().forEach((function(i){var o=Sc(i,2),a=o[0],l=o[1];if(l){var u=s?a:t.layout.getLinkPosition(t.layout.graph.getLink(a.source,a.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){var d=Math.cbrt(Math.max(0,r(h)||1))*t.nodeRelSize,p=Math.cbrt(Math.max(0,r(c)||1))*t.nodeRelSize,f=n(a),m=e(a),g=a.__curve?function(t){return a.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",h,c,t),y:e("y",h,c,t),z:e("z",h,c,t)}},y=a.__curve?a.__curve.getLength():Math.sqrt(["x","y","z"].map((function(t){return Math.pow((c[t]||0)-(h[t]||0),2)})).reduce((function(t,e){return t+e}),0)),v=d+f+(y-d-p-f)*m,_=g(v/y),b=g((v-f)/y);["x","y","z"].forEach((function(t){return l.position[t]=b[t]}));var x=mc(Bc.Vector3,Ec(["x","y","z"].map((function(t){return _[t]}))));l.parent.localToWorld(x),l.lookAt(x)}}})),i=eh(t.linkDirectionalParticleSpeed),t.graphData.links.forEach((function(e){var n=t.particlesDataMapper.getObj(e),r=n&&n.children,o=e.__singleHopPhotonsObj&&e.__singleHopPhotonsObj.children;if(o&&o.length||r&&r.length){var a=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),l=a[s?"source":"from"],u=a[s?"target":"to"];if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var h=i(e),c=e.__curve?function(t){return e.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",l,u,t),y:e("y",l,u,t),z:e("z",l,u,t)}};[].concat(Ec(r||[]),Ec(o||[])).forEach((function(t,e){var n="singleHopPhotons"===t.parent.__linkThreeObjType;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=n?0:e/r.length),t.__progressRatio+=h,t.__progressRatio>=1){if(n)return t.parent.remove(t),void kc(t);t.__progressRatio=t.__progressRatio%1}var i=t.__progressRatio,s=c(i);["x","y","z"].forEach((function(e){return t.position[e]=s[e]}))}))}}})),this},emitParticle:function(t,e){if(e&&t.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var n=new Bc.Group;n.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=n,t.graphScene.add(n)}var r=eh(t.linkDirectionalParticleWidth),i=Math.ceil(10*r(e))/10/2,s=t.linkDirectionalParticleResolution,o=new Bc.SphereGeometry(i,s,s),a=eh(t.linkColor),l=eh(t.linkDirectionalParticleColor)(e)||a(e)||"#f0f0f0",u=new Bc.Color(Lc(l)),h=3*t.linkOpacity,c=new Bc.MeshLambertMaterial({color:u,transparent:!0,opacity:h});e.__singleHopPhotonsObj.add(new Bc.Mesh(o,c))}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!t.initialised)return null;var n=function t(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new Bc.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,Ec((n.children||[]).filter((function(t){return!t.hasOwnProperty("__graphObjType")||"node"===t.__graphObjType&&e(t.__data)})).map(t)))}(t.graphScene);return n.length?Object.assign.apply(Object,Ec(["x","y","z"].map((function(t){return yc({},t,[oh(n,(function(e){return e.min[t]})),sh(n,(function(e){return e.max[t]}))])})))):null}},stateInit:function(){return{d3ForceLayout:Hl().force("link",cl()).force("charge",Wl()).force("center",Da()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.graphScene=t,e.nodeDataMapper=new Dc(t,{objBindAttr:"__threeObj"}),e.linkDataMapper=new Dc(t,{objBindAttr:"__lineObj"}),e.arrowDataMapper=new Dc(t,{objBindAttr:"__arrowObj"}),e.particlesDataMapper=new Dc(t,{objBindAttr:"__photonsObj"})},update:function(t,e){var n=function(t){return t.some((function(t){return e.hasOwnProperty(t)}))};if(t.engineRunning=!1,"function"==typeof t.onUpdate&&t.onUpdate(),null!==t.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&zc(t.graphData.nodes,eh(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&zc(t.graphData.links,eh(t.linkAutoColorBy),t.linkColor),t._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=eh(t.nodeThreeObject),i=eh(t.nodeThreeObjectExtend),s=eh(t.nodeVal),o=eh(t.nodeColor),a=eh(t.nodeVisibility),l={},u={};(t._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&t.nodeDataMapper.clear(),t.nodeDataMapper.onCreateObj((function(e){var n,s=r(e),o=i(e);return s&&t.nodeThreeObject===s&&(s=s.clone()),s&&!o?n=s:((n=new Bc.Mesh).__graphDefaultObj=!0,s&&o&&n.add(s)),n.__graphObjType="node",n})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=s(n)||1,i=Math.cbrt(r)*t.nodeRelSize,a=t.nodeResolution;e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&e.geometry.parameters.radius===i&&e.geometry.parameters.widthSegments===a||(l.hasOwnProperty(r)||(l[r]=new Bc.SphereGeometry(i,a,a)),e.geometry.dispose(),e.geometry=l[r]);var h=o(n),c=new Bc.Color(Lc(h||"#ffffaa")),d=t.nodeOpacity*Uc(h);"MeshLambertMaterial"===e.material.type&&e.material.color.equals(c)&&e.material.opacity===d||(u.hasOwnProperty(h)||(u[h]=new Bc.MeshLambertMaterial({color:c,transparent:!0,opacity:d})),e.material.dispose(),e.material=u[h])}})).digest(t.graphData.nodes.filter(a))}if(t._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=eh(t.linkThreeObject),c=eh(t.linkThreeObjectExtend),d=eh(t.linkMaterial),p=eh(t.linkVisibility),f=eh(t.linkColor),m=eh(t.linkWidth),g={},y={},v={},_=t.graphData.links.filter(p);if((t._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&t.linkDataMapper.clear(),t.linkDataMapper.onRemoveObj((function(t){var e=t.__data&&t.__data.__singleHopPhotonsObj;e&&(e.parent.remove(e),kc(e),delete t.__data.__singleHopPhotonsObj)})).onCreateObj((function(e){var n,r,i=h(e),s=c(e);if(i&&t.linkThreeObject===i&&(i=i.clone()),!i||s)if(!!m(e))n=new Bc.Mesh;else{var o=new Bc.BufferGeometry;o[Vc]("position",new Bc.BufferAttribute(new Float32Array(6),3)),n=new Bc.Line(o)}return i?s?((r=new Bc.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=e.children.length?e.children[0]:e,i=Math.ceil(10*m(n))/10,s=!!i;if(s){var o=i/2,a=t.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==a){if(!g.hasOwnProperty(i)){var l=new Bc.CylinderGeometry(o,o,1,a,1,!1);l[Gc]((new Bc.Matrix4).makeTranslation(0,.5,0)),l[Gc]((new Bc.Matrix4).makeRotationX(Math.PI/2)),g[i]=l}r.geometry.dispose(),r.geometry=g[i]}}var u=d(n);if(u)r.material=u;else{var h=f(n),c=new Bc.Color(Lc(h||"#f0f0f0")),p=t.linkOpacity*Uc(h),_=s?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==_||!r.material.color.equals(c)||r.material.opacity!==p){var b=s?y:v;b.hasOwnProperty(h)||(b[h]=new Bc[_]({color:c,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=b[h]}}}})).digest(_),t.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var b=eh(t.linkDirectionalArrowLength),x=eh(t.linkDirectionalArrowColor);t.arrowDataMapper.onCreateObj((function(){var t=new Bc.Mesh(void 0,new Bc.MeshLambertMaterial({transparent:!0}));return t.__linkThreeObjType="arrow",t})).onUpdateObj((function(e,n){var r=b(n),i=t.linkDirectionalArrowResolution;if(!e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||e.geometry.parameters.height!==r||e.geometry.parameters.radialSegments!==i){var s=new Bc.ConeGeometry(.25*r,r,i);s.translate(0,r/2,0),s.rotateX(Math.PI/2),e.geometry.dispose(),e.geometry=s}var o=x(n)||f(n)||"#f0f0f0";e.material.color=new Bc.Color(Lc(o)),e.material.opacity=3*t.linkOpacity*Uc(o)})).digest(_.filter(b))}if(t.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var w=eh(t.linkDirectionalParticles),M=eh(t.linkDirectionalParticleWidth),S=eh(t.linkDirectionalParticleColor),T={},E={};t.particlesDataMapper.onCreateObj((function(){var t=new Bc.Group;return t.__linkThreeObjType="photons",t.__photonDataMapper=new Dc(t),t})).onUpdateObj((function(e,n){var r,i=Math.round(Math.abs(w(n))),s=!!e.children.length&&e.children[0],o=Math.ceil(10*M(n))/10/2,a=t.linkDirectionalParticleResolution;s&&s.geometry.parameters.radius===o&&s.geometry.parameters.widthSegments===a?r=s.geometry:(E.hasOwnProperty(o)||(E[o]=new Bc.SphereGeometry(o,a,a)),r=E[o],s&&s.geometry.dispose());var l,u=S(n)||f(n)||"#f0f0f0",h=new Bc.Color(Lc(u)),c=3*t.linkOpacity;s&&s.material.color.equals(h)&&s.material.opacity===c?l=s.material:(T.hasOwnProperty(u)||(T[u]=new Bc.MeshLambertMaterial({color:h,transparent:!0,opacity:c})),l=T[u],s&&s.material.dispose()),e.__photonDataMapper.id((function(t){return t.idx})).onCreateObj((function(){return new Bc.Mesh(r,l)})).onUpdateObj((function(t){t.geometry=r,t.material=l})).digest(Ec(new Array(i)).map((function(t,e){return{idx:e}})))})).digest(_.filter(w))}}if(t._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){t.engineRunning=!1,t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]}));var A,C="ngraph"!==t.forceEngine;if(C){(A=t.d3ForceLayout).stop().alpha(1).numDimensions(t.numDimensions).nodes(t.graphData.nodes);var R=t.d3ForceLayout.force("link");R&&R.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var N=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===Cc(t)?e(t):t}o.out.push(a)}));var h=[];return function t(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=function(){var s=n[o];if(-1!==r.indexOf(s)){var a=[].concat(Ec(r.slice(r.indexOf(s))),[s]).map((function(t){return e(t.data)}));return h.some((function(t){return t.length===a.length&&t.every((function(t,e){return t===a[e]}))}))||(h.push(a),l(a)),1}i>s.depth&&(s.depth=i,t(s.out,[].concat(Ec(r),[s]),i+(s.skip?0:1)))},o=0,a=n.length;o<a;o++)s()}(Object.values(u)),Object.assign.apply(Object,[{}].concat(Ec(Object.entries(u).filter((function(t){return!Sc(t,2)[1].skip})).map((function(t){var e=Sc(t,2);return yc({},e[0],e[1].depth)})))))}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),P=Math.max.apply(Math,Ec(Object.values(N||[]))),k=t.dagLevelDistance||t.graphData.nodes.length/(P||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var O=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[O]}))}if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var I=["rl","td","zout"].includes(t.dagMode),D=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[D]=function(e){return(N[e[t.nodeId]]-P/2)*k*(I?-1:1)}(e)}))}t.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?function(t,e,n,r){var i,s,o,a,l=al(.1);function u(t){for(var l=0,u=i.length;l<u;++l){var h=i[l],c=h.x-e||1e-6,d=(h.y||0)-n||1e-6,p=(h.z||0)-r||1e-6,f=Math.sqrt(c*c+d*d+p*p),m=(a[l]-f)*o[l]*t/f;h.vx+=c*m,s>1&&(h.vy+=d*m),s>2&&(h.vz+=p*m)}}function h(){if(i){var e,n=i.length;for(o=new Array(n),a=new Array(n),e=0;e<n;++e)a[e]=+t(i[e],e,i),o[e]=isNaN(a[e])?0:+l(i[e],e,i)}}return"function"!=typeof t&&(t=al(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),u.initialize=function(t,...e){i=t,s=e.find((t=>[1,2,3].includes(t)))||2,h()},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:al(+t),h(),u):l},u.radius=function(e){return arguments.length?(t="function"==typeof e?e:al(+e),h(),u):t},u.x=function(t){return arguments.length?(e=+t,u):e},u.y=function(t){return arguments.length?(n=+t,u):n},u.z=function(t){return arguments.length?(r=+t,u):r},u}((function(e){var n=N[e[t.nodeId]]||-1;return("radialin"===t.dagMode?P-n:n)*k})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null)}else{var L=jc.graph();t.graphData.nodes.forEach((function(e){L.addNode(e[t.nodeId])})),t.graphData.links.forEach((function(t){L.addLink(t.source,t.target)})),A=jc.forcelayout(L,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wc(Object(n),!0).forEach((function(e){yc(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({dimensions:t.numDimensions},t.ngraphPhysics)),A.graph=L}for(var U=0;U<t.warmupTicks&&!(C&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin);U++)A[C?"tick":"step"]();t.layout=A,this.resetCountdown()}t.engineRunning=!0,t.onFinishUpdate()}});var Wc=function(t){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function r(){var n;cc(this,r);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=hc(this,r,[].concat(s))).__kapsuleInstance=mc(t,[].concat(Ec(e?[n]:[]),s)),n}return bc(r,n),gc(r)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(t()).forEach((function(t){return n.prototype[t]=function(){var e,n=(e=this.__kapsuleInstance)[t].apply(e,arguments);return n===this.__kapsuleInstance?this:n}})),n}(Hc,(window.THREE?window.THREE:{Group:Nr}).Group,!0);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var qc=function(t){return"string"==typeof t?JSON.parse(t):t},$c=function(t){if("function"==typeof t)return t;var e=eval;try{return e("("+t+")")}catch(t){}return null},Xc=function(t){return isNaN(parseFloat(t))?$c(t)?$c(t):t:parseFloat(t)};function Yc(){return Yc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Yc.apply(null,arguments)}function Kc(t,e){return Kc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kc(t,e)}function Zc(t){return Zc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zc(t)}function Jc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Jc=function(){return!!t})()}function Qc(t){var e="function"==typeof Map?new Map:void 0;return Qc=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(Jc())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&Kc(i,n.prototype),i}(t,arguments,Zc(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Kc(n,t)},Qc(t)}AFRAME.components.hasOwnProperty("forcegraph")||AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:qc,default:[]},links:{parse:qc,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:$c,default:function(){return!0}},onDagError:{parse:$c,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:Xc,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:Xc,default:!0},nodeColor:{parse:Xc,default:"color"},nodeAutoColorBy:{parse:Xc,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:Xc,default:null},nodeThreeObjectExtend:{parse:Xc,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:Xc,default:!0},linkColor:{parse:Xc,default:"color"},linkAutoColorBy:{parse:Xc,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:Xc,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:Xc,default:0},linkCurveRotation:{parse:Xc,default:0},linkMaterial:{parse:Xc,default:null},linkThreeObject:{parse:Xc,default:null},linkThreeObjectExtend:{parse:Xc,default:!1},linkPositionUpdate:{parse:$c,default:null},linkDirectionalArrowLength:{parse:Xc,default:0},linkDirectionalArrowColor:{parse:Xc,default:null},linkDirectionalArrowRelPos:{parse:Xc,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:Xc,default:0},linkDirectionalParticleSpeed:{parse:Xc,default:.01},linkDirectionalParticleWidth:{parse:Xc,default:.5},linkDirectionalParticleColor:{parse:Xc,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:$c,default:function(){}},onLinkHover:{parse:$c,default:function(){}},onNodeClick:{parse:$c,default:function(){}},onLinkClick:{parse:$c,default:function(){}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:qc,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:$c,default:function(){}},onEngineStop:{parse:$c,default:function(){}}},getGraphBbox:function(t){return this.forceGraph||(this.forceGraph=new Wc),this.forceGraph.getGraphBbox(t)},emitParticle:function(){this.forceGraph||(this.forceGraph=new Wc);var t=this.forceGraph,e=t.emitParticle.apply(t,arguments);return e===t?this:e},d3Force:function(){this.forceGraph||(this.forceGraph=new Wc);var t=this.forceGraph,e=t.d3Force.apply(t,arguments);return e===t?this:e},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){var t=this,e=this.state={};e.infoEl=document.createElement("a-text"),e.infoEl.setAttribute("position","0 -0.1 -1"),e.infoEl.setAttribute("width",1),e.infoEl.setAttribute("align","center"),e.infoEl.setAttribute("color","lavender");var n=document.querySelector("a-entity[camera], a-camera");n.appendChild(e.infoEl),e.cameraObj=n.object3D.children.filter((function(t){return"PerspectiveCamera"===t.type}))[0],this.el.sceneEl.addEventListener("camera-set-active",(function(t){e.cameraObj=t.detail.cameraEl.components.camera.camera})),this.forceGraph||(this.forceGraph=new Wc),this.forceGraph.onFinishUpdate((function(){return t.el.setObject3D("forcegraphGroup",t.forceGraph)})).onLoading((function(){return e.infoEl.setAttribute("value","Loading...")})).onFinishLoading((function(){return e.infoEl.setAttribute("value","")})),this.el.addEventListener("raycaster-intersected",(function(t){return e.hoverDetail=t.detail})),this.el.addEventListener("raycaster-intersected-cleared",(function(t){return e.hoverDetail=t.detail})),this.el.addEventListener("click",(function(){return e.hoverObj&&t.data["on"+("node"===e.hoverObj.__graphObjType?"Node":"Link")+"Click"](e.hoverObj.__data)}))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(t){var e=this,n=this.data,r=AFRAME.utils.diff(n,t);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter((function(t){return t in r})).forEach((function(t){e.forceGraph[t](""!==n[t]?n[t]:null)})),("nodes"in r||"links"in r)&&e.forceGraph.graphData({nodes:n.nodes,links:n.links})},tick:function(t,e){for(var n=this.state,r=this.data,i=n.hoverDetail?n.hoverDetail.getIntersection?n.hoverDetail.getIntersection(this.el):n.hoverDetail.intersection||void 0:void 0,s=i?i.object:void 0;s&&!s.hasOwnProperty("__graphObjType");)s=s.parent;if(s!==n.hoverObj){var o=n.hoverObj?n.hoverObj.__graphObjType:null,a=n.hoverObj?n.hoverObj.__data:null,l=s?s.__graphObjType:null,u=s?s.__data:null;o&&o!==l&&r["on"+("node"===o?"Node":"Link")+"Hover"](null,a),l&&r["on"+("node"===l?"Node":"Link")+"Hover"](u,o===l?a:null),n.hoverObj=s}this.forceGraph.tickFrame()}});var td={1:"Passed invalid arguments to hsl, please pass multiple numbers e.g. hsl(360, 0.75, 0.4) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75 }).\n\n",2:"Passed invalid arguments to hsla, please pass multiple numbers e.g. hsla(360, 0.75, 0.4, 0.7) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75, alpha: 0.7 }).\n\n",3:"Passed an incorrect argument to a color function, please pass a string representation of a color.\n\n",4:"Couldn't generate valid rgb string from %s, it returned %s.\n\n",5:"Couldn't parse the color string. Please provide the color as a string in hex, rgb, rgba, hsl or hsla notation.\n\n",6:"Passed invalid arguments to rgb, please pass multiple numbers e.g. rgb(255, 205, 100) or an object e.g. rgb({ red: 255, green: 205, blue: 100 }).\n\n",7:"Passed invalid arguments to rgba, please pass multiple numbers e.g. rgb(255, 205, 100, 0.75) or an object e.g. rgb({ red: 255, green: 205, blue: 100, alpha: 0.75 }).\n\n",8:"Passed invalid argument to toColorString, please pass a RgbColor, RgbaColor, HslColor or HslaColor object.\n\n",9:"Please provide a number of steps to the modularScale helper.\n\n",10:"Please pass a number or one of the predefined scales to the modularScale helper as the ratio.\n\n",11:'Invalid value passed as base to modularScale, expected number or em string but got "%s"\n\n',12:'Expected a string ending in "px" or a number passed as the first argument to %s(), got "%s" instead.\n\n',13:'Expected a string ending in "px" or a number passed as the second argument to %s(), got "%s" instead.\n\n',14:'Passed invalid pixel value ("%s") to %s(), please pass a value like "12px" or 12.\n\n',15:'Passed invalid base value ("%s") to %s(), please pass a value like "12px" or 12.\n\n',16:"You must provide a template to this method.\n\n",17:"You passed an unsupported selector state to this method.\n\n",18:"minScreen and maxScreen must be provided as stringified numbers with the same units.\n\n",19:"fromSize and toSize must be provided as stringified numbers with the same units.\n\n",20:"expects either an array of objects or a single object with the properties prop, fromSize, and toSize.\n\n",21:"expects the objects in the first argument array to have the properties `prop`, `fromSize`, and `toSize`.\n\n",22:"expects the first argument object to have the properties `prop`, `fromSize`, and `toSize`.\n\n",23:"fontFace expects a name of a font-family.\n\n",24:"fontFace expects either the path to the font file(s) or a name of a local copy.\n\n",25:"fontFace expects localFonts to be an array.\n\n",26:"fontFace expects fileFormats to be an array.\n\n",27:"radialGradient requries at least 2 color-stops to properly render.\n\n",28:"Please supply a filename to retinaImage() as the first argument.\n\n",29:"Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.\n\n",30:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",31:"The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation\n\n",32:"To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s')\n\n",33:"The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation\n\n",34:"borderRadius expects a radius value as a string or number as the second argument.\n\n",35:'borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.\n\n',36:"Property must be a string value.\n\n",37:"Syntax Error at %s.\n\n",38:"Formula contains a function that needs parentheses at %s.\n\n",39:"Formula is missing closing parenthesis at %s.\n\n",40:"Formula has too many closing parentheses at %s.\n\n",41:"All values in a formula must have the same unit or be unitless.\n\n",42:"Please provide a number of steps to the modularScale helper.\n\n",43:"Please pass a number or one of the predefined scales to the modularScale helper as the ratio.\n\n",44:"Invalid value passed as base to modularScale, expected number or em/rem string but got %s.\n\n",45:"Passed invalid argument to hslToColorString, please pass a HslColor or HslaColor object.\n\n",46:"Passed invalid argument to rgbToColorString, please pass a RgbColor or RgbaColor object.\n\n",47:"minScreen and maxScreen must be provided as stringified numbers with the same units.\n\n",48:"fromSize and toSize must be provided as stringified numbers with the same units.\n\n",49:"Expects either an array of objects or a single object with the properties prop, fromSize, and toSize.\n\n",50:"Expects the objects in the first argument array to have the properties prop, fromSize, and toSize.\n\n",51:"Expects the first argument object to have the properties prop, fromSize, and toSize.\n\n",52:"fontFace expects either the path to the font file(s) or a name of a local copy.\n\n",53:"fontFace expects localFonts to be an array.\n\n",54:"fontFace expects fileFormats to be an array.\n\n",55:"fontFace expects a name of a font-family.\n\n",56:"linearGradient requries at least 2 color-stops to properly render.\n\n",57:"radialGradient requries at least 2 color-stops to properly render.\n\n",58:"Please supply a filename to retinaImage() as the first argument.\n\n",59:"Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.\n\n",60:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",61:"Property must be a string value.\n\n",62:"borderRadius expects a radius value as a string or number as the second argument.\n\n",63:'borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.\n\n',64:"The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation.\n\n",65:"To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s').\n\n",66:"The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation.\n\n",67:"You must provide a template to this method.\n\n",68:"You passed an unsupported selector state to this method.\n\n",69:'Expected a string ending in "px" or a number passed as the first argument to %s(), got %s instead.\n\n',70:'Expected a string ending in "px" or a number passed as the second argument to %s(), got %s instead.\n\n',71:'Passed invalid pixel value %s to %s(), please pass a value like "12px" or 12.\n\n',72:'Passed invalid base value %s to %s(), please pass a value like "12px" or 12.\n\n',73:"Please provide a valid CSS variable.\n\n",74:"CSS variable not found and no default was provided.\n\n",75:"important requires a valid style object, got a %s instead.\n\n",76:"fromSize and toSize must be provided as stringified numbers with the same units as minScreen and maxScreen.\n\n",77:'remToPx expects a value in "rem" but you provided it in "%s".\n\n',78:'base must be set in "px" or "%" but you set it in "%s".\n'};function ed(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r,i=e[0],s=[];for(r=1;r<e.length;r+=1)s.push(e[r]);return s.forEach((function(t){i=i.replace(/%[a-z]/,t)})),i}var nd=function(t){function e(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t.call(this,ed.apply(void 0,[td[e]].concat(r)))||this)}return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Kc(t,e)}(e,t),e}(Qc(Error));function rd(t){return Math.round(255*t)}function id(t,e,n){return rd(t)+","+rd(e)+","+rd(n)}function sd(t,e,n,r){if(void 0===r&&(r=id),0===e)return r(n,n,n);var i=(t%360+360)%360/60,s=(1-Math.abs(2*n-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,l=0,u=0;i>=0&&i<1?(a=s,l=o):i>=1&&i<2?(a=o,l=s):i>=2&&i<3?(l=s,u=o):i>=3&&i<4?(l=o,u=s):i>=4&&i<5?(a=o,u=s):i>=5&&i<6&&(a=s,u=o);var h=n-s/2;return r(a+h,l+h,u+h)}var od={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var ad=/^#[a-fA-F0-9]{6}$/,ld=/^#[a-fA-F0-9]{8}$/,ud=/^#[a-fA-F0-9]{3}$/,hd=/^#[a-fA-F0-9]{4}$/,cd=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,dd=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,pd=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,fd=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function md(t){if("string"!=typeof t)throw new nd(3);var e=function(t){if("string"!=typeof t)return t;var e=t.toLowerCase();return od[e]?"#"+od[e]:t}(t);if(e.match(ad))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(ld)){var n=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:n}}if(e.match(ud))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(hd)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=cd.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=dd.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=pd.exec(e);if(o){var a="rgb("+sd(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=cd.exec(a);if(!l)throw new nd(4,e,a);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var u=fd.exec(e.substring(0,50));if(u){var h="rgb("+sd(parseInt(""+u[1],10),parseInt(""+u[2],10)/100,parseInt(""+u[3],10)/100)+")",c=cd.exec(h);if(!c)throw new nd(4,e,h);return{red:parseInt(""+c[1],10),green:parseInt(""+c[2],10),blue:parseInt(""+c[3],10),alpha:parseFloat(""+u[4])>1?parseFloat(""+u[4])/100:parseFloat(""+u[4])}}throw new nd(5)}function gd(t){return function(t){var e,n=t.red/255,r=t.green/255,i=t.blue/255,s=Math.max(n,r,i),o=Math.min(n,r,i),a=(s+o)/2;if(s===o)return void 0!==t.alpha?{hue:0,saturation:0,lightness:a,alpha:t.alpha}:{hue:0,saturation:0,lightness:a};var l=s-o,u=a>.5?l/(2-s-o):l/(s+o);switch(s){case n:e=(r-i)/l+(r<i?6:0);break;case r:e=(i-n)/l+2;break;default:e=(n-r)/l+4}return e*=60,void 0!==t.alpha?{hue:e,saturation:u,lightness:a,alpha:t.alpha}:{hue:e,saturation:u,lightness:a}}(md(t))}var yd=function(t){return 7===t.length&&t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?"#"+t[1]+t[3]+t[5]:t};function vd(t){var e=t.toString(16);return 1===e.length?"0"+e:e}function _d(t){return vd(Math.round(255*t))}function bd(t,e,n){return yd("#"+_d(t)+_d(e)+_d(n))}function xd(t,e,n){return sd(t,e,n,bd)}function wd(t,e,n){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n)return yd("#"+vd(t)+vd(e)+vd(n));if("object"==typeof t&&void 0===e&&void 0===n)return yd("#"+vd(t.red)+vd(t.green)+vd(t.blue));throw new nd(6)}function Md(t,e,n,r){if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?wd(t.red,t.green,t.blue):"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")";throw new nd(7)}function Sd(t){if("object"!=typeof t)throw new nd(8);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&"number"==typeof t.alpha}(t))return Md(t);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return wd(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&"number"==typeof t.alpha}(t))return function(t,e,n,r){if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?xd(t.hue,t.saturation,t.lightness):"rgba("+sd(t.hue,t.saturation,t.lightness)+","+t.alpha+")";throw new nd(2)}(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return function(t,e,n){if("object"==typeof t&&void 0===e&&void 0===n)return xd(t.hue,t.saturation,t.lightness);throw new nd(1)}(t);throw new nd(8)}function Td(t,e,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=e?t.apply(this,r):Td(t,e,r)}}function Ed(t){return Td(t,t.length,[])}function Ad(t,e,n){return Math.max(t,Math.min(e,n))}Ed((function(t,e){if("transparent"===e)return e;var n=gd(e);return Sd(Yc({},n,{hue:n.hue+parseFloat(t)}))})),Ed((function(t,e){if("transparent"===e)return e;var n=gd(e);return Sd(Yc({},n,{lightness:Ad(0,1,n.lightness-parseFloat(t))}))})),Ed((function(t,e){if("transparent"===e)return e;var n=gd(e);return Sd(Yc({},n,{saturation:Ad(0,1,n.saturation-parseFloat(t))}))})),Ed((function(t,e){if("transparent"===e)return e;var n=gd(e);return Sd(Yc({},n,{lightness:Ad(0,1,n.lightness+parseFloat(t))}))}));var Cd=Ed((function(t,e,n){if("transparent"===e)return n;if("transparent"===n)return e;if(0===t)return n;var r=md(e),i=Yc({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=md(n),o=Yc({},s,{alpha:"number"==typeof s.alpha?s.alpha:1}),a=i.alpha-o.alpha,l=2*parseFloat(t)-1,u=((l*a==-1?l:l+a)/(1+l*a)+1)/2,h=1-u;return Md({red:Math.floor(i.red*u+o.red*h),green:Math.floor(i.green*u+o.green*h),blue:Math.floor(i.blue*u+o.blue*h),alpha:i.alpha*parseFloat(t)+o.alpha*(1-parseFloat(t))})})),Rd=Cd;var Nd=Ed((function(t,e){if("transparent"===e)return e;var n=md(e);return Md(Yc({},n,{alpha:Ad(0,1,(100*("number"==typeof n.alpha?n.alpha:1)+100*parseFloat(t))/100)}))})),Pd=Nd;Ed((function(t,e){if("transparent"===e)return e;var n=gd(e);return Sd(Yc({},n,{saturation:Ad(0,1,n.saturation+parseFloat(t))}))})),Ed((function(t,e){return"transparent"===e?e:Sd(Yc({},gd(e),{hue:parseFloat(t)}))})),Ed((function(t,e){return"transparent"===e?e:Sd(Yc({},gd(e),{lightness:parseFloat(t)}))})),Ed((function(t,e){return"transparent"===e?e:Sd(Yc({},gd(e),{saturation:parseFloat(t)}))})),Ed((function(t,e){return"transparent"===e?e:Rd(parseFloat(t),"rgb(0, 0, 0)",e)})),Ed((function(t,e){return"transparent"===e?e:Rd(parseFloat(t),"rgb(255, 255, 255)",e)})),Ed((function(t,e){if("transparent"===e)return e;var n=md(e);return Md(Yc({},n,{alpha:Ad(0,1,+(100*("number"==typeof n.alpha?n.alpha:1)-100*parseFloat(t)).toFixed(2)/100)}))}));function kd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Od(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Id(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Dd(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Id(Object(n),!0).forEach((function(e){Od(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Id(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ld(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Fd(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ud(t){return function(t){if(Array.isArray(t))return kd(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Fd(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fd(t,e){if(t){if("string"==typeof t)return kd(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kd(t,e):void 0}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".graph-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: Sans-serif;\n  z-index: 1000;\n}");var zd,Bd,jd,Vd,Gd,Hd,Wd,qd,$d,Xd,Yd,Kd,Zd,Jd=th({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(t,e){e.container&&(e.container.style.width="".concat(t,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(t,e){e.container&&(e.container.style.height="".concat(t,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:Dd(Dd({},Object.assign.apply(Object,[{}].concat(Ud(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map((function(t){return Od({},t,(function(e){for(var n=e.forcegraph.components.forcegraph,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=n[t].apply(n,i);return o===n?this:o}))})))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(t,e){t.innerHTML="",e.container=document.createElement("div"),t.appendChild(e.container),e.container.style.position="relative",e.container.style.width="".concat(e.width,"px"),e.container.style.height="".concat(e.height,"px"),e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="graph-nav-info",e.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var n,r,i,s,o,a=document.createElement("a-scene");a.setAttribute("embedded",""),a.appendChild(e.sky=document.createElement("a-sky")),e.sky.setAttribute("radius",3e3),a.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7"),n.appendChild(r=document.createElement("a-entity")),r.setAttribute("camera",""),r.setAttribute("position","0 0 0"),r.setAttribute("look-controls","pointerLockEnabled: false"),r.setAttribute("wasd-controls","fly: true; acceleration: 700"),r.appendChild(i=document.createElement("a-text")),i.setAttribute("position","0 -0.3 -1"),i.setAttribute("width",2),i.setAttribute("align","center"),i.setAttribute("color","lavender"),i.setAttribute("value",""),r.appendChild(s=document.createElement("a-text")),s.setAttribute("position","0 -0.4 -1"),s.setAttribute("width",1.3),s.setAttribute("align","center"),s.setAttribute("color","lavender"),s.setAttribute("value",""),e.raycasterEls=[],a.appendChild(o=document.createElement("a-entity")),o.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),o.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),e.raycasterEls.push(o),["left","right"].forEach((function(t){var r;n.appendChild(r=document.createElement("a-entity")),r.setAttribute("laser-controls","hand: ".concat(t,"; model: false;")),r.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),e.raycasterEls.push(r)})),a.appendChild(e.forcegraph=document.createElement("a-entity")),e.forcegraph.setAttribute("forcegraph",null),e.container.appendChild(a),e.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,Ud(["node","link"].map((function(t){var n={node:"Node",link:"Link"}[t];return Od({},"on".concat(n,"Hover"),(function(r,o){var a=r&&eh(e["".concat(t,"Label")])(r)||"",l=r&&eh(e["".concat(t,"Desc")])(r)||"";i.setAttribute("value",a),s.setAttribute("value",l),e["on".concat(n,"Hover")]&&e["on".concat(n,"Hover")](r,o)}))})))))},update:function(t,e){if(e.hasOwnProperty("backgroundColor")){var n=md(t.backgroundColor).alpha;void 0===n&&(n=1),t.sky.setAttribute("color",Pd(1,t.backgroundColor)),t.sky.setAttribute("opacity",n)}e.hasOwnProperty("showNavInfo")&&(t.navInfo.style.display=t.showNavInfo?null:"none");var r=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some((function(e){return t[e]}))||["nodeLabel","linkLabel"].some((function(e){return"name"!==t[e]}))||["nodeDesc","linkDesc"].some((function(e){return"desc"!==t[e]}));t.raycasterEls.forEach((function(t){return t.setAttribute("raycaster",r?"objects: [forcegraph]; interval: 100":"objects: __none__")}));var i=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],s=Object.assign.apply(Object,[{}].concat(Ud(Object.entries(t).filter((function(t){var n=Ld(t,2),r=n[0],s=n[1];return e.hasOwnProperty(r)&&-1!==i.indexOf(r)&&null!=s})).map((function(t){var e=Ld(t,2);return Od({},e[0],e[1])}))),Ud(Object.entries(t.graphData).map((function(t){var e=Ld(t,2);return Od({},e[0],e[1])})))));t.forcegraph.setAttribute("forcegraph",s)}}),Qd={exports:{}},tp={exports:{}},ep={};function np(){return Bd||(Bd=1,tp.exports=(zd||(zd=1,function(){var t="function"==typeof Symbol&&Symbol.for,e=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,r=t?Symbol.for("react.fragment"):60107,i=t?Symbol.for("react.strict_mode"):60108,s=t?Symbol.for("react.profiler"):60114,o=t?Symbol.for("react.provider"):60109,a=t?Symbol.for("react.context"):60110,l=t?Symbol.for("react.async_mode"):60111,u=t?Symbol.for("react.concurrent_mode"):60111,h=t?Symbol.for("react.forward_ref"):60112,c=t?Symbol.for("react.suspense"):60113,d=t?Symbol.for("react.suspense_list"):60120,p=t?Symbol.for("react.memo"):60115,f=t?Symbol.for("react.lazy"):60116,m=t?Symbol.for("react.block"):60121,g=t?Symbol.for("react.fundamental"):60117,y=t?Symbol.for("react.responder"):60118,v=t?Symbol.for("react.scope"):60119;function _(t){if("object"==typeof t&&null!==t){var d=t.$$typeof;switch(d){case e:var m=t.type;switch(m){case l:case u:case r:case s:case i:case c:return m;default:var g=m&&m.$$typeof;switch(g){case a:case h:case f:case p:case o:return g;default:return d}}case n:return d}}}var b=l,x=u,w=a,M=o,S=e,T=h,E=r,A=f,C=p,R=n,N=s,P=i,k=c,O=!1;function I(t){return _(t)===u}ep.AsyncMode=b,ep.ConcurrentMode=x,ep.ContextConsumer=w,ep.ContextProvider=M,ep.Element=S,ep.ForwardRef=T,ep.Fragment=E,ep.Lazy=A,ep.Memo=C,ep.Portal=R,ep.Profiler=N,ep.StrictMode=P,ep.Suspense=k,ep.isAsyncMode=function(t){return O||(O=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),I(t)||_(t)===l},ep.isConcurrentMode=I,ep.isContextConsumer=function(t){return _(t)===a},ep.isContextProvider=function(t){return _(t)===o},ep.isElement=function(t){return"object"==typeof t&&null!==t&&t.$$typeof===e},ep.isForwardRef=function(t){return _(t)===h},ep.isFragment=function(t){return _(t)===r},ep.isLazy=function(t){return _(t)===f},ep.isMemo=function(t){return _(t)===p},ep.isPortal=function(t){return _(t)===n},ep.isProfiler=function(t){return _(t)===s},ep.isStrictMode=function(t){return _(t)===i},ep.isSuspense=function(t){return _(t)===c},ep.isValidElementType=function(t){return"string"==typeof t||"function"==typeof t||t===r||t===u||t===s||t===i||t===c||t===d||"object"==typeof t&&null!==t&&(t.$$typeof===f||t.$$typeof===p||t.$$typeof===o||t.$$typeof===a||t.$$typeof===h||t.$$typeof===g||t.$$typeof===y||t.$$typeof===v||t.$$typeof===m)},ep.typeOf=_}()),ep)),tp.exports}function rp(){if(Vd)return jd;Vd=1;var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;return jd=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map((function(t){return e[t]}));if("0123456789"!==r.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(r,i){for(var s,o,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(r),l=1;l<arguments.length;l++){for(var u in s=Object(arguments[l]))e.call(s,u)&&(a[u]=s[u]);if(t){o=t(s);for(var h=0;h<o.length;h++)n.call(s,o[h])&&(a[o[h]]=s[o[h]])}}return a},jd}function ip(){if(Hd)return Gd;Hd=1;return Gd="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function sp(){return qd?Wd:(qd=1,Wd=Function.call.bind(Object.prototype.hasOwnProperty))}function op(){if(Xd)return $d;Xd=1;var t,e=ip(),n={},r=sp();function i(i,s,o,a,l){for(var u in i)if(r(i,u)){var h;try{if("function"!=typeof i[u]){var c=Error((a||"React class")+": "+o+" type `"+u+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof i[u]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}h=i[u](s,u,a,o,null,e)}catch(t){h=t}if(!h||h instanceof Error||t((a||"React class")+": type specification of "+o+" `"+u+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof h+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),h instanceof Error&&!(h.message in n)){n[h.message]=!0;var d=l?l():"";t("Failed "+o+" type: "+h.message+(null!=d?d:""))}}}return t=function(t){var e="Warning: "+t;"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(t){}},i.resetWarningCache=function(){n={}},$d=i}function ap(){if(Kd)return Yd;Kd=1;var t,e=np(),n=rp(),r=ip(),i=sp(),s=op();function o(){return null}return t=function(t){var e="Warning: "+t;"undefined"!=typeof console&&console.error(e);try{throw new Error(e)}catch(t){}},Yd=function(a,l){var u="function"==typeof Symbol&&Symbol.iterator;var h="<<anonymous>>",c={array:m("array"),bigint:m("bigint"),bool:m("boolean"),func:m("function"),number:m("number"),object:m("object"),string:m("string"),symbol:m("symbol"),any:f(o),arrayOf:function(t){return f((function(e,n,i,s,o){if("function"!=typeof t)return new p("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var a=e[n];if(!Array.isArray(a))return new p("Invalid "+s+" `"+o+"` of type `"+v(a)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<a.length;l++){var u=t(a,l,i,s,o+"["+l+"]",r);if(u instanceof Error)return u}return null}))},element:f((function(t,e,n,r,i){var s=t[e];return a(s)?null:new p("Invalid "+r+" `"+i+"` of type `"+v(s)+"` supplied to `"+n+"`, expected a single ReactElement.")})),elementType:f((function(t,n,r,i,s){var o=t[n];return e.isValidElementType(o)?null:new p("Invalid "+i+" `"+s+"` of type `"+v(o)+"` supplied to `"+r+"`, expected a single ReactElement type.")})),instanceOf:function(t){return f((function(e,n,r,i,s){if(!(e[n]instanceof t)){var o=t.name||h;return new p("Invalid "+i+" `"+s+"` of type `"+(((a=e[n]).constructor&&a.constructor.name?a.constructor.name:h)+"` supplied to `")+r+"`, expected instance of `"+o+"`.")}var a;return null}))},node:f((function(t,e,n,r,i){return y(t[e])?null:new p("Invalid "+r+" `"+i+"` supplied to `"+n+"`, expected a ReactNode.")})),objectOf:function(t){return f((function(e,n,s,o,a){if("function"!=typeof t)return new p("Property `"+a+"` of component `"+s+"` has invalid PropType notation inside objectOf.");var l=e[n],u=v(l);if("object"!==u)return new p("Invalid "+o+" `"+a+"` of type `"+u+"` supplied to `"+s+"`, expected an object.");for(var h in l)if(i(l,h)){var c=t(l,h,s,o,a+"."+h,r);if(c instanceof Error)return c}return null}))},oneOf:function(e){if(!Array.isArray(e))return t(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),o;return f((function(t,n,r,i,s){for(var o=t[n],a=0;a<e.length;a++)if(d(o,e[a]))return null;var l=JSON.stringify(e,(function(t,e){return"symbol"===_(e)?String(e):e}));return new p("Invalid "+i+" `"+s+"` of value `"+String(o)+"` supplied to `"+r+"`, expected one of "+l+".")}))},oneOfType:function(e){if(!Array.isArray(e))return t("Invalid argument supplied to oneOfType, expected an instance of array."),o;for(var n=0;n<e.length;n++){var s=e[n];if("function"!=typeof s)return t("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+b(s)+" at index "+n+"."),o}return f((function(t,n,s,o,a){for(var l=[],u=0;u<e.length;u++){var h=(0,e[u])(t,n,s,o,a,r);if(null==h)return null;h.data&&i(h.data,"expectedType")&&l.push(h.data.expectedType)}return new p("Invalid "+o+" `"+a+"` supplied to `"+s+"`"+(l.length>0?", expected one of type ["+l.join(", ")+"]":"")+".")}))},shape:function(t){return f((function(e,n,i,s,o){var a=e[n],l=v(a);if("object"!==l)return new p("Invalid "+s+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var u in t){var h=t[u];if("function"!=typeof h)return g(i,s,o,u,_(h));var c=h(a,u,i,s,o+"."+u,r);if(c)return c}return null}))},exact:function(t){return f((function(e,s,o,a,l){var u=e[s],h=v(u);if("object"!==h)return new p("Invalid "+a+" `"+l+"` of type `"+h+"` supplied to `"+o+"`, expected `object`.");var c=n({},e[s],t);for(var d in c){var f=t[d];if(i(t,d)&&"function"!=typeof f)return g(o,a,l,d,_(f));if(!f)return new p("Invalid "+a+" `"+l+"` key `"+d+"` supplied to `"+o+"`.\nBad object: "+JSON.stringify(e[s],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(t),null,"  "));var m=f(u,d,o,a,l+"."+d,r);if(m)return m}return null}))}};function d(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}function p(t,e){this.message=t,this.data=e&&"object"==typeof e?e:{},this.stack=""}function f(e){var n={},i=0;function s(s,o,a,u,c,d,f){if(u=u||h,d=d||a,f!==r){if(l){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}if("undefined"!=typeof console){var g=u+":"+a;!n[g]&&i<3&&(t("You are manually calling a React.PropTypes validation function for the `"+d+"` prop on `"+u+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),n[g]=!0,i++)}}return null==o[a]?s?null===o[a]?new p("The "+c+" `"+d+"` is marked as required in `"+u+"`, but its value is `null`."):new p("The "+c+" `"+d+"` is marked as required in `"+u+"`, but its value is `undefined`."):null:e(o,a,u,c,d)}var o=s.bind(null,!1);return o.isRequired=s.bind(null,!0),o}function m(t){return f((function(e,n,r,i,s,o){var a=e[n];return v(a)!==t?new p("Invalid "+i+" `"+s+"` of type `"+_(a)+"` supplied to `"+r+"`, expected `"+t+"`.",{expectedType:t}):null}))}function g(t,e,n,r,i){return new p((t||"React class")+": "+e+" type `"+n+"."+r+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+i+"`.")}function y(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(y);if(null===t||a(t))return!0;var e=function(t){var e=t&&(u&&t[u]||t["@@iterator"]);if("function"==typeof e)return e}(t);if(!e)return!1;var n,r=e.call(t);if(e!==t.entries){for(;!(n=r.next()).done;)if(!y(n.value))return!1}else for(;!(n=r.next()).done;){var i=n.value;if(i&&!y(i[1]))return!1}return!0;default:return!1}}function v(t){var e=typeof t;return Array.isArray(t)?"array":t instanceof RegExp?"object":function(t,e){return"symbol"===t||!!e&&("Symbol"===e["@@toStringTag"]||"function"==typeof Symbol&&e instanceof Symbol)}(e,t)?"symbol":e}function _(t){if(null==t)return""+t;var e=v(t);if("object"===e){if(t instanceof Date)return"date";if(t instanceof RegExp)return"regexp"}return e}function b(t){var e=_(t);switch(e){case"array":case"object":return"an "+e;case"boolean":case"date":case"regexp":return"a "+e;default:return e}}return p.prototype=Error.prototype,c.checkPropTypes=s,c.resetWarningCache=s.resetWarningCache,c.PropTypes=c,c},Yd}function lp(){if(Zd)return Qd.exports;Zd=1;var t=np();return Qd.exports=ap()(t.isElement,true),Qd.exports}var up=p(lp()),hp={width:up.number,height:up.number,graphData:up.shape({nodes:up.arrayOf(up.object).isRequired,links:up.arrayOf(up.object).isRequired}),backgroundColor:up.string,nodeRelSize:up.number,nodeId:up.string,nodeLabel:up.oneOfType([up.string,up.func]),nodeVal:up.oneOfType([up.number,up.string,up.func]),nodeVisibility:up.oneOfType([up.bool,up.string,up.func]),nodeColor:up.oneOfType([up.string,up.func]),nodeAutoColorBy:up.oneOfType([up.string,up.func]),onNodeHover:up.func,onNodeClick:up.func,linkSource:up.string,linkTarget:up.string,linkLabel:up.oneOfType([up.string,up.func]),linkVisibility:up.oneOfType([up.bool,up.string,up.func]),linkColor:up.oneOfType([up.string,up.func]),linkAutoColorBy:up.oneOfType([up.string,up.func]),linkWidth:up.oneOfType([up.number,up.string,up.func]),linkCurvature:up.oneOfType([up.number,up.string,up.func]),linkDirectionalArrowLength:up.oneOfType([up.number,up.string,up.func]),linkDirectionalArrowColor:up.oneOfType([up.string,up.func]),linkDirectionalArrowRelPos:up.oneOfType([up.number,up.string,up.func]),linkDirectionalParticles:up.oneOfType([up.number,up.string,up.func]),linkDirectionalParticleSpeed:up.oneOfType([up.number,up.string,up.func]),linkDirectionalParticleWidth:up.oneOfType([up.number,up.string,up.func]),linkDirectionalParticleColor:up.oneOfType([up.string,up.func]),onLinkHover:up.func,onLinkClick:up.func,dagMode:up.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:up.number,dagNodeFilter:up.func,onDagError:up.func,d3AlphaMin:up.number,d3AlphaDecay:up.number,d3VelocityDecay:up.number,warmupTicks:up.number,cooldownTicks:up.number,cooldownTime:up.number,onEngineTick:up.func,onEngineStop:up.func,getGraphBbox:up.func},cp={zoomToFit:up.func,onNodeRightClick:up.func,onNodeDrag:up.func,onNodeDragEnd:up.func,onLinkRightClick:up.func,linkHoverPrecision:up.number,onBackgroundClick:up.func,onBackgroundRightClick:up.func,enablePointerInteraction:up.bool,enableNodeDrag:up.bool},dp={showNavInfo:up.bool,nodeOpacity:up.number,nodeResolution:up.number,nodeThreeObject:up.oneOfType([up.object,up.string,up.func]),nodeThreeObjectExtend:up.oneOfType([up.bool,up.string,up.func]),linkOpacity:up.number,linkResolution:up.number,linkCurveRotation:up.oneOfType([up.number,up.string,up.func]),linkMaterial:up.oneOfType([up.object,up.string,up.func]),linkThreeObject:up.oneOfType([up.object,up.string,up.func]),linkThreeObjectExtend:up.oneOfType([up.bool,up.string,up.func]),linkPositionUpdate:up.func,linkDirectionalArrowResolution:up.number,linkDirectionalParticleResolution:up.number,forceEngine:up.oneOf(["d3","ngraph"]),ngraphPhysics:up.object,numDimensions:up.oneOf([1,2,3])},pp=Object.assign({},hp,cp,{linkLineDash:up.oneOfType([up.arrayOf(up.number),up.string,up.func]),nodeCanvasObjectMode:up.oneOfType([up.string,up.func]),nodeCanvasObject:up.func,nodePointerAreaPaint:up.func,linkCanvasObjectMode:up.oneOfType([up.string,up.func]),linkCanvasObject:up.func,linkPointerAreaPaint:up.func,autoPauseRedraw:up.bool,minZoom:up.number,maxZoom:up.number,enableZoomInteraction:up.oneOfType([up.bool,up.func]),enablePanInteraction:up.oneOfType([up.bool,up.func]),onZoom:up.func,onZoomEnd:up.func,onRenderFramePre:up.func,onRenderFramePost:up.func}),fp=Object.assign({},hp,cp,dp,{enableNavigationControls:up.bool,controlType:up.oneOf(["trackball","orbit","fly"]),rendererConfig:up.object,extraRenderers:up.arrayOf(up.shape({render:up.func.isRequired}))}),mp=Object.assign({},hp,dp,{nodeDesc:up.oneOfType([up.string,up.func]),linkDesc:up.oneOfType([up.string,up.func])}),gp=Object.assign({},hp,dp,{markerAttrs:up.object,yOffset:up.number,glScale:up.number});const yp=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.wrapperElementType,a=void 0===o?"div":o,l=e.nodeMapper,u=void 0===l?function(t){return t}:l,c=e.methodNames,p=void 0===c?[]:c,f=e.initPropNames,m=void 0===f?[]:f;return n.forwardRef((function(e,o){var l=n.useRef(),c=n.useMemo((function(){var n=Object.fromEntries(m.filter((function(t){return e.hasOwnProperty(t)})).map((function(t){return[t,e[t]]})));return t(n)}),[]);d((function(){c(u(l.current))}),n.useLayoutEffect),d((function(){return c._destructor instanceof Function?c._destructor:void 0}));var f,g,y,v=n.useCallback((function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return c[t]instanceof Function?c[t].apply(c,n):void 0}),[c]),_=n.useRef({});return Object.keys((f=e,g=[].concat(h(p),h(m)),y=new Set(g),Object.assign.apply(Object,[{}].concat(s(Object.entries(f).filter((function(t){var e=i(t,1)[0];return!y.has(e)})).map((function(t){var e=i(t,2);return r({},e[0],e[1])}))))))).filter((function(t){return _.current[t]!==e[t]})).forEach((function(t){return v(t,e[t])})),_.current=e,n.useImperativeHandle(o,(function(){return Object.fromEntries(p.map((function(t){return[t,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return v.apply(void 0,[t].concat(n))}]})))}),[v]),n.createElement(a,{ref:l})}))}(Jd,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});function vp(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||xp(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bp(t){return function(t){if(Array.isArray(t))return wp(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||xp(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xp(t,e){if(t){if("string"==typeof t)return wp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wp(t,e):void 0}}function wp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}yp.displayName="ForceGraphVR",yp.propTypes=mp;function Mp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Sp(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Ep(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tp(t){return function(t){if(Array.isArray(t))return Mp(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ep(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ep(t,e){if(t){if("string"==typeof t)return Mp(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mp(t,e):void 0}}function Ap(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.useEffect,r=n.useRef(),i=n.useRef(!1),s=n.useRef(!1),o=Sp(n.useState(0),2);o[0];var a=o[1];i.current&&(s.current=!0),e((function(){return i.current||(r.current=t(),i.current=!0),a((function(t){return t+1})),function(){s.current&&r.current&&r.current()}}),[])}const Cp=1001,Rp="srgb",Np="srgb-linear",Pp="linear",kp="srgb",Op=7680,Ip=2e3;let Dp=class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return void 0!==n&&(void 0!==n[t]&&-1!==n[t].indexOf(e))}removeEventListener(t,e){const n=this._listeners;if(void 0===n)return;const r=n[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,r=e.length;n<r;n++)e[n].call(this,t);t.target=null}}};const Lp=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Up(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Lp[255&t]+Lp[t>>8&255]+Lp[t>>16&255]+Lp[t>>24&255]+"-"+Lp[255&e]+Lp[e>>8&255]+"-"+Lp[e>>16&15|64]+Lp[e>>24&255]+"-"+Lp[63&n|128]+Lp[n>>8&255]+"-"+Lp[n>>16&255]+Lp[n>>24&255]+Lp[255&r]+Lp[r>>8&255]+Lp[r>>16&255]+Lp[r>>24&255]).toLowerCase()}function Fp(t,e,n){return Math.max(e,Math.min(n,t))}function zp(t,e,n){return(1-n)*t+n*e}function Bp(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function jp(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}let Vp=class t{constructor(e=0,n=0){t.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Fp(this.x,t.x,e.x),this.y=Fp(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=Fp(this.x,t,e),this.y=Fp(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Fp(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Fp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Gp=class t{constructor(e,n,r,i,s,o,a,l,u){t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,u)}set(t,e,n,r,i,s,o,a,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],u=n[4],h=n[7],c=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*y+a*b,i[3]=s*m+o*v+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+u*y+h*b,i[4]=l*m+u*v+h*x,i[7]=l*g+u*_+h*w,i[2]=c*f+d*y+p*b,i[5]=c*m+d*v+p*x,i[8]=c*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8];return e*s*u-e*o*l-n*i*u+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=u*s-o*l,c=o*a-u*i,d=l*i-s*a,p=e*h+n*c+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(r*l-u*n)*f,t[2]=(o*n-r*s)*f,t[3]=c*f,t[4]=(u*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Hp.makeScale(t,e)),this}rotate(t){return this.premultiply(Hp.makeRotation(-t)),this}translate(t,e){return this.premultiply(Hp.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}};const Hp=new Gp;function Wp(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const qp=(new Gp).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),$p=(new Gp).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Xp(){const t={enabled:!0,workingColorSpace:Np,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===kp&&(t.r=Kp(t.r),t.g=Kp(t.g),t.b=Kp(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===kp&&(t.r=Zp(t.r),t.g=Zp(t.g),t.b=Zp(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?Pp:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[Np]:{primaries:e,whitePoint:r,transfer:Pp,toXYZ:qp,fromXYZ:$p,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Rp},outputColorSpaceConfig:{drawingBufferColorSpace:Rp}},[Rp]:{primaries:e,whitePoint:r,transfer:kp,toXYZ:qp,fromXYZ:$p,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Rp}}}),t}const Yp=Xp();function Kp(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Zp(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Jp,Qp=class{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Jp&&(Jp=Wp("canvas")),Jp.width=t.width,Jp.height=t.height;const n=Jp.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Jp}return e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Wp("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*Kp(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Kp(e[t]/255)):e[t]=Kp(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},tf=0,ef=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tf++}),this.uuid=Up(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(nf(r[e].image)):t.push(nf(r[e]))}else t=nf(r);n.url=t}return e||(t.images[this.uuid]=n),n}};function nf(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Qp.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let rf=0,sf=class t extends Dp{constructor(e=t.DEFAULT_IMAGE,n=t.DEFAULT_MAPPING,r=1001,i=1001,s=1006,o=1008,a=1023,l=1009,u=t.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rf++}),this.uuid=Up(),this.name="",this.source=new ef(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Vp(0,0),this.repeat=new Vp(1,1),this.center=new Vp(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Gp,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case Cp:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case Cp:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}};sf.DEFAULT_IMAGE=null,sf.DEFAULT_MAPPING=300,sf.DEFAULT_ANISOTROPY=1;let of=class t{constructor(e=0,n=0,r=0,i=1){t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],u=a[4],h=a[8],c=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-c)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+c)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(u+c)/4,_=(h+f)/4,b=(p+m)/4;return t>a&&t>y?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=v/n,i=_/n):a>y?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=b/r):y<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=b/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(c-u)*(c-u));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(h-f)/y,this.z=(c-u)/y,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Fp(this.x,t.x,e.x),this.y=Fp(this.y,t.y,e.y),this.z=Fp(this.z,t.z,e.z),this.w=Fp(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=Fp(this.x,t,e),this.y=Fp(this.y,t,e),this.z=Fp(this.z,t,e),this.w=Fp(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Fp(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},af=class{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],u=n[r+2],h=n[r+3];const c=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=u,void(t[e+3]=h);if(1===o)return t[e+0]=c,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==c||l!==d||u!==p){let t=1-o;const e=a*c+l*d+u*p+h*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+c*i,l=l*t+d*i,u=u*t+p*i,h=h*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+u*u+h*h);a*=t,l*=t,u*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=u,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],u=n[r+3],h=i[s],c=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+u*h+a*d-l*c,t[e+1]=a*p+u*c+l*h-o*d,t[e+2]=l*p+u*d+o*c-a*h,t[e+3]=u*p-o*h-a*c-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),u=o(r/2),h=o(i/2),c=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"YXZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"ZXY":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"ZYX":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"YZX":this._x=c*u*h+l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h-c*d*p;break;case"XZY":this._x=c*u*h-l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],u=e[6],h=e[10],c=n+o+h;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(u-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>h){const t=2*Math.sqrt(1+n-o-h);this._w=(u-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-n-h);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+h-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Fp(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,u=e._w;return this._x=n*u+s*o+r*l-i*a,this._y=r*u+s*a+i*o-n*l,this._z=i*u+s*l+n*a-r*o,this._w=s*u-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,o),h=Math.sin((1-e)*u)/l,c=Math.sin(e*u)/l;return this._w=s*h+this._w*c,this._x=n*h+this._x*c,this._y=r*h+this._y*c,this._z=i*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},lf=class t{constructor(e=0,n=0,r=0){t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(hf.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(hf.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),u=2*(o*e-i*r),h=2*(i*n-s*e);return this.x=e+a*l+s*h-o*u,this.y=n+a*u+o*l-i*h,this.z=r+a*h+i*u-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Fp(this.x,t.x,e.x),this.y=Fp(this.y,t.y,e.y),this.z=Fp(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=Fp(this.x,t,e),this.y=Fp(this.y,t,e),this.z=Fp(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Fp(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return uf.copy(this).projectOnVector(t),this.sub(uf)}reflect(t){return this.sub(uf.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Fp(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const uf=new lf,hf=new af;let cf=class{constructor(t=new lf(1/0,1/0,1/0),e=new lf(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(pf.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(pf.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=pf.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,pf):pf.fromBufferAttribute(r,e),pf.applyMatrix4(t.matrixWorld),this.expandByPoint(pf);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),ff.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),ff.copy(n.boundingBox)),ff.applyMatrix4(t.matrixWorld),this.union(ff)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,pf),pf.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(xf),wf.subVectors(this.max,xf),mf.subVectors(t.a,xf),gf.subVectors(t.b,xf),yf.subVectors(t.c,xf),vf.subVectors(gf,mf),_f.subVectors(yf,gf),bf.subVectors(mf,yf);let e=[0,-vf.z,vf.y,0,-_f.z,_f.y,0,-bf.z,bf.y,vf.z,0,-vf.x,_f.z,0,-_f.x,bf.z,0,-bf.x,-vf.y,vf.x,0,-_f.y,_f.x,0,-bf.y,bf.x,0];return!!Tf(e,mf,gf,yf,wf)&&(e=[1,0,0,0,1,0,0,0,1],!!Tf(e,mf,gf,yf,wf)&&(Mf.crossVectors(vf,_f),e=[Mf.x,Mf.y,Mf.z],Tf(e,mf,gf,yf,wf)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,pf).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(pf).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(df[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),df[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),df[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),df[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),df[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),df[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),df[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),df[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(df)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};const df=[new lf,new lf,new lf,new lf,new lf,new lf,new lf,new lf],pf=new lf,ff=new cf,mf=new lf,gf=new lf,yf=new lf,vf=new lf,_f=new lf,bf=new lf,xf=new lf,wf=new lf,Mf=new lf,Sf=new lf;function Tf(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Sf.fromArray(t,s);const o=i.x*Math.abs(Sf.x)+i.y*Math.abs(Sf.y)+i.z*Math.abs(Sf.z),a=e.dot(Sf),l=n.dot(Sf),u=r.dot(Sf);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>o)return!1}return!0}const Ef=new cf,Af=new lf,Cf=new lf;let Rf=class{constructor(t=new lf,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Ef.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Af.subVectors(t,this.center);const e=Af.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Af,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Cf.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Af.copy(t.center).add(Cf)),this.expandByPoint(Af.copy(t.center).sub(Cf))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}};const Nf=new lf,Pf=new lf,kf=new lf,Of=new lf,If=new lf,Df=new lf,Lf=new lf;let Uf=class{constructor(t=new lf,e=new lf(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Nf)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Nf.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Nf.copy(this.origin).addScaledVector(this.direction,e),Nf.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){Pf.copy(t).add(e).multiplyScalar(.5),kf.copy(e).sub(t).normalize(),Of.copy(this.origin).sub(Pf);const i=.5*t.distanceTo(e),s=-this.direction.dot(kf),o=Of.dot(this.direction),a=-Of.dot(kf),l=Of.lengthSq(),u=Math.abs(1-s*s);let h,c,d,p;if(u>0)if(h=s*a-o,c=s*o-a,p=i*u,h>=0)if(c>=-p)if(c<=p){const t=1/u;h*=t,c*=t,d=h*(h+s*c+2*o)+c*(s*h+c+2*a)+l}else c=i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c=-i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c<=-p?(h=Math.max(0,-(-s*i+o)),c=h>0?-i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l):c<=p?(h=0,c=Math.min(Math.max(-i,-a),i),d=c*(c+2*a)+l):(h=Math.max(0,-(s*i+o)),c=h>0?i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l);else c=s>0?-i:i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(Pf).addScaledVector(kf,c),d}intersectSphere(t,e){Nf.subVectors(t.center,this.origin);const n=Nf.dot(this.direction),r=Nf.dot(Nf)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(n=(t.min.x-c.x)*l,r=(t.max.x-c.x)*l):(n=(t.max.x-c.x)*l,r=(t.min.x-c.x)*l),u>=0?(i=(t.min.y-c.y)*u,s=(t.max.y-c.y)*u):(i=(t.max.y-c.y)*u,s=(t.min.y-c.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),h>=0?(o=(t.min.z-c.z)*h,a=(t.max.z-c.z)*h):(o=(t.max.z-c.z)*h,a=(t.min.z-c.z)*h),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Nf)}intersectTriangle(t,e,n,r,i){If.subVectors(e,t),Df.subVectors(n,t),Lf.crossVectors(If,Df);let s,o=this.direction.dot(Lf);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Of.subVectors(this.origin,t);const a=s*this.direction.dot(Df.crossVectors(Of,Df));if(a<0)return null;const l=s*this.direction.dot(If.cross(Of));if(l<0)return null;if(a+l>o)return null;const u=-s*Of.dot(Lf);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},Ff=class t{constructor(e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g){t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g)}set(t,e,n,r,i,s,o,a,l,u,h,c,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=u,g[10]=h,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new t).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/zf.setFromMatrixColumn(t,0).length(),i=1/zf.setFromMatrixColumn(t,1).length(),s=1/zf.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=-a*h,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*h,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t-i*o,e[4]=-s*h,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*h,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=i-t*h,e[8]=r*h+n,e[1]=h,e[5]=s*u,e[9]=-o*u,e[2]=-l*u,e[6]=n*h+r,e[10]=t-i*h}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=-h,e[8]=l*u,e[1]=t*h+i,e[5]=s*u,e[9]=n*h-r,e[2]=r*h-n,e[6]=o*u,e[10]=i*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(jf,t,Vf)}lookAt(t,e,n){const r=this.elements;return Wf.subVectors(t,e),0===Wf.lengthSq()&&(Wf.z=1),Wf.normalize(),Gf.crossVectors(n,Wf),0===Gf.lengthSq()&&(1===Math.abs(n.z)?Wf.x+=1e-4:Wf.z+=1e-4,Wf.normalize(),Gf.crossVectors(n,Wf)),Gf.normalize(),Hf.crossVectors(Wf,Gf),r[0]=Gf.x,r[4]=Hf.x,r[8]=Wf.x,r[1]=Gf.y,r[5]=Hf.y,r[9]=Wf.y,r[2]=Gf.z,r[6]=Hf.z,r[10]=Wf.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],u=n[1],h=n[5],c=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],b=n[15],x=r[0],w=r[4],M=r[8],S=r[12],T=r[1],E=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],k=r[14],O=r[3],I=r[7],D=r[11],L=r[15];return i[0]=s*x+o*T+a*R+l*O,i[4]=s*w+o*E+a*N+l*I,i[8]=s*M+o*A+a*P+l*D,i[12]=s*S+o*C+a*k+l*L,i[1]=u*x+h*T+c*R+d*O,i[5]=u*w+h*E+c*N+d*I,i[9]=u*M+h*A+c*P+d*D,i[13]=u*S+h*C+c*k+d*L,i[2]=p*x+f*T+m*R+g*O,i[6]=p*w+f*E+m*N+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*S+f*C+m*k+g*L,i[3]=y*x+v*T+_*R+b*O,i[7]=y*w+v*E+_*N+b*I,i[11]=y*M+v*A+_*P+b*D,i[15]=y*S+v*C+_*k+b*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],u=t[2],h=t[6],c=t[10],d=t[14];return t[3]*(+i*a*h-r*l*h-i*o*c+n*l*c+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*c+i*s*c-r*s*d+r*l*u-i*a*u)+t[11]*(+e*l*h-e*o*d-i*s*h+n*s*d+i*o*u-n*l*u)+t[15]*(-r*o*u-e*a*h+e*o*c+r*s*h-n*s*c+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=h*m*l-f*c*l+f*a*d-o*m*d-h*a*g+o*c*g,v=p*c*l-u*m*l-p*a*d+s*m*d+u*a*g-s*c*g,_=u*f*l-p*h*l+p*o*d-s*f*d-u*o*g+s*h*g,b=p*h*a-u*f*a-p*o*c+s*f*c+u*o*m-s*h*m,x=e*y+n*v+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=y*w,t[1]=(f*c*i-h*m*i-f*r*d+n*m*d+h*r*g-n*c*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(h*a*i-o*c*i-h*r*l+n*c*l+o*r*d-n*a*d)*w,t[4]=v*w,t[5]=(u*m*i-p*c*i+p*r*d-e*m*d-u*r*g+e*c*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*c*i-u*a*i+u*r*l-e*c*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*h*i-u*f*i-p*n*d+e*f*d+u*n*g-e*h*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(u*o*i-s*h*i-u*n*l+e*h*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(u*f*r-p*h*r+p*n*c-e*f*c-u*n*m+e*h*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*h*r-u*o*r+u*n*a-e*h*a-s*n*c+e*o*c)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,u=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,u*o+n,u*a-r*s,0,l*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,u=s+s,h=o+o,c=i*l,d=i*u,p=i*h,f=s*u,m=s*h,g=o*h,y=a*l,v=a*u,_=a*h,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-v)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(c+g))*x,r[6]=(m+y)*x,r[7]=0,r[8]=(p+v)*w,r[9]=(m-y)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=zf.set(r[0],r[1],r[2]).length();const s=zf.set(r[4],r[5],r[6]).length(),o=zf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Bf.copy(this);const a=1/i,l=1/s,u=1/o;return Bf.elements[0]*=a,Bf.elements[1]*=a,Bf.elements[2]*=a,Bf.elements[4]*=l,Bf.elements[5]*=l,Bf.elements[6]*=l,Bf.elements[8]*=u,Bf.elements[9]*=u,Bf.elements[10]*=u,e.setFromRotationMatrix(Bf),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s,o=2e3){const a=this.elements,l=2*i/(e-t),u=2*i/(n-r),h=(e+t)/(e-t),c=(n+r)/(n-r);let d,p;if(o===Ip)d=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(2001!==o)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-i),p=-s*i/(s-i)}return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,s,o=2e3){const a=this.elements,l=1/(e-t),u=1/(n-r),h=1/(s-i),c=(e+t)*l,d=(n+r)*u;let p,f;if(o===Ip)p=(s+i)*h,f=-2*h;else{if(2001!==o)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*h,f=-1*h}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};const zf=new lf,Bf=new Ff,jf=new lf(0,0,0),Vf=new lf(1,1,1),Gf=new lf,Hf=new lf,Wf=new lf,qf=new Ff,$f=new af;let Xf=class t{constructor(e=0,n=0,r=0,i=t.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],u=r[9],h=r[2],c=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(Fp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Fp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(Fp(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Fp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Fp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Fp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return qf.makeRotationFromQuaternion(t),this.setFromRotationMatrix(qf,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return $f.setFromEuler(this),this.setFromQuaternion($f,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Xf.DEFAULT_ORDER="XYZ";let Yf=class{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}},Kf=0;const Zf=new lf,Jf=new af,Qf=new Ff,tm=new lf,em=new lf,nm=new lf,rm=new af,im=new lf(1,0,0),sm=new lf(0,1,0),om=new lf(0,0,1),am={type:"added"},lm={type:"removed"},um={type:"childadded",child:null},hm={type:"childremoved",child:null};let cm=class t extends Dp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Kf++}),this.uuid=Up(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=t.DEFAULT_UP.clone();const e=new lf,n=new Xf,r=new af,i=new lf(1,1,1);n._onChange((function(){r.setFromEuler(n,!1)})),r._onChange((function(){n.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ff},normalMatrix:{value:new Gp}}),this.matrix=new Ff,this.matrixWorld=new Ff,this.matrixAutoUpdate=t.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=t.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Yf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Jf.setFromAxisAngle(t,e),this.quaternion.multiply(Jf),this}rotateOnWorldAxis(t,e){return Jf.setFromAxisAngle(t,e),this.quaternion.premultiply(Jf),this}rotateX(t){return this.rotateOnAxis(im,t)}rotateY(t){return this.rotateOnAxis(sm,t)}rotateZ(t){return this.rotateOnAxis(om,t)}translateOnAxis(t,e){return Zf.copy(t).applyQuaternion(this.quaternion),this.position.add(Zf.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(im,t)}translateY(t){return this.translateOnAxis(sm,t)}translateZ(t){return this.translateOnAxis(om,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Qf.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?tm.copy(t):tm.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),em.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Qf.lookAt(em,tm,this.up):Qf.lookAt(tm,em,this.up),this.quaternion.setFromRotationMatrix(Qf),r&&(Qf.extractRotation(r.matrixWorld),Jf.setFromRotationMatrix(Qf),this.quaternion.premultiply(Jf.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(am),um.child=t,this.dispatchEvent(um),um.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(lm),hm.child=t,this.dispatchEvent(hm),hm.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Qf.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Qf.multiply(t.parent.matrixWorld)),t.applyMatrix4(Qf),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(am),um.child=t,this.dispatchEvent(um),um.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(em,t,nm),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(em,rm,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),u=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),h.length>0&&(n.nodes=h)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}};cm.DEFAULT_UP=new lf(0,1,0),cm.DEFAULT_MATRIX_AUTO_UPDATE=!0,cm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const dm=new lf,pm=new lf,fm=new lf,mm=new lf,gm=new lf,ym=new lf,vm=new lf,_m=new lf,bm=new lf,xm=new lf,wm=new of,Mm=new of,Sm=new of;let Tm=class t{constructor(t=new lf,e=new lf,n=new lf){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),dm.subVectors(t,e),r.cross(dm);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){dm.subVectors(r,e),pm.subVectors(n,e),fm.subVectors(t,e);const s=dm.dot(dm),o=dm.dot(pm),a=dm.dot(fm),l=pm.dot(pm),u=pm.dot(fm),h=s*l-o*o;if(0===h)return i.set(0,0,0),null;const c=1/h,d=(l*a-o*u)*c,p=(s*u-o*a)*c;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,mm)&&(mm.x>=0&&mm.y>=0&&mm.x+mm.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,mm)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,mm.x),a.addScaledVector(s,mm.y),a.addScaledVector(o,mm.z),a)}static getInterpolatedAttribute(t,e,n,r,i,s){return wm.setScalar(0),Mm.setScalar(0),Sm.setScalar(0),wm.fromBufferAttribute(t,e),Mm.fromBufferAttribute(t,n),Sm.fromBufferAttribute(t,r),s.setScalar(0),s.addScaledVector(wm,i.x),s.addScaledVector(Mm,i.y),s.addScaledVector(Sm,i.z),s}static isFrontFacing(t,e,n,r){return dm.subVectors(n,e),pm.subVectors(t,e),dm.cross(pm).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return dm.subVectors(this.c,this.b),pm.subVectors(this.a,this.b),.5*dm.cross(pm).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return t.getNormal(this.a,this.b,this.c,e)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return t.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return t.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return t.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;gm.subVectors(r,n),ym.subVectors(i,n),_m.subVectors(t,n);const a=gm.dot(_m),l=ym.dot(_m);if(a<=0&&l<=0)return e.copy(n);bm.subVectors(t,r);const u=gm.dot(bm),h=ym.dot(bm);if(u>=0&&h<=u)return e.copy(r);const c=a*h-u*l;if(c<=0&&a>=0&&u<=0)return s=a/(a-u),e.copy(n).addScaledVector(gm,s);xm.subVectors(t,i);const d=gm.dot(xm),p=ym.dot(xm);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(ym,o);const m=u*p-d*h;if(m<=0&&h-u>=0&&d-p>=0)return vm.subVectors(i,r),o=(h-u)/(h-u+(d-p)),e.copy(r).addScaledVector(vm,o);const g=1/(m+f+c);return s=f*g,o=c*g,e.copy(n).addScaledVector(gm,s).addScaledVector(ym,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};const Em={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Am={h:0,s:0,l:0},Cm={h:0,s:0,l:0};function Rm(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}let Nm=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Rp){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Yp.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=Yp.workingColorSpace){return this.r=t,this.g=e,this.b=n,Yp.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=Yp.workingColorSpace){if(t=function(t,e){return(t%e+e)%e}(t,1),e=Fp(e,0,1),n=Fp(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Rm(i,r,t+1/3),this.g=Rm(i,r,t),this.b=Rm(i,r,t-1/3)}return Yp.toWorkingColorSpace(this,r),this}setStyle(t,e=Rp){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Rp){const n=Em[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Kp(t.r),this.g=Kp(t.g),this.b=Kp(t.b),this}copyLinearToSRGB(t){return this.r=Zp(t.r),this.g=Zp(t.g),this.b=Zp(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Rp){return Yp.fromWorkingColorSpace(Pm.copy(this),t),65536*Math.round(Fp(255*Pm.r,0,255))+256*Math.round(Fp(255*Pm.g,0,255))+Math.round(Fp(255*Pm.b,0,255))}getHexString(t=Rp){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Yp.workingColorSpace){Yp.fromWorkingColorSpace(Pm.copy(this),e);const n=Pm.r,r=Pm.g,i=Pm.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const u=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=u<=.5?t/(s+o):t/(2-s-o),s){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=u,t}getRGB(t,e=Yp.workingColorSpace){return Yp.fromWorkingColorSpace(Pm.copy(this),e),t.r=Pm.r,t.g=Pm.g,t.b=Pm.b,t}getStyle(t=Rp){Yp.fromWorkingColorSpace(Pm.copy(this),t);const e=Pm.r,n=Pm.g,r=Pm.b;return t!==Rp?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Am),this.setHSL(Am.h+t,Am.s+e,Am.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Am),t.getHSL(Cm);const n=zp(Am.h,Cm.h,e),r=zp(Am.s,Cm.s,e),i=zp(Am.l,Cm.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Pm=new Nm;Nm.NAMES=Em;let km=0,Om=class extends Dp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:km++}),this.uuid=Up(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Nm(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Op,this.stencilZFail=Op,this.stencilZPass=Op,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Op&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Op&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Op&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},Im=class extends Om{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Nm(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xf,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};const Dm=new lf,Lm=new Vp;let Um=0,Fm=class{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Um++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Lm.fromBufferAttribute(this,e),Lm.applyMatrix3(t),this.setXY(e,Lm.x,Lm.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Dm.fromBufferAttribute(this,e),Dm.applyMatrix3(t),this.setXYZ(e,Dm.x,Dm.y,Dm.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Dm.fromBufferAttribute(this,e),Dm.applyMatrix4(t),this.setXYZ(e,Dm.x,Dm.y,Dm.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Dm.fromBufferAttribute(this,e),Dm.applyNormalMatrix(t),this.setXYZ(e,Dm.x,Dm.y,Dm.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Dm.fromBufferAttribute(this,e),Dm.transformDirection(t),this.setXYZ(e,Dm.x,Dm.y,Dm.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Bp(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=jp(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Bp(e,this.array)),e}setX(t,e){return this.normalized&&(e=jp(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Bp(e,this.array)),e}setY(t,e){return this.normalized&&(e=jp(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Bp(e,this.array)),e}setZ(t,e){return this.normalized&&(e=jp(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Bp(e,this.array)),e}setW(t,e){return this.normalized&&(e=jp(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=jp(e,this.array),n=jp(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=jp(e,this.array),n=jp(n,this.array),r=jp(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=jp(e,this.array),n=jp(n,this.array),r=jp(r,this.array),i=jp(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}},zm=class extends Fm{constructor(t,e,n){super(new Uint16Array(t),e,n)}},Bm=class extends Fm{constructor(t,e,n){super(new Uint32Array(t),e,n)}},jm=class extends Fm{constructor(t,e,n){super(new Float32Array(t),e,n)}},Vm=0;const Gm=new Ff,Hm=new cm,Wm=new lf,qm=new cf,$m=new cf,Xm=new lf;let Ym=class t extends Dp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vm++}),this.uuid=Up(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?Bm:zm)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Gp).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Gm.makeRotationFromQuaternion(t),this.applyMatrix4(Gm),this}rotateX(t){return Gm.makeRotationX(t),this.applyMatrix4(Gm),this}rotateY(t){return Gm.makeRotationY(t),this.applyMatrix4(Gm),this}rotateZ(t){return Gm.makeRotationZ(t),this.applyMatrix4(Gm),this}translate(t,e,n){return Gm.makeTranslation(t,e,n),this.applyMatrix4(Gm),this}scale(t,e,n){return Gm.makeScale(t,e,n),this.applyMatrix4(Gm),this}lookAt(t){return Hm.lookAt(t),Hm.updateMatrix(),this.applyMatrix4(Hm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wm).negate(),this.translate(Wm.x,Wm.y,Wm.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}this.setAttribute("position",new jm(e,3))}else{const n=Math.min(t.length,e.count);for(let r=0;r<n;r++){const n=t[r];e.setXYZ(r,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new cf);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new lf(-1/0,-1/0,-1/0),new lf(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];qm.setFromBufferAttribute(n),this.morphTargetsRelative?(Xm.addVectors(this.boundingBox.min,qm.min),this.boundingBox.expandByPoint(Xm),Xm.addVectors(this.boundingBox.max,qm.max),this.boundingBox.expandByPoint(Xm)):(this.boundingBox.expandByPoint(qm.min),this.boundingBox.expandByPoint(qm.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Rf);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new lf,1/0);if(t){const n=this.boundingSphere.center;if(qm.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];$m.setFromBufferAttribute(n),this.morphTargetsRelative?(Xm.addVectors(qm.min,$m.min),qm.expandByPoint(Xm),Xm.addVectors(qm.max,$m.max),qm.expandByPoint(Xm)):(qm.expandByPoint($m.min),qm.expandByPoint($m.max))}qm.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)Xm.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(Xm));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)Xm.fromBufferAttribute(s,e),o&&(Wm.fromBufferAttribute(t,e),Xm.add(Wm)),r=Math.max(r,n.distanceToSquared(Xm))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Fm(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<n.count;t++)o[t]=new lf,a[t]=new lf;const l=new lf,u=new lf,h=new lf,c=new Vp,d=new Vp,p=new Vp,f=new lf,m=new lf;function g(t,e,r){l.fromBufferAttribute(n,t),u.fromBufferAttribute(n,e),h.fromBufferAttribute(n,r),c.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),u.sub(l),h.sub(l),d.sub(c),p.sub(c);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const v=new lf,_=new lf,b=new lf,x=new lf;function w(t){b.fromBufferAttribute(r,t),x.copy(b);const e=o[t];v.copy(e),v.sub(b.multiplyScalar(b.dot(e))).normalize(),_.crossVectors(x,e);const n=_.dot(a[t])<0?-1:1;s.setXYZW(t,v.x,v.y,v.z,n)}for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Fm(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new lf,i=new lf,s=new lf,o=new lf,a=new lf,l=new lf,u=new lf,h=new lf;if(t)for(let c=0,d=t.count;c<d;c+=3){const d=t.getX(c+0),p=t.getX(c+1),f=t.getX(c+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),a.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),n.setXYZ(t+0,u.x,u.y,u.z),n.setXYZ(t+1,u.x,u.y,u.z),n.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Xm.fromBufferAttribute(t,e),Xm.normalize(),t.setXYZ(e,Xm.x,Xm.y,Xm.z)}toNonIndexed(){function e(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Fm(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new t,r=this.index.array,i=this.attributes;for(const t in i){const s=e(i[t],r);n.setAttribute(t,s)}const s=this.morphAttributes;for(const t in s){const i=[],o=s[t];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],r);i.push(n)}n.morphAttributes[t]=i}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let t=0,e=o.length;t<e;t++){const e=o[t];n.addGroup(e.start,e.count,e.materialIndex)}return n}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const Km=new Ff,Zm=new Uf,Jm=new Rf,Qm=new lf,tg=new lf,eg=new lf,ng=new lf,rg=new lf,ig=new lf,sg=new lf,og=new lf;function ag(t,e,n,r,i,s,o,a,l,u){t.getVertexPosition(a,tg),t.getVertexPosition(l,eg),t.getVertexPosition(u,ng);const h=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;og.copy(a),og.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(og);return u<n.near||u>n.far?null:{distance:u,point:og.clone(),object:t}}(t,e,n,r,tg,eg,ng,sg);if(h){const t=new lf;Tm.getBarycoord(sg,tg,eg,ng,t),i&&(h.uv=Tm.getInterpolatedAttribute(i,a,l,u,t,new Vp)),s&&(h.uv1=Tm.getInterpolatedAttribute(s,a,l,u,t,new Vp)),o&&(h.normal=Tm.getInterpolatedAttribute(o,a,l,u,t,new lf),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const e={a:a,b:l,c:u,normal:new lf,materialIndex:0};Tm.getNormal(tg,eg,ng,e.normal),h.face=e,h.barycoord=t}return h}let lg=class extends cm{constructor(){super(),this.isGroup=!0,this.type="Group"}},ug=class extends Om{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Nm(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}};const hg=new lf,cg=new lf,dg=new Ff,pg=new Uf,fg=new Rf,mg=new lf,gg=new lf;function yg(t,e,n,r,i,s,o){const a=t.geometry.attributes.position;hg.fromBufferAttribute(a,i),cg.fromBufferAttribute(a,s);if(n.distanceSqToSegment(hg,cg,mg,gg)>r)return;mg.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(mg);return l<e.near||l>e.far?void 0:{distance:l,point:gg.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}let vg=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const u=n[r];return(r+(s-u)/(n[r+1]-u))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new Vp:new lf);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new lf,r=[],i=[],s=[],o=new lf,a=new Ff;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new lf)}i[0]=new lf,s[0]=new lf;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),c=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),c<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Fp(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Fp(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},_g=class extends vg{constructor(t=0,e=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new Vp){const n=e,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};function bg(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,u=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,u*=o,i(e,n,l,u)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}const xg=new lf,wg=new bg,Mg=new bg,Sg=new bg;function Tg(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function Eg(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function Ag(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}let Cg=class extends vg{constructor(t=new lf,e=new lf,n=new lf,r=new lf){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new lf){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Ag(t,r.x,i.x,s.x,o.x),Ag(t,r.y,i.y,s.y,o.y),Ag(t,r.z,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},Rg=class extends vg{constructor(t=new lf,e=new lf,n=new lf){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new lf){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(Eg(t,r.x,i.x,s.x),Eg(t,r.y,i.y,s.y),Eg(t,r.z,i.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}};var Ng=Object.freeze({__proto__:null,ArcCurve:class extends _g{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends vg{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new lf){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?o=r[(l-1)%i]:(xg.subVectors(r[0],r[1]).add(r[0]),o=xg);const h=r[l%i],c=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(xg.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=xg),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(c),t),r=Math.pow(c.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),wg.initNonuniformCatmullRom(o.x,h.x,c.x,a.x,e,n,r),Mg.initNonuniformCatmullRom(o.y,h.y,c.y,a.y,e,n,r),Sg.initNonuniformCatmullRom(o.z,h.z,c.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(wg.initCatmullRom(o.x,h.x,c.x,a.x,this.tension),Mg.initCatmullRom(o.y,h.y,c.y,a.y,this.tension),Sg.initCatmullRom(o.z,h.z,c.z,a.z,this.tension));return n.set(wg.calc(u),Mg.calc(u),Sg.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new lf).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:class extends vg{constructor(t=new Vp,e=new Vp,n=new Vp,r=new Vp){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Vp){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(Ag(t,r.x,i.x,s.x,o.x),Ag(t,r.y,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},CubicBezierCurve3:Cg,EllipseCurve:_g,LineCurve:class extends vg{constructor(t=new Vp,e=new Vp){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Vp){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Vp){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},LineCurve3:class extends vg{constructor(t=new lf,e=new lf){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new lf){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new lf){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:class extends vg{constructor(t=new Vp,e=new Vp,n=new Vp){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Vp){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(Eg(t,r.x,i.x,s.x),Eg(t,r.y,i.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve3:Rg,SplineCurve:class extends vg{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Vp){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return n.set(Tg(o,a.x,l.x,u.x,h.x),Tg(o,a.y,l.y,u.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Vp).fromArray(n))}return this}}});let Pg=class t extends Ym{constructor(t=1,e=1,n=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const u=[],h=[],c=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,s=new Vp,f=new lf;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=r;t++)h.push(0,m*_,0),c.push(0,_,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=v*i,f.y=m*_,f.z=v*n,h.push(f.x,f.y,f.z),c.push(0,_,0),s.x=.5*n+.5,s.y=.5*i*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=b+t;!0===n?u.push(r,r+1,e):u.push(r+1,r,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const s=new lf,y=new lf;let v=0;const _=(e-t)/n;for(let l=0;l<=i;l++){const u=[],g=l/i,v=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);y.x=v*l,y.y=-g*n+m,y.z=v*f,h.push(y.x,y.y,y.z),s.set(l,_,f).normalize(),c.push(s.x,s.y,s.z),d.push(e,1-g),u.push(p++)}f.push(u)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const s=f[r][n],o=f[r+1][n],a=f[r+1][n+1],l=f[r][n+1];(t>0||0!==r)&&(u.push(s,o,l),v+=3),(e>0||r!==i-1)&&(u.push(o,a,l),v+=3)}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new jm(h,3)),this.setAttribute("normal",new jm(c,3)),this.setAttribute("uv",new jm(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}};function kg(t,e,n){var r,i=1;function s(){var s,o,a=r.length,l=0,u=0,h=0;for(s=0;s<a;++s)l+=(o=r[s]).x||0,u+=o.y||0,h+=o.z||0;for(l=(l/a-t)*i,u=(u/a-e)*i,h=(h/a-n)*i,s=0;s<a;++s)o=r[s],l&&(o.x-=l),u&&(o.y-=u),h&&(o.z-=h)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t},s.x=function(e){return arguments.length?(t=+e,s):t},s.y=function(t){return arguments.length?(e=+t,s):e},s.z=function(t){return arguments.length?(n=+t,s):n},s.strength=function(t){return arguments.length?(i=+t,s):i},s}function Og(t,e,n){if(isNaN(e))return t;var r,i,s,o,a,l,u=t._root,h={data:n},c=t._x0,d=t._x1;if(!u)return t._root=h,t;for(;u.length;)if((o=e>=(i=(c+d)/2))?c=i:d=i,r=u,!(u=u[a=+o]))return r[a]=h,t;if(e===(s=+t._x.call(null,u.data)))return h.next=u,r?r[a]=h:t._root=h,t;do{r=r?r[a]=new Array(2):t._root=new Array(2),(o=e>=(i=(c+d)/2))?c=i:d=i}while((a=+o)==(l=+(s>=i)));return r[l]=u,r[a]=h,t}function Ig(t,e,n){this.node=t,this.x0=e,this.x1=n}function Dg(t){return t[0]}function Lg(t,e){var n=new Ug(null==e?Dg:e,NaN,NaN);return null==t?n:n.addAll(t)}function Ug(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function Fg(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"173"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="173");var zg=Lg.prototype=Ug.prototype;function Bg(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,h,c,d,p=t._root,f={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o,i=p,!(p=p[c=h<<1|u]))return i[c]=f,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&n===l)return f.next=p,i?i[c]=f:t._root=f,t;do{i=i?i[c]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o}while((c=h<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=p,i[c]=f,t}function jg(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Vg(t){return t[0]}function Gg(t){return t[1]}function Hg(t,e,n){var r=new Wg(null==e?Vg:e,null==n?Gg:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Wg(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function qg(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}zg.copy=function(){var t,e,n=new Ug(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=Fg(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=Fg(e));return n},zg.add=function(t){const e=+this._x.call(null,t);return Og(this.cover(e),e,t)},zg.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let s,o=0;o<e;++o)isNaN(s=+this._x.call(null,t[o]))||(n[o]=s,s<r&&(r=s),s>i&&(i=s));if(r>i)return this;this.cover(r).cover(i);for(let r=0;r<e;++r)Og(this,n[r],t[r]);return this},zg.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,s=n-e||1,o=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=o,o=r,s*=2,i){case 0:n=e+s;break;case 1:e=n-s}this._root&&this._root.length&&(this._root=o)}return this._x0=e,this._x1=n,this},zg.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},zg.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},zg.find=function(t,e){var n,r,i,s,o,a=this._x0,l=this._x1,u=[],h=this._root;for(h&&u.push(new Ig(h,a,l)),null==e?e=1/0:(a=t-e,l=t+e);s=u.pop();)if(!(!(h=s.node)||(r=s.x0)>l||(i=s.x1)<a))if(h.length){var c=(r+i)/2;u.push(new Ig(h[1],c,i),new Ig(h[0],r,c)),(o=+(t>=c))&&(s=u[u.length-1],u[u.length-1]=u[u.length-1-o],u[u.length-1-o]=s)}else{var d=Math.abs(t-+this._x.call(null,h.data));d<e&&(e=d,a=t-d,l=t+d,n=h.data)}return n},zg.remove=function(t){if(isNaN(s=+this._x.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h=this._root,c=this._x0,d=this._x1;if(!h)return this;if(h.length)for(;;){if((a=s>=(o=(c+d)/2))?c=o:d=o,e=h,!(h=h[l=+a]))return this;if(!h.length)break;e[l+1&1]&&(n=e,u=l)}for(;h.data!==t;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(h=e[0]||e[1])&&h===(e[1]||e[0])&&!h.length&&(n?n[u]=h:this._root=h),this):(this._root=i,this)},zg.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},zg.root=function(){return this._root},zg.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},zg.visit=function(t){var e,n,r,i,s=[],o=this._root;for(o&&s.push(new Ig(o,this._x0,this._x1));e=s.pop();)if(!t(o=e.node,r=e.x0,i=e.x1)&&o.length){var a=(r+i)/2;(n=o[1])&&s.push(new Ig(n,a,i)),(n=o[0])&&s.push(new Ig(n,r,a))}return this},zg.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ig(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.x1,l=(o+a)/2;(s=i[0])&&n.push(new Ig(s,o,l)),(s=i[1])&&n.push(new Ig(s,l,a))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},zg.x=function(t){return arguments.length?(this._x=t,this):this._x};var $g=Hg.prototype=Wg.prototype;function Xg(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var s,o,a,l,u,h,c,d,p,f,m,g,y=t._root,v={data:i},_=t._x0,b=t._y0,x=t._z0,w=t._x1,M=t._y1,S=t._z1;if(!y)return t._root=v,t;for(;y.length;)if((d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l,s=y,!(y=y[m=f<<2|p<<1|d]))return s[m]=v,t;if(u=+t._x.call(null,y.data),h=+t._y.call(null,y.data),c=+t._z.call(null,y.data),e===u&&n===h&&r===c)return v.next=y,s?s[m]=v:t._root=v,t;do{s=s?s[m]=new Array(8):t._root=new Array(8),(d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l}while((m=f<<2|p<<1|d)==(g=(c>=l)<<2|(h>=a)<<1|u>=o));return s[g]=y,s[m]=v,t}function Yg(t,e,n,r,i,s,o){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=s,this.z1=o}$g.copy=function(){var t,e,n=new Wg(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=qg(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=qg(e));return n},$g.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Bg(this.cover(e,n),e,n,t)},$g.addAll=function(t){var e,n,r,i,s=t.length,o=new Array(s),a=new Array(s),l=1/0,u=1/0,h=-1/0,c=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,a[n]=i,r<l&&(l=r),r>h&&(h=r),i<u&&(u=i),i>c&&(c=i));if(l>h||u>c)return this;for(this.cover(l,u).cover(h,c),n=0;n<s;++n)Bg(this,o[n],a[n],t[n]);return this},$g.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},$g.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},$g.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},$g.find=function(t,e,n){var r,i,s,o,a,l,u,h=this._x0,c=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new jg(m,h,c,d,p)),null==n?n=1/0:(h=t-n,c=e-n,d=t+n,p=e+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(s=l.y0)>p||(o=l.x1)<h||(a=l.y1)<c))if(m.length){var g=(i+o)/2,y=(s+a)/2;f.push(new jg(m[3],g,y,o,a),new jg(m[2],i,y,g,a),new jg(m[1],g,s,o,y),new jg(m[0],i,s,g,y)),(u=(e>=y)<<1|t>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-u],f[f.length-1-u]=l)}else{var v=t-+this._x.call(null,m.data),_=e-+this._y.call(null,m.data),b=v*v+_*_;if(b<n){var x=Math.sqrt(n=b);h=t-x,c=e-x,d=t+x,p=e+x,r=m.data}}return r},$g.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((u=s>=(a=(f+g)/2))?f=a:g=a,(h=o>=(l=(m+y)/2))?m=l:y=l,e=p,!(p=p[c=h<<1|u]))return this;if(!p.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(n=e,d=c)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[c]=i:delete e[c],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},$g.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},$g.root=function(){return this._root},$g.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},$g.visit=function(t){var e,n,r,i,s,o,a=[],l=this._root;for(l&&a.push(new jg(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,s=e.x1,o=e.y1)&&l.length){var u=(r+s)/2,h=(i+o)/2;(n=l[3])&&a.push(new jg(n,u,h,s,o)),(n=l[2])&&a.push(new jg(n,r,h,u,o)),(n=l[1])&&a.push(new jg(n,u,i,s,h)),(n=l[0])&&a.push(new jg(n,r,i,u,h))}return this},$g.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new jg(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.x1,u=e.y1,h=(o+l)/2,c=(a+u)/2;(s=i[0])&&n.push(new jg(s,o,a,h,c)),(s=i[1])&&n.push(new jg(s,h,a,l,c)),(s=i[2])&&n.push(new jg(s,o,c,h,u)),(s=i[3])&&n.push(new jg(s,h,c,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},$g.x=function(t){return arguments.length?(this._x=t,this):this._x},$g.y=function(t){return arguments.length?(this._y=t,this):this._y};const Kg=(t,e,n,r,i,s)=>Math.sqrt((t-r)**2+(e-i)**2+(n-s)**2);function Zg(t){return t[0]}function Jg(t){return t[1]}function Qg(t){return t[2]}function ty(t,e,n,r){var i=new ey(null==e?Zg:e,null==n?Jg:n,null==r?Qg:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function ey(t,e,n,r,i,s,o,a,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function ny(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var ry=ty.prototype=ey.prototype;function iy(t){return function(){return t}}function sy(t){return 1e-6*(t()-.5)}function oy(t){return t.index}function ay(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function ly(t){var e,n,r,i,s,o,a,l=oy,u=function(t){return 1/Math.min(s[t.source.index],s[t.target.index])},h=iy(30),c=1;function d(r){for(var s=0,l=t.length;s<c;++s)for(var u,h,d,p,f,m=0,g=0,y=0,v=0;m<l;++m)h=(u=t[m]).source,g=(d=u.target).x+d.vx-h.x-h.vx||sy(a),i>1&&(y=d.y+d.vy-h.y-h.vy||sy(a)),i>2&&(v=d.z+d.vz-h.z-h.vz||sy(a)),g*=p=((p=Math.sqrt(g*g+y*y+v*v))-n[m])/p*r*e[m],y*=p,v*=p,d.vx-=g*(f=o[m]),i>1&&(d.vy-=y*f),i>2&&(d.vz-=v*f),h.vx+=g*(f=1-f),i>1&&(h.vy+=y*f),i>2&&(h.vz+=v*f)}function p(){if(r){var i,a,u=r.length,h=t.length,c=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(i=0,s=new Array(u);i<h;++i)(a=t[i]).index=i,"object"!=typeof a.source&&(a.source=ay(c,a.source)),"object"!=typeof a.target&&(a.target=ay(c,a.target)),s[a.source.index]=(s[a.source.index]||0)+1,s[a.target.index]=(s[a.target.index]||0)+1;for(i=0,o=new Array(h);i<h;++i)a=t[i],o[i]=s[a.source.index]/(s[a.source.index]+s[a.target.index]);e=new Array(h),f(),n=new Array(h),m()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function m(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,...e){r=t,a=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,p()},d.links=function(e){return arguments.length?(t=e,p(),d):t},d.id=function(t){return arguments.length?(l=t,d):l},d.iterations=function(t){return arguments.length?(c=+t,d):c},d.strength=function(t){return arguments.length?(u="function"==typeof t?t:iy(+t),f(),d):u},d.distance=function(t){return arguments.length?(h="function"==typeof t?t:iy(+t),m(),d):h},d}ry.copy=function(){var t,e,n=new ey(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=ny(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=ny(e));return n},ry.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return Xg(this.cover(e,n,r),e,n,r,t)},ry.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c,d,p,f,m=0;m<e;++m)isNaN(d=+this._x.call(null,c=t[m]))||isNaN(p=+this._y.call(null,c))||isNaN(f=+this._z.call(null,c))||(n[m]=d,r[m]=p,i[m]=f,d<s&&(s=d),d>l&&(l=d),p<o&&(o=p),p>u&&(u=p),f<a&&(a=f),f>h&&(h=f));if(s>l||o>u||a>h)return this;this.cover(s,o,a).cover(l,u,h);for(let s=0;s<e;++s)Xg(this,n[s],r[s],i[s],t[s]);return this},ry.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(t))+1,a=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var u,h,c=o-r||1,d=this._root;r>t||t>=o||i>e||e>=a||s>n||n>=l;)switch(h=(n<s)<<2|(e<i)<<1|t<r,(u=new Array(8))[h]=d,d=u,c*=2,h){case 0:o=r+c,a=i+c,l=s+c;break;case 1:r=o-c,a=i+c,l=s+c;break;case 2:o=r+c,i=a-c,l=s+c;break;case 3:r=o-c,i=a-c,l=s+c;break;case 4:o=r+c,a=i+c,s=l-c;break;case 5:r=o-c,a=i+c,s=l-c;break;case 6:o=r+c,i=a-c,s=l-c;break;case 7:r=o-c,i=a-c,s=l-c}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this},ry.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},ry.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},ry.find=function(t,e,n,r){var i,s,o,a,l,u,h,c,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,y=this._y1,v=this._z1,_=[],b=this._root;for(b&&_.push(new Yg(b,p,f,m,g,y,v)),null==r?r=1/0:(p=t-r,f=e-r,m=n-r,g=t+r,y=e+r,v=n+r,r*=r);c=_.pop();)if(!(!(b=c.node)||(s=c.x0)>g||(o=c.y0)>y||(a=c.z0)>v||(l=c.x1)<p||(u=c.y1)<f||(h=c.z1)<m))if(b.length){var x=(s+l)/2,w=(o+u)/2,M=(a+h)/2;_.push(new Yg(b[7],x,w,M,l,u,h),new Yg(b[6],s,w,M,x,u,h),new Yg(b[5],x,o,M,l,w,h),new Yg(b[4],s,o,M,x,w,h),new Yg(b[3],x,w,a,l,u,M),new Yg(b[2],s,w,a,x,u,M),new Yg(b[1],x,o,a,l,w,M),new Yg(b[0],s,o,a,x,w,M)),(d=(n>=M)<<2|(e>=w)<<1|t>=x)&&(c=_[_.length-1],_[_.length-1]=_[_.length-1-d],_[_.length-1-d]=c)}else{var S=t-+this._x.call(null,b.data),T=e-+this._y.call(null,b.data),E=n-+this._z.call(null,b.data),A=S*S+T*T+E*E;if(A<r){var C=Math.sqrt(r=A);p=t-C,f=e-C,m=n-C,g=t+C,y=e+C,v=n+C,i=b.data}}return i},ry.findAllWithinRadius=function(t,e,n,r){const i=[],s=t-r,o=e-r,a=n-r,l=t+r,u=e+r,h=n+r;return this.visit(((c,d,p,f,m,g,y)=>{if(!c.length)do{const s=c.data;Kg(t,e,n,this._x(s),this._y(s),this._z(s))<=r&&i.push(s)}while(c=c.next);return d>l||p>u||f>h||m<s||g<o||y<a})),i},ry.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(a=+this._z.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g=this._root,y=this._x0,v=this._y0,_=this._z0,b=this._x1,x=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((c=s>=(l=(y+b)/2))?y=l:b=l,(d=o>=(u=(v+x)/2))?v=u:x=u,(p=a>=(h=(_+w)/2))?_=h:w=h,e=g,!(g=g[f=p<<2|d<<1|c]))return this;if(!g.length)break;(e[f+1&7]||e[f+2&7]||e[f+3&7]||e[f+4&7]||e[f+5&7]||e[f+6&7]||e[f+7&7])&&(n=e,m=f)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},ry.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},ry.root=function(){return this._root},ry.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},ry.visit=function(t){var e,n,r,i,s,o,a,l,u=[],h=this._root;for(h&&u.push(new Yg(h,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=u.pop();)if(!t(h=e.node,r=e.x0,i=e.y0,s=e.z0,o=e.x1,a=e.y1,l=e.z1)&&h.length){var c=(r+o)/2,d=(i+a)/2,p=(s+l)/2;(n=h[7])&&u.push(new Yg(n,c,d,p,o,a,l)),(n=h[6])&&u.push(new Yg(n,r,d,p,c,a,l)),(n=h[5])&&u.push(new Yg(n,c,i,p,o,d,l)),(n=h[4])&&u.push(new Yg(n,r,i,p,c,d,l)),(n=h[3])&&u.push(new Yg(n,c,d,s,o,a,p)),(n=h[2])&&u.push(new Yg(n,r,d,s,c,a,p)),(n=h[1])&&u.push(new Yg(n,c,i,s,o,d,p)),(n=h[0])&&u.push(new Yg(n,r,i,s,c,d,p))}return this},ry.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Yg(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.z0,u=e.x1,h=e.y1,c=e.z1,d=(o+u)/2,p=(a+h)/2,f=(l+c)/2;(s=i[0])&&n.push(new Yg(s,o,a,l,d,p,f)),(s=i[1])&&n.push(new Yg(s,d,a,l,u,p,f)),(s=i[2])&&n.push(new Yg(s,o,p,l,d,h,f)),(s=i[3])&&n.push(new Yg(s,d,p,l,u,h,f)),(s=i[4])&&n.push(new Yg(s,o,a,f,d,p,c)),(s=i[5])&&n.push(new Yg(s,d,a,f,u,p,c)),(s=i[6])&&n.push(new Yg(s,o,p,f,d,h,c)),(s=i[7])&&n.push(new Yg(s,d,p,f,u,h,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},ry.x=function(t){return arguments.length?(this._x=t,this):this._x},ry.y=function(t){return arguments.length?(this._y=t,this):this._y},ry.z=function(t){return arguments.length?(this._z=t,this):this._z};var uy={value:()=>{}};function hy(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new cy(r)}function cy(t){this._=t}function dy(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function py(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=uy,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}cy.prototype=hy.prototype={constructor:cy,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=py(i[n],t.name,e);else if(null==e)for(n in i)i[n]=py(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=dy(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new cy(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};var fy,my,gy=0,yy=0,vy=0,_y=0,by=0,xy=0,wy="object"==typeof performance&&performance.now?performance:Date,My="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Sy(){return by||(My(Ty),by=wy.now()+xy)}function Ty(){by=0}function Ey(){this._call=this._time=this._next=null}function Ay(t,e,n){var r=new Ey;return r.restart(t,e,n),r}function Cy(){by=(_y=wy.now())+xy,gy=yy=0;try{!function(){Sy(),++gy;for(var t,e=fy;e;)(t=by-e._time)>=0&&e._call.call(void 0,t),e=e._next;--gy}()}finally{gy=0,function(){var t,e,n=fy,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:fy=e);my=t,Ny(r)}(),by=0}}function Ry(){var t=wy.now(),e=t-_y;e>1e3&&(xy-=e,_y=t)}function Ny(t){gy||(yy&&(yy=clearTimeout(yy)),t-by>24?(t<1/0&&(yy=setTimeout(Cy,t-wy.now()-xy)),vy&&(vy=clearInterval(vy))):(vy||(_y=wy.now(),vy=setInterval(Ry,1e3)),gy=1,My(Cy)))}Ey.prototype=Ay.prototype={constructor:Ey,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Sy():+n)+(null==e?0:+e),this._next||my===this||(my?my._next=this:fy=this,my=this),this._call=t,this._time=n,Ny()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ny())}};const Py=4294967296;function ky(t){return t.x}function Oy(t){return t.y}function Iy(t){return t.z}var Dy,Ly,Uy,Fy,zy=Math.PI*(3-Math.sqrt(5)),By=20*Math.PI/(9+Math.sqrt(221));function jy(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,h=Ay(p),c=hy("tick","end"),d=function(){let t=1;return()=>(t=(1664525*t+1013904223)%Py)/Py}();function p(){f(),c.call("tick",n),i<s&&(h.stop(),c.call("end",n))}function f(e){var s,h,c=t.length;void 0===e&&(e=1);for(var d=0;d<e;++d)for(i+=(a-i)*o,u.forEach((function(t){t(i)})),s=0;s<c;++s)null==(h=t[s]).fx?h.x+=h.vx*=l:(h.x=h.fx,h.vx=0),r>1&&(null==h.fy?h.y+=h.vy*=l:(h.y=h.fy,h.vy=0)),r>2&&(null==h.fz?h.z+=h.vz*=l:(h.z=h.fz,h.vz=0));return n}function m(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var s=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),o=n*zy,a=n*By;1===r?e.x=s:2===r?(e.x=s*Math.cos(o),e.y=s*Math.sin(o)):(e.x=s*Math.sin(o)*Math.cos(a),e.y=s*Math.cos(o),e.z=s*Math.sin(o)*Math.sin(a))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,d,r),e}return null==t&&(t=[]),m(),n={tick:f,restart:function(){return h.restart(p),n},stop:function(){return h.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),u.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,m(),u.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(s=+t,n):s},alphaDecay:function(t){return arguments.length?(o=+t,n):+o},alphaTarget:function(t){return arguments.length?(a=+t,n):a},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(d=t,u.forEach(g),n):d},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,g(e)),n):u.get(t)},find:function(){var e,n,i,s,o,a,l=Array.prototype.slice.call(arguments),u=l.shift()||0,h=(r>1?l.shift():null)||0,c=(r>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=t.length;for(d*=d,p=0;p<f;++p)(s=(e=u-(o=t[p]).x)*e+(n=h-(o.y||0))*n+(i=c-(o.z||0))*i)<d&&(a=o,d=s);return a},on:function(t,e){return arguments.length>1?(c.on(t,e),n):c.on(t)}}}function Vy(){var t,e,n,r,i,s,o=iy(-30),a=1,l=1/0,u=.81;function h(r){var s,o=t.length,a=(1===e?Lg(t,ky):2===e?Hg(t,ky,Oy):3===e?ty(t,ky,Oy,Iy):null).visitAfter(d);for(i=r,s=0;s<o;++s)n=t[s],a.visit(p)}function c(){if(t){var e,n,r=t.length;for(s=new Array(r),e=0;e<r;++e)n=t[e],s[n.index]=+o(n,e,t)}}function d(t){var n,r,i,o,a,l,u=0,h=0,c=t.length;if(c){for(i=o=a=l=0;l<c;++l)(n=t[l])&&(r=Math.abs(n.value))&&(u+=n.value,h+=r,i+=r*(n.x||0),o+=r*(n.y||0),a+=r*(n.z||0));u*=Math.sqrt(4/c),t.x=i/h,e>1&&(t.y=o/h),e>2&&(t.z=a/h)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{u+=s[n.data.index]}while(n=n.next)}t.value=u}function p(t,o,h,c,d){if(!t.value)return!0;var p=[h,c,d][e-1],f=t.x-n.x,m=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,y=p-o,v=f*f+m*m+g*g;if(y*y/u<v)return v<l&&(0===f&&(v+=(f=sy(r))*f),e>1&&0===m&&(v+=(m=sy(r))*m),e>2&&0===g&&(v+=(g=sy(r))*g),v<a&&(v=Math.sqrt(a*v)),n.vx+=f*t.value*i/v,e>1&&(n.vy+=m*t.value*i/v),e>2&&(n.vz+=g*t.value*i/v)),!0;if(!(t.length||v>=l)){(t.data!==n||t.next)&&(0===f&&(v+=(f=sy(r))*f),e>1&&0===m&&(v+=(m=sy(r))*m),e>2&&0===g&&(v+=(g=sy(r))*g),v<a&&(v=Math.sqrt(a*v)));do{t.data!==n&&(y=s[t.data.index]*i/v,n.vx+=f*y,e>1&&(n.vy+=m*y),e>2&&(n.vz+=g*y))}while(t=t.next)}}return h.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,c()},h.strength=function(t){return arguments.length?(o="function"==typeof t?t:iy(+t),c(),h):o},h.distanceMin=function(t){return arguments.length?(a=t*t,h):Math.sqrt(a)},h.distanceMax=function(t){return arguments.length?(l=t*t,h):Math.sqrt(l)},h.theta=function(t){return arguments.length?(u=t*t,h):Math.sqrt(u)},h}function Gy(){if(Ly)return Dy;return Ly=1,Dy=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var s=e[n];return s||(s=e[n]=[]),s.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],s=0;s<i.length;++s)i[s].callback===r&&i.splice(s,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t},Dy}var Hy,Wy,qy,$y,Xy,Yy=function(){if(Fy)return Uy;Fy=1,Uy=function(s){"uniqueLinkId"in(s=s||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),s.multigraph=s.uniqueLinkId);void 0===s.multigraph&&(s.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var o=new Map,a=new Map,l={},u=0,h=s.multigraph?function(t,e,n){var s=i(t,e),o=l.hasOwnProperty(s);if(o||T(t,e)){o||(l[s]=0);var a="@"+ ++l[s];s=i(t+a,e+a)}return new r(t,e,n,s)}:function(t,e,n){var s=i(t,e),o=a.get(s);if(o)return o.data=n,o;return new r(t,e,n,s)},c=[],d=E,p=E,f=E,m=E,g={version:20,addNode:_,addLink:function(t,e,r){f();var i=b(t)||_(t),s=b(e)||_(e),o=h(t,e,r),l=a.has(o.id);a.set(o.id,o),n(i,o),t!==e&&n(s,o);return d(o,l?"update":"add"),m(),o},removeLink:function(t,e){void 0!==e&&(t=T(t,e));return S(t)},removeNode:x,getNode:b,getNodeCount:w,getLinkCount:M,getEdgeCount:M,getLinksCount:M,getNodesCount:w,getLinks:function(t){var e=b(t);return e?e.links:null},forEachNode:R,forEachLinkedNode:function(t,e,n){var r=b(t);if(r&&r.links&&"function"==typeof e)return n?function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value;if(s.fromId===e&&n(o.get(s.toId),s))return!0;i=r.next()}}(r.links,t,e):function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value,a=s.fromId===e?s.toId:s.fromId;if(n(o.get(a),s))return!0;i=r.next()}}(r.links,t,e)},forEachLink:function(t){if("function"==typeof t)for(var e=a.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),R((function(t){x(t.id)})),m()},hasLink:T,hasNode:b,getLink:T};return t(g),function(){var t=g.on;function e(){return g.beginUpdate=f=A,g.endUpdate=m=C,d=y,p=v,g.on=t,t.apply(g,arguments)}g.on=e}(),g;function y(t,e){c.push({link:t,changeType:e})}function v(t,e){c.push({node:t,changeType:e})}function _(t,n){if(void 0===t)throw new Error("Invalid node identifier");f();var r=b(t);return r?(r.data=n,p(r,"update")):(r=new e(t,n),p(r,"add")),o.set(t,r),m(),r}function b(t){return o.get(t)}function x(t){var e=b(t);if(!e)return!1;f();var n=e.links;return n&&(n.forEach(S),e.links=null),o.delete(t),p(e,"remove"),m(),!0}function w(){return o.size}function M(){return a.size}function S(t){if(!t)return!1;if(!a.get(t.id))return!1;f(),a.delete(t.id);var e=b(t.fromId),n=b(t.toId);return e&&e.links.delete(t),n&&n.links.delete(t),d(t,"remove"),m(),!0}function T(t,e){if(void 0!==t&&void 0!==e)return a.get(i(t,e))}function E(){}function A(){u+=1}function C(){0===(u-=1)&&c.length>0&&(g.fire("changed",c),c.length=0)}function R(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var e=o.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}}};var t=Gy();function e(t,e){this.id=t,this.links=null,this.data=e}function n(t,e){t.links?t.links.add(e):t.links=new Set([e])}function r(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function i(t,e){return t.toString()+" "+e.toString()}return Uy}(),Ky=p(Yy),Zy={exports:{}},Jy={exports:{}};function Qy(){return Wy||(Wy=1,Hy=function(t){return 0===t?"x":1===t?"y":2===t?"z":"c"+(t+1)}),Hy}function tv(){if($y)return qy;$y=1;const t=Qy();return qy=function(e){return function(n,r){let i=r&&r.indent||0,s=r&&void 0!==r.join?r.join:"\n",o=Array(i+1).join(" "),a=[];for(let r=0;r<e;++r){let e=t(r),i=0===r?"":o;a.push(i+n.replace(/{var}/g,e))}return a.join(s)}},qy}var ev,nv={exports:{}};var rv,iv={exports:{}};var sv,ov={exports:{}};var av,lv={exports:{}};var uv,hv,cv,dv,pv,fv={exports:{}};var mv,gv,yv,vv,_v={exports:{}};function bv(){if(yv)return gv;yv=1,gv=function(l){var u=(cv||(cv=1,hv=function(t,e,n,r){this.from=t,this.to=e,this.length=n,this.coefficient=r}),hv),h=(pv||(pv=1,dv=function t(e,n){var r;if(e||(e={}),n)for(r in n)if(n.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof n[r];i&&typeof e[r]===s?"object"===s&&(e[r]=t(e[r],n[r])):e[r]=n[r]}return e}),dv),c=Gy();if(l){if(void 0!==l.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==l.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}l=h(l,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var d=o[l.dimensions];if(!d){var p=l.dimensions;d={Body:t(p,l.debug),createQuadTree:e(p),createBounds:n(p),createDragForce:r(p),createSpringForce:i(p),integrate:s(p)},o[p]=d}var f=d.Body,m=d.createQuadTree,g=d.createBounds,y=d.createDragForce,v=d.createSpringForce,_=d.integrate,b=function(){if(mv)return _v.exports;function t(t){return new e("number"==typeof t?t:+new Date)}function e(t){this.seed=t}function n(t){return Math.sqrt(2*Math.PI/t)*Math.pow(1/Math.E*(t+1/(12*t-1/(10*t))),t)}function r(){var t=this.seed;return t=4294967295&(3042594569^(t=4251993797+(t=4294967295&(3550635116+(t=374761393+(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+(t<<5)&4294967295)^t<<9))+(t<<3)&4294967295)^t>>>16),this.seed=t,(268435455&t)/268435456}return mv=1,_v.exports=t,_v.exports.random=t,_v.exports.randomIterator=function(e,n){var r=n||t();if("function"!=typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(t){var n,i,s;for(n=e.length-1;n>0;--n)i=r.next(n+1),s=e[i],e[i]=e[n],e[n]=s,t(s);e.length&&t(e[0])},shuffle:function(){var t,n,i;for(t=e.length-1;t>0;--t)n=r.next(t+1),i=e[n],e[n]=e[t],e[t]=i;return e}}},e.prototype.next=function(t){return Math.floor(this.nextDouble()*t)},e.prototype.nextDouble=r,e.prototype.uniform=r,e.prototype.gaussian=function(){var t,e,n;do{t=(e=2*this.nextDouble()-1)*e+(n=2*this.nextDouble()-1)*n}while(t>=1||0===t);return e*Math.sqrt(-2*Math.log(t)/t)},e.prototype.levy=function(){var t=1.5,e=Math.pow(n(2.5)*Math.sin(Math.PI*t/2)/(n(1.25)*t*Math.pow(2,.25)),1/t);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/t)},_v.exports}().random(42),x=[],w=[],M=m(l,b),S=g(x,l,b),T=v(l,b),E=y(l),A=[],C=new Map,R=0;k("nbody",(function(){if(0===x.length)return;M.insertBodies(x);var t=x.length;for(;t--;){var e=x[t];e.isPinned||(e.reset(),M.updateBodyForce(e),E.update(e))}})),k("spring",(function(){var t=w.length;for(;t--;)T.update(w[t])}));var N={bodies:x,quadTree:M,springs:w,settings:l,addForce:k,removeForce:function(t){var e=A.indexOf(C.get(t));if(e<0)return;A.splice(e,1),C.delete(t)},getForces:function(){return C},step:function(){for(var t=0;t<A.length;++t)A[t](R);var e=_(x,l.timeStep,l.adaptiveTimeStepWeight);return R+=1,e},addBody:function(t){if(!t)throw new Error("Body is required");return x.push(t),t},addBodyAt:function(t){if(!t)throw new Error("Body position is required");var e=(t=>new f(t))(t);return x.push(e),e},removeBody:function(t){if(t){var e=x.indexOf(t);if(!(e<0))return x.splice(e,1),0===x.length&&S.reset(),!0}},addSpring:function(t,e,n,r){if(!t||!e)throw new Error("Cannot add null spring to force simulator");"number"!=typeof n&&(n=-1);var i=new u(t,e,n,r>=0?r:-1);return w.push(i),i},getTotalMovement:function(){return 0},removeSpring:function(t){if(t){var e=w.indexOf(t);return e>-1?(w.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(t){return S.getBestNewPosition(t)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(t){return void 0!==t?(l.gravity=t,M.options({gravity:t}),this):l.gravity},theta:function(t){return void 0!==t?(l.theta=t,M.options({theta:t}),this):l.theta},random:b};return function(t,e){for(var n in t)a(t,e,n)}(l,N),c(N),N;function P(){return S.update(),S.box}function k(t,e){if(C.has(t))throw new Error("Force "+t+" is already added");C.set(t,e),A.push(e)}};var t=function(){if(Xy)return Jy.exports;Xy=1;const t=tv();function e(t,e){return`\n${r(t,e)}\n${n(t)}\nreturn {Body: Body, Vector: Vector};\n`}function n(e){let n=t(e),r=n("{var}",{join:", "});return`\nfunction Body(${r}) {\n  this.isPinned = false;\n  this.pos = new Vector(${r});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${r}) {\n  ${n("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function r(e,n){let r=t(e),i="";return n&&(i=`${r("\n\t   var v{var};\n\tObject.defineProperty(this, '{var}', {\n\t  set: function(v) { \n\t    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n\t    v{var} = v; \n\t  },\n\t  get: function() { return v{var}; }\n\t});")}`),`function Vector(${r("{var}",{join:", "})}) {\n  ${i}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${r('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${r("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${r('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${r("this.{var} = ",{join:""})}0;\n  };`}return Jy.exports=function(t,n){let r=e(t,n),{Body:i}=new Function(r)();return i},Jy.exports.generateCreateBodyFunctionBody=e,Jy.exports.getVectorCode=r,Jy.exports.getBodyCode=n,Jy.exports}(),e=function(){if(ev)return nv.exports;ev=1;const t=tv(),e=Qy();function n(n){let l=t(n),u=Math.pow(2,n),h=`\n${a()}\n${o(n)}\n${r(n)}\n${s(n)}\n${i(n)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(t){let e=[];for(let n=0;n<u;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("      node.")}\n      node.body = null;\n      node.mass = ${l("node.mass_{var} = ",{join:""})}0;\n      ${l("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${l("var d{var};",{indent:4})}\n    var r; \n    ${l("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${l("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${l("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${l("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < , treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${l("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let t=Array(11).join(" "),e=[];for(let n=0;n<u;++n)e.push(t+`if (node.quad${n}) {`),e.push(t+`  queue[pushIdx] = node.quad${n};`),e.push(t+"  queueLength += 1;"),e.push(t+"  pushIdx += 1;"),e.push(t+"}");return e.join("\n")}()}\n        }\n      }\n    }\n\n    ${l("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${l("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${l("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${l("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${l("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${l("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${l("root.min_{var} = {var}min;",{indent:4})}\n    ${l("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${l("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${l("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${l("var min_{var} = node.min_{var};",{indent:8})}\n        ${l("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(){let t=[],r=Array(8+1).join(" ");for(let i=0;i<n;++i)t.push(r+`if (${e(i)} > max_${e(i)}) {`),t.push(r+`  quadIdx = quadIdx + ${Math.pow(2,i)};`),t.push(r+`  min_${e(i)} = max_${e(i)};`),t.push(r+`  max_${e(i)} = node.max_${e(i)};`),t.push(r+"}");return t.join("\n")}()}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${l("child.min_{var} = min_{var};",{indent:10})}\n          ${l("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${l("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${l("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`;return h}function r(e){let n=t(e);return`\n  function isSamePosition(point1, point2) {\n    ${n("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${n("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function i(t){var e=Math.pow(2,t);return`\nfunction setChild(node, idx, child) {\n  ${function(){let t=[];for(let n=0;n<e;++n){let e=0===n?"  ":"  else ";t.push(`${e}if (idx === ${n}) node.quad${n} = child;`)}return t.join("\n")}()}\n}`}function s(t){return`function getChild(node, idx) {\n${function(){let e=[],n=Math.pow(2,t);for(let t=0;t<n;++t)e.push(`  if (idx === ${t}) return node.quad${t};`);return e.join("\n")}()}\n  return null;\n}`}function o(e){let n=t(e),r=Math.pow(2,e);var i=`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(t){let e=[];for(let n=0;n<r;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("  this.")}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${n("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${n("this.min_{var} = 0;",{indent:2})}\n  ${n("this.max_{var} = 0;",{indent:2})}\n}\n`;return i}function a(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}return nv.exports=function(t){let e=n(t);return new Function(e)()},nv.exports.generateQuadTreeFunctionBody=n,nv.exports.getInsertStackCode=a,nv.exports.getQuadNodeCode=o,nv.exports.isSamePosition=r,nv.exports.getChildBodyCode=s,nv.exports.setChildBodyCode=i,nv.exports}(),n=function(){if(rv)return iv.exports;rv=1,iv.exports=function(t){let n=e(t);return new Function("bodies","settings","random",n)},iv.exports.generateFunctionBody=e;const t=tv();function e(e){let n=t(e);return`\n  var boundingBox = {\n    ${n("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${n("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${n("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${n("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${n("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${n("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${n("var max_{var} = -Infinity;",{indent:4})}\n    ${n("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${n("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${n("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${n("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${n("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${n("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}return iv.exports}(),r=function(){if(sv)return ov.exports;sv=1;const t=tv();function e(e){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${t(e)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}return ov.exports=function(t){let n=e(t);return new Function("options",n)},ov.exports.generateCreateDragForceFunctionBody=e,ov.exports}(),i=function(){if(av)return lv.exports;av=1;const t=tv();function e(e){let n=t(e);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${n("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${n("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${n("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${n("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}return lv.exports=function(t){let n=e(t);return new Function("options","random",n)},lv.exports.generateCreateSpringForceFunctionBody=e,lv.exports}(),s=function(){if(uv)return fv.exports;uv=1;const t=tv();function e(e){let n=t(e);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${n("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${n("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${n("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${n("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${n("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${n("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${n("body.pos.{var} += d{var};",{indent:4})}\n\n    ${n("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${n("t{var} * t{var}",{join:" + "})})/length;\n`}return fv.exports=function(t){let n=e(t);return new Function("bodies","timeStep","adaptiveTimeStepWeight",n)},fv.exports.generateIntegratorFunctionBody=e,fv.exports}(),o={};function a(t,e,n){if(t.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=Number.isFinite(t[n]);e[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return t[n]=r,e}return t[n]}:function(r){return void 0!==r?(t[n]=r,e):t[n]}}}return gv}var xv=function(){if(vv)return Zy.exports;vv=1,Zy.exports=function(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var i=(r&&r.createSimulator||bv())(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var s=n.version>19?function(t){var e=n.getLinks(t);return e?1+e.size/3:1}:function(t){var e=n.getLinks(t);return e?1+e.length/3:1};r&&"function"==typeof r.nodeMass&&(s=r.nodeMass);var o=new Map,a={},l=0,u=i.settings.springTransform||e;l=0,n.forEachNode((function(t){m(t.id),l+=1})),n.forEachLink(y),n.on("changed",f);var h=!1,c={step:function(){if(0===l)return d(!0),!0;var t=i.step();c.lastMove=t,c.fire("step");var e=t/l<=.01;return d(e),e},getNodePosition:function(t){return b(t).pos},setNodePosition:function(t){var e=b(t);e.setPosition.apply(e,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(t){var e=a[t];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:p,pinNode:function(t,e){b(t.id).isPinned=!!e},isNodePinned:function(t){return b(t.id).isPinned},dispose:function(){n.off("changed",f),c.fire("disposed")},getBody:function(t){return o.get(t)},getSpring:function(t,e){var r;if(void 0===e)r="object"!=typeof t?t:t.id;else{var i=n.hasLink(t,e);if(!i)return;r=i.id}return a[r]},getForceVectorLength:function(){var t=0,e=0;return p((function(n){t+=Math.abs(n.force.x),e+=Math.abs(n.force.y)})),Math.sqrt(t*t+e*e)},simulator:i,graph:n,lastMove:0};return t(c),c;function d(t){var e;h!==t&&(h=t,e=t,c.fire("stable",e))}function p(t){o.forEach(t)}function f(t){for(var e=0;e<t.length;++e){var r=t[e];"add"===r.changeType?(r.node&&m(r.node.id),r.link&&y(r.link)):"remove"===r.changeType&&(r.node&&g(r.node),r.link&&v(r.link))}l=n.getNodesCount()}function m(t){var e=o.get(t);if(!e){var r=n.getNode(t);if(!r)throw new Error("initBody() was called with unknown node id");var s=r.position;if(!s){var a=function(t){var e=[];if(!t.links)return e;for(var n=Math.min(t.links.length,2),r=0;r<n;++r){var i=t.links[r],s=i.fromId!==t.id?o.get(i.fromId):o.get(i.toId);s&&s.pos&&e.push(s)}return e}(r);s=i.getBestNewBodyPosition(a)}(e=i.addBodyAt(s)).id=t,o.set(t,e),_(t),function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)}(r)&&(e.isPinned=!0)}}function g(t){var e=t.id,n=o.get(e);n&&(o.delete(e),i.removeBody(n))}function y(t){_(t.fromId),_(t.toId);var e=o.get(t.fromId),n=o.get(t.toId),r=i.addSpring(e,n,t.length);u(t,r),a[t.id]=r}function v(t){var e=a[t.id];if(e){var r=n.getNode(t.fromId),s=n.getNode(t.toId);r&&_(r.id),s&&_(s.id),delete a[t.id],i.removeSpring(e)}}function _(t){var e=o.get(t);if(e.mass=s(t),Number.isNaN(e.mass))throw new Error("Node mass should be a number")}function b(t){var e=o.get(t);return e||(m(t),e=o.get(t)),e}},Zy.exports.simulator=bv();var t=Gy();function e(){}return Zy.exports}(),wv=p(xv);function Mv(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var Sv="object"==typeof global&&global&&global.Object===Object&&global,Tv="object"==typeof self&&self&&self.Object===Object&&self,Ev=Sv||Tv||Function("return this")(),Av=function(){return Ev.Date.now()},Cv=/\s/;var Rv=/^\s+/;function Nv(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Cv.test(t.charAt(e)););return e}(t)+1).replace(Rv,""):t}var Pv=Ev.Symbol,kv=Object.prototype,Ov=kv.hasOwnProperty,Iv=kv.toString,Dv=Pv?Pv.toStringTag:void 0;var Lv=Object.prototype.toString;var Uv=Pv?Pv.toStringTag:void 0;function Fv(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Uv&&Uv in Object(t)?function(t){var e=Ov.call(t,Dv),n=t[Dv];try{t[Dv]=void 0;var r=!0}catch(t){}var i=Iv.call(t);return r&&(e?t[Dv]=n:delete t[Dv]),i}(t):function(t){return Lv.call(t)}(t)}var zv=/^[-+]0x[0-9a-f]+$/i,Bv=/^0b[01]+$/i,jv=/^0o[0-7]+$/i,Vv=parseInt;function Gv(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==Fv(t)}(t))return NaN;if(Mv(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Mv(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Nv(t);var n=Bv.test(t);return n||jv.test(t)?Vv(t.slice(2),n?2:8):zv.test(t)?NaN:+t}var Hv=Math.max,Wv=Math.min;function qv(t,e,n){var r,i,s,o,a,l,u=0,h=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||c&&t-u>=s}function m(){var t=Av();if(f(t))return g(t);a=setTimeout(m,function(t){var n=e-(t-l);return c?Wv(n,s-(t-u)):n}(t))}function g(t){return a=void 0,d&&r?p(t):(r=i=void 0,o)}function y(){var t=Av(),n=f(t);if(r=arguments,i=this,l=t,n){if(void 0===a)return function(t){return u=t,a=setTimeout(m,e),h?p(t):o}(l);if(c)return clearTimeout(a),a=setTimeout(m,e),p(l)}return void 0===a&&(a=setTimeout(m,e)),o}return e=Gv(e)||0,Mv(n)&&(h=!!n.leading,s=(c="maxWait"in n)?Hv(Gv(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=l=i=a=void 0},y.flush=function(){return void 0===a?o:g(Av())},y}function $v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Xv(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function Yv(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return $v(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$v(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Kv=Xv((function t(e,n){var r=n.default,i=void 0===r?null:r,s=n.triggerUpdate,o=void 0===s||s,a=n.onChange,l=void 0===a?function(t,e){}:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l}));function Zv(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,r=t.props,i=void 0===r?{}:r,s=t.methods,o=void 0===s?{}:s,a=t.aliases,l=void 0===a?{}:a,u=t.init,h=void 0===u?function(){}:u,c=t.update,d=void 0===c?function(){}:c,p=Object.keys(i).map((function(t){return new Kv(t,i[t])}));return function t(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var s=!!(this instanceof t?this.constructor:void 0),a=s?r.shift():void 0,u=r[0],c=void 0===u?{}:u,f=Object.assign({},n instanceof Function?n(c):n,{initialised:!1}),m={};function g(t){return y(t,c),v(),g}var y=function(t,e){h.call(g,t,f,e),f.initialised=!0},v=qv((function(){f.initialised&&(d.call(g,f,m),m={})}),1);return p.forEach((function(t){g[t.name]=function(t){var e=t.name,n=t.triggerUpdate,r=void 0!==n&&n,i=t.onChange,s=void 0===i?function(t,e){}:i,o=t.defaultVal,a=void 0===o?null:o;return function(t){var n=f[e];if(!arguments.length)return n;var i=void 0===t?a:t;return f[e]=i,s.call(g,i,f,n),!m.hasOwnProperty(e)&&(m[e]=n),r&&v(),g}}(t)})),Object.keys(o).forEach((function(t){g[t]=function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=o[t]).call.apply(e,[g,f].concat(r))}})),Object.entries(l).forEach((function(t){var e=Yv(t,2),n=e[0],r=e[1];return g[n]=g[r]})),g.resetProps=function(){return p.forEach((function(t){g[t.name](t.defaultVal)})),g},g.resetProps(),f._rerender=v,s&&a&&g(a),g}}var Jv=function(t){return"function"==typeof t?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}};let Qv=class extends Map{constructor(t,e=e_){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(t_(this,t))}has(t){return super.has(t_(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(r),t.delete(r));return n}(this,t))}};function t_({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function e_(t){return null!==t&&"object"==typeof t?t.valueOf():t}function n_(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function r_(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function i_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s_(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function o_(t,e){return t.get(s_(t,e))}function a_(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function l_(t,e,n){return t.set(s_(t,e),n),n}function u_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function h_(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||p_(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c_(t){return function(t){if(Array.isArray(t))return i_(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d_(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function p_(t,e){if(t){if("string"==typeof t)return i_(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i_(t,e):void 0}}var f_=new WeakMap,m_=new WeakMap,g_=new WeakMap,y_=new WeakMap,v_=new WeakMap,__=new WeakMap,b_=function(){return u_((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a_(this,f_,new Map),a_(this,m_,new Map),a_(this,g_,(function(t){return t})),a_(this,y_,(function(){return{}})),a_(this,v_,(function(){})),a_(this,__,(function(){}))}),[{key:"getObj",value:function(t){return o_(f_,this).get(o_(g_,this).call(this,t))}},{key:"getData",value:function(t){return o_(m_,this).get(t)}},{key:"entries",value:function(){return c_(o_(m_,this).entries()).map((function(t){var e=h_(t,2),n=e[0];return[e[1],n]}))}},{key:"id",value:function(t){return l_(g_,this,Jv(t)),this}},{key:"onCreateObj",value:function(t){return l_(y_,this,t),this}},{key:"onUpdateObj",value:function(t){return l_(v_,this,t),this}},{key:"onRemoveObj",value:function(t){return l_(__,this,t),this}},{key:"digest",value:function(t){var e=this;t.filter((function(t){return!o_(f_,e).has(o_(g_,e).call(e,t))})).forEach((function(t){var n=o_(y_,e).call(e,t);o_(f_,e).set(o_(g_,e).call(e,t),n),o_(m_,e).set(n,t)}));var n=new Map(t.map((function(t){return[o_(g_,e).call(e,t),t]})));return o_(f_,this).forEach((function(t,r){n.has(r)?o_(v_,e).call(e,t,n.get(r)):(o_(__,e).call(e,t,r),o_(f_,e).delete(r),o_(m_,e).delete(t))})),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function x_(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const w_=Symbol("implicit");var M_=function(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function S_(t){return S_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S_(t)}var T_=/^\s+/,E_=/\s+$/;function A_(t,e){if(e=e||{},(t=t||"")instanceof A_)return t;if(!(this instanceof A_))return new A_(t,e);var n=function(t){var e={r:0,g:0,b:0},n=1,r=null,i=null,s=null,o=!1,a=!1;"string"==typeof t&&(t=function(t){t=t.replace(T_,"").replace(E_,"").toLowerCase();var e,n=!1;if(H_[t])t=H_[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=tb.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=tb.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=tb.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=tb.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=tb.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=tb.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=tb.hex8.exec(t))return{r:Y_(e[1]),g:Y_(e[2]),b:Y_(e[3]),a:Q_(e[4]),format:n?"name":"hex8"};if(e=tb.hex6.exec(t))return{r:Y_(e[1]),g:Y_(e[2]),b:Y_(e[3]),format:n?"name":"hex"};if(e=tb.hex4.exec(t))return{r:Y_(e[1]+""+e[1]),g:Y_(e[2]+""+e[2]),b:Y_(e[3]+""+e[3]),a:Q_(e[4]+""+e[4]),format:n?"name":"hex8"};if(e=tb.hex3.exec(t))return{r:Y_(e[1]+""+e[1]),g:Y_(e[2]+""+e[2]),b:Y_(e[3]+""+e[3]),format:n?"name":"hex"};return!1}(t));"object"==S_(t)&&(eb(t.r)&&eb(t.g)&&eb(t.b)?(e=function(t,e,n){return{r:255*$_(t,255),g:255*$_(e,255),b:255*$_(n,255)}}(t.r,t.g,t.b),o=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):eb(t.h)&&eb(t.s)&&eb(t.v)?(r=Z_(t.s),i=Z_(t.v),e=function(t,e,n){t=6*$_(t,360),e=$_(e,100),n=$_(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6,u=[n,o,s,s,a,n][l],h=[a,n,n,o,s,s][l],c=[s,s,a,n,n,o][l];return{r:255*u,g:255*h,b:255*c}}(t.h,r,i),o=!0,a="hsv"):eb(t.h)&&eb(t.s)&&eb(t.l)&&(r=Z_(t.s),s=Z_(t.l),e=function(t,e,n){var r,i,s;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=$_(t,360),e=$_(e,100),n=$_(n,100),0===e)r=i=s=n;else{var a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,r,s),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a));return n=q_(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function C_(t,e,n){t=$_(t,255),e=$_(e,255),n=$_(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=(s+o)/2;if(s==o)r=i=0;else{var l=s-o;switch(i=a>.5?l/(2-s-o):l/(s+o),s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,l:a}}function R_(t,e,n){t=$_(t,255),e=$_(e,255),n=$_(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=s,l=s-o;if(i=0===s?0:l/s,s==o)r=0;else{switch(s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,v:a}}function N_(t,e,n,r){var i=[K_(Math.round(t).toString(16)),K_(Math.round(e).toString(16)),K_(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function P_(t,e,n,r){return[K_(J_(r)),K_(Math.round(t).toString(16)),K_(Math.round(e).toString(16)),K_(Math.round(n).toString(16))].join("")}function k_(t,e){e=0===e?0:e||10;var n=A_(t).toHsl();return n.s-=e/100,n.s=X_(n.s),A_(n)}function O_(t,e){e=0===e?0:e||10;var n=A_(t).toHsl();return n.s+=e/100,n.s=X_(n.s),A_(n)}function I_(t){return A_(t).desaturate(100)}function D_(t,e){e=0===e?0:e||10;var n=A_(t).toHsl();return n.l+=e/100,n.l=X_(n.l),A_(n)}function L_(t,e){e=0===e?0:e||10;var n=A_(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),A_(n)}function U_(t,e){e=0===e?0:e||10;var n=A_(t).toHsl();return n.l-=e/100,n.l=X_(n.l),A_(n)}function F_(t,e){var n=A_(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,A_(n)}function z_(t){var e=A_(t).toHsl();return e.h=(e.h+180)%360,A_(e)}function B_(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=A_(t).toHsl(),r=[A_(t)],i=360/e,s=1;s<e;s++)r.push(A_({h:(n.h+s*i)%360,s:n.s,l:n.l}));return r}function j_(t){var e=A_(t).toHsl(),n=e.h;return[A_(t),A_({h:(n+72)%360,s:e.s,l:e.l}),A_({h:(n+216)%360,s:e.s,l:e.l})]}function V_(t,e,n){e=e||6,n=n||30;var r=A_(t).toHsl(),i=360/n,s=[A_(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(A_(r));return s}function G_(t,e){e=e||6;for(var n=A_(t).toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/e;e--;)o.push(A_({h:r,s:i,v:s})),s=(s+a)%1;return o}A_.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=q_(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=R_(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=R_(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=C_(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=C_(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return N_(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var s=[K_(Math.round(t).toString(16)),K_(Math.round(e).toString(16)),K_(Math.round(n).toString(16)),K_(J_(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*$_(this._r,255))+"%",g:Math.round(100*$_(this._g,255))+"%",b:Math.round(100*$_(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*$_(this._r,255))+"%, "+Math.round(100*$_(this._g,255))+"%, "+Math.round(100*$_(this._b,255))+"%)":"rgba("+Math.round(100*$_(this._r,255))+"%, "+Math.round(100*$_(this._g,255))+"%, "+Math.round(100*$_(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(W_[N_(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+P_(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=A_(t);n="#"+P_(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return A_(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(D_,arguments)},brighten:function(){return this._applyModification(L_,arguments)},darken:function(){return this._applyModification(U_,arguments)},desaturate:function(){return this._applyModification(k_,arguments)},saturate:function(){return this._applyModification(O_,arguments)},greyscale:function(){return this._applyModification(I_,arguments)},spin:function(){return this._applyModification(F_,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(V_,arguments)},complement:function(){return this._applyCombination(z_,arguments)},monochromatic:function(){return this._applyCombination(G_,arguments)},splitcomplement:function(){return this._applyCombination(j_,arguments)},triad:function(){return this._applyCombination(B_,[3])},tetrad:function(){return this._applyCombination(B_,[4])}},A_.fromRatio=function(t,e){if("object"==S_(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:Z_(t[r]));t=n}return A_(t,e)},A_.equals=function(t,e){return!(!t||!e)&&A_(t).toRgbString()==A_(e).toRgbString()},A_.random=function(){return A_.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},A_.mix=function(t,e,n){n=0===n?0:n||50;var r=A_(t).toRgb(),i=A_(e).toRgb(),s=n/100;return A_({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},
// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)
// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)
A_.readability=function(t,e){var n=A_(t),r=A_(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},A_.isReadable=function(t,e,n){var r,i,s=A_.readability(t,e);switch(i=!1,(r=function(t){var e,n;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==n&&"large"!==n&&(n="small");return{level:e,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},A_.mostReadable=function(t,e,n){var r,i,s,o,a=null,l=0;i=(n=n||{}).includeFallbackColors,s=n.level,o=n.size;for(var u=0;u<e.length;u++)(r=A_.readability(t,e[u]))>l&&(l=r,a=A_(e[u]));return A_.isReadable(t,a,{level:s,size:o})||!i?a:(n.includeFallbackColors=!1,A_.mostReadable(t,["#fff","#000"],n))};var H_=A_.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},W_=A_.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(H_);function q_(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function $_(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function X_(t){return Math.min(1,Math.max(0,t))}function Y_(t){return parseInt(t,16)}function K_(t){return 1==t.length?"0"+t:""+t}function Z_(t){return t<=1&&(t=100*t+"%"),t}function J_(t){return Math.round(255*parseFloat(t)).toString(16)}function Q_(t){return Y_(t)/255}var tb=function(){var t="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",e="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+e),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+e),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+e),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function eb(t){return!!tb.CSS_UNIT.exec(t)}function nb(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function rb(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function ib(t,e,n){return e=pb(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,mb()?Reflect.construct(e,n||[],pb(t).constructor):e.apply(t,n))}function sb(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ob(t,e){return t.get(rb(t,e))}function ab(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function lb(t,e,n){return t.set(rb(t,e),n),n}function ub(t,e,n){if(mb())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}function hb(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xb(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function cb(t,e,n){return(e=xb(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function db(){return db="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=pb(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},db.apply(null,arguments)}function pb(t){return pb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pb(t)}function fb(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yb(t,e)}function mb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(mb=function(){return!!t})()}function gb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function yb(t,e){return yb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yb(t,e)}function vb(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Mb(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _b(t,e,n,r){var i=db(pb(t.prototype),e,n);return"function"==typeof i?function(t){return i.apply(n,t)}:i}function bb(t){return function(t){if(Array.isArray(t))return nb(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Mb(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xb(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function wb(t){return wb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wb(t)}function Mb(t,e){if(t){if("string"==typeof t)return nb(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nb(t,e):void 0}}var Sb=function(t){t instanceof Array?t.forEach(Sb):(t.map&&t.map.dispose(),t.dispose())},Tb=function(t){t.geometry&&t.geometry.dispose(),t.material&&Sb(t.material),t.texture&&t.texture.dispose(),t.children&&t.children.forEach(Tb)},Eb=function(t){for(;t.children.length;){var e=t.children[0];t.remove(e),Tb(e)}},Ab=new WeakMap,Cb=new WeakMap,Rb=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.dataBindAttr,s=void 0===i?"__data":i,o=r.objBindAttr,a=void 0===o?"__threeObj":o;return sb(this,e),cb(n=ib(this,e),"scene",void 0),ab(n,Ab,void 0),ab(n,Cb,void 0),n.scene=t,lb(Ab,n,s),lb(Cb,n,a),n.onRemoveObj((function(){})),n}return fb(e,t),hb(e,[{key:"onCreateObj",value:function(t){var n=this;return _b(e,"onCreateObj",this)([function(e){var r=t(e);return e[ob(Cb,n)]=r,r[ob(Ab,n)]=e,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(t){var n=this;return _b(e,"onRemoveObj",this)([function(r,i){var s=_b(e,"getData",n)([r]);t(r,i),n.scene.remove(r),Eb(r),delete s[ob(Cb,n)]}]),this}}])}(b_),Nb=function(t){return isNaN(t)?parseInt(A_(t).toHex(),16):t},Pb=function(t){return isNaN(t)?A_(t).getAlpha():1},kb=function t(){var e=new Qv,n=[],r=[],i=w_;function s(t){let s=e.get(t);if(void 0===s){if(i!==w_)return i;e.set(t,s=n.push(t)-1)}return r[s%r.length]}return s.domain=function(t){if(!arguments.length)return n.slice();n=[],e=new Qv;for(const r of t)e.has(r)||e.set(r,n.push(r)-1);return s},s.range=function(t){return arguments.length?(r=Array.from(t),s):r.slice()},s.unknown=function(t){return arguments.length?(i=t,s):i},s.copy=function(){return t(n,r).unknown(i)},x_.apply(s,arguments),s}(M_);function Ob(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=kb(e(t))}))}var Ib=window.THREE?window.THREE:{Group:lg,Mesh:class extends cm{constructor(t=new Ym,e=new Im){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(i&&o){ig.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(rg.fromBufferAttribute(a,t),s?ig.addScaledVector(rg,r):ig.addScaledVector(rg.sub(e),r))}e.add(ig)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Jm.copy(n.boundingSphere),Jm.applyMatrix4(i),Zm.copy(t.ray).recast(t.near),!1===Jm.containsPoint(Zm.origin)){if(null===Zm.intersectSphere(Jm,Qm))return;if(Zm.origin.distanceToSquared(Qm)>(t.far-t.near)**2)return}Km.copy(i).invert(),Zm.copy(t.ray).applyMatrix4(Km),null!==n.boundingBox&&!1===Zm.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Zm)}}_computeIntersections(t,e,n){let r;const i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,h=i.attributes.normal,c=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let i=0,a=c.length;i<a;i++){const a=c[i],p=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=ag(this,p,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=ag(this,s,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,o=c.length;i<o;i++){const o=c[i],p=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=ag(this,p,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=ag(this,s,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}},MeshLambertMaterial:class extends Om{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Nm(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Nm(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Vp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xf,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}},Color:Nm,BufferGeometry:Ym,BufferAttribute:Fm,Matrix4:Ff,Vector3:lf,SphereGeometry:class t extends Ym{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const u=[],h=new lf,c=new lf,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let v=0;0===d&&0===s?v=.5/e:d===n&&a===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),h.y=t*Math.cos(s+y*o),h.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),p.push(h.x,h.y,h.z),c.copy(h).normalize(),f.push(c.x,c.y,c.z),m.push(a+v,1-y),g.push(l++)}u.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=u[t][r+1],i=u[t][r],o=u[t+1][r],l=u[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new jm(p,3)),this.setAttribute("normal",new jm(f,3)),this.setAttribute("uv",new jm(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(e){return new t(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},CylinderGeometry:Pg,TubeGeometry:class t extends Ym{constructor(t=new Rg(new lf(-1,-1,0),new lf(-1,1,0),new lf(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new lf,a=new lf,l=new Vp;let u=new lf;const h=[],c=[],d=[],p=[];function f(i){u=t.getPointAt(i/e,u);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),c.push(a.x,a.y,a.z),o.x=u.x+n*a.x,o.y=u.y+n*a.y,o.z=u.z+n*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new jm(h,3)),this.setAttribute("normal",new jm(c,3)),this.setAttribute("uv",new jm(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(e){return new t((new Ng[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},ConeGeometry:class t extends Pg{constructor(t=1,e=1,n=32,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(e){return new t(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Line:class extends cm{constructor(t=new Ym,e=new ug){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)hg.fromBufferAttribute(e,t-1),cg.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=hg.distanceTo(cg);t.setAttribute("lineDistance",new jm(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),fg.copy(n.boundingSphere),fg.applyMatrix4(r),fg.radius+=i,!1===t.ray.intersectsSphere(fg))return;dg.copy(r).invert(),pg.copy(t.ray).applyMatrix4(dg);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=this.isLineSegments?2:1,u=n.index,h=n.attributes.position;if(null!==u){const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=u.getX(i),r=u.getX(i+1),s=yg(this,t,pg,a,n,r,i);s&&e.push(s)}if(this.isLineLoop){const i=u.getX(r-1),s=u.getX(n),o=yg(this,t,pg,a,i,s,r-1);o&&e.push(o)}}else{const n=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=yg(this,t,pg,a,i,i+1,i);n&&e.push(n)}if(this.isLineLoop){const i=yg(this,t,pg,a,r-1,n,r-1);i&&e.push(i)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}},LineBasicMaterial:ug,QuadraticBezierCurve3:Rg,CubicBezierCurve3:Cg,Box3:cf},Db={graph:Ky,forcelayout:wv},Lb=(new Ib.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Ub=(new Ib.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",Fb=Zv({props:{jsonUrl:{onChange:function(t,e){var n=this;t&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(t).then((function(t){return t.json()})).then((function(t){e.fetchingJson=!1,e.onFinishLoading(t),n.graphData(t)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(t,e){var n=e.d3ForceLayout.force("charge");function r(t,e){t.forEach((function(t){delete t[e],delete t["v".concat(e)]}))}n&&n.strength(t>2?-60:-30),t<3&&r(e.graphData.nodes,"z"),t<2&&r(e.graphData.nodes,"y")}},dagMode:{onChange:function(t,e){!t&&"d3"===e.forceEngine&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=t.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.velocityDecay(t)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(t){return t._flushObjects=!0,t._rerender(),this},d3Force:function(t,e,n){return void 0===n?t.d3ForceLayout.force(e):(t.d3ForceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},tickFrame:function(t){var e,n,r,i,s="ngraph"!==t.forceEngine;return t.engineRunning&&function(){++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||s&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.layout[s?"tick":"step"](),t.onEngineTick());var e=Jv(t.nodeThreeObjectExtend);t.nodeDataMapper.entries().forEach((function(n){var r=vb(n,2),i=r[0],o=r[1];if(o){var a=s?i:t.layout.getNodePosition(i[t.nodeId]),l=e(i);t.nodePositionUpdate&&t.nodePositionUpdate(l?o.children[0]:o,{x:a.x,y:a.y,z:a.z},i)&&!l||(o.position.x=a.x,o.position.y=a.y||0,o.position.z=a.z||0)}}));var n=Jv(t.linkWidth),r=Jv(t.linkCurvature),i=Jv(t.linkCurveRotation),o=Jv(t.linkThreeObjectExtend);function a(e){var n=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),o=n[s?"source":"from"],a=n[s?"target":"to"];if(o&&a&&o.hasOwnProperty("x")&&a.hasOwnProperty("x")){var l=r(e);if(l){var u,h=new Ib.Vector3(o.x,o.y||0,o.z||0),c=new Ib.Vector3(a.x,a.y||0,a.z||0),d=h.distanceTo(c),p=i(e);if(d>0){var f=a.x-o.x,m=a.y-o.y||0,g=(new Ib.Vector3).subVectors(c,h),y=g.clone().multiplyScalar(l).cross(0!==f||0!==m?new Ib.Vector3(0,0,1):new Ib.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new Ib.Vector3).addVectors(h,c).divideScalar(2));u=new Ib.QuadraticBezierCurve3(h,y,c)}else{var v=70*l,_=-p,b=_+Math.PI/2;u=new Ib.CubicBezierCurve3(h,new Ib.Vector3(v*Math.cos(b),v*Math.sin(b),0).add(h),new Ib.Vector3(v*Math.cos(_),v*Math.sin(_),0).add(h),c)}e.__curve=u}else e.__curve=null}}t.linkDataMapper.entries().forEach((function(e){var r=vb(e,2),i=r[0],l=r[1];if(l){var u=s?i:t.layout.getLinkPosition(t.layout.graph.getLink(i.source,i.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){a(i);var d=o(i);if(!t.linkPositionUpdate||!t.linkPositionUpdate(d?l.children[1]:l,{start:{x:h.x,y:h.y,z:h.z},end:{x:c.x,y:c.y,z:c.z}},i)||d){var p=30,f=i.__curve,m=l.children.length?l.children[0]:l;if("Line"===m.type){if(f){var g=f.getPoints(p);m.geometry.getAttribute("position").array.length!==3*g.length&&m.geometry[Lb]("position",new Ib.BufferAttribute(new Float32Array(3*g.length),3)),m.geometry.setFromPoints(g)}else{var y=m.geometry.getAttribute("position");y&&y.array&&6===y.array.length||m.geometry[Lb]("position",y=new Ib.BufferAttribute(new Float32Array(6),3)),y.array[0]=h.x,y.array[1]=h.y||0,y.array[2]=h.z||0,y.array[3]=c.x,y.array[4]=c.y||0,y.array[5]=c.z||0,y.needsUpdate=!0}m.geometry.computeBoundingSphere()}else if("Mesh"===m.type)if(f){m.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1));var v=Math.ceil(10*n(i))/10/2,_=new Ib.TubeGeometry(f,p,v,t.linkResolution,!1);m.geometry.dispose(),m.geometry=_}else{if(!m.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var b=Math.ceil(10*n(i))/10/2,x=new Ib.CylinderGeometry(b,b,1,t.linkResolution,1,!1);x[Ub]((new Ib.Matrix4).makeTranslation(0,.5,0)),x[Ub]((new Ib.Matrix4).makeRotationX(Math.PI/2)),m.geometry.dispose(),m.geometry=x}var w=new Ib.Vector3(h.x,h.y||0,h.z||0),M=new Ib.Vector3(c.x,c.y||0,c.z||0),S=w.distanceTo(M);m.position.x=w.x,m.position.y=w.y,m.position.z=w.z,m.scale.z=S,m.parent.localToWorld(M),m.lookAt(M)}}}}}))}(),e=Jv(t.linkDirectionalArrowRelPos),n=Jv(t.linkDirectionalArrowLength),r=Jv(t.nodeVal),t.arrowDataMapper.entries().forEach((function(i){var o=vb(i,2),a=o[0],l=o[1];if(l){var u=s?a:t.layout.getLinkPosition(t.layout.graph.getLink(a.source,a.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){var d=Math.cbrt(Math.max(0,r(h)||1))*t.nodeRelSize,p=Math.cbrt(Math.max(0,r(c)||1))*t.nodeRelSize,f=n(a),m=e(a),g=a.__curve?function(t){return a.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",h,c,t),y:e("y",h,c,t),z:e("z",h,c,t)}},y=a.__curve?a.__curve.getLength():Math.sqrt(["x","y","z"].map((function(t){return Math.pow((c[t]||0)-(h[t]||0),2)})).reduce((function(t,e){return t+e}),0)),v=d+f+(y-d-p-f)*m,_=g(v/y),b=g((v-f)/y);["x","y","z"].forEach((function(t){return l.position[t]=b[t]}));var x=ub(Ib.Vector3,bb(["x","y","z"].map((function(t){return _[t]}))));l.parent.localToWorld(x),l.lookAt(x)}}})),i=Jv(t.linkDirectionalParticleSpeed),t.graphData.links.forEach((function(e){var n=t.particlesDataMapper.getObj(e),r=n&&n.children,o=e.__singleHopPhotonsObj&&e.__singleHopPhotonsObj.children;if(o&&o.length||r&&r.length){var a=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),l=a[s?"source":"from"],u=a[s?"target":"to"];if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var h=i(e),c=e.__curve?function(t){return e.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",l,u,t),y:e("y",l,u,t),z:e("z",l,u,t)}};[].concat(bb(r||[]),bb(o||[])).forEach((function(t,e){var n="singleHopPhotons"===t.parent.__linkThreeObjType;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=n?0:e/r.length),t.__progressRatio+=h,t.__progressRatio>=1){if(n)return t.parent.remove(t),void Eb(t);t.__progressRatio=t.__progressRatio%1}var i=t.__progressRatio,s=c(i);["x","y","z"].forEach((function(e){return t.position[e]=s[e]}))}))}}})),this},emitParticle:function(t,e){if(e&&t.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var n=new Ib.Group;n.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=n,t.graphScene.add(n)}var r=Jv(t.linkDirectionalParticleWidth),i=Math.ceil(10*r(e))/10/2,s=t.linkDirectionalParticleResolution,o=new Ib.SphereGeometry(i,s,s),a=Jv(t.linkColor),l=Jv(t.linkDirectionalParticleColor)(e)||a(e)||"#f0f0f0",u=new Ib.Color(Nb(l)),h=3*t.linkOpacity,c=new Ib.MeshLambertMaterial({color:u,transparent:!0,opacity:h});e.__singleHopPhotonsObj.add(new Ib.Mesh(o,c))}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!t.initialised)return null;var n=function t(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new Ib.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,bb((n.children||[]).filter((function(t){return!t.hasOwnProperty("__graphObjType")||"node"===t.__graphObjType&&e(t.__data)})).map(t)))}(t.graphScene);return n.length?Object.assign.apply(Object,bb(["x","y","z"].map((function(t){return cb({},t,[r_(n,(function(e){return e.min[t]})),n_(n,(function(e){return e.max[t]}))])})))):null}},stateInit:function(){return{d3ForceLayout:jy().force("link",ly()).force("charge",Vy()).force("center",kg()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.graphScene=t,e.nodeDataMapper=new Rb(t,{objBindAttr:"__threeObj"}),e.linkDataMapper=new Rb(t,{objBindAttr:"__lineObj"}),e.arrowDataMapper=new Rb(t,{objBindAttr:"__arrowObj"}),e.particlesDataMapper=new Rb(t,{objBindAttr:"__photonsObj"})},update:function(t,e){var n=function(t){return t.some((function(t){return e.hasOwnProperty(t)}))};if(t.engineRunning=!1,"function"==typeof t.onUpdate&&t.onUpdate(),null!==t.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&Ob(t.graphData.nodes,Jv(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&Ob(t.graphData.links,Jv(t.linkAutoColorBy),t.linkColor),t._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=Jv(t.nodeThreeObject),i=Jv(t.nodeThreeObjectExtend),s=Jv(t.nodeVal),o=Jv(t.nodeColor),a=Jv(t.nodeVisibility),l={},u={};(t._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&t.nodeDataMapper.clear(),t.nodeDataMapper.onCreateObj((function(e){var n,s=r(e),o=i(e);return s&&t.nodeThreeObject===s&&(s=s.clone()),s&&!o?n=s:((n=new Ib.Mesh).__graphDefaultObj=!0,s&&o&&n.add(s)),n.__graphObjType="node",n})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=s(n)||1,i=Math.cbrt(r)*t.nodeRelSize,a=t.nodeResolution;e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&e.geometry.parameters.radius===i&&e.geometry.parameters.widthSegments===a||(l.hasOwnProperty(r)||(l[r]=new Ib.SphereGeometry(i,a,a)),e.geometry.dispose(),e.geometry=l[r]);var h=o(n),c=new Ib.Color(Nb(h||"#ffffaa")),d=t.nodeOpacity*Pb(h);"MeshLambertMaterial"===e.material.type&&e.material.color.equals(c)&&e.material.opacity===d||(u.hasOwnProperty(h)||(u[h]=new Ib.MeshLambertMaterial({color:c,transparent:!0,opacity:d})),e.material.dispose(),e.material=u[h])}})).digest(t.graphData.nodes.filter(a))}if(t._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=Jv(t.linkThreeObject),c=Jv(t.linkThreeObjectExtend),d=Jv(t.linkMaterial),p=Jv(t.linkVisibility),f=Jv(t.linkColor),m=Jv(t.linkWidth),g={},y={},v={},_=t.graphData.links.filter(p);if((t._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&t.linkDataMapper.clear(),t.linkDataMapper.onRemoveObj((function(t){var e=t.__data&&t.__data.__singleHopPhotonsObj;e&&(e.parent.remove(e),Eb(e),delete t.__data.__singleHopPhotonsObj)})).onCreateObj((function(e){var n,r,i=h(e),s=c(e);if(i&&t.linkThreeObject===i&&(i=i.clone()),!i||s)if(!!m(e))n=new Ib.Mesh;else{var o=new Ib.BufferGeometry;o[Lb]("position",new Ib.BufferAttribute(new Float32Array(6),3)),n=new Ib.Line(o)}return i?s?((r=new Ib.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=e.children.length?e.children[0]:e,i=Math.ceil(10*m(n))/10,s=!!i;if(s){var o=i/2,a=t.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==a){if(!g.hasOwnProperty(i)){var l=new Ib.CylinderGeometry(o,o,1,a,1,!1);l[Ub]((new Ib.Matrix4).makeTranslation(0,.5,0)),l[Ub]((new Ib.Matrix4).makeRotationX(Math.PI/2)),g[i]=l}r.geometry.dispose(),r.geometry=g[i]}}var u=d(n);if(u)r.material=u;else{var h=f(n),c=new Ib.Color(Nb(h||"#f0f0f0")),p=t.linkOpacity*Pb(h),_=s?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==_||!r.material.color.equals(c)||r.material.opacity!==p){var b=s?y:v;b.hasOwnProperty(h)||(b[h]=new Ib[_]({color:c,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=b[h]}}}})).digest(_),t.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var b=Jv(t.linkDirectionalArrowLength),x=Jv(t.linkDirectionalArrowColor);t.arrowDataMapper.onCreateObj((function(){var t=new Ib.Mesh(void 0,new Ib.MeshLambertMaterial({transparent:!0}));return t.__linkThreeObjType="arrow",t})).onUpdateObj((function(e,n){var r=b(n),i=t.linkDirectionalArrowResolution;if(!e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||e.geometry.parameters.height!==r||e.geometry.parameters.radialSegments!==i){var s=new Ib.ConeGeometry(.25*r,r,i);s.translate(0,r/2,0),s.rotateX(Math.PI/2),e.geometry.dispose(),e.geometry=s}var o=x(n)||f(n)||"#f0f0f0";e.material.color=new Ib.Color(Nb(o)),e.material.opacity=3*t.linkOpacity*Pb(o)})).digest(_.filter(b))}if(t.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var w=Jv(t.linkDirectionalParticles),M=Jv(t.linkDirectionalParticleWidth),S=Jv(t.linkDirectionalParticleColor),T={},E={};t.particlesDataMapper.onCreateObj((function(){var t=new Ib.Group;return t.__linkThreeObjType="photons",t.__photonDataMapper=new Rb(t),t})).onUpdateObj((function(e,n){var r,i=Math.round(Math.abs(w(n))),s=!!e.children.length&&e.children[0],o=Math.ceil(10*M(n))/10/2,a=t.linkDirectionalParticleResolution;s&&s.geometry.parameters.radius===o&&s.geometry.parameters.widthSegments===a?r=s.geometry:(E.hasOwnProperty(o)||(E[o]=new Ib.SphereGeometry(o,a,a)),r=E[o],s&&s.geometry.dispose());var l,u=S(n)||f(n)||"#f0f0f0",h=new Ib.Color(Nb(u)),c=3*t.linkOpacity;s&&s.material.color.equals(h)&&s.material.opacity===c?l=s.material:(T.hasOwnProperty(u)||(T[u]=new Ib.MeshLambertMaterial({color:h,transparent:!0,opacity:c})),l=T[u],s&&s.material.dispose()),e.__photonDataMapper.id((function(t){return t.idx})).onCreateObj((function(){return new Ib.Mesh(r,l)})).onUpdateObj((function(t){t.geometry=r,t.material=l})).digest(bb(new Array(i)).map((function(t,e){return{idx:e}})))})).digest(_.filter(w))}}if(t._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){t.engineRunning=!1,t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]}));var A,C="ngraph"!==t.forceEngine;if(C){(A=t.d3ForceLayout).stop().alpha(1).numDimensions(t.numDimensions).nodes(t.graphData.nodes);var R=t.d3ForceLayout.force("link");R&&R.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var N=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===wb(t)?e(t):t}o.out.push(a)}));var h=[];return function t(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=function(){var s=n[o];if(-1!==r.indexOf(s)){var a=[].concat(bb(r.slice(r.indexOf(s))),[s]).map((function(t){return e(t.data)}));return h.some((function(t){return t.length===a.length&&t.every((function(t,e){return t===a[e]}))}))||(h.push(a),l(a)),1}i>s.depth&&(s.depth=i,t(s.out,[].concat(bb(r),[s]),i+(s.skip?0:1)))},o=0,a=n.length;o<a;o++)s()}(Object.values(u)),Object.assign.apply(Object,[{}].concat(bb(Object.entries(u).filter((function(t){return!vb(t,2)[1].skip})).map((function(t){var e=vb(t,2);return cb({},e[0],e[1].depth)})))))}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),P=Math.max.apply(Math,bb(Object.values(N||[]))),k=t.dagLevelDistance||t.graphData.nodes.length/(P||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var O=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[O]}))}if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var I=["rl","td","zout"].includes(t.dagMode),D=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[D]=function(e){return(N[e[t.nodeId]]-P/2)*k*(I?-1:1)}(e)}))}t.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?function(t,e,n,r){var i,s,o,a,l=iy(.1);function u(t){for(var l=0,u=i.length;l<u;++l){var h=i[l],c=h.x-e||1e-6,d=(h.y||0)-n||1e-6,p=(h.z||0)-r||1e-6,f=Math.sqrt(c*c+d*d+p*p),m=(a[l]-f)*o[l]*t/f;h.vx+=c*m,s>1&&(h.vy+=d*m),s>2&&(h.vz+=p*m)}}function h(){if(i){var e,n=i.length;for(o=new Array(n),a=new Array(n),e=0;e<n;++e)a[e]=+t(i[e],e,i),o[e]=isNaN(a[e])?0:+l(i[e],e,i)}}return"function"!=typeof t&&(t=iy(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),u.initialize=function(t,...e){i=t,s=e.find((t=>[1,2,3].includes(t)))||2,h()},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:iy(+t),h(),u):l},u.radius=function(e){return arguments.length?(t="function"==typeof e?e:iy(+e),h(),u):t},u.x=function(t){return arguments.length?(e=+t,u):e},u.y=function(t){return arguments.length?(n=+t,u):n},u.z=function(t){return arguments.length?(r=+t,u):r},u}((function(e){var n=N[e[t.nodeId]]||-1;return("radialin"===t.dagMode?P-n:n)*k})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null)}else{var L=Db.graph();t.graphData.nodes.forEach((function(e){L.addNode(e[t.nodeId])})),t.graphData.links.forEach((function(t){L.addLink(t.source,t.target)})),A=Db.forcelayout(L,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gb(Object(n),!0).forEach((function(e){cb(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gb(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({dimensions:t.numDimensions},t.ngraphPhysics)),A.graph=L}for(var U=0;U<t.warmupTicks&&!(C&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin);U++)A[C?"tick":"step"]();t.layout=A,this.resetCountdown()}t.engineRunning=!0,t.onFinishUpdate()}});var zb=function(t){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function r(){var n;sb(this,r);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=ib(this,r,[].concat(s))).__kapsuleInstance=ub(t,[].concat(bb(e?[n]:[]),s)),n}return fb(r,n),hb(r)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(t()).forEach((function(t){return n.prototype[t]=function(){var e,n=(e=this.__kapsuleInstance)[t].apply(e,arguments);return n===this.__kapsuleInstance?this:n}})),n}(Fb,(window.THREE?window.THREE:{Group:lg}).Group,!0);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var Bb=function(t){return"string"==typeof t?JSON.parse(t):t},jb=function(t){if("function"==typeof t)return t;var e=eval;try{return e("("+t+")")}catch(t){}return null},Vb=function(t){return isNaN(parseFloat(t))?jb(t)?jb(t):t:parseFloat(t)};function Gb(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Hb(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Wb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function qb(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wb(Object(n),!0).forEach((function(e){Hb(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wb(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function $b(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Yb(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xb(t){return function(t){if(Array.isArray(t))return Gb(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Yb(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yb(t,e){if(t){if("string"==typeof t)return Gb(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gb(t,e):void 0}}AFRAME.components.hasOwnProperty("forcegraph")||AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:Bb,default:[]},links:{parse:Bb,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:jb,default:function(){return!0}},onDagError:{parse:jb,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:Vb,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:Vb,default:!0},nodeColor:{parse:Vb,default:"color"},nodeAutoColorBy:{parse:Vb,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:Vb,default:null},nodeThreeObjectExtend:{parse:Vb,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:Vb,default:!0},linkColor:{parse:Vb,default:"color"},linkAutoColorBy:{parse:Vb,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:Vb,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:Vb,default:0},linkCurveRotation:{parse:Vb,default:0},linkMaterial:{parse:Vb,default:null},linkThreeObject:{parse:Vb,default:null},linkThreeObjectExtend:{parse:Vb,default:!1},linkPositionUpdate:{parse:jb,default:null},linkDirectionalArrowLength:{parse:Vb,default:0},linkDirectionalArrowColor:{parse:Vb,default:null},linkDirectionalArrowRelPos:{parse:Vb,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:Vb,default:0},linkDirectionalParticleSpeed:{parse:Vb,default:.01},linkDirectionalParticleWidth:{parse:Vb,default:.5},linkDirectionalParticleColor:{parse:Vb,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:jb,default:function(){}},onLinkHover:{parse:jb,default:function(){}},onNodeClick:{parse:jb,default:function(){}},onLinkClick:{parse:jb,default:function(){}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:Bb,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:jb,default:function(){}},onEngineStop:{parse:jb,default:function(){}}},getGraphBbox:function(t){return this.forceGraph||(this.forceGraph=new zb),this.forceGraph.getGraphBbox(t)},emitParticle:function(){this.forceGraph||(this.forceGraph=new zb);var t=this.forceGraph,e=t.emitParticle.apply(t,arguments);return e===t?this:e},d3Force:function(){this.forceGraph||(this.forceGraph=new zb);var t=this.forceGraph,e=t.d3Force.apply(t,arguments);return e===t?this:e},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){var t=this,e=this.state={};e.infoEl=document.createElement("a-text"),e.infoEl.setAttribute("position","0 -0.1 -1"),e.infoEl.setAttribute("width",1),e.infoEl.setAttribute("align","center"),e.infoEl.setAttribute("color","lavender");var n=document.querySelector("a-entity[camera], a-camera");n.appendChild(e.infoEl),e.cameraObj=n.object3D.children.filter((function(t){return"PerspectiveCamera"===t.type}))[0],this.el.sceneEl.addEventListener("camera-set-active",(function(t){e.cameraObj=t.detail.cameraEl.components.camera.camera})),this.forceGraph||(this.forceGraph=new zb),this.forceGraph.onFinishUpdate((function(){return t.el.setObject3D("forcegraphGroup",t.forceGraph)})).onLoading((function(){return e.infoEl.setAttribute("value","Loading...")})).onFinishLoading((function(){return e.infoEl.setAttribute("value","")})),this.el.addEventListener("raycaster-intersected",(function(t){return e.hoverDetail=t.detail})),this.el.addEventListener("raycaster-intersected-cleared",(function(t){return e.hoverDetail=t.detail})),this.el.addEventListener("click",(function(){return e.hoverObj&&t.data["on"+("node"===e.hoverObj.__graphObjType?"Node":"Link")+"Click"](e.hoverObj.__data)}))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(t){var e=this,n=this.data,r=AFRAME.utils.diff(n,t);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter((function(t){return t in r})).forEach((function(t){e.forceGraph[t](""!==n[t]?n[t]:null)})),("nodes"in r||"links"in r)&&e.forceGraph.graphData({nodes:n.nodes,links:n.links})},tick:function(t,e){for(var n=this.state,r=this.data,i=n.hoverDetail?n.hoverDetail.getIntersection?n.hoverDetail.getIntersection(this.el):n.hoverDetail.intersection||void 0:void 0,s=i?i.object:void 0;s&&!s.hasOwnProperty("__graphObjType");)s=s.parent;if(s!==n.hoverObj){var o=n.hoverObj?n.hoverObj.__graphObjType:null,a=n.hoverObj?n.hoverObj.__data:null,l=s?s.__graphObjType:null,u=s?s.__data:null;o&&o!==l&&r["on"+("node"===o?"Node":"Link")+"Hover"](null,a),l&&r["on"+("node"===l?"Node":"Link")+"Hover"](u,o===l?a:null),n.hoverObj=s}this.forceGraph.tickFrame()}});var Kb=Zv({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:qb(qb({},Object.assign.apply(Object,[{}].concat(Xb(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map((function(t){return Hb({},t,(function(e){for(var n=e.forcegraph.components.forcegraph,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=n[t].apply(n,i);return o===n?this:o}))})))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).markerAttrs,r=void 0===n?{preset:"hiro"}:n;t.innerHTML="",e.container=document.createElement("div"),t.appendChild(e.container);var i=document.createElement("a-scene");i.setAttribute("embedded",""),i.setAttribute("vr-mode-ui","enabled: false"),i.setAttribute("arjs","debugUIEnabled: false;");var s,o=document.createElement("a-marker");Object.entries(r).forEach((function(t){var e=$b(t,2),n=e[0],r=e[1];return o.setAttribute(n,r)})),i.appendChild(o),i.appendChild(s=document.createElement("a-entity")),s.setAttribute("cursor"),s.setAttribute("raycaster","objects: [forcegraph]"),e.forcegraph=document.createElement("a-entity"),e.forcegraph.setAttribute("forcegraph",null),o.appendChild(e.forcegraph);var a=document.createElement("a-entity");a.setAttribute("camera",""),i.appendChild(a),e.container.appendChild(i)},update:function(t,e){e.hasOwnProperty("width")&&t.width&&(t.container.style.width="".concat(t.width,"px")),e.hasOwnProperty("height")&&t.height&&(t.container.style.height="".concat(t.height,"px")),e.hasOwnProperty("glScale")&&t.forcegraph.setAttribute("scale",Xb(new Array(3)).map((function(){return 1/t.glScale})).join(" ")),e.hasOwnProperty("yOffset")&&t.forcegraph.setAttribute("position","0 ".concat(t.yOffset," 0"));var n=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],r=Object.assign.apply(Object,[{}].concat(Xb(Object.entries(t).filter((function(t){var r=$b(t,2),i=r[0],s=r[1];return e.hasOwnProperty(i)&&-1!==n.indexOf(i)&&null!=s})).map((function(t){var e=$b(t,2);return Hb({},e[0],e[1])}))),Xb(Object.entries(t.graphData).map((function(t){var e=$b(t,2);return Hb({},e[0],e[1])})))));t.forcegraph.setAttribute("forcegraph",r)}});const Zb=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.wrapperElementType,i=void 0===r?"div":r,s=e.nodeMapper,o=void 0===s?function(t){return t}:s,a=e.methodNames,l=void 0===a?[]:a,u=e.initPropNames,h=void 0===u?[]:u;return n.forwardRef((function(e,r){var s=n.useRef(),a=n.useMemo((function(){var n=Object.fromEntries(h.filter((function(t){return e.hasOwnProperty(t)})).map((function(t){return[t,e[t]]})));return t(n)}),[]);Ap((function(){a(o(s.current))}),n.useLayoutEffect),Ap((function(){return a._destructor instanceof Function?a._destructor:void 0}));var u,c,d,p=n.useCallback((function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return a[t]instanceof Function?a[t].apply(a,n):void 0}),[a]),f=n.useRef({});return Object.keys((u=e,c=[].concat(Tp(l),Tp(h)),d=new Set(c),Object.assign.apply(Object,[{}].concat(bp(Object.entries(u).filter((function(t){var e=_p(t,1)[0];return!d.has(e)})).map((function(t){var e=_p(t,2);return vp({},e[0],e[1])}))))))).filter((function(t){return f.current[t]!==e[t]})).forEach((function(t){return p(t,e[t])})),f.current=e,n.useImperativeHandle(r,(function(){return Object.fromEntries(l.map((function(t){return[t,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return p.apply(void 0,[t].concat(n))}]})))}),[p]),n.createElement(i,{ref:s})}))}(Kb,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});function Jb(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qb(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||ex(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tx(t){return function(t){if(Array.isArray(t))return nx(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ex(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ex(t,e){if(t){if("string"==typeof t)return nx(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nx(t,e):void 0}}function nx(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}Zb.displayName="ForceGraphAR",Zb.propTypes=gp;function rx(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ix(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||ox(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sx(t){return function(t){if(Array.isArray(t))return rx(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ox(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ox(t,e){if(t){if("string"==typeof t)return rx(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rx(t,e):void 0}}function ax(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.useEffect,r=n.useRef(),i=n.useRef(!1),s=n.useRef(!1),o=ix(n.useState(0),2);o[0];var a=o[1];i.current&&(s.current=!0),e((function(){return i.current||(r.current=t(),i.current=!0),a((function(t){return t+1})),function(){s.current&&r.current&&r.current()}}),[])}const lx="173",ux=0,hx=1,cx=2,dx=0,px=1,fx=2,mx=3,gx=0,yx=1,vx=2,_x=100,bx=101,xx=102,wx=200,Mx=201,Sx=202,Tx=203,Ex=204,Ax=205,Cx=206,Rx=207,Nx=208,Px=209,kx=210,Ox=211,Ix=212,Dx=213,Lx=214,Ux=0,Fx=1,zx=2,Bx=3,jx=4,Vx=5,Gx=6,Hx=7,Wx=301,qx=302,$x=303,Xx=304,Yx=306,Kx=1e3,Zx=1001,Jx=1002,Qx=1003,tw=1004,ew=1005,nw=1006,rw=1007,iw=1008,sw=1009,ow=1010,aw=1011,lw=1012,uw=1013,hw=1014,cw=1015,dw=1016,pw=1017,fw=1018,mw=1020,gw=35902,yw=1021,vw=1022,_w=1023,bw=1024,xw=1025,ww=1026,Mw=1027,Sw=1028,Tw=1029,Ew=1030,Aw=1031,Cw=1033,Rw=33776,Nw=33777,Pw=33778,kw=33779,Ow=35840,Iw=35841,Dw=35842,Lw=35843,Uw=36196,Fw=37492,zw=37496,Bw=37808,jw=37809,Vw=37810,Gw=37811,Hw=37812,Ww=37813,qw=37814,$w=37815,Xw=37816,Yw=37817,Kw=37818,Zw=37819,Jw=37820,Qw=37821,tM=36492,eM=36494,nM=36495,rM=36283,iM=36284,sM=36285,oM=36286,aM="",lM="srgb",uM="srgb-linear",hM="linear",cM="srgb",dM=7680,pM=512,fM=513,mM=514,gM=515,yM=516,vM=517,_M=518,bM=519,xM=35044,wM=35048,MM="300 es",SM=2e3,TM=2001;class EM{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return void 0!==n&&(void 0!==n[t]&&-1!==n[t].indexOf(e))}removeEventListener(t,e){const n=this._listeners;if(void 0===n)return;const r=n[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,r=e.length;n<r;n++)e[n].call(this,t);t.target=null}}}const AM=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let CM=1234567;const RM=Math.PI/180,NM=180/Math.PI;function PM(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(AM[255&t]+AM[t>>8&255]+AM[t>>16&255]+AM[t>>24&255]+"-"+AM[255&e]+AM[e>>8&255]+"-"+AM[e>>16&15|64]+AM[e>>24&255]+"-"+AM[63&n|128]+AM[n>>8&255]+"-"+AM[n>>16&255]+AM[n>>24&255]+AM[255&r]+AM[r>>8&255]+AM[r>>16&255]+AM[r>>24&255]).toLowerCase()}function kM(t,e,n){return Math.max(e,Math.min(n,t))}function OM(t,e){return(t%e+e)%e}function IM(t,e,n){return(1-n)*t+n*e}function DM(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function LM(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const UM={DEG2RAD:RM,RAD2DEG:NM,generateUUID:PM,clamp:kM,euclideanModulo:OM,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:IM,damp:function(t,e,n,r){return IM(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(OM(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(CM=t);let e=CM+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*RM},radToDeg:function(t){return t*NM},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),u=s((e+r)/2),h=o((e+r)/2),c=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*h,l*c,l*d,a*u);break;case"YZY":t.set(l*d,a*h,l*c,a*u);break;case"ZXZ":t.set(l*c,l*d,a*h,a*u);break;case"XZX":t.set(a*h,l*f,l*p,a*u);break;case"YXY":t.set(l*p,a*h,l*f,a*u);break;case"ZYZ":t.set(l*f,l*p,a*h,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:LM,denormalize:DM};class FM{constructor(t=0,e=0){FM.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=kM(this.x,t.x,e.x),this.y=kM(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=kM(this.x,t,e),this.y=kM(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(kM(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(kM(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zM{constructor(t,e,n,r,i,s,o,a,l){zM.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l)}set(t,e,n,r,i,s,o,a,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],u=n[4],h=n[7],c=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=s*f+o*y+a*b,i[3]=s*m+o*v+a*x,i[6]=s*g+o*_+a*w,i[1]=l*f+u*y+h*b,i[4]=l*m+u*v+h*x,i[7]=l*g+u*_+h*w,i[2]=c*f+d*y+p*b,i[5]=c*m+d*v+p*x,i[8]=c*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8];return e*s*u-e*o*l-n*i*u+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=u*s-o*l,c=o*a-u*i,d=l*i-s*a,p=e*h+n*c+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(r*l-u*n)*f,t[2]=(o*n-r*s)*f,t[3]=c*f,t[4]=(u*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(BM.makeScale(t,e)),this}rotate(t){return this.premultiply(BM.makeRotation(-t)),this}translate(t,e){return this.premultiply(BM.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const BM=new zM;function jM(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function VM(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function GM(){const t=VM("canvas");return t.style.display="block",t}const HM={};function WM(t){t in HM||(HM[t]=!0,console.warn(t))}const qM=(new zM).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),$M=(new zM).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function XM(){const t={enabled:!0,workingColorSpace:uM,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===cM&&(t.r=KM(t.r),t.g=KM(t.g),t.b=KM(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===cM&&(t.r=ZM(t.r),t.g=ZM(t.g),t.b=ZM(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===aM?hM:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[uM]:{primaries:e,whitePoint:r,transfer:hM,toXYZ:qM,fromXYZ:$M,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:lM},outputColorSpaceConfig:{drawingBufferColorSpace:lM}},[lM]:{primaries:e,whitePoint:r,transfer:cM,toXYZ:qM,fromXYZ:$M,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:lM}}}),t}const YM=XM();function KM(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ZM(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let JM;class QM{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===JM&&(JM=VM("canvas")),JM.width=t.width,JM.height=t.height;const n=JM.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=JM}return e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=VM("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*KM(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*KM(e[t]/255)):e[t]=KM(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let tS=0;class eS{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tS++}),this.uuid=PM(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(nS(r[e].image)):t.push(nS(r[e]))}else t=nS(r);n.url=t}return e||(t.images[this.uuid]=n),n}}function nS(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?QM.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let rS=0;class iS extends EM{constructor(t=iS.DEFAULT_IMAGE,e=iS.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,o=1023,a=1009,l=iS.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rS++}),this.uuid=PM(),this.name="",this.source=new eS(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new FM(0,0),this.repeat=new FM(1,1),this.center=new FM(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zM,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Kx:t.x=t.x-Math.floor(t.x);break;case Zx:t.x=t.x<0?0:1;break;case Jx:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Kx:t.y=t.y-Math.floor(t.y);break;case Zx:t.y=t.y<0?0:1;break;case Jx:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}iS.DEFAULT_IMAGE=null,iS.DEFAULT_MAPPING=300,iS.DEFAULT_ANISOTROPY=1;class sS{constructor(t=0,e=0,n=0,r=1){sS.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],u=a[4],h=a[8],c=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-c)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+c)<o&&Math.abs(h+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(u+c)/4,_=(h+f)/4,b=(p+m)/4;return t>a&&t>y?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=v/n,i=_/n):a>y?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=b/r):y<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=b/i),this.set(n,r,i,e),this}let y=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(c-u)*(c-u));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(h-f)/y,this.z=(c-u)/y,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=kM(this.x,t.x,e.x),this.y=kM(this.y,t.y,e.y),this.z=kM(this.z,t.z,e.z),this.w=kM(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=kM(this.x,t,e),this.y=kM(this.y,t,e),this.z=kM(this.z,t,e),this.w=kM(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(kM(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class oS extends EM{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new sS(0,0,t,e),this.scissorTest=!1,this.viewport=new sS(0,0,t,e);const r={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:nw,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new iS(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let t=0;t<s;t++)this.textures[t]=i.clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const e=Object.assign({},t.texture.image);return this.texture.source=new eS(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class aS extends oS{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class lS extends iS{constructor(t=null,e=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=Qx,this.minFilter=Qx,this.wrapR=Zx,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class uS extends iS{constructor(t=null,e=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=Qx,this.minFilter=Qx,this.wrapR=Zx,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hS{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],u=n[r+2],h=n[r+3];const c=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=u,void(t[e+3]=h);if(1===o)return t[e+0]=c,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||a!==c||l!==d||u!==p){let t=1-o;const e=a*c+l*d+u*p+h*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+c*i,l=l*t+d*i,u=u*t+p*i,h=h*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+u*u+h*h);a*=t,l*=t,u*=t,h*=t}}t[e]=a,t[e+1]=l,t[e+2]=u,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],u=n[r+3],h=i[s],c=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+u*h+a*d-l*c,t[e+1]=a*p+u*c+l*h-o*d,t[e+2]=l*p+u*d+o*c-a*h,t[e+3]=u*p-o*h-a*c-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),u=o(r/2),h=o(i/2),c=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"YXZ":this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"ZXY":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p;break;case"ZYX":this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p;break;case"YZX":this._x=c*u*h+l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h-c*d*p;break;case"XZY":this._x=c*u*h-l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],u=e[6],h=e[10],c=n+o+h;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(u-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>h){const t=2*Math.sqrt(1+n-o-h);this._w=(u-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>h){const t=2*Math.sqrt(1+o-n-h);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+h-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(kM(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,u=e._w;return this._x=n*u+s*o+r*l-i*a,this._y=r*u+s*a+i*o-n*l,this._z=i*u+s*l+n*a-r*o,this._w=s*u-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,o),h=Math.sin((1-e)*u)/l,c=Math.sin(e*u)/l;return this._w=s*h+this._w*c,this._x=n*h+this._x*c,this._y=r*h+this._y*c,this._z=i*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class cS{constructor(t=0,e=0,n=0){cS.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(pS.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(pS.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),u=2*(o*e-i*r),h=2*(i*n-s*e);return this.x=e+a*l+s*h-o*u,this.y=n+a*u+o*l-i*h,this.z=r+a*h+i*u-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=kM(this.x,t.x,e.x),this.y=kM(this.y,t.y,e.y),this.z=kM(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=kM(this.x,t,e),this.y=kM(this.y,t,e),this.z=kM(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(kM(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return dS.copy(this).projectOnVector(t),this.sub(dS)}reflect(t){return this.sub(dS.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(kM(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dS=new cS,pS=new hS;class fS{constructor(t=new cS(1/0,1/0,1/0),e=new cS(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(gS.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(gS.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=gS.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,gS):gS.fromBufferAttribute(r,e),gS.applyMatrix4(t.matrixWorld),this.expandByPoint(gS);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),yS.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),yS.copy(n.boundingBox)),yS.applyMatrix4(t.matrixWorld),this.union(yS)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,gS),gS.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(SS),TS.subVectors(this.max,SS),vS.subVectors(t.a,SS),_S.subVectors(t.b,SS),bS.subVectors(t.c,SS),xS.subVectors(_S,vS),wS.subVectors(bS,_S),MS.subVectors(vS,bS);let e=[0,-xS.z,xS.y,0,-wS.z,wS.y,0,-MS.z,MS.y,xS.z,0,-xS.x,wS.z,0,-wS.x,MS.z,0,-MS.x,-xS.y,xS.x,0,-wS.y,wS.x,0,-MS.y,MS.x,0];return!!CS(e,vS,_S,bS,TS)&&(e=[1,0,0,0,1,0,0,0,1],!!CS(e,vS,_S,bS,TS)&&(ES.crossVectors(xS,wS),e=[ES.x,ES.y,ES.z],CS(e,vS,_S,bS,TS)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,gS).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(gS).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(mS[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),mS[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),mS[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),mS[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),mS[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),mS[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),mS[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),mS[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(mS)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const mS=[new cS,new cS,new cS,new cS,new cS,new cS,new cS,new cS],gS=new cS,yS=new fS,vS=new cS,_S=new cS,bS=new cS,xS=new cS,wS=new cS,MS=new cS,SS=new cS,TS=new cS,ES=new cS,AS=new cS;function CS(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){AS.fromArray(t,s);const o=i.x*Math.abs(AS.x)+i.y*Math.abs(AS.y)+i.z*Math.abs(AS.z),a=e.dot(AS),l=n.dot(AS),u=r.dot(AS);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>o)return!1}return!0}const RS=new fS,NS=new cS,PS=new cS;class kS{constructor(t=new cS,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):RS.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;NS.subVectors(t,this.center);const e=NS.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(NS,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(PS.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(NS.copy(t.center).add(PS)),this.expandByPoint(NS.copy(t.center).sub(PS))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const OS=new cS,IS=new cS,DS=new cS,LS=new cS,US=new cS,FS=new cS,zS=new cS;class BS{constructor(t=new cS,e=new cS(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,OS)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=OS.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(OS.copy(this.origin).addScaledVector(this.direction,e),OS.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){IS.copy(t).add(e).multiplyScalar(.5),DS.copy(e).sub(t).normalize(),LS.copy(this.origin).sub(IS);const i=.5*t.distanceTo(e),s=-this.direction.dot(DS),o=LS.dot(this.direction),a=-LS.dot(DS),l=LS.lengthSq(),u=Math.abs(1-s*s);let h,c,d,p;if(u>0)if(h=s*a-o,c=s*o-a,p=i*u,h>=0)if(c>=-p)if(c<=p){const t=1/u;h*=t,c*=t,d=h*(h+s*c+2*o)+c*(s*h+c+2*a)+l}else c=i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c=-i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;else c<=-p?(h=Math.max(0,-(-s*i+o)),c=h>0?-i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l):c<=p?(h=0,c=Math.min(Math.max(-i,-a),i),d=c*(c+2*a)+l):(h=Math.max(0,-(s*i+o)),c=h>0?i:Math.min(Math.max(-i,-a),i),d=-h*h+c*(c+2*a)+l);else c=s>0?-i:i,h=Math.max(0,-(s*c+o)),d=-h*h+c*(c+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(IS).addScaledVector(DS,c),d}intersectSphere(t,e){OS.subVectors(t.center,this.origin);const n=OS.dot(this.direction),r=OS.dot(OS)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(n=(t.min.x-c.x)*l,r=(t.max.x-c.x)*l):(n=(t.max.x-c.x)*l,r=(t.min.x-c.x)*l),u>=0?(i=(t.min.y-c.y)*u,s=(t.max.y-c.y)*u):(i=(t.max.y-c.y)*u,s=(t.min.y-c.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),h>=0?(o=(t.min.z-c.z)*h,a=(t.max.z-c.z)*h):(o=(t.max.z-c.z)*h,a=(t.min.z-c.z)*h),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,OS)}intersectTriangle(t,e,n,r,i){US.subVectors(e,t),FS.subVectors(n,t),zS.crossVectors(US,FS);let s,o=this.direction.dot(zS);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}LS.subVectors(this.origin,t);const a=s*this.direction.dot(FS.crossVectors(LS,FS));if(a<0)return null;const l=s*this.direction.dot(US.cross(LS));if(l<0)return null;if(a+l>o)return null;const u=-s*LS.dot(zS);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class jS{constructor(t,e,n,r,i,s,o,a,l,u,h,c,d,p,f,m){jS.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l,u,h,c,d,p,f,m)}set(t,e,n,r,i,s,o,a,l,u,h,c,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=u,g[10]=h,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new jS).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/VS.setFromMatrixColumn(t,0).length(),i=1/VS.setFromMatrixColumn(t,1).length(),s=1/VS.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=-a*h,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*h,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,n=a*h,r=l*u,i=l*h;e[0]=t-i*o,e[4]=-s*h,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,n=s*h,r=o*u,i=o*h;e[0]=a*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*h,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=i-t*h,e[8]=r*h+n,e[1]=h,e[5]=s*u,e[9]=-o*u,e[2]=-l*u,e[6]=n*h+r,e[10]=t-i*h}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=-h,e[8]=l*u,e[1]=t*h+i,e[5]=s*u,e[9]=n*h-r,e[2]=r*h-n,e[6]=o*u,e[10]=i*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(HS,t,WS)}lookAt(t,e,n){const r=this.elements;return XS.subVectors(t,e),0===XS.lengthSq()&&(XS.z=1),XS.normalize(),qS.crossVectors(n,XS),0===qS.lengthSq()&&(1===Math.abs(n.z)?XS.x+=1e-4:XS.z+=1e-4,XS.normalize(),qS.crossVectors(n,XS)),qS.normalize(),$S.crossVectors(XS,qS),r[0]=qS.x,r[4]=$S.x,r[8]=XS.x,r[1]=qS.y,r[5]=$S.y,r[9]=XS.y,r[2]=qS.z,r[6]=$S.z,r[10]=XS.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],u=n[1],h=n[5],c=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],b=n[15],x=r[0],w=r[4],M=r[8],S=r[12],T=r[1],E=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],k=r[14],O=r[3],I=r[7],D=r[11],L=r[15];return i[0]=s*x+o*T+a*R+l*O,i[4]=s*w+o*E+a*N+l*I,i[8]=s*M+o*A+a*P+l*D,i[12]=s*S+o*C+a*k+l*L,i[1]=u*x+h*T+c*R+d*O,i[5]=u*w+h*E+c*N+d*I,i[9]=u*M+h*A+c*P+d*D,i[13]=u*S+h*C+c*k+d*L,i[2]=p*x+f*T+m*R+g*O,i[6]=p*w+f*E+m*N+g*I,i[10]=p*M+f*A+m*P+g*D,i[14]=p*S+f*C+m*k+g*L,i[3]=y*x+v*T+_*R+b*O,i[7]=y*w+v*E+_*N+b*I,i[11]=y*M+v*A+_*P+b*D,i[15]=y*S+v*C+_*k+b*L,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],u=t[2],h=t[6],c=t[10],d=t[14];return t[3]*(+i*a*h-r*l*h-i*o*c+n*l*c+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*c+i*s*c-r*s*d+r*l*u-i*a*u)+t[11]*(+e*l*h-e*o*d-i*s*h+n*s*d+i*o*u-n*l*u)+t[15]*(-r*o*u-e*a*h+e*o*c+r*s*h-n*s*c+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=h*m*l-f*c*l+f*a*d-o*m*d-h*a*g+o*c*g,v=p*c*l-u*m*l-p*a*d+s*m*d+u*a*g-s*c*g,_=u*f*l-p*h*l+p*o*d-s*f*d-u*o*g+s*h*g,b=p*h*a-u*f*a-p*o*c+s*f*c+u*o*m-s*h*m,x=e*y+n*v+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return t[0]=y*w,t[1]=(f*c*i-h*m*i-f*r*d+n*m*d+h*r*g-n*c*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(h*a*i-o*c*i-h*r*l+n*c*l+o*r*d-n*a*d)*w,t[4]=v*w,t[5]=(u*m*i-p*c*i+p*r*d-e*m*d-u*r*g+e*c*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*c*i-u*a*i+u*r*l-e*c*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*h*i-u*f*i-p*n*d+e*f*d+u*n*g-e*h*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(u*o*i-s*h*i-u*n*l+e*h*l+s*n*d-e*o*d)*w,t[12]=b*w,t[13]=(u*f*r-p*h*r+p*n*c-e*f*c-u*n*m+e*h*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*h*r-u*o*r+u*n*a-e*h*a-s*n*c+e*o*c)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,u=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,u*o+n,u*a-r*s,0,l*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,u=s+s,h=o+o,c=i*l,d=i*u,p=i*h,f=s*u,m=s*h,g=o*h,y=a*l,v=a*u,_=a*h,b=n.x,x=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+_)*b,r[2]=(p-v)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(c+g))*x,r[6]=(m+y)*x,r[7]=0,r[8]=(p+v)*w,r[9]=(m-y)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=VS.set(r[0],r[1],r[2]).length();const s=VS.set(r[4],r[5],r[6]).length(),o=VS.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],GS.copy(this);const a=1/i,l=1/s,u=1/o;return GS.elements[0]*=a,GS.elements[1]*=a,GS.elements[2]*=a,GS.elements[4]*=l,GS.elements[5]*=l,GS.elements[6]*=l,GS.elements[8]*=u,GS.elements[9]*=u,GS.elements[10]*=u,e.setFromRotationMatrix(GS),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s,o=2e3){const a=this.elements,l=2*i/(e-t),u=2*i/(n-r),h=(e+t)/(e-t),c=(n+r)/(n-r);let d,p;if(o===SM)d=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(o!==TM)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-i),p=-s*i/(s-i)}return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,s,o=2e3){const a=this.elements,l=1/(e-t),u=1/(n-r),h=1/(s-i),c=(e+t)*l,d=(n+r)*u;let p,f;if(o===SM)p=(s+i)*h,f=-2*h;else{if(o!==TM)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*h,f=-1*h}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const VS=new cS,GS=new jS,HS=new cS(0,0,0),WS=new cS(1,1,1),qS=new cS,$S=new cS,XS=new cS,YS=new jS,KS=new hS;class ZS{constructor(t=0,e=0,n=0,r=ZS.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],u=r[9],h=r[2],c=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(kM(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-kM(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(kM(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-kM(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(kM(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-kM(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return YS.makeRotationFromQuaternion(t),this.setFromRotationMatrix(YS,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return KS.setFromEuler(this),this.setFromQuaternion(KS,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ZS.DEFAULT_ORDER="XYZ";class JS{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let QS=0;const tT=new cS,eT=new hS,nT=new jS,rT=new cS,iT=new cS,sT=new cS,oT=new hS,aT=new cS(1,0,0),lT=new cS(0,1,0),uT=new cS(0,0,1),hT={type:"added"},cT={type:"removed"},dT={type:"childadded",child:null},pT={type:"childremoved",child:null};class fT extends EM{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:QS++}),this.uuid=PM(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=fT.DEFAULT_UP.clone();const t=new cS,e=new ZS,n=new hS,r=new cS(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new jS},normalMatrix:{value:new zM}}),this.matrix=new jS,this.matrixWorld=new jS,this.matrixAutoUpdate=fT.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=fT.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new JS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return eT.setFromAxisAngle(t,e),this.quaternion.multiply(eT),this}rotateOnWorldAxis(t,e){return eT.setFromAxisAngle(t,e),this.quaternion.premultiply(eT),this}rotateX(t){return this.rotateOnAxis(aT,t)}rotateY(t){return this.rotateOnAxis(lT,t)}rotateZ(t){return this.rotateOnAxis(uT,t)}translateOnAxis(t,e){return tT.copy(t).applyQuaternion(this.quaternion),this.position.add(tT.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(aT,t)}translateY(t){return this.translateOnAxis(lT,t)}translateZ(t){return this.translateOnAxis(uT,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(nT.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?rT.copy(t):rT.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),iT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nT.lookAt(iT,rT,this.up):nT.lookAt(rT,iT,this.up),this.quaternion.setFromRotationMatrix(nT),r&&(nT.extractRotation(r.matrixWorld),eT.setFromRotationMatrix(nT),this.quaternion.premultiply(eT.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(hT),dT.child=t,this.dispatchEvent(dT),dT.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(cT),pT.child=t,this.dispatchEvent(pT),pT.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),nT.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),nT.multiply(t.parent.matrixWorld)),t.applyMatrix4(nT),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(hT),dT.child=t,this.dispatchEvent(dT),dT.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(iT,t,sT),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(iT,oT,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),u=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),h.length>0&&(n.nodes=h)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}fT.DEFAULT_UP=new cS(0,1,0),fT.DEFAULT_MATRIX_AUTO_UPDATE=!0,fT.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const mT=new cS,gT=new cS,yT=new cS,vT=new cS,_T=new cS,bT=new cS,xT=new cS,wT=new cS,MT=new cS,ST=new cS,TT=new sS,ET=new sS,AT=new sS;class CT{constructor(t=new cS,e=new cS,n=new cS){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),mT.subVectors(t,e),r.cross(mT);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){mT.subVectors(r,e),gT.subVectors(n,e),yT.subVectors(t,e);const s=mT.dot(mT),o=mT.dot(gT),a=mT.dot(yT),l=gT.dot(gT),u=gT.dot(yT),h=s*l-o*o;if(0===h)return i.set(0,0,0),null;const c=1/h,d=(l*a-o*u)*c,p=(s*u-o*a)*c;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,vT)&&(vT.x>=0&&vT.y>=0&&vT.x+vT.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,vT)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,vT.x),a.addScaledVector(s,vT.y),a.addScaledVector(o,vT.z),a)}static getInterpolatedAttribute(t,e,n,r,i,s){return TT.setScalar(0),ET.setScalar(0),AT.setScalar(0),TT.fromBufferAttribute(t,e),ET.fromBufferAttribute(t,n),AT.fromBufferAttribute(t,r),s.setScalar(0),s.addScaledVector(TT,i.x),s.addScaledVector(ET,i.y),s.addScaledVector(AT,i.z),s}static isFrontFacing(t,e,n,r){return mT.subVectors(n,e),gT.subVectors(t,e),mT.cross(gT).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return mT.subVectors(this.c,this.b),gT.subVectors(this.a,this.b),.5*mT.cross(gT).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return CT.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return CT.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,r,i){return CT.getInterpolation(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return CT.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return CT.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;_T.subVectors(r,n),bT.subVectors(i,n),wT.subVectors(t,n);const a=_T.dot(wT),l=bT.dot(wT);if(a<=0&&l<=0)return e.copy(n);MT.subVectors(t,r);const u=_T.dot(MT),h=bT.dot(MT);if(u>=0&&h<=u)return e.copy(r);const c=a*h-u*l;if(c<=0&&a>=0&&u<=0)return s=a/(a-u),e.copy(n).addScaledVector(_T,s);ST.subVectors(t,i);const d=_T.dot(ST),p=bT.dot(ST);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(bT,o);const m=u*p-d*h;if(m<=0&&h-u>=0&&d-p>=0)return xT.subVectors(i,r),o=(h-u)/(h-u+(d-p)),e.copy(r).addScaledVector(xT,o);const g=1/(m+f+c);return s=f*g,o=c*g,e.copy(n).addScaledVector(_T,s).addScaledVector(bT,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const RT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},NT={h:0,s:0,l:0},PT={h:0,s:0,l:0};function kT(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}let OT=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=lM){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,YM.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=YM.workingColorSpace){return this.r=t,this.g=e,this.b=n,YM.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=YM.workingColorSpace){if(t=OM(t,1),e=kM(e,0,1),n=kM(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=kT(i,r,t+1/3),this.g=kT(i,r,t),this.b=kT(i,r,t-1/3)}return YM.toWorkingColorSpace(this,r),this}setStyle(t,e=lM){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=lM){const n=RT[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=KM(t.r),this.g=KM(t.g),this.b=KM(t.b),this}copyLinearToSRGB(t){return this.r=ZM(t.r),this.g=ZM(t.g),this.b=ZM(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=lM){return YM.fromWorkingColorSpace(IT.copy(this),t),65536*Math.round(kM(255*IT.r,0,255))+256*Math.round(kM(255*IT.g,0,255))+Math.round(kM(255*IT.b,0,255))}getHexString(t=lM){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=YM.workingColorSpace){YM.fromWorkingColorSpace(IT.copy(this),e);const n=IT.r,r=IT.g,i=IT.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const u=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=u<=.5?t/(s+o):t/(2-s-o),s){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=u,t}getRGB(t,e=YM.workingColorSpace){return YM.fromWorkingColorSpace(IT.copy(this),e),t.r=IT.r,t.g=IT.g,t.b=IT.b,t}getStyle(t=lM){YM.fromWorkingColorSpace(IT.copy(this),t);const e=IT.r,n=IT.g,r=IT.b;return t!==lM?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(NT),this.setHSL(NT.h+t,NT.s+e,NT.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(NT),t.getHSL(PT);const n=IM(NT.h,PT.h,e),r=IM(NT.s,PT.s,e),i=IM(NT.l,PT.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const IT=new OT;OT.NAMES=RT;let DT=0;class LT extends EM{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:DT++}),this.uuid=PM(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ex,this.blendDst=Ax,this.blendEquation=_x,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new OT(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=dM,this.stencilZFail=dM,this.stencilZPass=dM,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Ex&&(n.blendSrc=this.blendSrc),this.blendDst!==Ax&&(n.blendDst=this.blendDst),this.blendEquation!==_x&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==dM&&(n.stencilFail=this.stencilFail),this.stencilZFail!==dM&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==dM&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class UT extends LT{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new OT(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ZS,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const FT=zT();function zT(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(r[t]=0,r[256|t]=32768,i[t]=24,i[256|t]=24):e<-14?(r[t]=1024>>-e-14,r[256|t]=1024>>-e-14|32768,i[t]=-e-1,i[256|t]=-e-1):e<=15?(r[t]=e+15<<10,r[256|t]=e+15<<10|32768,i[t]=13,i[256|t]=13):e<128?(r[t]=31744,r[256|t]=64512,i[t]=24,i[256|t]=24):(r[t]=31744,r[256|t]=64512,i[t]=13,i[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;!(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,s[t]=e|n}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:a}}function BT(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=kM(t,-65504,65504),FT.floatView[0]=t;const e=FT.uint32View[0],n=e>>23&511;return FT.baseTable[n]+((8388607&e)>>FT.shiftTable[n])}function jT(t){const e=t>>10;return FT.uint32View[0]=FT.mantissaTable[FT.offsetTable[e]+(1023&t)]+FT.exponentTable[e],FT.floatView[0]}const VT=new cS,GT=new FM;let HT=0;class WT{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:HT++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=xM,this.updateRanges=[],this.gpuType=cw,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)GT.fromBufferAttribute(this,e),GT.applyMatrix3(t),this.setXY(e,GT.x,GT.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)VT.fromBufferAttribute(this,e),VT.applyMatrix3(t),this.setXYZ(e,VT.x,VT.y,VT.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)VT.fromBufferAttribute(this,e),VT.applyMatrix4(t),this.setXYZ(e,VT.x,VT.y,VT.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)VT.fromBufferAttribute(this,e),VT.applyNormalMatrix(t),this.setXYZ(e,VT.x,VT.y,VT.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)VT.fromBufferAttribute(this,e),VT.transformDirection(t),this.setXYZ(e,VT.x,VT.y,VT.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=DM(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=LM(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=DM(e,this.array)),e}setX(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=DM(e,this.array)),e}setY(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=DM(e,this.array)),e}setZ(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=DM(e,this.array)),e}setW(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array),i=LM(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==xM&&(t.usage=this.usage),t}}class qT extends WT{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class $T extends WT{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class XT extends WT{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=jT(this.array[t*this.itemSize]);return this.normalized&&(e=DM(e,this.array)),e}setX(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize]=BT(e),this}getY(t){let e=jT(this.array[t*this.itemSize+1]);return this.normalized&&(e=DM(e,this.array)),e}setY(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+1]=BT(e),this}getZ(t){let e=jT(this.array[t*this.itemSize+2]);return this.normalized&&(e=DM(e,this.array)),e}setZ(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+2]=BT(e),this}getW(t){let e=jT(this.array[t*this.itemSize+3]);return this.normalized&&(e=DM(e,this.array)),e}setW(t,e){return this.normalized&&(e=LM(e,this.array)),this.array[t*this.itemSize+3]=BT(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array)),this.array[t+0]=BT(e),this.array[t+1]=BT(n),this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array)),this.array[t+0]=BT(e),this.array[t+1]=BT(n),this.array[t+2]=BT(r),this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array),i=LM(i,this.array)),this.array[t+0]=BT(e),this.array[t+1]=BT(n),this.array[t+2]=BT(r),this.array[t+3]=BT(i),this}}class YT extends WT{constructor(t,e,n){super(new Float32Array(t),e,n)}}let KT=0;const ZT=new jS,JT=new fT,QT=new cS,tE=new fS,eE=new fS,nE=new cS;class rE extends EM{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:KT++}),this.uuid=PM(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(jM(t)?$T:qT)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new zM).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return ZT.makeRotationFromQuaternion(t),this.applyMatrix4(ZT),this}rotateX(t){return ZT.makeRotationX(t),this.applyMatrix4(ZT),this}rotateY(t){return ZT.makeRotationY(t),this.applyMatrix4(ZT),this}rotateZ(t){return ZT.makeRotationZ(t),this.applyMatrix4(ZT),this}translate(t,e,n){return ZT.makeTranslation(t,e,n),this.applyMatrix4(ZT),this}scale(t,e,n){return ZT.makeScale(t,e,n),this.applyMatrix4(ZT),this}lookAt(t){return JT.lookAt(t),JT.updateMatrix(),this.applyMatrix4(JT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(QT).negate(),this.translate(QT.x,QT.y,QT.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}this.setAttribute("position",new YT(e,3))}else{const n=Math.min(t.length,e.count);for(let r=0;r<n;r++){const n=t[r];e.setXYZ(r,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new fS);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new cS(-1/0,-1/0,-1/0),new cS(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];tE.setFromBufferAttribute(n),this.morphTargetsRelative?(nE.addVectors(this.boundingBox.min,tE.min),this.boundingBox.expandByPoint(nE),nE.addVectors(this.boundingBox.max,tE.max),this.boundingBox.expandByPoint(nE)):(this.boundingBox.expandByPoint(tE.min),this.boundingBox.expandByPoint(tE.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new kS);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new cS,1/0);if(t){const n=this.boundingSphere.center;if(tE.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];eE.setFromBufferAttribute(n),this.morphTargetsRelative?(nE.addVectors(tE.min,eE.min),tE.expandByPoint(nE),nE.addVectors(tE.max,eE.max),tE.expandByPoint(nE)):(tE.expandByPoint(eE.min),tE.expandByPoint(eE.max))}tE.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)nE.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(nE));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)nE.fromBufferAttribute(s,e),o&&(QT.fromBufferAttribute(t,e),nE.add(QT)),r=Math.max(r,n.distanceToSquared(nE))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new WT(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<n.count;t++)o[t]=new cS,a[t]=new cS;const l=new cS,u=new cS,h=new cS,c=new FM,d=new FM,p=new FM,f=new cS,m=new cS;function g(t,e,r){l.fromBufferAttribute(n,t),u.fromBufferAttribute(n,e),h.fromBufferAttribute(n,r),c.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),u.sub(l),h.sub(l),d.sub(c),p.sub(c);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const v=new cS,_=new cS,b=new cS,x=new cS;function w(t){b.fromBufferAttribute(r,t),x.copy(b);const e=o[t];v.copy(e),v.sub(b.multiplyScalar(b.dot(e))).normalize(),_.crossVectors(x,e);const n=_.dot(a[t])<0?-1:1;s.setXYZW(t,v.x,v.y,v.z,n)}for(let e=0,n=y.length;e<n;++e){const n=y[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new WT(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new cS,i=new cS,s=new cS,o=new cS,a=new cS,l=new cS,u=new cS,h=new cS;if(t)for(let c=0,d=t.count;c<d;c+=3){const d=t.getX(c+0),p=t.getX(c+1),f=t.getX(c+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),a.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,i),h.subVectors(r,i),u.cross(h),n.setXYZ(t+0,u.x,u.y,u.z),n.setXYZ(t+1,u.x,u.y,u.z),n.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)nE.fromBufferAttribute(t,e),nE.normalize(),t.setXYZ(e,nE.x,nE.y,nE.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new WT(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new rE,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const iE=new jS,sE=new BS,oE=new kS,aE=new cS,lE=new cS,uE=new cS,hE=new cS,cE=new cS,dE=new cS,pE=new cS,fE=new cS;class mE extends fT{constructor(t=new rE,e=new UT){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(i&&o){dE.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(cE.fromBufferAttribute(a,t),s?dE.addScaledVector(cE,r):dE.addScaledVector(cE.sub(e),r))}e.add(dE)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),oE.copy(n.boundingSphere),oE.applyMatrix4(i),sE.copy(t.ray).recast(t.near),!1===oE.containsPoint(sE.origin)){if(null===sE.intersectSphere(oE,aE))return;if(sE.origin.distanceToSquared(aE)>(t.far-t.near)**2)return}iE.copy(i).invert(),sE.copy(t.ray).applyMatrix4(iE),null!==n.boundingBox&&!1===sE.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,sE)}}_computeIntersections(t,e,n){let r;const i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,h=i.attributes.normal,c=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let i=0,a=c.length;i<a;i++){const a=c[i],p=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=gE(this,p,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=gE(this,s,t,n,l,u,h,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,o=c.length;i<o;i++){const o=c[i],p=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=gE(this,p,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=gE(this,s,t,n,l,u,h,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}}function gE(t,e,n,r,i,s,o,a,l,u){t.getVertexPosition(a,lE),t.getVertexPosition(l,uE),t.getVertexPosition(u,hE);const h=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;fE.copy(a),fE.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(fE);return u<n.near||u>n.far?null:{distance:u,point:fE.clone(),object:t}}(t,e,n,r,lE,uE,hE,pE);if(h){const t=new cS;CT.getBarycoord(pE,lE,uE,hE,t),i&&(h.uv=CT.getInterpolatedAttribute(i,a,l,u,t,new FM)),s&&(h.uv1=CT.getInterpolatedAttribute(s,a,l,u,t,new FM)),o&&(h.normal=CT.getInterpolatedAttribute(o,a,l,u,t,new cS),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const e={a:a,b:l,c:u,normal:new cS,materialIndex:0};CT.getNormal(lE,uE,hE,e.normal),h.face=e,h.barycoord=t}return h}class yE extends rE{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],u=[],h=[];let c=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,y){const v=s/m,_=p/g,b=s/2,x=p/2,w=f/2,M=m+1,S=g+1;let T=0,E=0;const A=new cS;for(let s=0;s<S;s++){const o=s*_-x;for(let a=0;a<M;a++){const c=a*v-b;A[t]=c*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),h.push(a/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=c+e+M*t,r=c+e+M*(t+1),i=c+(e+1)+M*(t+1),s=c+(e+1)+M*t;a.push(n,r,s),a.push(r,i,s),E+=6}o.addGroup(d,E,y),d+=E,c+=T}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new YT(l,3)),this.setAttribute("normal",new YT(u,3)),this.setAttribute("uv",new YT(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new yE(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function vE(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function _E(t){const e={};for(let n=0;n<t.length;n++){const r=vE(t[n]);for(const t in r)e[t]=r[t]}return e}function bE(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:YM.workingColorSpace}const xE={clone:vE,merge:_E};class wE extends LT{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=vE(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class ME extends fT{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new jS,this.projectionMatrix=new jS,this.projectionMatrixInverse=new jS,this.coordinateSystem=SM}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const SE=new cS,TE=new FM,EE=new FM;class AE extends ME{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*NM*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*RM*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*NM*Math.atan(Math.tan(.5*RM*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){SE.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(SE.x,SE.y).multiplyScalar(-t/SE.z),SE.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(SE.x,SE.y).multiplyScalar(-t/SE.z)}getViewSize(t,e){return this.getViewBounds(t,TE,EE),e.subVectors(EE,TE)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*RM*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const CE=-90;class RE extends fT{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new AE(CE,1,t,e);r.layers=this.layers,this.add(r);const i=new AE(CE,1,t,e);i.layers=this.layers,this.add(i);const s=new AE(CE,1,t,e);s.layers=this.layers,this.add(s);const o=new AE(CE,1,t,e);o.layers=this.layers,this.add(o);const a=new AE(CE,1,t,e);a.layers=this.layers,this.add(a);const l=new AE(CE,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,r,i,s,o,a]=e;for(const t of e)this.remove(t);if(t===SM)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==TM)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,s,o,a,l,u]=this.children,h=t.getRenderTarget(),c=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(e,i),t.setRenderTarget(n,1,r),t.render(e,s),t.setRenderTarget(n,2,r),t.render(e,o),t.setRenderTarget(n,3,r),t.render(e,a),t.setRenderTarget(n,4,r),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,r),t.render(e,u),t.setRenderTarget(h,c,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class NE extends iS{constructor(t,e,n,r,i,s,o,a,l,u){super(t=void 0!==t?t:[],e=void 0!==e?e:Wx,n,r,i,s,o,a,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class PE extends aS{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new NE(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:nw}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new yE(5,5,5),i=new wE({name:"CubemapFromEquirect",uniforms:vE(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const s=new mE(r,i),o=e.minFilter;e.minFilter===iw&&(e.minFilter=nw);return new RE(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}let kE=class extends fT{constructor(){super(),this.isGroup=!0,this.type="Group"}};const OE={type:"move"};class IE{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new kE,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new kE,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new cS,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new cS),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new kE,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new cS,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new cS),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n),i=this._getHandJoint(l,r);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,u=.005;l.inputState.pinching&&o>a+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(r=e.getPose(t.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(OE)))}return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new kE;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class DE extends fT{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ZS,this.environmentIntensity=1,this.environmentRotation=new ZS,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class LE{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=xM,this.updateRanges=[],this.version=0,this.uuid=PM()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=PM()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=PM()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const UE=new cS;class FE{constructor(t,e,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)UE.fromBufferAttribute(this,e),UE.applyMatrix4(t),this.setXYZ(e,UE.x,UE.y,UE.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)UE.fromBufferAttribute(this,e),UE.applyNormalMatrix(t),this.setXYZ(e,UE.x,UE.y,UE.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)UE.fromBufferAttribute(this,e),UE.transformDirection(t),this.setXYZ(e,UE.x,UE.y,UE.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=DM(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=LM(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=LM(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=LM(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=LM(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=LM(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=DM(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=DM(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=DM(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=DM(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=LM(e,this.array),n=LM(n,this.array),r=LM(r,this.array),i=LM(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new WT(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new FE(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class zE extends LT{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new OT(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class BE extends iS{constructor(t=null,e=1,n=1,r,i,s,o,a,l=1003,u=1003,h,c){super(null,s,o,a,l,u,r,i,h,c),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jE extends WT{constructor(t,e,n,r=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const VE=new cS,GE=new cS,HE=new zM;class WE{constructor(t=new cS(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=VE.subVectors(n,e).cross(GE.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(VE),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||HE.getNormalMatrix(t),r=this.coplanarPoint(VE).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const qE=new kS,$E=new cS;class XE{constructor(t=new WE,e=new WE,n=new WE,r=new WE,i=new WE,s=new WE){this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],h=r[6],c=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],y=r[13],v=r[14],_=r[15];if(n[0].setComponents(a-i,c-l,m-d,_-g).normalize(),n[1].setComponents(a+i,c+l,m+d,_+g).normalize(),n[2].setComponents(a+s,c+u,m+p,_+y).normalize(),n[3].setComponents(a-s,c-u,m-p,_-y).normalize(),n[4].setComponents(a-o,c-h,m-f,_-v).normalize(),e===SM)n[5].setComponents(a+o,c+h,m+f,_+v).normalize();else{if(e!==TM)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,h,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),qE.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),qE.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(qE)}intersectsSprite(t){return qE.center.set(0,0,0),qE.radius=.7071067811865476,qE.applyMatrix4(t.matrixWorld),this.intersectsSphere(qE)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if($E.x=r.normal.x>0?t.max.x:t.min.x,$E.y=r.normal.y>0?t.max.y:t.min.y,$E.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint($E)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class YE extends LT{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new OT(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const KE=new cS,ZE=new cS,JE=new jS,QE=new BS,tA=new kS,eA=new cS,nA=new cS;function rA(t,e,n,r,i,s,o){const a=t.geometry.attributes.position;KE.fromBufferAttribute(a,i),ZE.fromBufferAttribute(a,s);if(n.distanceSqToSegment(KE,ZE,eA,nA)>r)return;eA.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(eA);return l<e.near||l>e.far?void 0:{distance:l,point:nA.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}class iA extends LT{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new OT(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class sA extends iS{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Qx,this.minFilter=Qx,this.generateMipmaps=!1,this.needsUpdate=!0}}class oA extends iS{constructor(t,e,n,r,i,s,o,a,l,u=1026){if(u!==ww&&u!==Mw)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===ww&&(n=hw),void 0===n&&u===Mw&&(n=mw),super(null,r,i,s,o,a,u,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:Qx,this.minFilter=void 0!==a?a:Qx,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class aA{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const u=n[r];return(r+(s-u)/(n[r+1]-u))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new FM:new cS);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new cS,r=[],i=[],s=[],o=new cS,a=new jS;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new cS)}i[0]=new cS,s[0]=new cS;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),c=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),c<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(kM(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(kM(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class lA extends aA{constructor(t=0,e=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new FM){const n=e,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function uA(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,u=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,u*=o,i(e,n,l,u)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}const hA=new cS,cA=new uA,dA=new uA,pA=new uA;function fA(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function mA(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function gA(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}class yA extends aA{constructor(t=new cS,e=new cS,n=new cS,r=new cS){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new cS){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(gA(t,r.x,i.x,s.x,o.x),gA(t,r.y,i.y,s.y,o.y),gA(t,r.z,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class vA extends aA{constructor(t=new cS,e=new cS,n=new cS){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new cS){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(mA(t,r.x,i.x,s.x),mA(t,r.y,i.y,s.y),mA(t,r.z,i.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}var _A=Object.freeze({__proto__:null,ArcCurve:class extends lA{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends aA{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new cS){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?o=r[(l-1)%i]:(hA.subVectors(r[0],r[1]).add(r[0]),o=hA);const h=r[l%i],c=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(hA.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=hA),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(c),t),r=Math.pow(c.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),cA.initNonuniformCatmullRom(o.x,h.x,c.x,a.x,e,n,r),dA.initNonuniformCatmullRom(o.y,h.y,c.y,a.y,e,n,r),pA.initNonuniformCatmullRom(o.z,h.z,c.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(cA.initCatmullRom(o.x,h.x,c.x,a.x,this.tension),dA.initCatmullRom(o.y,h.y,c.y,a.y,this.tension),pA.initCatmullRom(o.z,h.z,c.z,a.z,this.tension));return n.set(cA.calc(u),dA.calc(u),pA.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new cS).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:class extends aA{constructor(t=new FM,e=new FM,n=new FM,r=new FM){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new FM){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(gA(t,r.x,i.x,s.x,o.x),gA(t,r.y,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},CubicBezierCurve3:yA,EllipseCurve:lA,LineCurve:class extends aA{constructor(t=new FM,e=new FM){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new FM){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new FM){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},LineCurve3:class extends aA{constructor(t=new cS,e=new cS){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new cS){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new cS){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:class extends aA{constructor(t=new FM,e=new FM,n=new FM){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new FM){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(mA(t,r.x,i.x,s.x),mA(t,r.y,i.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve3:vA,SplineCurve:class extends aA{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new FM){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],h=r[s>r.length-3?r.length-1:s+2];return n.set(fA(o,a.x,l.x,u.x,h.x),fA(o,a.y,l.y,u.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new FM).fromArray(n))}return this}}});class bA extends rE{constructor(t=1,e=1,n=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const u=[],h=[],c=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,s=new FM,f=new cS;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=r;t++)h.push(0,m*_,0),c.push(0,_,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=v*i,f.y=m*_,f.z=v*n,h.push(f.x,f.y,f.z),c.push(0,_,0),s.x=.5*n+.5,s.y=.5*i*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=b+t;!0===n?u.push(r,r+1,e):u.push(r+1,r,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const s=new cS,y=new cS;let v=0;const _=(e-t)/n;for(let l=0;l<=i;l++){const u=[],g=l/i,v=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);y.x=v*l,y.y=-g*n+m,y.z=v*f,h.push(y.x,y.y,y.z),s.set(l,_,f).normalize(),c.push(s.x,s.y,s.z),d.push(e,1-g),u.push(p++)}f.push(u)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const s=f[r][n],o=f[r+1][n],a=f[r+1][n+1],l=f[r][n+1];(t>0||0!==r)&&(u.push(s,o,l),v+=3),(e>0||r!==i-1)&&(u.push(o,a,l),v+=3)}l.addGroup(g,v,0),g+=v}(),!1===s&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new YT(h,3)),this.setAttribute("normal",new YT(c,3)),this.setAttribute("uv",new YT(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bA(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class xA extends bA{constructor(t=1,e=1,n=32,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(t){return new xA(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class wA extends rE{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,u=a+1,h=t/o,c=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<u;t++){const e=t*c-s;for(let n=0;n<l;n++){const r=n*h-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new YT(p,3)),this.setAttribute("normal",new YT(f,3)),this.setAttribute("uv",new YT(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wA(t.width,t.height,t.widthSegments,t.heightSegments)}}class MA extends rE{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const u=[],h=new cS,c=new cS,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let v=0;0===d&&0===s?v=.5/e:d===n&&a===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const a=n/e;h.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),h.y=t*Math.cos(s+y*o),h.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),p.push(h.x,h.y,h.z),c.copy(h).normalize(),f.push(c.x,c.y,c.z),m.push(a+v,1-y),g.push(l++)}u.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=u[t][r+1],i=u[t][r],o=u[t+1][r],l=u[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new YT(p,3)),this.setAttribute("normal",new YT(f,3)),this.setAttribute("uv",new YT(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new MA(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class SA extends rE{constructor(t=new vA(new cS(-1,-1,0),new cS(-1,1,0),new cS(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new cS,a=new cS,l=new FM;let u=new cS;const h=[],c=[],d=[],p=[];function f(i){u=t.getPointAt(i/e,u);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),c.push(a.x,a.y,a.z),o.x=u.x+n*a.x,o.y=u.y+n*a.y,o.z=u.z+n*a.z,h.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new YT(h,3)),this.setAttribute("normal",new YT(c,3)),this.setAttribute("uv",new YT(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new SA((new _A[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class TA extends LT{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new OT(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class EA extends LT{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new OT(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new OT(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ZS,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class AA extends EA{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new FM(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return kM(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new OT(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new OT(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new OT(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class CA extends LT{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new OT(16777215),this.specular=new OT(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new OT(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ZS,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class RA extends LT{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new OT(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new OT(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class NA extends LT{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class PA extends LT{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new OT(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new OT(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ZS,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class kA extends LT{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class OA extends LT{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class IA extends LT{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new OT(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new FM(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class DA extends YE{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const LA={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class UA{constructor(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}}const FA=new UA;class zA{constructor(t){this.manager=void 0!==t?t:FA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}zA.DEFAULT_MATERIAL_NAME="__DEFAULT";class BA extends zA{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=LA.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=VM("img");function a(){u(),LA.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){u(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function u(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}class jA extends fT{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new OT(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class VA extends jA{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(fT.DEFAULT_UP),this.updateMatrix(),this.groundColor=new OT(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const GA=new jS,HA=new cS,WA=new cS;class qA{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new FM(512,512),this.map=null,this.mapPass=null,this.matrix=new jS,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new XE,this._frameExtents=new FM(1,1),this._viewportCount=1,this._viewports=[new sS(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;HA.setFromMatrixPosition(t.matrixWorld),e.position.copy(HA),WA.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(WA),e.updateMatrixWorld(),GA.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GA),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(GA)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class $A extends qA{constructor(){super(new AE(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*NM*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class XA extends jA{constructor(t,e,n=0,r=Math.PI/3,i=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(fT.DEFAULT_UP),this.updateMatrix(),this.target=new fT,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new $A}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const YA=new jS,KA=new cS,ZA=new cS;class JA extends qA{constructor(){super(new AE(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new FM(4,2),this._viewportCount=6,this._viewports=[new sS(2,1,1,1),new sS(0,1,1,1),new sS(3,1,1,1),new sS(1,1,1,1),new sS(3,0,1,1),new sS(1,0,1,1)],this._cubeDirections=[new cS(1,0,0),new cS(-1,0,0),new cS(0,0,1),new cS(0,0,-1),new cS(0,1,0),new cS(0,-1,0)],this._cubeUps=[new cS(0,1,0),new cS(0,1,0),new cS(0,1,0),new cS(0,1,0),new cS(0,0,1),new cS(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),KA.setFromMatrixPosition(t.matrixWorld),n.position.copy(KA),ZA.copy(n.position),ZA.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(ZA),n.updateMatrixWorld(),r.makeTranslation(-KA.x,-KA.y,-KA.z),YA.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(YA)}}class QA extends jA{constructor(t,e,n=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new JA}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class tC extends ME{constructor(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class eC extends qA{constructor(){super(new tC(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nC extends jA{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(fT.DEFAULT_UP),this.updateMatrix(),this.target=new fT,this.shadow=new eC}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class rC extends jA{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class iC extends jA{constructor(t,e,n=10,r=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class sC{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new cS)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}class oC extends jA{constructor(t=new sC,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class aC extends AE{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t,this.index=0}}class lC{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=uC(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=uC();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function uC(){return performance.now()}class hC extends LE{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}const cC=new jS;class dC{constructor(t,e,n=0,r=1/0){this.ray=new BS(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new JS,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return cC.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(cC),this}intersectObject(t,e=!0,n=[]){return fC(t,this,n,e),n.sort(pC),n}intersectObjects(t,e=!0,n=[]){for(let r=0,i=t.length;r<i;r++)fC(t[r],this,n,e);return n.sort(pC),n}}function pC(t,e){return t.distance-e.distance}function fC(t,e,n,r){let i=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(i=!1)}if(!0===i&&!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)fC(r[t],e,n,!0)}}class mC{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=kM(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(kM(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class gC{constructor(t,e,n,r){gC.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let n=0;n<4;n++)this.elements[n]=t[n+e];return this}set(t,e,n,r){const i=this.elements;return i[0]=t,i[2]=e,i[1]=n,i[3]=r,this}}class yC extends EM{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function vC(t,e,n,r){const i=function(t){switch(t){case sw:case ow:return{byteLength:1,components:1};case lw:case aw:case dw:return{byteLength:2,components:1};case pw:case fw:return{byteLength:2,components:4};case hw:case uw:case cw:return{byteLength:4,components:1};case gw:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}(r);switch(n){case yw:case bw:return t*e;case xw:return t*e*2;case Sw:case Tw:return t*e/i.components*i.byteLength;case Ew:case Aw:return t*e*2/i.components*i.byteLength;case vw:return t*e*3/i.components*i.byteLength;case _w:case Cw:return t*e*4/i.components*i.byteLength;case Rw:case Nw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Pw:case kw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Iw:case Lw:return Math.max(t,16)*Math.max(e,8)/4;case Ow:case Dw:return Math.max(t,8)*Math.max(e,8)/2;case Uw:case Fw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case zw:case Bw:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case jw:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case Vw:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case Gw:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case Hw:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case Ww:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case qw:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case $w:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case Xw:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case Yw:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case Kw:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case Zw:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case Jw:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case Qw:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case tM:case eM:case nM:return Math.ceil(t/4)*Math.ceil(e/4)*16;case rM:case iM:return Math.ceil(t/4)*Math.ceil(e/4)*8;case sM:case oM:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function _C(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function bC(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);r&&(t.deleteBuffer(r.buffer),e.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=e.get(n);if(void 0===i)e.set(n,function(e,n){const r=e.array,i=e.usage,s=r.byteLength,o=t.createBuffer();let a;if(t.bindBuffer(n,o),t.bufferData(n,r,i),e.onUploadCallback(),r instanceof Float32Array)a=t.FLOAT;else if(r instanceof Uint16Array)a=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=t.SHORT;else if(r instanceof Uint32Array)a=t.UNSIGNED_INT;else if(r instanceof Int32Array)a=t.INT;else if(r instanceof Int8Array)a=t.BYTE;else if(r instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:s}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,r){const i=n.array,s=n.updateRanges;if(t.bindBuffer(r,e),0===s.length)t.bufferSubData(r,0,i);else{s.sort(((t,e)=>t.start-e.start));let e=0;for(let t=1;t<s.length;t++){const n=s[e],r=s[t];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++e,s[e]=r)}s.length=e+1;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:lx}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=lx);const xC={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},wC={common:{diffuse:{value:new OT(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new zM},alphaMap:{value:null},alphaMapTransform:{value:new zM},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new zM}},envmap:{envMap:{value:null},envMapRotation:{value:new zM},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new zM}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new zM}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new zM},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new zM},normalScale:{value:new FM(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new zM},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new zM}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new zM}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new zM}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new OT(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new OT(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new zM},alphaTest:{value:0},uvTransform:{value:new zM}},sprite:{diffuse:{value:new OT(16777215)},opacity:{value:1},center:{value:new FM(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new zM},alphaMap:{value:null},alphaMapTransform:{value:new zM},alphaTest:{value:0}}},MC={basic:{uniforms:_E([wC.common,wC.specularmap,wC.envmap,wC.aomap,wC.lightmap,wC.fog]),vertexShader:xC.meshbasic_vert,fragmentShader:xC.meshbasic_frag},lambert:{uniforms:_E([wC.common,wC.specularmap,wC.envmap,wC.aomap,wC.lightmap,wC.emissivemap,wC.bumpmap,wC.normalmap,wC.displacementmap,wC.fog,wC.lights,{emissive:{value:new OT(0)}}]),vertexShader:xC.meshlambert_vert,fragmentShader:xC.meshlambert_frag},phong:{uniforms:_E([wC.common,wC.specularmap,wC.envmap,wC.aomap,wC.lightmap,wC.emissivemap,wC.bumpmap,wC.normalmap,wC.displacementmap,wC.fog,wC.lights,{emissive:{value:new OT(0)},specular:{value:new OT(1118481)},shininess:{value:30}}]),vertexShader:xC.meshphong_vert,fragmentShader:xC.meshphong_frag},standard:{uniforms:_E([wC.common,wC.envmap,wC.aomap,wC.lightmap,wC.emissivemap,wC.bumpmap,wC.normalmap,wC.displacementmap,wC.roughnessmap,wC.metalnessmap,wC.fog,wC.lights,{emissive:{value:new OT(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xC.meshphysical_vert,fragmentShader:xC.meshphysical_frag},toon:{uniforms:_E([wC.common,wC.aomap,wC.lightmap,wC.emissivemap,wC.bumpmap,wC.normalmap,wC.displacementmap,wC.gradientmap,wC.fog,wC.lights,{emissive:{value:new OT(0)}}]),vertexShader:xC.meshtoon_vert,fragmentShader:xC.meshtoon_frag},matcap:{uniforms:_E([wC.common,wC.bumpmap,wC.normalmap,wC.displacementmap,wC.fog,{matcap:{value:null}}]),vertexShader:xC.meshmatcap_vert,fragmentShader:xC.meshmatcap_frag},points:{uniforms:_E([wC.points,wC.fog]),vertexShader:xC.points_vert,fragmentShader:xC.points_frag},dashed:{uniforms:_E([wC.common,wC.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xC.linedashed_vert,fragmentShader:xC.linedashed_frag},depth:{uniforms:_E([wC.common,wC.displacementmap]),vertexShader:xC.depth_vert,fragmentShader:xC.depth_frag},normal:{uniforms:_E([wC.common,wC.bumpmap,wC.normalmap,wC.displacementmap,{opacity:{value:1}}]),vertexShader:xC.meshnormal_vert,fragmentShader:xC.meshnormal_frag},sprite:{uniforms:_E([wC.sprite,wC.fog]),vertexShader:xC.sprite_vert,fragmentShader:xC.sprite_frag},background:{uniforms:{uvTransform:{value:new zM},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xC.background_vert,fragmentShader:xC.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new zM}},vertexShader:xC.backgroundCube_vert,fragmentShader:xC.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xC.cube_vert,fragmentShader:xC.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xC.equirect_vert,fragmentShader:xC.equirect_frag},distanceRGBA:{uniforms:_E([wC.common,wC.displacementmap,{referencePosition:{value:new cS},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xC.distanceRGBA_vert,fragmentShader:xC.distanceRGBA_frag},shadow:{uniforms:_E([wC.lights,wC.fog,{color:{value:new OT(0)},opacity:{value:1}}]),vertexShader:xC.shadow_vert,fragmentShader:xC.shadow_frag}};MC.physical={uniforms:_E([MC.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new zM},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new zM},clearcoatNormalScale:{value:new FM(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new zM},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new zM},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new zM},sheen:{value:0},sheenColor:{value:new OT(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new zM},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new zM},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new zM},transmissionSamplerSize:{value:new FM},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new zM},attenuationDistance:{value:0},attenuationColor:{value:new OT(0)},specularColor:{value:new OT(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new zM},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new zM},anisotropyVector:{value:new FM},anisotropyMap:{value:null},anisotropyMapTransform:{value:new zM}}]),vertexShader:xC.meshphysical_vert,fragmentShader:xC.meshphysical_frag};const SC={r:0,b:0,g:0},TC=new ZS,EC=new jS;function AC(t,e,n,r,i,s,o){const a=new OT(0);let l,u,h=!0===s?0:1,c=null,d=0,p=null;function f(t){let r=!0===t.isScene?t.background:null;if(r&&r.isTexture){r=(t.backgroundBlurriness>0?n:e).get(r)}return r}function m(e,n){e.getRGB(SC,bE(t)),r.buffers.color.setClear(SC.r,SC.g,SC.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(a,h)},render:function(e){let n=!1;const i=f(e);null===i?m(a,h):i&&i.isColor&&(m(i,1),n=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===s&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const r=f(n);r&&(r.isCubeTexture||r.mapping===Yx)?(void 0===u&&(u=new mE(new yE(1,1,1),new wE({name:"BackgroundCubeMaterial",uniforms:vE(MC.backgroundCube.uniforms),vertexShader:MC.backgroundCube.vertexShader,fragmentShader:MC.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),TC.copy(n.backgroundRotation),TC.x*=-1,TC.y*=-1,TC.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(TC.y*=-1,TC.z*=-1),u.material.uniforms.envMap.value=r,u.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(EC.makeRotationFromEuler(TC)),u.material.toneMapped=YM.getTransfer(r.colorSpace)!==cM,c===r&&d===r.version&&p===t.toneMapping||(u.material.needsUpdate=!0,c=r,d=r.version,p=t.toneMapping),u.layers.enableAll(),e.unshift(u,u.geometry,u.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new mE(new wA(2,2),new wE({name:"BackgroundMaterial",uniforms:vE(MC.background.uniforms),vertexShader:MC.background.vertexShader,fragmentShader:MC.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=YM.getTransfer(r.colorSpace)!==cM,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),c===r&&d===r.version&&p===t.toneMapping||(l.material.needsUpdate=!0,c=r,d=r.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function CC(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=u(null);let s=i,o=!1;function a(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function u(t){const e=[],r=[],i=[];for(let t=0;t<n;t++)e[t]=0,r[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:r,attributeDivisors:i,object:t,attributes:{},index:null}}function h(){const t=s.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function c(t){d(t,0)}function d(e,n){const r=s.newAttributes,i=s.enabledAttributes,o=s.attributeDivisors;r[e]=1,0===i[e]&&(t.enableVertexAttribArray(e),i[e]=1),o[e]!==n&&(t.vertexAttribDivisor(e,n),o[e]=n)}function p(){const e=s.newAttributes,n=s.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function f(e,n,r,i,s,o,a){!0===a?t.vertexAttribIPointer(e,n,r,s,o):t.vertexAttribPointer(e,n,r,i,s,o)}function m(){g(),o=!0,s!==i&&(s=i,a(s.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let y=!1;const v=function(e,n,i){const s=!0===i.wireframe;let o=r[e.id];void 0===o&&(o={},r[e.id]=o);let a=o[n.id];void 0===a&&(a={},o[n.id]=a);let l=a[s];void 0===l&&(l=u(t.createVertexArray()),a[s]=l);return l}(m,l,i);s!==v&&(s=v,a(s.object)),y=function(t,e,n,r){const i=s.attributes,o=e.attributes;let a=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){const n=i[e];let r=o[e];if(void 0===r&&("instanceMatrix"===e&&t.instanceMatrix&&(r=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(r=t.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;a++}}return s.attributesNum!==a||s.index!==r}(n,m,l,g),y&&function(t,e,n,r){const i={},o=e.attributes;let a=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){let n=o[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[e]=r,a++}}s.attributes=i,s.attributesNum=a,s.index=r}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(y||o)&&(o=!1,function(n,r,i,s){h();const o=s.attributes,a=i.getAttributes(),l=r.defaultAttributeValues;for(const r in a){const i=a[r];if(i.location>=0){let a=o[r];if(void 0===a&&("instanceMatrix"===r&&n.instanceMatrix&&(a=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(a=n.instanceColor)),void 0!==a){const r=a.normalized,o=a.itemSize,l=e.get(a);if(void 0===l)continue;const u=l.buffer,h=l.type,p=l.bytesPerElement,m=h===t.INT||h===t.UNSIGNED_INT||a.gpuType===uw;if(a.isInterleavedBufferAttribute){const e=a.data,l=e.stride,g=a.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)d(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)c(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,h,r,l*p,(g+o/i.locationSize*t)*p,m)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)d(i.location+t,a.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<i.locationSize;t++)c(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,h,r,o*p,o/i.locationSize*t*p,m)}}else if(void 0!==l){const e=l[r];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,i,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in r){const e=r[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete r[t]}},releaseStatesOfGeometry:function(t){if(void 0===r[t.id])return;const e=r[t.id];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete r[t.id]},releaseStatesOfProgram:function(t){for(const e in r){const n=r[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)l(i[t].object),delete i[t];delete n[t.id]}},initAttributes:h,enableAttribute:c,disableUnusedAttributes:p}}function RC(t,e,n){let r;function i(e,i,s){0!==s&&(t.drawArraysInstanced(r,e,i,s),n.update(i,r,s))}this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(t,i,s){if(0===s)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,t,0,i,0,s);let o=0;for(let t=0;t<s;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(t,s,o,a){if(0===o)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)i(t[e],s[e],a[e]);else{l.multiDrawArraysInstancedWEBGL(r,t,0,s,0,a,0,o);let e=0;for(let t=0;t<o;t++)e+=s[t]*a[t];n.update(e,r,1)}}}function NC(t,e,n,r){let i;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&e.has("EXT_clip_control"),h=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,textureFormatReadable:function(e){return e===_w||r.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===dw&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==sw&&r.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==cw&&!i)},precision:o,logarithmicDepthBuffer:l,reverseDepthBuffer:u,maxTextures:h,maxVertexTextures:c,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function PC(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new WE,a=new zM,l={value:null,needsUpdate:!1};function u(t,n,r,i){const s=null!==t?t.length:0;let u=null;if(0!==s){if(u=l.value,!0!==i||null===u){const e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===u||u.length<e)&&(u=new Float32Array(e));for(let e=0,n=r;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(i,a),o.normal.toArray(u,n),u[n+3]=o.constant}l.value=u,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==r||i;return i=e,r=t.length,n},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=u(t,e,0)},this.setState=function(o,a,h){const c=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!i||null===c||0===c.length||s&&!p)s?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);e.numPlanes=r,e.numIntersection=0}();else{const t=s?0:r,e=4*t;let i=f.clippingState||null;l.value=i,i=u(c,a,e,h);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function kC(t){let e=new WeakMap;function n(t,e){return e===$x?t.mapping=Wx:e===Xx&&(t.mapping=qx),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(s===$x||s===Xx){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=new PE(s.height);return o.fromEquirectangularTexture(t,i),e.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}const OC=[.125,.215,.35,.446,.526,.582],IC=20,DC=new tC,LC=new OT;let UC=null,FC=0,zC=0,BC=!1;const jC=(1+Math.sqrt(5))/2,VC=1/jC,GC=[new cS(-jC,VC,0),new cS(jC,VC,0),new cS(-VC,0,jC),new cS(VC,0,jC),new cS(0,jC,-VC),new cS(0,jC,VC),new cS(-1,1,-1),new cS(1,1,-1),new cS(-1,1,1),new cS(1,1,1)];let HC=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){UC=this._renderer.getRenderTarget(),FC=this._renderer.getActiveCubeFace(),zC=this._renderer.getActiveMipmapLevel(),BC=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=XC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=$C(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(UC,FC,zC),this._renderer.xr.enabled=BC,t.scissorTest=!1,qC(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Wx||t.mapping===qx?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),UC=this._renderer.getRenderTarget(),FC=this._renderer.getActiveCubeFace(),zC=this._renderer.getActiveMipmapLevel(),BC=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:nw,minFilter:nw,generateMipmaps:!1,type:dw,format:_w,colorSpace:uM,depthBuffer:!1},r=WC(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=WC(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],r=[];let i=t;const s=t-4+1+OC.length;for(let o=0;o<s;o++){const s=Math.pow(2,i);n.push(s);let a=1/s;o>t-4?a=OC[o-t+4-1]:0===o&&(a=0),r.push(a);const l=1/(s-2),u=-l,h=1+l,c=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,p=6,f=3,m=2,g=1,y=new Float32Array(f*p*d),v=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];y.set(r,f*p*t),v.set(c,m*p*t);const i=[t,t,t,t,t,t];_.set(i,g*p*t)}const b=new rE;b.setAttribute("position",new WT(y,f)),b.setAttribute("uv",new WT(v,m)),b.setAttribute("faceIndex",new WT(_,g)),e.push(b),i>4&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(t,e,n){const r=new Float32Array(IC),i=new cS(0,1,0),s=new wE({name:"SphericalGaussianBlur",defines:{n:IC,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:YC(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(r,t,e)}return r}_compileMaterial(t){const e=new mE(this._lodPlanes[0],t);this._renderer.compile(e,DC)}_sceneToCubeUV(t,e,n,r){const i=new AE(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,u=a.toneMapping;a.getClearColor(LC),a.toneMapping=0,a.autoClear=!1;const h=new UT({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),c=new mE(new yE,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(LC),d=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1===n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e]));const l=this._cubeSize;qC(r,n*l,e>2?l:0,l,l),a.setRenderTarget(r),d&&a.render(c,i),a.render(t,i)}c.geometry.dispose(),c.material.dispose(),a.toneMapping=u,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===Wx||t.mapping===qx;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=XC()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=$C());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new mE(this._lodPlanes[0],i);i.uniforms.envMap.value=t;const o=this._cubeSize;qC(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,DC)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const r=this._lodPlanes.length;for(let e=1;e<r;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=GC[(r-e-1)%GC.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new mE(this._lodPlanes[r],l),h=l.uniforms,c=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*c):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):IC;f>IC&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<IC;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,o&&(h.poleAxis.value=o);const{_lodMax:y}=this;h.dTheta.value=d,h.mipInt.value=y-n;const v=this._sizeLods[r];qC(e,3*v*(r>y-4?r-y+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(u,DC)}};function WC(t,e,n){const r=new aS(t,e,n);return r.texture.mapping=Yx,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function qC(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function $C(){return new wE({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:YC(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function XC(){return new wE({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:YC(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function YC(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function KC(t){let e=new WeakMap,n=null;function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,o=s===$x||s===Xx,a=s===Wx||s===qx;if(o||a){let s=e.get(i);const l=void 0!==s?s.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new HC(t)),s=o?n.fromEquirectangular(i,s):n.fromCubemap(i,s),s.texture.pmremVersion=i.pmremVersion,e.set(i,s),s.texture;if(void 0!==s)return s.texture;{const l=i.image;return o&&l&&l.height>0||a&&l&&function(t){let e=0;const n=6;for(let r=0;r<n;r++)void 0!==t[r]&&e++;return e===n}(l)?(null===n&&(n=new HC(t)),s=o?n.fromEquirectangular(i):n.fromCubemap(i),s.texture.pmremVersion=i.pmremVersion,e.set(i,s),i.addEventListener("dispose",r),s.texture):null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ZC(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&WM("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function JC(t,e,n,r){const i={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{if(void 0===i)return;{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}}const a=new(jM(n)?$T:qT)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(n){const r=n.attributes;for(const n in r)e.update(r[n],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function QC(t,e,n){let r,i,s;function o(e,o,a){0!==a&&(t.drawElementsInstanced(r,o,i,e*s,a),n.update(o,r,a))}this.setMode=function(t){r=t},this.setIndex=function(t){i=t.type,s=t.bytesPerElement},this.render=function(e,o){t.drawElements(r,o,i,e*s),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(t,s,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,s,0,i,t,0,o);let a=0;for(let t=0;t<o;t++)a+=s[t];n.update(a,r,1)},this.renderMultiDrawInstances=function(t,a,l,u){if(0===l)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<t.length;e++)o(t[e]/s,a[e],u[e]);else{h.multiDrawElementsInstancedWEBGL(r,a,0,i,t,0,u,0,l);let e=0;for(let t=0;t<l;t++)e+=a[t]*u[t];n.update(e,r,1)}}}function tR(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function eR(t,e,n){const r=new WeakMap,i=new sS;return{update:function(s,o,a){const l=s.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=void 0!==u?u.length:0;let c=r.get(o);if(void 0===c||c.count!==h){void 0!==c&&c.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let v=0;!0===d&&(v=1),!0===p&&(v=2),!0===f&&(v=3);let _=o.attributes.position.count*v,b=1;_>e.maxTextureSize&&(b=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const x=new Float32Array(_*b*4*h),w=new lS(x,_,b,h);w.type=cw,w.needsUpdate=!0;const M=4*v;for(let T=0;T<h;T++){const E=m[T],A=g[T],C=y[T],R=_*b*4*T;for(let N=0;N<E.count;N++){const P=N*M;!0===d&&(i.fromBufferAttribute(E,N),x[R+P+0]=i.x,x[R+P+1]=i.y,x[R+P+2]=i.z,x[R+P+3]=0),!0===p&&(i.fromBufferAttribute(A,N),x[R+P+4]=i.x,x[R+P+5]=i.y,x[R+P+6]=i.z,x[R+P+7]=0),!0===f&&(i.fromBufferAttribute(C,N),x[R+P+8]=i.x,x[R+P+9]=i.y,x[R+P+10]=i.z,x[R+P+11]=4===C.itemSize?i.w:1)}}function S(){w.dispose(),r.delete(o),o.removeEventListener("dispose",S)}c={count:h,texture:w,size:new FM(_,b)},r.set(o,c),o.addEventListener("dispose",S)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)a.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let k=0;for(let I=0;I<l.length;I++)k+=l[I];const O=o.morphTargetsRelative?1:1-k;a.getUniforms().setValue(t,"morphTargetBaseInfluence",O),a.getUniforms().setValue(t,"morphTargetInfluences",l)}a.getUniforms().setValue(t,"morphTargetsTexture",c.texture,n),a.getUniforms().setValue(t,"morphTargetsTextureSize",c.size)}}}function nR(t,e,n,r){let i=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(o){const a=r.render.frame,l=o.geometry,u=e.get(o,l);if(i.get(u)!==a&&(e.update(u),i.set(u,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),i.get(o)!==a&&(n.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,t.ARRAY_BUFFER),i.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;i.get(t)!==a&&(t.update(),i.set(t,a))}return u},dispose:function(){i=new WeakMap}}}const rR=new iS,iR=new oA(1,1),sR=new lS,oR=new uS,aR=new NE,lR=[],uR=[],hR=new Float32Array(16),cR=new Float32Array(9),dR=new Float32Array(4);function pR(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=lR[i];if(void 0===s&&(s=new Float32Array(i),lR[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function fR(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function mR(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function gR(t,e){let n=uR[e];void 0===n&&(n=new Int32Array(e),uR[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function yR(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function vR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(fR(n,e))return;t.uniform2fv(this.addr,e),mR(n,e)}}function _R(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(fR(n,e))return;t.uniform3fv(this.addr,e),mR(n,e)}}function bR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(fR(n,e))return;t.uniform4fv(this.addr,e),mR(n,e)}}function xR(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(fR(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),mR(n,e)}else{if(fR(n,r))return;dR.set(r),t.uniformMatrix2fv(this.addr,!1,dR),mR(n,r)}}function wR(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(fR(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),mR(n,e)}else{if(fR(n,r))return;cR.set(r),t.uniformMatrix3fv(this.addr,!1,cR),mR(n,r)}}function MR(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(fR(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),mR(n,e)}else{if(fR(n,r))return;hR.set(r),t.uniformMatrix4fv(this.addr,!1,hR),mR(n,r)}}function SR(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function TR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(fR(n,e))return;t.uniform2iv(this.addr,e),mR(n,e)}}function ER(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(fR(n,e))return;t.uniform3iv(this.addr,e),mR(n,e)}}function AR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(fR(n,e))return;t.uniform4iv(this.addr,e),mR(n,e)}}function CR(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function RR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(fR(n,e))return;t.uniform2uiv(this.addr,e),mR(n,e)}}function NR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(fR(n,e))return;t.uniform3uiv(this.addr,e),mR(n,e)}}function PR(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(fR(n,e))return;t.uniform4uiv(this.addr,e),mR(n,e)}}function kR(t,e,n){const r=this.cache,i=n.allocateTextureUnit();let s;r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),this.type===t.SAMPLER_2D_SHADOW?(iR.compareFunction=gM,s=iR):s=rR,n.setTexture2D(e||s,i)}function OR(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||oR,i)}function IR(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||aR,i)}function DR(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||sR,i)}function LR(t,e){t.uniform1fv(this.addr,e)}function UR(t,e){const n=pR(e,this.size,2);t.uniform2fv(this.addr,n)}function FR(t,e){const n=pR(e,this.size,3);t.uniform3fv(this.addr,n)}function zR(t,e){const n=pR(e,this.size,4);t.uniform4fv(this.addr,n)}function BR(t,e){const n=pR(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function jR(t,e){const n=pR(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function VR(t,e){const n=pR(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function GR(t,e){t.uniform1iv(this.addr,e)}function HR(t,e){t.uniform2iv(this.addr,e)}function WR(t,e){t.uniform3iv(this.addr,e)}function qR(t,e){t.uniform4iv(this.addr,e)}function $R(t,e){t.uniform1uiv(this.addr,e)}function XR(t,e){t.uniform2uiv(this.addr,e)}function YR(t,e){t.uniform3uiv(this.addr,e)}function KR(t,e){t.uniform4uiv(this.addr,e)}function ZR(t,e,n){const r=this.cache,i=e.length,s=gR(n,i);fR(r,s)||(t.uniform1iv(this.addr,s),mR(r,s));for(let t=0;t!==i;++t)n.setTexture2D(e[t]||rR,s[t])}function JR(t,e,n){const r=this.cache,i=e.length,s=gR(n,i);fR(r,s)||(t.uniform1iv(this.addr,s),mR(r,s));for(let t=0;t!==i;++t)n.setTexture3D(e[t]||oR,s[t])}function QR(t,e,n){const r=this.cache,i=e.length,s=gR(n,i);fR(r,s)||(t.uniform1iv(this.addr,s),mR(r,s));for(let t=0;t!==i;++t)n.setTextureCube(e[t]||aR,s[t])}function tN(t,e,n){const r=this.cache,i=e.length,s=gR(n,i);fR(r,s)||(t.uniform1iv(this.addr,s),mR(r,s));for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||sR,s[t])}class eN{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return yR;case 35664:return vR;case 35665:return _R;case 35666:return bR;case 35674:return xR;case 35675:return wR;case 35676:return MR;case 5124:case 35670:return SR;case 35667:case 35671:return TR;case 35668:case 35672:return ER;case 35669:case 35673:return AR;case 5125:return CR;case 36294:return RR;case 36295:return NR;case 36296:return PR;case 35678:case 36198:case 36298:case 36306:case 35682:return kR;case 35679:case 36299:case 36307:return OR;case 35680:case 36300:case 36308:case 36293:return IR;case 36289:case 36303:case 36311:case 36292:return DR}}(e.type)}}class nN{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return LR;case 35664:return UR;case 35665:return FR;case 35666:return zR;case 35674:return BR;case 35675:return jR;case 35676:return VR;case 5124:case 35670:return GR;case 35667:case 35671:return HR;case 35668:case 35672:return WR;case 35669:case 35673:return qR;case 5125:return $R;case 36294:return XR;case 36295:return YR;case 36296:return KR;case 35678:case 36198:case 36298:case 36306:case 35682:return ZR;case 35679:case 36299:case 36307:return JR;case 35680:case 36300:case 36308:case 36293:return QR;case 36289:case 36303:case 36311:case 36292:return tN}}(e.type)}}class rN{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}}}const iN=/(\w+)(\])?(\[|\.)?/g;function sN(t,e){t.seq.push(e),t.map[e.id]=e}function oN(t,e,n){const r=t.name,i=r.length;for(iN.lastIndex=0;;){const s=iN.exec(r),o=iN.lastIndex;let a=s[1];const l="]"===s[2],u=s[3];if(l&&(a|=0),void 0===u||"["===u&&o+2===i){sN(n,void 0===u?new eN(a,t,e):new nN(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new rN(a),sN(n,t)),n=t}}}class aN{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);oN(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)}setOptional(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)}static upload(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}}static seqWithValue(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n}}function lN(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}let uN=0;const hN=new zM;function cN(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=i;t<s;t++){const i=t+1;r.push(`${i===e?">":" "} ${i}: ${n[t]}`)}return r.join("\n")}(t.getShaderSource(e),r)}return i}function dN(t,e){const n=function(t){YM._getMatrix(hN,YM.workingColorSpace,t);const e=`mat3( ${hN.elements.map((t=>t.toFixed(4)))} )`;switch(YM.getTransfer(t)){case hM:return[e,"LinearTransferOETF"];case cM:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${t}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function pN(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const fN=new cS;function mN(){YM.getLuminanceCoefficients(fN);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${fN.x.toFixed(4)}, ${fN.y.toFixed(4)}, ${fN.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function gN(t){return""!==t}function yN(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function vN(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const _N=/^[ \t]*#include +<([\w\d./]+)>/gm;function bN(t){return t.replace(_N,wN)}const xN=new Map;function wN(t,e){let n=xC[e];if(void 0===n){const t=xN.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=xC[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return bN(n)}const MN=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function SN(t){return t.replace(MN,TN)}function TN(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function EN(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function AN(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),u=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Wx:case qx:e="ENVMAP_TYPE_CUBE";break;case Yx:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),h=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===qx&&(e="ENVMAP_MODE_REFRACTION");return e}(n),c=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(gN).join("\n")}(n),f=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),m=i.createProgram();let g,y,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(gN).join("\n"),g.length>0&&(g+="\n"),y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(gN).join("\n"),y.length>0&&(y+="\n")):(g=[EN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(gN).join("\n"),y=[EN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.envMap?"#define "+c:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?xC.tonemapping_pars_fragment:"",0!==n.toneMapping?pN("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",xC.colorspace_pars_fragment,dN("linearToOutputTexel",n.outputColorSpace),mN(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(gN).join("\n")),o=bN(o),o=yN(o,n),o=vN(o,n),a=bN(a),a=yN(a,n),a=vN(a,n),o=SN(o),a=SN(a),!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",n.glslVersion===MM?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===MM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=v+g+o,b=v+y+a,x=lN(i,i.VERTEX_SHADER,_),w=lN(i,i.FRAGMENT_SHADER,b);function M(e){if(t.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(x).trim(),s=i.getShaderInfoLog(w).trim();let o=!0,a=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(i,m,x,w);else{const t=cN(i,x,"vertex"),r=cN(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==s||(a=!1);a&&(e.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:s,prefix:y}})}i.deleteShader(x),i.deleteShader(w),S=new aN(i,m),T=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),s=r.name;let o=1;r.type===t.FLOAT_MAT2&&(o=2),r.type===t.FLOAT_MAT3&&(o=3),r.type===t.FLOAT_MAT4&&(o=4),n[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(i,m)}let S,T;i.attachShader(m,x),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===S&&M(this),S},this.getAttributes=function(){return void 0===T&&M(this),T};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=i.getProgramParameter(m,37297)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=uN++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let CN=0;class RN{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new NN(t),e.set(t,n)),n}}class NN{constructor(t){this.id=CN++,this.code=t,this.usedTimes=0}}function PN(t,e,n,r,i,s,o){const a=new JS,l=new RN,u=new Set,h=[],c=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return u.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,a,h,g,y){const v=g.fog,_=y.geometry,b=s.isMeshStandardMaterial?g.environment:null,x=(s.isMeshStandardMaterial?n:e).get(s.envMap||b),w=x&&x.mapping===Yx?x.image.height:null,M=f[s.type];null!==s.precision&&(p=i.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const S=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,T=void 0!==S?S.length:0;let E,A,C,R,N=0;if(void 0!==_.morphAttributes.position&&(N=1),void 0!==_.morphAttributes.normal&&(N=2),void 0!==_.morphAttributes.color&&(N=3),M){const t=MC[M];E=t.vertexShader,A=t.fragmentShader}else E=s.vertexShader,A=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const P=t.getRenderTarget(),k=t.state.buffers.depth.getReversed(),O=!0===y.isInstancedMesh,I=!0===y.isBatchedMesh,D=!!s.map,L=!!s.matcap,U=!!x,F=!!s.aoMap,z=!!s.lightMap,B=!!s.bumpMap,j=!!s.normalMap,V=!!s.displacementMap,G=!!s.emissiveMap,H=!!s.metalnessMap,W=!!s.roughnessMap,q=s.anisotropy>0,$=s.clearcoat>0,X=s.dispersion>0,Y=s.iridescence>0,K=s.sheen>0,Z=s.transmission>0,J=q&&!!s.anisotropyMap,Q=$&&!!s.clearcoatMap,tt=$&&!!s.clearcoatNormalMap,et=$&&!!s.clearcoatRoughnessMap,nt=Y&&!!s.iridescenceMap,rt=Y&&!!s.iridescenceThicknessMap,it=K&&!!s.sheenColorMap,st=K&&!!s.sheenRoughnessMap,ot=!!s.specularMap,at=!!s.specularColorMap,lt=!!s.specularIntensityMap,ut=Z&&!!s.transmissionMap,ht=Z&&!!s.thicknessMap,ct=!!s.gradientMap,dt=!!s.alphaMap,pt=s.alphaTest>0,ft=!!s.alphaHash,mt=!!s.extensions;let gt=0;s.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(gt=t.toneMapping));const yt={shaderID:M,shaderType:s.type,shaderName:s.name,vertexShader:E,fragmentShader:A,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:I,batchingColor:I&&null!==y._colorsTexture,instancing:O,instancingColor:O&&null!==y.instanceColor,instancingMorph:O&&null!==y.morphTexture,supportsVertexTextures:d,outputColorSpace:null===P?t.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:uM,alphaToCoverage:!!s.alphaToCoverage,map:D,matcap:L,envMap:U,envMapMode:U&&x.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:z,bumpMap:B,normalMap:j,displacementMap:d&&V,emissiveMap:G,normalMapObjectSpace:j&&1===s.normalMapType,normalMapTangentSpace:j&&0===s.normalMapType,metalnessMap:H,roughnessMap:W,anisotropy:q,anisotropyMap:J,clearcoat:$,clearcoatMap:Q,clearcoatNormalMap:tt,clearcoatRoughnessMap:et,dispersion:X,iridescence:Y,iridescenceMap:nt,iridescenceThicknessMap:rt,sheen:K,sheenColorMap:it,sheenRoughnessMap:st,specularMap:ot,specularColorMap:at,specularIntensityMap:lt,transmission:Z,transmissionMap:ut,thicknessMap:ht,gradientMap:ct,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:dt,alphaTest:pt,alphaHash:ft,combine:s.combine,mapUv:D&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:z&&m(s.lightMap.channel),bumpMapUv:B&&m(s.bumpMap.channel),normalMapUv:j&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:G&&m(s.emissiveMap.channel),metalnessMapUv:H&&m(s.metalnessMap.channel),roughnessMapUv:W&&m(s.roughnessMap.channel),anisotropyMapUv:J&&m(s.anisotropyMap.channel),clearcoatMapUv:Q&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:tt&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:rt&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:it&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:st&&m(s.sheenRoughnessMap.channel),specularMapUv:ot&&m(s.specularMap.channel),specularColorMapUv:at&&m(s.specularColorMap.channel),specularIntensityMapUv:lt&&m(s.specularIntensityMap.channel),transmissionMapUv:ut&&m(s.transmissionMap.channel),thicknessMapUv:ht&&m(s.thicknessMap.channel),alphaMapUv:dt&&m(s.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(j||q),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(D||dt),fog:!!v,useFog:!0===s.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:c,reverseDepthBuffer:k,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:T,morphTextureStride:N,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,decodeVideoTexture:D&&!0===s.map.isVideoTexture&&YM.getTransfer(s.map.colorSpace)===cM,decodeVideoTextureEmissive:G&&!0===s.emissiveMap.isVideoTexture&&YM.getTransfer(s.emissiveMap.colorSpace)===cM,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:mt&&!0===s.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mt&&!0===s.extensions.multiDraw||I)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return yt.vertexUv1s=u.has(1),yt.vertexUv2s=u.has(2),yt.vertexUv3s=u.has(3),u.clear(),yt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){a.disableAll(),e.supportsVertexTextures&&a.enable(0);e.instancing&&a.enable(1);e.instancingColor&&a.enable(2);e.instancingMorph&&a.enable(3);e.matcap&&a.enable(4);e.envMap&&a.enable(5);e.normalMapObjectSpace&&a.enable(6);e.normalMapTangentSpace&&a.enable(7);e.clearcoat&&a.enable(8);e.iridescence&&a.enable(9);e.alphaTest&&a.enable(10);e.vertexColors&&a.enable(11);e.vertexAlphas&&a.enable(12);e.vertexUv1s&&a.enable(13);e.vertexUv2s&&a.enable(14);e.vertexUv3s&&a.enable(15);e.vertexTangents&&a.enable(16);e.anisotropy&&a.enable(17);e.alphaHash&&a.enable(18);e.batching&&a.enable(19);e.dispersion&&a.enable(20);e.batchingColor&&a.enable(21);t.push(a.mask),a.disableAll(),e.fog&&a.enable(0);e.useFog&&a.enable(1);e.flatShading&&a.enable(2);e.logarithmicDepthBuffer&&a.enable(3);e.reverseDepthBuffer&&a.enable(4);e.skinning&&a.enable(5);e.morphTargets&&a.enable(6);e.morphNormals&&a.enable(7);e.morphColors&&a.enable(8);e.premultipliedAlpha&&a.enable(9);e.shadowMapEnabled&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.useDepthPacking&&a.enable(13);e.dithering&&a.enable(14);e.transmission&&a.enable(15);e.sheen&&a.enable(16);e.opaque&&a.enable(17);e.pointsUvs&&a.enable(18);e.decodeVideoTexture&&a.enable(19);e.decodeVideoTextureEmissive&&a.enable(20);e.alphaToCoverage&&a.enable(21);t.push(a.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=MC[e];n=xE.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new AN(t,n,e,s),h.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:h,dispose:function(){l.dispose()}}}function kN(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function ON(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function IN(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function DN(){const t=[];let e=0;const n=[],r=[],i=[];function s(n,r,i,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){e=0,n.length=0,r.length=0,i.length=0},push:function(t,e,o,a,l,u){const h=s(t,e,o,a,l,u);o.transmission>0?r.push(h):!0===o.transparent?i.push(h):n.push(h)},unshift:function(t,e,o,a,l,u){const h=s(t,e,o,a,l,u);o.transmission>0?r.unshift(h):!0===o.transparent?i.unshift(h):n.unshift(h)},finish:function(){for(let n=e,r=t.length;n<r;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ON),r.length>1&&r.sort(e||IN),i.length>1&&i.sort(e||IN)}}}function LN(){let t=new WeakMap;return{get:function(e,n){const r=t.get(e);let i;return void 0===r?(i=new DN,t.set(e,[i])):n>=r.length?(i=new DN,r.push(i)):i=r[n],i},dispose:function(){t=new WeakMap}}}function UN(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new cS,color:new OT};break;case"SpotLight":n={position:new cS,direction:new cS,color:new OT,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new cS,color:new OT,distance:0,decay:0};break;case"HemisphereLight":n={direction:new cS,skyColor:new OT,groundColor:new OT};break;case"RectAreaLight":n={color:new OT,position:new cS,halfWidth:new cS,halfHeight:new cS}}return t[e.id]=n,n}}}let FN=0;function zN(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function BN(t){const e=new UN,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new FM};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new FM,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new cS);const i=new cS,s=new jS,o=new jS;return{setup:function(i){let s=0,o=0,a=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let l=0,u=0,h=0,c=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0;i.sort(zN);for(let t=0,_=i.length;t<_;t++){const _=i[t],b=_.color,x=_.intensity,w=_.distance,M=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=b.r*x,o+=b.g*x,a+=b.b*x;else if(_.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(_.sh.coefficients[t],x);v++}else if(_.isDirectionalLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,r.directionalShadow[l]=e,r.directionalShadowMap[l]=M,r.directionalShadowMatrix[l]=_.shadow.matrix,p++}r.directional[l]=t,l++}else if(_.isSpotLight){const t=e.get(_);t.position.setFromMatrixPosition(_.matrixWorld),t.color.copy(b).multiplyScalar(x),t.distance=w,t.coneCos=Math.cos(_.angle),t.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),t.decay=_.decay,r.spot[h]=t;const i=_.shadow;if(_.map&&(r.spotLightMap[g]=_.map,g++,i.updateMatrices(_),_.castShadow&&y++),r.spotLightMatrix[h]=i.matrix,_.castShadow){const t=n.get(_);t.shadowIntensity=i.intensity,t.shadowBias=i.bias,t.shadowNormalBias=i.normalBias,t.shadowRadius=i.radius,t.shadowMapSize=i.mapSize,r.spotShadow[h]=t,r.spotShadowMap[h]=M,m++}h++}else if(_.isRectAreaLight){const t=e.get(_);t.color.copy(b).multiplyScalar(x),t.halfWidth.set(.5*_.width,0,0),t.halfHeight.set(0,.5*_.height,0),r.rectArea[c]=t,c++}else if(_.isPointLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),t.distance=_.distance,t.decay=_.decay,_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,r.pointShadow[u]=e,r.pointShadowMap[u]=M,r.pointShadowMatrix[u]=_.shadow.matrix,f++}r.point[u]=t,u++}else if(_.isHemisphereLight){const t=e.get(_);t.skyColor.copy(_.color).multiplyScalar(x),t.groundColor.copy(_.groundColor).multiplyScalar(x),r.hemi[d]=t,d++}}c>0&&(!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=wC.LTC_FLOAT_1,r.rectAreaLTC2=wC.LTC_FLOAT_2):(r.rectAreaLTC1=wC.LTC_HALF_1,r.rectAreaLTC2=wC.LTC_HALF_2)),r.ambient[0]=s,r.ambient[1]=o,r.ambient[2]=a;const _=r.hash;_.directionalLength===l&&_.pointLength===u&&_.spotLength===h&&_.rectAreaLength===c&&_.hemiLength===d&&_.numDirectionalShadows===p&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===v||(r.directional.length=l,r.spot.length=h,r.rectArea.length=c,r.point.length=u,r.hemi.length=d,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-y,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=y,r.numLightProbes=v,_.directionalLength=l,_.pointLength=u,_.spotLength=h,_.rectAreaLength=c,_.hemiLength=d,_.numDirectionalShadows=p,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=v,r.version=FN++)},setupView:function(t,e){let n=0,a=0,l=0,u=0,h=0;const c=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(c),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(c),t.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(c),l++}else if(d.isRectAreaLight){const t=r.rectArea[u];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(c),o.identity(),s.copy(d.matrixWorld),s.premultiply(c),o.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),u++}else if(d.isPointLight){const t=r.point[a];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(c),a++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(c),h++}}},state:r}}function jN(t){const e=new BN(t),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){i.camera=t,n.length=0,r.length=0},state:i,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function VN(t){let e=new WeakMap;return{get:function(n,r=0){const i=e.get(n);let s;return void 0===i?(s=new jN(t),e.set(n,[s])):r>=i.length?(s=new jN(t),i.push(s)):s=i[r],s},dispose:function(){e=new WeakMap}}}function GN(t,e,n){let r=new XE;const i=new FM,s=new FM,o=new sS,a=new kA({depthPacking:3201}),l=new OA,u={},h=n.maxTextureSize,c={[gx]:1,[yx]:0,[vx]:2},d=new wE({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new FM},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new rE;f.setAttribute("position",new WT(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new mE(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let y=this.type;function v(n,r){const s=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new aS(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,s,p,m,null)}function _(e,n,r,i){let s=null;const o=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let r=u[t];void 0===r&&(r={},u[t]=r);let i=r[e];void 0===i&&(i=s.clone(),r[e]=i,n.addEventListener("dispose",x)),s=i}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial){t.properties.get(s).light=r}return s}function b(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),l=n.material;if(Array.isArray(l)){const e=r.groups;for(let u=0,h=e.length;u<h;u++){const h=e[u],c=l[h.materialIndex];if(c&&c.visible){const e=_(n,c,o,a);n.onBeforeShadow(t,n,i,s,r,e,h),t.renderBufferDirect(s,null,r,e,n,h),n.onAfterShadow(t,n,i,s,r,e,h)}}}else if(l.visible){const e=_(n,l,o,a);n.onBeforeShadow(t,n,i,s,r,e,null),t.renderBufferDirect(s,null,r,e,n,null),n.onAfterShadow(t,n,i,s,r,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],i,s,o,a)}function x(t){t.target.removeEventListener("dispose",x);for(const e in u){const n=u[e],r=t.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(e,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),u=t.getActiveCubeFace(),c=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==y&&3===this.type,f=3===y&&3!==this.type;for(let l=0,u=e.length;l<u;l++){const u=e[l],c=u.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);const m=c.getFrameExtents();if(i.multiply(m),s.copy(c.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/m.x),i.x=s.x*m.x,c.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/m.y),i.y=s.y*m.y,c.mapSize.y=s.y)),null===c.map||!0===p||!0===f){const t=3!==this.type?{minFilter:Qx,magFilter:Qx}:{};null!==c.map&&c.map.dispose(),c.map=new aS(i.x,i.y,t),c.map.texture.name=u.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const g=c.getViewportCount();for(let t=0;t<g;t++){const e=c.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),c.updateMatrices(u,t),r=c.getFrustum(),b(n,a,c.camera,u,this.type)}!0!==c.isPointLightShadow&&3===this.type&&v(c,a),c.needsUpdate=!1}y=this.type,g.needsUpdate=!1,t.setRenderTarget(l,u,c)}}const HN={[Ux]:1,[zx]:6,[jx]:7,[Bx]:5,[Fx]:0,[Gx]:2,[Hx]:4,[Vx]:3};function WN(t,e){const n=new function(){let e=!1;const n=new sS;let r=null;const i=new sS(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,s=null,o=null;return{setReversed:function(t){if(r!==t){const t=e.get("EXT_clip_control");r?t.clipControlEXT(t.LOWER_LEFT_EXT,t.ZERO_TO_ONE_EXT):t.clipControlEXT(t.LOWER_LEFT_EXT,t.NEGATIVE_ONE_TO_ONE_EXT);const n=o;o=null,this.setClear(n)}r=t},getReversed:function(){return r},setTest:function(e){e?B(t.DEPTH_TEST):j(t.DEPTH_TEST)},setMask:function(e){i===e||n||(t.depthMask(e),i=e)},setFunc:function(e){if(r&&(e=HN[e]),s!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}s=e}},setLocked:function(t){n=t},setClear:function(e){o!==e&&(r&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){n=!1,i=null,s=null,o=null,r=!1}}},i=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,u=null;return{setTest:function(n){e||(n?B(t.STENCIL_TEST):j(t.STENCIL_TEST))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,u=null}}},s=new WeakMap,o=new WeakMap;let a={},l={},u=new WeakMap,h=[],c=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=new OT(0,0,0),x=0,w=!1,M=null,S=null,T=null,E=null,A=null;const C=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,N=0;const P=t.getParameter(t.VERSION);-1!==P.indexOf("WebGL")?(N=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=N>=1):-1!==P.indexOf("OpenGL ES")&&(N=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=N>=2);let k=null,O={};const I=t.getParameter(t.SCISSOR_BOX),D=t.getParameter(t.VIEWPORT),L=(new sS).fromArray(I),U=(new sS).fromArray(D);function F(e,n,r,i){const s=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<r;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,i,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(n+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return o}const z={};function B(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function j(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}z[t.TEXTURE_2D]=F(t.TEXTURE_2D,t.TEXTURE_2D,1),z[t.TEXTURE_CUBE_MAP]=F(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),z[t.TEXTURE_2D_ARRAY]=F(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),z[t.TEXTURE_3D]=F(t.TEXTURE_3D,t.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),B(t.DEPTH_TEST),r.setFunc(3),W(!1),q(1),B(t.CULL_FACE),H(0);const V={[_x]:t.FUNC_ADD,[bx]:t.FUNC_SUBTRACT,[xx]:t.FUNC_REVERSE_SUBTRACT};V[103]=t.MIN,V[104]=t.MAX;const G={[wx]:t.ZERO,[Mx]:t.ONE,[Sx]:t.SRC_COLOR,[Ex]:t.SRC_ALPHA,[kx]:t.SRC_ALPHA_SATURATE,[Nx]:t.DST_COLOR,[Cx]:t.DST_ALPHA,[Tx]:t.ONE_MINUS_SRC_COLOR,[Ax]:t.ONE_MINUS_SRC_ALPHA,[Px]:t.ONE_MINUS_DST_COLOR,[Rx]:t.ONE_MINUS_DST_ALPHA,[Ox]:t.CONSTANT_COLOR,[Ix]:t.ONE_MINUS_CONSTANT_COLOR,[Dx]:t.CONSTANT_ALPHA,[Lx]:t.ONE_MINUS_CONSTANT_ALPHA};function H(e,n,r,i,s,o,a,l,u,h){if(0!==e){if(!1===d&&(B(t.BLEND),d=!0),5===e)s=s||n,o=o||r,a=a||i,n===f&&s===y||(t.blendEquationSeparate(V[n],V[s]),f=n,y=s),r===m&&i===g&&o===v&&a===_||(t.blendFuncSeparate(G[r],G[i],G[o],G[a]),m=r,g=i,v=o,_=a),!1!==l.equals(b)&&u===x||(t.blendColor(l.r,l.g,l.b,u),b.copy(l),x=u),p=e,w=!1;else if(e!==p||h!==w){if(f===_x&&y===_x||(t.blendEquation(t.FUNC_ADD),f=_x,y=_x),h)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,v=null,_=null,b.set(0,0,0),x=0,p=e,w=h}}else!0===d&&(j(t.BLEND),d=!1)}function W(e){M!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),M=e)}function q(e){0!==e?(B(t.CULL_FACE),e!==S&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):j(t.CULL_FACE),S=e}function $(e,n,r){e?(B(t.POLYGON_OFFSET_FILL),E===n&&A===r||(t.polygonOffset(n,r),E=n,A=r)):j(t.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:B,disable:j,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,e===t.DRAW_FRAMEBUFFER&&(l[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(l[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let r=h,i=!1;if(e){r=u.get(n),void 0===r&&(r=[],u.set(n,r));const s=e.textures;if(r.length!==s.length||r[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=s.length;e<n;e++)r[e]=t.COLOR_ATTACHMENT0+e;r.length=s.length,i=!0}}else r[0]!==t.BACK&&(r[0]=t.BACK,i=!0);i&&t.drawBuffers(r)},useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:H,setMaterial:function(e,s){2===e.side?j(t.CULL_FACE):B(t.CULL_FACE);let o=1===e.side;s&&(o=!o),W(o),1===e.blending&&!1===e.transparent?H(0):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),n.setMask(e.colorWrite);const a=e.stencilWrite;i.setTest(a),a&&(i.setMask(e.stencilWriteMask),i.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),i.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),$(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(t.SAMPLE_ALPHA_TO_COVERAGE):j(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:q,setLineWidth:function(e){e!==T&&(R&&t.lineWidth(e),T=e)},setPolygonOffset:$,setScissorTest:function(e){e?B(t.SCISSOR_TEST):j(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+C-1),k!==e&&(t.activeTexture(e),k=e)},bindTexture:function(e,n,r){void 0===r&&(r=null===k?t.TEXTURE0+C-1:k);let i=O[r];void 0===i&&(i={type:void 0,texture:void 0},O[r]=i),i.type===e&&i.texture===n||(k!==r&&(t.activeTexture(r),k=r),t.bindTexture(e,n||z[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=O[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(e);void 0===i&&(i=t.getUniformBlockIndex(n,e.name),r.set(e,i))},uniformBlockBinding:function(e,n){const r=o.get(n).get(e);s.get(n)!==r&&(t.uniformBlockBinding(n,r,e.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===L.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===U.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),U.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),r.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},k=null,O={},l={},u=new WeakMap,h=[],c=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=new OT(0,0,0),x=0,w=!1,M=null,S=null,T=null,E=null,A=null,L.set(0,0,t.canvas.width,t.canvas.height),U.set(0,0,t.canvas.width,t.canvas.height),n.reset(),r.reset(),i.reset()}}}function qN(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new FM,h=new WeakMap;let c;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):VM("canvas")}function m(t,e,n){let r=1;const i=j(t);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(r*i.width),s=Math.floor(r*i.height);void 0===c&&(c=f(n,s));const o=e?f(n,s):c;o.width=n,o.height=s;return o.getContext("2d").drawImage(t,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+s+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),t}return t}function g(t){return t.generateMipmaps}function y(e){t.generateMipmap(e)}function v(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function _(n,r,i,s,o=!1){if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=r;if(r===t.RED&&(i===t.FLOAT&&(a=t.R32F),i===t.HALF_FLOAT&&(a=t.R16F),i===t.UNSIGNED_BYTE&&(a=t.R8)),r===t.RED_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.R8UI),i===t.UNSIGNED_SHORT&&(a=t.R16UI),i===t.UNSIGNED_INT&&(a=t.R32UI),i===t.BYTE&&(a=t.R8I),i===t.SHORT&&(a=t.R16I),i===t.INT&&(a=t.R32I)),r===t.RG&&(i===t.FLOAT&&(a=t.RG32F),i===t.HALF_FLOAT&&(a=t.RG16F),i===t.UNSIGNED_BYTE&&(a=t.RG8)),r===t.RG_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RG8UI),i===t.UNSIGNED_SHORT&&(a=t.RG16UI),i===t.UNSIGNED_INT&&(a=t.RG32UI),i===t.BYTE&&(a=t.RG8I),i===t.SHORT&&(a=t.RG16I),i===t.INT&&(a=t.RG32I)),r===t.RGB_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RGB8UI),i===t.UNSIGNED_SHORT&&(a=t.RGB16UI),i===t.UNSIGNED_INT&&(a=t.RGB32UI),i===t.BYTE&&(a=t.RGB8I),i===t.SHORT&&(a=t.RGB16I),i===t.INT&&(a=t.RGB32I)),r===t.RGBA_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RGBA8UI),i===t.UNSIGNED_SHORT&&(a=t.RGBA16UI),i===t.UNSIGNED_INT&&(a=t.RGBA32UI),i===t.BYTE&&(a=t.RGBA8I),i===t.SHORT&&(a=t.RGBA16I),i===t.INT&&(a=t.RGBA32I)),r===t.RGB&&i===t.UNSIGNED_INT_5_9_9_9_REV&&(a=t.RGB9_E5),r===t.RGBA){const e=o?hM:YM.getTransfer(s);i===t.FLOAT&&(a=t.RGBA32F),i===t.HALF_FLOAT&&(a=t.RGBA16F),i===t.UNSIGNED_BYTE&&(a=e===cM?t.SRGB8_ALPHA8:t.RGBA8),i===t.UNSIGNED_SHORT_4_4_4_4&&(a=t.RGBA4),i===t.UNSIGNED_SHORT_5_5_5_1&&(a=t.RGB5_A1)}return a!==t.R16F&&a!==t.R32F&&a!==t.RG16F&&a!==t.RG32F&&a!==t.RGBA16F&&a!==t.RGBA32F||e.get("EXT_color_buffer_float"),a}function b(e,n){let r;return e?null===n||n===hw||n===mw?r=t.DEPTH24_STENCIL8:n===cw?r=t.DEPTH32F_STENCIL8:n===lw&&(r=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===hw||n===mw?r=t.DEPTH_COMPONENT24:n===cw?r=t.DEPTH_COMPONENT32F:n===lw&&(r=t.DEPTH_COMPONENT16),r}function x(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==Qx&&t.minFilter!==nw?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function w(t){const e=t.target;e.removeEventListener("dispose",w),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const n=t.source,i=d.get(n);if(i){const r=i[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(t),0===Object.keys(i).length&&d.delete(n)}r.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function M(e){const n=e.target;n.removeEventListener("dispose",M),function(e){const n=r.get(e);e.depthTexture&&(e.depthTexture.dispose(),r.remove(e.depthTexture));if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let r=0;r<n.__webglFramebuffer[e].length;r++)t.deleteFramebuffer(n.__webglFramebuffer[e][r]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=e.textures;for(let e=0,n=i.length;e<n;e++){const n=r.get(i[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),o.memory.textures--),r.remove(i[e])}r.remove(e)}(n)}function S(e){const n=r.get(e);t.deleteTexture(n.__webglTexture);const i=e.source;delete d.get(i)[n.__cacheKey],o.memory.textures--}let T=0;function E(e,i){const s=r.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void k(s,e,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+i)}const A={[Kx]:t.REPEAT,[Zx]:t.CLAMP_TO_EDGE,[Jx]:t.MIRRORED_REPEAT},C={[Qx]:t.NEAREST,[tw]:t.NEAREST_MIPMAP_NEAREST,[ew]:t.NEAREST_MIPMAP_LINEAR,[nw]:t.LINEAR,[rw]:t.LINEAR_MIPMAP_NEAREST,[iw]:t.LINEAR_MIPMAP_LINEAR},R={[pM]:t.NEVER,[bM]:t.ALWAYS,[fM]:t.LESS,[gM]:t.LEQUAL,[mM]:t.EQUAL,[_M]:t.GEQUAL,[yM]:t.GREATER,[vM]:t.NOTEQUAL};function N(n,s){if(s.type!==cw||!1!==e.has("OES_texture_float_linear")||s.magFilter!==nw&&s.magFilter!==rw&&s.magFilter!==ew&&s.magFilter!==iw&&s.minFilter!==nw&&s.minFilter!==rw&&s.minFilter!==ew&&s.minFilter!==iw||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,A[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,C[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,C[s.minFilter]),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,R[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===Qx)return;if(s.minFilter!==ew&&s.minFilter!==iw)return;if(s.type===cw&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy}}}function P(e,n){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let s=d.get(i);void 0===s&&(s={},d.set(i,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;const i=s[e.__cacheKey];void 0!==i&&(s[e.__cacheKey].usedTimes--,0===i.usedTimes&&S(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return r}function k(e,o,a){let l=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=t.TEXTURE_3D);const u=P(e,o),h=o.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+a);const c=r.get(h);if(h.version!==c.__version||!0===u){n.activeTexture(t.TEXTURE0+a);const e=YM.getPrimaries(YM.workingColorSpace),r=o.colorSpace===aM?null:YM.getPrimaries(o.colorSpace),d=o.colorSpace===aM||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,i.maxTextureSize);p=B(o,p);const f=s.convert(o.format,o.colorSpace),v=s.convert(o.type);let w,M=_(o.internalFormat,f,v,o.colorSpace,o.isVideoTexture);N(l,o);const S=o.mipmaps,T=!0!==o.isVideoTexture,E=void 0===c.__version||!0===u,A=h.dataReady,C=x(o,p);if(o.isDepthTexture)M=b(o.format===Mw,o.type),E&&(T?n.texStorage2D(t.TEXTURE_2D,1,M,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,M,p.width,p.height,0,f,v,null));else if(o.isDataTexture)if(S.length>0){T&&E&&n.texStorage2D(t.TEXTURE_2D,C,M,S[0].width,S[0].height);for(let e=0,r=S.length;e<r;e++)w=S[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,M,w.width,w.height,0,f,v,w.data);o.generateMipmaps=!1}else T?(E&&n.texStorage2D(t.TEXTURE_2D,C,M,p.width,p.height),A&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,v,p.data)):n.texImage2D(t.TEXTURE_2D,0,M,p.width,p.height,0,f,v,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,M,S[0].width,S[0].height,p.depth);for(let e=0,r=S.length;e<r;e++)if(w=S[e],o.format!==_w)if(null!==f)if(T){if(A)if(o.layerUpdates.size>0){const r=vC(w.width,w.height,o.format,o.type);for(const i of o.layerUpdates){const s=w.data.subarray(i*r/w.data.BYTES_PER_ELEMENT,(i+1)*r/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,i,w.width,w.height,1,f,s)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,w.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,M,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?A&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,v,w.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,M,w.width,w.height,p.depth,0,f,v,w.data)}else{T&&E&&n.texStorage2D(t.TEXTURE_2D,C,M,S[0].width,S[0].height);for(let e=0,r=S.length;e<r;e++)w=S[e],o.format!==_w?null!==f?T?A&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,w.data):n.compressedTexImage2D(t.TEXTURE_2D,e,M,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,M,w.width,w.height,0,f,v,w.data)}else if(o.isDataArrayTexture)if(T){if(E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,M,p.width,p.height,p.depth),A)if(o.layerUpdates.size>0){const e=vC(p.width,p.height,o.format,o.type);for(const r of o.layerUpdates){const i=p.data.subarray(r*e/p.data.BYTES_PER_ELEMENT,(r+1)*e/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,v,i)}o.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,M,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isData3DTexture)T?(E&&n.texStorage3D(t.TEXTURE_3D,C,M,p.width,p.height,p.depth),A&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)):n.texImage3D(t.TEXTURE_3D,0,M,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isFramebufferTexture){if(E)if(T)n.texStorage2D(t.TEXTURE_2D,C,M,p.width,p.height);else{let e=p.width,r=p.height;for(let i=0;i<C;i++)n.texImage2D(t.TEXTURE_2D,i,M,e,r,0,f,v,null),e>>=1,r>>=1}}else if(S.length>0){if(T&&E){const e=j(S[0]);n.texStorage2D(t.TEXTURE_2D,C,M,e.width,e.height)}for(let e=0,r=S.length;e<r;e++)w=S[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,v,w):n.texImage2D(t.TEXTURE_2D,e,M,f,v,w);o.generateMipmaps=!1}else if(T){if(E){const e=j(p);n.texStorage2D(t.TEXTURE_2D,C,M,e.width,e.height)}A&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,v,p)}else n.texImage2D(t.TEXTURE_2D,0,M,f,v,p);g(o)&&y(l),c.__version=h.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function O(e,i,o,l,u,h){const c=s.convert(o.format,o.colorSpace),d=s.convert(o.type),p=_(o.internalFormat,c,d,o.colorSpace),f=r.get(i),m=r.get(o);if(m.__renderTarget=i,!f.__hasExternalTextures){const e=Math.max(1,i.width>>h),r=Math.max(1,i.height>>h);u===t.TEXTURE_3D||u===t.TEXTURE_2D_ARRAY?n.texImage3D(u,h,p,e,r,i.depth,0,c,d,null):n.texImage2D(u,h,p,e,r,0,c,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),z(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,u,m.__webglTexture,0,F(i)):(u===t.TEXTURE_2D||u>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,u,m.__webglTexture,h),n.bindFramebuffer(t.FRAMEBUFFER,null)}function I(e,n,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const i=n.depthTexture,s=i&&i.isDepthTexture?i.type:null,o=b(n.stencilBuffer,s),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=F(n);z(n)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,o,n.width,n.height):r?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,o,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,o,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let i=0;i<e.length;i++){const o=e[i],l=s.convert(o.format,o.colorSpace),u=s.convert(o.type),h=_(o.internalFormat,l,u,o.colorSpace),c=F(n);r&&!1===z(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,c,h,n.width,n.height):z(n)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,c,h,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,h,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function D(e){const i=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),t){const e=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),i.__depthDisposeCallback=e}i.__boundDepthTexture=t}if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=r.get(i.depthTexture);s.__renderTarget=i,s.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);const o=s.__webglTexture,l=F(i);if(i.depthTexture.format===ww)z(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==Mw)throw new Error("Unknown depthTexture format");z(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,e)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=t.createRenderbuffer(),I(i.__webglDepthbuffer[r],e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,s=i.__webglDepthbuffer[r];t.bindRenderbuffer(t.RENDERBUFFER,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,s)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=t.createRenderbuffer(),I(i.__webglDepthbuffer,e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,r)}n.bindFramebuffer(t.FRAMEBUFFER,null)}const L=[],U=[];function F(t){return Math.min(i.maxSamples,t.samples)}function z(t){const n=r.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(t,e){const n=t.colorSpace,r=t.format,i=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==uM&&n!==aM&&(YM.getTransfer(n)===cM?r===_w&&i===sw||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function j(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(u.width=t.naturalWidth||t.width,u.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(u.width=t.displayWidth,u.height=t.displayHeight):(u.width=t.width,u.height=t.height),u}this.allocateTextureUnit=function(){const t=T;return t>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+i.maxTextures),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?k(s,e,i):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+i)},this.setTexture3D=function(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?k(s,e,i):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+i)},this.setTextureCube=function(e,o){const a=r.get(e);e.version>0&&a.__version!==e.version?function(e,o,a){if(6!==o.image.length)return;const l=P(e,o),u=o.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+a);const h=r.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(t.TEXTURE0+a);const e=YM.getPrimaries(YM.workingColorSpace),r=o.colorSpace===aM?null:YM.getPrimaries(o.colorSpace),c=o.colorSpace===aM||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,c);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:m(o.image[t],!0,i.maxCubemapSize),f[t]=B(o,f[t]);const v=f[0],b=s.convert(o.format,o.colorSpace),w=s.convert(o.type),M=_(o.internalFormat,b,w,o.colorSpace),S=!0!==o.isVideoTexture,T=void 0===h.__version||!0===l,E=u.dataReady;let A,C=x(o,v);if(N(t.TEXTURE_CUBE_MAP,o),d){S&&T&&n.texStorage2D(t.TEXTURE_CUBE_MAP,C,M,v.width,v.height);for(let e=0;e<6;e++){A=f[e].mipmaps;for(let r=0;r<A.length;r++){const i=A[r];o.format!==_w?null!==b?S?E&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,b,i.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,M,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):S?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,b,w,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,M,i.width,i.height,0,b,w,i.data)}}}else{if(A=o.mipmaps,S&&T){A.length>0&&C++;const e=j(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,C,M,e.width,e.height)}for(let e=0;e<6;e++)if(p){S?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,b,w,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,M,f[e].width,f[e].height,0,b,w,f[e].data);for(let r=0;r<A.length;r++){const i=A[r].image[e].image;S?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,i.width,i.height,b,w,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,M,i.width,i.height,0,b,w,i.data)}}else{S?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,b,w,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,M,b,w,f[e]);for(let r=0;r<A.length;r++){const i=A[r];S?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,b,w,i.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,M,b,w,i.image[e])}}}g(o)&&y(t.TEXTURE_CUBE_MAP),h.__version=u.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(a,e,o):n.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,n,i){const s=r.get(e);void 0!==n&&O(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==i&&D(e)},this.setupRenderTarget=function(e){const i=e.texture,a=r.get(e),l=r.get(i);e.addEventListener("dispose",M);const u=e.textures,h=!0===e.isWebGLCubeRenderTarget,c=u.length>1;if(c||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=i.version,o.memory.textures++),h){a.__webglFramebuffer=[];for(let e=0;e<6;e++)if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer[e]=[];for(let n=0;n<i.mipmaps.length;n++)a.__webglFramebuffer[e][n]=t.createFramebuffer()}else a.__webglFramebuffer[e]=t.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer=[];for(let e=0;e<i.mipmaps.length;e++)a.__webglFramebuffer[e]=t.createFramebuffer()}else a.__webglFramebuffer=t.createFramebuffer();if(c)for(let e=0,n=u.length;e<n;e++){const n=r.get(u[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===z(e)){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){const r=u[n];a.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,a.__webglColorRenderbuffer[n]);const i=s.convert(r.format,r.colorSpace),o=s.convert(r.type),l=_(r.internalFormat,i,o,r.colorSpace,!0===e.isXRRenderTarget),h=F(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,a.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),I(a.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),N(t.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)O(a.__webglFramebuffer[n][r],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else O(a.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&y(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(c){for(let i=0,s=u.length;i<s;i++){const s=u[i],o=r.get(s);n.bindTexture(t.TEXTURE_2D,o.__webglTexture),N(t.TEXTURE_2D,s),O(a.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,0),g(s)&&y(t.TEXTURE_2D)}n.unbindTexture()}else{let r=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(r=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),N(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)O(a.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,r,n);else O(a.__webglFramebuffer,e,i,t.COLOR_ATTACHMENT0,r,0);g(i)&&y(r),n.unbindTexture()}e.depthBuffer&&D(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(g(s)){const e=v(t),i=r.get(s).__webglTexture;n.bindTexture(e,i),y(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===z(e)){const i=e.textures,s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const u=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=r.get(e),c=i.length>1;if(c)for(let e=0;e<i.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<i.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),c){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[n]);const e=r.get(i[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),!0===l&&(L.length=0,U.length=0,L.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(L.push(u),U.push(u),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,U)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,L))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),c)for(let e=0;e<i.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=r.get(i[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=O,this.useMultisampledRTT=z}function $N(t,e){return{convert:function(n,r=""){let i;const s=YM.getTransfer(r);if(n===sw)return t.UNSIGNED_BYTE;if(n===pw)return t.UNSIGNED_SHORT_4_4_4_4;if(n===fw)return t.UNSIGNED_SHORT_5_5_5_1;if(n===gw)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===ow)return t.BYTE;if(n===aw)return t.SHORT;if(n===lw)return t.UNSIGNED_SHORT;if(n===uw)return t.INT;if(n===hw)return t.UNSIGNED_INT;if(n===cw)return t.FLOAT;if(n===dw)return t.HALF_FLOAT;if(n===yw)return t.ALPHA;if(n===vw)return t.RGB;if(n===_w)return t.RGBA;if(n===bw)return t.LUMINANCE;if(n===xw)return t.LUMINANCE_ALPHA;if(n===ww)return t.DEPTH_COMPONENT;if(n===Mw)return t.DEPTH_STENCIL;if(n===Sw)return t.RED;if(n===Tw)return t.RED_INTEGER;if(n===Ew)return t.RG;if(n===Aw)return t.RG_INTEGER;if(n===Cw)return t.RGBA_INTEGER;if(n===Rw||n===Nw||n===Pw||n===kw)if(s===cM){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Rw)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Nw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Pw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===kw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Rw)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Nw)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pw)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===kw)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ow||n===Iw||n===Dw||n===Lw){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Ow)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Iw)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Dw)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Lw)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Uw||n===Fw||n===zw){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===Uw||n===Fw)return s===cM?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===zw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===Bw||n===jw||n===Vw||n===Gw||n===Hw||n===Ww||n===qw||n===$w||n===Xw||n===Yw||n===Kw||n===Zw||n===Jw||n===Qw){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===Bw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===jw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Vw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Gw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Hw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Ww)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===qw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===$w)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Xw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Yw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Kw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Zw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Jw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Qw)return s===cM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===tM||n===eM||n===nM){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(n===tM)return s===cM?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===eM)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===nM)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===rM||n===iM||n===sM||n===oM){if(i=e.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===tM)return i.COMPRESSED_RED_RGTC1_EXT;if(n===iM)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===sM)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===oM)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===mw?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class XN{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const r=new iS;t.properties.get(r).__webglTexture=e.texture,e.depthNear===n.depthNear&&e.depthFar===n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new wE({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new mE(new wA(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class YN extends EM{constructor(t,e){super();const n=this;let r=null,i=1,s=null,o="local-floor",a=1,l=null,u=null,h=null,c=null,d=null,p=null;const f=new XN,m=e.getContextAttributes();let g=null,y=null;const v=[],_=[],b=new FM;let x=null;const w=new AE;w.viewport=new sS;const M=new AE;M.viewport=new sS;const S=[w,M],T=new aC;let E=null,A=null;function C(t){const e=_.indexOf(t.inputSource);if(-1===e)return;const n=v[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function R(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",R),r.removeEventListener("inputsourceschange",N);for(let t=0;t<v.length;t++){const e=_[t];null!==e&&(_[t]=null,v[t].disconnect(e))}E=null,A=null,f.reset(),t.setRenderTarget(g),d=null,c=null,h=null,r=null,y=null,D.stop(),n.isPresenting=!1,t.setPixelRatio(x),t.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function N(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=_.indexOf(n);r>=0&&(_[r]=null,v[r].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let r=_.indexOf(n);if(-1===r){for(let t=0;t<v.length;t++){if(t>=_.length){_.push(n),r=t;break}if(null===_[t]){_[t]=n,r=t;break}}if(-1===r)break}const i=v[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new IE,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new IE,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new IE,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==c?c:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(u){if(r=u,null!==r){g=t.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",R),r.addEventListener("inputsourceschange",N),!0!==m.xrCompatible&&await e.makeXRCompatible(),x=t.getPixelRatio(),t.getSize(b);if("undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,s=null,o=null;m.depth&&(o=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?Mw:ww,s=m.stencil?mw:hw);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:i};h=new XRWebGLBinding(r,e),c=h.createProjectionLayer(a),r.updateRenderState({layers:[c]}),t.setPixelRatio(1),t.setSize(c.textureWidth,c.textureHeight,!1),y=new aS(c.textureWidth,c.textureHeight,{format:_w,type:sw,depthTexture:new oA(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===c.ignoreDepthValues})}else{const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,e,n),r.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),y=new aS(d.framebufferWidth,d.framebufferHeight,{format:_w,type:sw,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}y.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await r.requestReferenceSpace(o),D.setContext(r),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const P=new cS,k=new cS;function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;let e=t.near,n=t.far;null!==f.texture&&(f.depthNear>0&&(e=f.depthNear),f.depthFar>0&&(n=f.depthFar)),T.near=M.near=w.near=e,T.far=M.far=w.far=n,E===T.near&&A===T.far||(r.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far),w.layers.mask=2|t.layers.mask,M.layers.mask=4|t.layers.mask,T.layers.mask=w.layers.mask|M.layers.mask;const i=t.parent,s=T.cameras;O(T,i);for(let t=0;t<s.length;t++)O(s[t],i);2===s.length?function(t,e,n){P.setFromMatrixPosition(e.matrixWorld),k.setFromMatrixPosition(n.matrixWorld);const r=P.distanceTo(k),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],h=(i[8]-1)/i[0],c=(s[8]+1)/s[0],d=o*h,p=o*c,f=r/(-h+c),m=f*-h;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===i[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,n=a+f,i=d-m,s=p+(r-m),h=l*a/n*e,c=u*a/n*e;t.projectionMatrix.makePerspective(i,s,h,c,e,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(T,w,M):T.projectionMatrix.copy(w.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*NM*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,T,i)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==c||null!==d)return a},this.setFoveation=function(t){a=t,null!==c&&(c.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let I=null;const D=new _C;D.setAnimationLoop((function(e,i){if(u=i.getViewerPose(l||s),p=i,null!==u){const e=u.views;null!==d&&(t.setRenderTargetFramebuffer(y,d.framebuffer),t.setRenderTarget(y));let n=!1;e.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r];let s=null;if(null!==d)s=d.getViewport(i);else{const e=h.getViewSubImage(c,i);s=e.viewport,0===r&&(t.setRenderTargetTextures(y,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(y))}let o=S[r];void 0===o&&(o=new AE,o.layers.enable(r),o.viewport=new sS,S[r]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===r&&(T.matrix.copy(o.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(o)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&h){const n=h.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&f.init(t,n,r.renderState)}}for(let t=0;t<v.length;t++){const e=_[t],n=v[t];null!==e&&void 0!==n&&n.update(e,i,l||s)}I&&I(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(t){I=t},this.dispose=function(){}}}const KN=new ZS,ZN=new jS;function JN(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function r(t,r){t.opacity.value=r.opacity,r.color&&t.diffuse.value.copy(r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map,n(r.map,t.mapTransform)),r.alphaMap&&(t.alphaMap.value=r.alphaMap,n(r.alphaMap,t.alphaMapTransform)),r.bumpMap&&(t.bumpMap.value=r.bumpMap,n(r.bumpMap,t.bumpMapTransform),t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,n(r.normalMap,t.normalMapTransform),t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,n(r.displacementMap,t.displacementMapTransform),t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,t.emissiveMapTransform)),r.specularMap&&(t.specularMap.value=r.specularMap,n(r.specularMap,t.specularMapTransform)),r.alphaTest>0&&(t.alphaTest.value=r.alphaTest);const i=e.get(r),s=i.envMap,o=i.envMapRotation;s&&(t.envMap.value=s,KN.copy(o),KN.x*=-1,KN.y*=-1,KN.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(KN.y*=-1,KN.z*=-1),t.envMapRotation.value.setFromMatrix4(ZN.makeRotationFromEuler(KN)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=r.reflectivity,t.ior.value=r.ior,t.refractionRatio.value=r.refractionRatio),r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,t.lightMapTransform)),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,bE(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,i,s,o,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(t,i):i.isMeshToonMaterial?(r(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,i)):i.isMeshPhongMaterial?(r(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,i)):i.isMeshStandardMaterial?(r(t,i),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,i),i.isMeshPhysicalMaterial&&function(t,e,r){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,i,a)):i.isMeshMatcapMaterial?(r(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,i)):i.isMeshDepthMaterial?r(t,i):i.isMeshDistanceMaterial?(r(t,i),function(t,n){const r=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(r.matrixWorld),t.nearDistance.value=r.shadow.camera.near,t.farDistance.value=r.shadow.camera.far}(t,i)):i.isMeshNormalMaterial?r(t,i):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,r,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*i,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i,s,o):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function QN(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,r){const i=t.value,s=e+"_"+n;if(void 0===r[s])return r[s]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const t=r[s];if("number"==typeof i||"boolean"==typeof i){if(t!==i)return r[s]=i,!0}else if(!1===t.equals(i))return t.copy(i),!0}return!1}function u(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const n=e.target;n.removeEventListener("dispose",h);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),t.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;r.uniformBlockBinding(t,n)},update:function(n,c){let d=i[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const r=16;for(let t=0,i=e.length;t<i;t++){const i=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=i.length;t<e;t++){const e=i[t],s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,i=s.length;t<i;t++){const i=u(s[t]),o=n%r,a=o%i.boundary,l=o+a;n+=a,0!==l&&r-l<i.storage&&(n+=r-l),e.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=i.storage}}}const i=n%r;i>0&&(n+=r-i);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const r=t.createBuffer(),i=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,i,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",h));const p=c.program;r.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=i[e.id],r=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=r.length;e<n;e++){const n=Array.isArray(r[e])?r[e]:[r[e]];for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===l(i,e,r,s)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const o=n[s],a=u(o);"number"==typeof o||"boolean"==typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=0,i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=0,i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=0):(o.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in i)t.deleteBuffer(i[e]);o=[],i={},s={}}}}const tP=new WE,eP=new FM,nP=new cS,rP=new FM,iP=new FM,sP=new cS,oP=new cS,aP=new jS,lP=new cS,uP=new cS;let hP=null,cP=null;const dP=[],pP=-1,fP=0,mP=1;class gP extends yC{constructor(t,e,n=null){super(e,n),this.objects=t,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new dC,this.mouseButtons={LEFT:cx,MIDDLE:cx,RIGHT:ux},this.touches={ONE:px},this._onPointerMove=yP.bind(this),this._onPointerDown=vP.bind(this),this._onPointerCancel=_P.bind(this),this._onContextMenu=bP.bind(this),null!==n&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(t){const e=this.domElement.getBoundingClientRect();eP.x=(t.clientX-e.left)/e.width*2-1,eP.y=-(t.clientY-e.top)/e.height*2+1}_updateState(t){let e;if("touch"===t.pointerType)e=this.touches.ONE;else switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=null}switch(e){case cx:case px:this.state=fP;break;case ux:case dx:this.state=mP;break;default:this.state=pP}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(t){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=t}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(t){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function yP(t){const e=this.object,n=this.domElement,r=this.raycaster;if(!1!==this.enabled){if(this._updatePointer(t),r.setFromCamera(eP,e),hP)this.state===fP?r.ray.intersectPlane(tP,sP)&&hP.position.copy(sP.sub(nP).applyMatrix4(aP)):this.state===mP&&(rP.subVectors(eP,iP).multiplyScalar(this.rotateSpeed),hP.rotateOnWorldAxis(lP,rP.x),hP.rotateOnWorldAxis(uP.normalize(),-rP.y)),this.dispatchEvent({type:"drag",object:hP}),iP.copy(eP);else if("mouse"===t.pointerType||"pen"===t.pointerType)if(dP.length=0,r.setFromCamera(eP,e),r.intersectObjects(this.objects,this.recursive,dP),dP.length>0){const t=dP[0].object;tP.setFromNormalAndCoplanarPoint(e.getWorldDirection(tP.normal),oP.setFromMatrixPosition(t.matrixWorld)),cP!==t&&null!==cP&&(this.dispatchEvent({type:"hoveroff",object:cP}),n.style.cursor="auto",cP=null),cP!==t&&(this.dispatchEvent({type:"hoveron",object:t}),n.style.cursor="pointer",cP=t)}else null!==cP&&(this.dispatchEvent({type:"hoveroff",object:cP}),n.style.cursor="auto",cP=null);iP.copy(eP)}}function vP(t){const e=this.object,n=this.domElement,r=this.raycaster;!1!==this.enabled&&(this._updatePointer(t),this._updateState(t),dP.length=0,r.setFromCamera(eP,e),r.intersectObjects(this.objects,this.recursive,dP),dP.length>0&&(hP=!0===this.transformGroup?xP(dP[0].object):dP[0].object,tP.setFromNormalAndCoplanarPoint(e.getWorldDirection(tP.normal),oP.setFromMatrixPosition(hP.matrixWorld)),r.ray.intersectPlane(tP,sP)&&(this.state===fP?(aP.copy(hP.parent.matrixWorld).invert(),nP.copy(sP).sub(oP.setFromMatrixPosition(hP.matrixWorld))):this.state===mP&&(lP.set(0,1,0).applyQuaternion(e.quaternion).normalize(),uP.set(1,0,0).applyQuaternion(e.quaternion).normalize())),n.style.cursor="move",this.dispatchEvent({type:"dragstart",object:hP})),iP.copy(eP))}function _P(){!1!==this.enabled&&(hP&&(this.dispatchEvent({type:"dragend",object:hP}),hP=null),this.domElement.style.cursor=cP?"pointer":"auto",this.state=pP)}function bP(t){!1!==this.enabled&&t.preventDefault()}function xP(t,e=null){return t.isGroup&&(e=t),null===t.parent?e:xP(t.parent,e)}function wP(t,e,n){var r,i=1;function s(){var s,o,a=r.length,l=0,u=0,h=0;for(s=0;s<a;++s)l+=(o=r[s]).x||0,u+=o.y||0,h+=o.z||0;for(l=(l/a-t)*i,u=(u/a-e)*i,h=(h/a-n)*i,s=0;s<a;++s)o=r[s],l&&(o.x-=l),u&&(o.y-=u),h&&(o.z-=h)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t},s.x=function(e){return arguments.length?(t=+e,s):t},s.y=function(t){return arguments.length?(e=+t,s):e},s.z=function(t){return arguments.length?(n=+t,s):n},s.strength=function(t){return arguments.length?(i=+t,s):i},s}function MP(t,e,n){if(isNaN(e))return t;var r,i,s,o,a,l,u=t._root,h={data:n},c=t._x0,d=t._x1;if(!u)return t._root=h,t;for(;u.length;)if((o=e>=(i=(c+d)/2))?c=i:d=i,r=u,!(u=u[a=+o]))return r[a]=h,t;if(e===(s=+t._x.call(null,u.data)))return h.next=u,r?r[a]=h:t._root=h,t;do{r=r?r[a]=new Array(2):t._root=new Array(2),(o=e>=(i=(c+d)/2))?c=i:d=i}while((a=+o)==(l=+(s>=i)));return r[l]=u,r[a]=h,t}function SP(t,e,n){this.node=t,this.x0=e,this.x1=n}function TP(t){return t[0]}function EP(t,e){var n=new AP(null==e?TP:e,NaN,NaN);return null==t?n:n.addAll(t)}function AP(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function CP(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var RP=EP.prototype=AP.prototype;function NP(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,h,c,d,p=t._root,f={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o,i=p,!(p=p[c=h<<1|u]))return i[c]=f,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&n===l)return f.next=p,i?i[c]=f:t._root=f,t;do{i=i?i[c]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o}while((c=h<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=p,i[c]=f,t}function PP(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function kP(t){return t[0]}function OP(t){return t[1]}function IP(t,e,n){var r=new DP(null==e?kP:e,null==n?OP:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function DP(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function LP(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}RP.copy=function(){var t,e,n=new AP(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=CP(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=CP(e));return n},RP.add=function(t){const e=+this._x.call(null,t);return MP(this.cover(e),e,t)},RP.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let s,o=0;o<e;++o)isNaN(s=+this._x.call(null,t[o]))||(n[o]=s,s<r&&(r=s),s>i&&(i=s));if(r>i)return this;this.cover(r).cover(i);for(let r=0;r<e;++r)MP(this,n[r],t[r]);return this},RP.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,s=n-e||1,o=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=o,o=r,s*=2,i){case 0:n=e+s;break;case 1:e=n-s}this._root&&this._root.length&&(this._root=o)}return this._x0=e,this._x1=n,this},RP.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},RP.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},RP.find=function(t,e){var n,r,i,s,o,a=this._x0,l=this._x1,u=[],h=this._root;for(h&&u.push(new SP(h,a,l)),null==e?e=1/0:(a=t-e,l=t+e);s=u.pop();)if(!(!(h=s.node)||(r=s.x0)>l||(i=s.x1)<a))if(h.length){var c=(r+i)/2;u.push(new SP(h[1],c,i),new SP(h[0],r,c)),(o=+(t>=c))&&(s=u[u.length-1],u[u.length-1]=u[u.length-1-o],u[u.length-1-o]=s)}else{var d=Math.abs(t-+this._x.call(null,h.data));d<e&&(e=d,a=t-d,l=t+d,n=h.data)}return n},RP.remove=function(t){if(isNaN(s=+this._x.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h=this._root,c=this._x0,d=this._x1;if(!h)return this;if(h.length)for(;;){if((a=s>=(o=(c+d)/2))?c=o:d=o,e=h,!(h=h[l=+a]))return this;if(!h.length)break;e[l+1&1]&&(n=e,u=l)}for(;h.data!==t;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(h=e[0]||e[1])&&h===(e[1]||e[0])&&!h.length&&(n?n[u]=h:this._root=h),this):(this._root=i,this)},RP.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},RP.root=function(){return this._root},RP.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},RP.visit=function(t){var e,n,r,i,s=[],o=this._root;for(o&&s.push(new SP(o,this._x0,this._x1));e=s.pop();)if(!t(o=e.node,r=e.x0,i=e.x1)&&o.length){var a=(r+i)/2;(n=o[1])&&s.push(new SP(n,a,i)),(n=o[0])&&s.push(new SP(n,r,a))}return this},RP.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new SP(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.x1,l=(o+a)/2;(s=i[0])&&n.push(new SP(s,o,l)),(s=i[1])&&n.push(new SP(s,l,a))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},RP.x=function(t){return arguments.length?(this._x=t,this):this._x};var UP=IP.prototype=DP.prototype;function FP(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var s,o,a,l,u,h,c,d,p,f,m,g,y=t._root,v={data:i},_=t._x0,b=t._y0,x=t._z0,w=t._x1,M=t._y1,S=t._z1;if(!y)return t._root=v,t;for(;y.length;)if((d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l,s=y,!(y=y[m=f<<2|p<<1|d]))return s[m]=v,t;if(u=+t._x.call(null,y.data),h=+t._y.call(null,y.data),c=+t._z.call(null,y.data),e===u&&n===h&&r===c)return v.next=y,s?s[m]=v:t._root=v,t;do{s=s?s[m]=new Array(8):t._root=new Array(8),(d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l}while((m=f<<2|p<<1|d)==(g=(c>=l)<<2|(h>=a)<<1|u>=o));return s[g]=y,s[m]=v,t}function zP(t,e,n,r,i,s,o){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=s,this.z1=o}UP.copy=function(){var t,e,n=new DP(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=LP(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=LP(e));return n},UP.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return NP(this.cover(e,n),e,n,t)},UP.addAll=function(t){var e,n,r,i,s=t.length,o=new Array(s),a=new Array(s),l=1/0,u=1/0,h=-1/0,c=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,a[n]=i,r<l&&(l=r),r>h&&(h=r),i<u&&(u=i),i>c&&(c=i));if(l>h||u>c)return this;for(this.cover(l,u).cover(h,c),n=0;n<s;++n)NP(this,o[n],a[n],t[n]);return this},UP.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},UP.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},UP.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},UP.find=function(t,e,n){var r,i,s,o,a,l,u,h=this._x0,c=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new PP(m,h,c,d,p)),null==n?n=1/0:(h=t-n,c=e-n,d=t+n,p=e+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(s=l.y0)>p||(o=l.x1)<h||(a=l.y1)<c))if(m.length){var g=(i+o)/2,y=(s+a)/2;f.push(new PP(m[3],g,y,o,a),new PP(m[2],i,y,g,a),new PP(m[1],g,s,o,y),new PP(m[0],i,s,g,y)),(u=(e>=y)<<1|t>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-u],f[f.length-1-u]=l)}else{var v=t-+this._x.call(null,m.data),_=e-+this._y.call(null,m.data),b=v*v+_*_;if(b<n){var x=Math.sqrt(n=b);h=t-x,c=e-x,d=t+x,p=e+x,r=m.data}}return r},UP.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((u=s>=(a=(f+g)/2))?f=a:g=a,(h=o>=(l=(m+y)/2))?m=l:y=l,e=p,!(p=p[c=h<<1|u]))return this;if(!p.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(n=e,d=c)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[c]=i:delete e[c],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},UP.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},UP.root=function(){return this._root},UP.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},UP.visit=function(t){var e,n,r,i,s,o,a=[],l=this._root;for(l&&a.push(new PP(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,s=e.x1,o=e.y1)&&l.length){var u=(r+s)/2,h=(i+o)/2;(n=l[3])&&a.push(new PP(n,u,h,s,o)),(n=l[2])&&a.push(new PP(n,r,h,u,o)),(n=l[1])&&a.push(new PP(n,u,i,s,h)),(n=l[0])&&a.push(new PP(n,r,i,u,h))}return this},UP.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new PP(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.x1,u=e.y1,h=(o+l)/2,c=(a+u)/2;(s=i[0])&&n.push(new PP(s,o,a,h,c)),(s=i[1])&&n.push(new PP(s,h,a,l,c)),(s=i[2])&&n.push(new PP(s,o,c,h,u)),(s=i[3])&&n.push(new PP(s,h,c,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},UP.x=function(t){return arguments.length?(this._x=t,this):this._x},UP.y=function(t){return arguments.length?(this._y=t,this):this._y};const BP=(t,e,n,r,i,s)=>Math.sqrt((t-r)**2+(e-i)**2+(n-s)**2);function jP(t){return t[0]}function VP(t){return t[1]}function GP(t){return t[2]}function HP(t,e,n,r){var i=new WP(null==e?jP:e,null==n?VP:n,null==r?GP:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function WP(t,e,n,r,i,s,o,a,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function qP(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var $P=HP.prototype=WP.prototype;function XP(t){return function(){return t}}function YP(t){return 1e-6*(t()-.5)}function KP(t){return t.index}function ZP(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function JP(t){var e,n,r,i,s,o,a,l=KP,u=function(t){return 1/Math.min(s[t.source.index],s[t.target.index])},h=XP(30),c=1;function d(r){for(var s=0,l=t.length;s<c;++s)for(var u,h,d,p,f,m=0,g=0,y=0,v=0;m<l;++m)h=(u=t[m]).source,g=(d=u.target).x+d.vx-h.x-h.vx||YP(a),i>1&&(y=d.y+d.vy-h.y-h.vy||YP(a)),i>2&&(v=d.z+d.vz-h.z-h.vz||YP(a)),g*=p=((p=Math.sqrt(g*g+y*y+v*v))-n[m])/p*r*e[m],y*=p,v*=p,d.vx-=g*(f=o[m]),i>1&&(d.vy-=y*f),i>2&&(d.vz-=v*f),h.vx+=g*(f=1-f),i>1&&(h.vy+=y*f),i>2&&(h.vz+=v*f)}function p(){if(r){var i,a,u=r.length,h=t.length,c=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(i=0,s=new Array(u);i<h;++i)(a=t[i]).index=i,"object"!=typeof a.source&&(a.source=ZP(c,a.source)),"object"!=typeof a.target&&(a.target=ZP(c,a.target)),s[a.source.index]=(s[a.source.index]||0)+1,s[a.target.index]=(s[a.target.index]||0)+1;for(i=0,o=new Array(h);i<h;++i)a=t[i],o[i]=s[a.source.index]/(s[a.source.index]+s[a.target.index]);e=new Array(h),f(),n=new Array(h),m()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function m(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,...e){r=t,a=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,p()},d.links=function(e){return arguments.length?(t=e,p(),d):t},d.id=function(t){return arguments.length?(l=t,d):l},d.iterations=function(t){return arguments.length?(c=+t,d):c},d.strength=function(t){return arguments.length?(u="function"==typeof t?t:XP(+t),f(),d):u},d.distance=function(t){return arguments.length?(h="function"==typeof t?t:XP(+t),m(),d):h},d}$P.copy=function(){var t,e,n=new WP(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=qP(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=qP(e));return n},$P.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return FP(this.cover(e,n,r),e,n,r,t)},$P.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c,d,p,f,m=0;m<e;++m)isNaN(d=+this._x.call(null,c=t[m]))||isNaN(p=+this._y.call(null,c))||isNaN(f=+this._z.call(null,c))||(n[m]=d,r[m]=p,i[m]=f,d<s&&(s=d),d>l&&(l=d),p<o&&(o=p),p>u&&(u=p),f<a&&(a=f),f>h&&(h=f));if(s>l||o>u||a>h)return this;this.cover(s,o,a).cover(l,u,h);for(let s=0;s<e;++s)FP(this,n[s],r[s],i[s],t[s]);return this},$P.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(t))+1,a=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var u,h,c=o-r||1,d=this._root;r>t||t>=o||i>e||e>=a||s>n||n>=l;)switch(h=(n<s)<<2|(e<i)<<1|t<r,(u=new Array(8))[h]=d,d=u,c*=2,h){case 0:o=r+c,a=i+c,l=s+c;break;case 1:r=o-c,a=i+c,l=s+c;break;case 2:o=r+c,i=a-c,l=s+c;break;case 3:r=o-c,i=a-c,l=s+c;break;case 4:o=r+c,a=i+c,s=l-c;break;case 5:r=o-c,a=i+c,s=l-c;break;case 6:o=r+c,i=a-c,s=l-c;break;case 7:r=o-c,i=a-c,s=l-c}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this},$P.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},$P.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},$P.find=function(t,e,n,r){var i,s,o,a,l,u,h,c,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,y=this._y1,v=this._z1,_=[],b=this._root;for(b&&_.push(new zP(b,p,f,m,g,y,v)),null==r?r=1/0:(p=t-r,f=e-r,m=n-r,g=t+r,y=e+r,v=n+r,r*=r);c=_.pop();)if(!(!(b=c.node)||(s=c.x0)>g||(o=c.y0)>y||(a=c.z0)>v||(l=c.x1)<p||(u=c.y1)<f||(h=c.z1)<m))if(b.length){var x=(s+l)/2,w=(o+u)/2,M=(a+h)/2;_.push(new zP(b[7],x,w,M,l,u,h),new zP(b[6],s,w,M,x,u,h),new zP(b[5],x,o,M,l,w,h),new zP(b[4],s,o,M,x,w,h),new zP(b[3],x,w,a,l,u,M),new zP(b[2],s,w,a,x,u,M),new zP(b[1],x,o,a,l,w,M),new zP(b[0],s,o,a,x,w,M)),(d=(n>=M)<<2|(e>=w)<<1|t>=x)&&(c=_[_.length-1],_[_.length-1]=_[_.length-1-d],_[_.length-1-d]=c)}else{var S=t-+this._x.call(null,b.data),T=e-+this._y.call(null,b.data),E=n-+this._z.call(null,b.data),A=S*S+T*T+E*E;if(A<r){var C=Math.sqrt(r=A);p=t-C,f=e-C,m=n-C,g=t+C,y=e+C,v=n+C,i=b.data}}return i},$P.findAllWithinRadius=function(t,e,n,r){const i=[],s=t-r,o=e-r,a=n-r,l=t+r,u=e+r,h=n+r;return this.visit(((c,d,p,f,m,g,y)=>{if(!c.length)do{const s=c.data;BP(t,e,n,this._x(s),this._y(s),this._z(s))<=r&&i.push(s)}while(c=c.next);return d>l||p>u||f>h||m<s||g<o||y<a})),i},$P.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(a=+this._z.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g=this._root,y=this._x0,v=this._y0,_=this._z0,b=this._x1,x=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((c=s>=(l=(y+b)/2))?y=l:b=l,(d=o>=(u=(v+x)/2))?v=u:x=u,(p=a>=(h=(_+w)/2))?_=h:w=h,e=g,!(g=g[f=p<<2|d<<1|c]))return this;if(!g.length)break;(e[f+1&7]||e[f+2&7]||e[f+3&7]||e[f+4&7]||e[f+5&7]||e[f+6&7]||e[f+7&7])&&(n=e,m=f)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},$P.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},$P.root=function(){return this._root},$P.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},$P.visit=function(t){var e,n,r,i,s,o,a,l,u=[],h=this._root;for(h&&u.push(new zP(h,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=u.pop();)if(!t(h=e.node,r=e.x0,i=e.y0,s=e.z0,o=e.x1,a=e.y1,l=e.z1)&&h.length){var c=(r+o)/2,d=(i+a)/2,p=(s+l)/2;(n=h[7])&&u.push(new zP(n,c,d,p,o,a,l)),(n=h[6])&&u.push(new zP(n,r,d,p,c,a,l)),(n=h[5])&&u.push(new zP(n,c,i,p,o,d,l)),(n=h[4])&&u.push(new zP(n,r,i,p,c,d,l)),(n=h[3])&&u.push(new zP(n,c,d,s,o,a,p)),(n=h[2])&&u.push(new zP(n,r,d,s,c,a,p)),(n=h[1])&&u.push(new zP(n,c,i,s,o,d,p)),(n=h[0])&&u.push(new zP(n,r,i,s,c,d,p))}return this},$P.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new zP(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.z0,u=e.x1,h=e.y1,c=e.z1,d=(o+u)/2,p=(a+h)/2,f=(l+c)/2;(s=i[0])&&n.push(new zP(s,o,a,l,d,p,f)),(s=i[1])&&n.push(new zP(s,d,a,l,u,p,f)),(s=i[2])&&n.push(new zP(s,o,p,l,d,h,f)),(s=i[3])&&n.push(new zP(s,d,p,l,u,h,f)),(s=i[4])&&n.push(new zP(s,o,a,f,d,p,c)),(s=i[5])&&n.push(new zP(s,d,a,f,u,p,c)),(s=i[6])&&n.push(new zP(s,o,p,f,d,h,c)),(s=i[7])&&n.push(new zP(s,d,p,f,u,h,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},$P.x=function(t){return arguments.length?(this._x=t,this):this._x},$P.y=function(t){return arguments.length?(this._y=t,this):this._y},$P.z=function(t){return arguments.length?(this._z=t,this):this._z};var QP={value:()=>{}};function tk(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new ek(r)}function ek(t){this._=t}function nk(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function rk(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=QP,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}ek.prototype=tk.prototype={constructor:ek,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=rk(i[n],t.name,e);else if(null==e)for(n in i)i[n]=rk(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=nk(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ek(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};var ik,sk,ok=0,ak=0,lk=0,uk=0,hk=0,ck=0,dk="object"==typeof performance&&performance.now?performance:Date,pk="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function fk(){return hk||(pk(mk),hk=dk.now()+ck)}function mk(){hk=0}function gk(){this._call=this._time=this._next=null}function yk(t,e,n){var r=new gk;return r.restart(t,e,n),r}function vk(){hk=(uk=dk.now())+ck,ok=ak=0;try{!function(){fk(),++ok;for(var t,e=ik;e;)(t=hk-e._time)>=0&&e._call.call(void 0,t),e=e._next;--ok}()}finally{ok=0,function(){var t,e,n=ik,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:ik=e);sk=t,bk(r)}(),hk=0}}function _k(){var t=dk.now(),e=t-uk;e>1e3&&(ck-=e,uk=t)}function bk(t){ok||(ak&&(ak=clearTimeout(ak)),t-hk>24?(t<1/0&&(ak=setTimeout(vk,t-dk.now()-ck)),lk&&(lk=clearInterval(lk))):(lk||(uk=dk.now(),lk=setInterval(_k,1e3)),ok=1,pk(vk)))}gk.prototype=yk.prototype={constructor:gk,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?fk():+n)+(null==e?0:+e),this._next||sk===this||(sk?sk._next=this:ik=this,sk=this),this._call=t,this._time=n,bk()},stop:function(){this._call&&(this._call=null,this._time=1/0,bk())}};const xk=4294967296;function wk(t){return t.x}function Mk(t){return t.y}function Sk(t){return t.z}var Tk,Ek,Ak,Ck,Rk=Math.PI*(3-Math.sqrt(5)),Nk=20*Math.PI/(9+Math.sqrt(221));function Pk(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,h=yk(p),c=tk("tick","end"),d=function(){let t=1;return()=>(t=(1664525*t+1013904223)%xk)/xk}();function p(){f(),c.call("tick",n),i<s&&(h.stop(),c.call("end",n))}function f(e){var s,h,c=t.length;void 0===e&&(e=1);for(var d=0;d<e;++d)for(i+=(a-i)*o,u.forEach((function(t){t(i)})),s=0;s<c;++s)null==(h=t[s]).fx?h.x+=h.vx*=l:(h.x=h.fx,h.vx=0),r>1&&(null==h.fy?h.y+=h.vy*=l:(h.y=h.fy,h.vy=0)),r>2&&(null==h.fz?h.z+=h.vz*=l:(h.z=h.fz,h.vz=0));return n}function m(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var s=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),o=n*Rk,a=n*Nk;1===r?e.x=s:2===r?(e.x=s*Math.cos(o),e.y=s*Math.sin(o)):(e.x=s*Math.sin(o)*Math.cos(a),e.y=s*Math.cos(o),e.z=s*Math.sin(o)*Math.sin(a))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,d,r),e}return null==t&&(t=[]),m(),n={tick:f,restart:function(){return h.restart(p),n},stop:function(){return h.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),u.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,m(),u.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(s=+t,n):s},alphaDecay:function(t){return arguments.length?(o=+t,n):+o},alphaTarget:function(t){return arguments.length?(a=+t,n):a},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(d=t,u.forEach(g),n):d},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,g(e)),n):u.get(t)},find:function(){var e,n,i,s,o,a,l=Array.prototype.slice.call(arguments),u=l.shift()||0,h=(r>1?l.shift():null)||0,c=(r>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=t.length;for(d*=d,p=0;p<f;++p)(s=(e=u-(o=t[p]).x)*e+(n=h-(o.y||0))*n+(i=c-(o.z||0))*i)<d&&(a=o,d=s);return a},on:function(t,e){return arguments.length>1?(c.on(t,e),n):c.on(t)}}}function kk(){var t,e,n,r,i,s,o=XP(-30),a=1,l=1/0,u=.81;function h(r){var s,o=t.length,a=(1===e?EP(t,wk):2===e?IP(t,wk,Mk):3===e?HP(t,wk,Mk,Sk):null).visitAfter(d);for(i=r,s=0;s<o;++s)n=t[s],a.visit(p)}function c(){if(t){var e,n,r=t.length;for(s=new Array(r),e=0;e<r;++e)n=t[e],s[n.index]=+o(n,e,t)}}function d(t){var n,r,i,o,a,l,u=0,h=0,c=t.length;if(c){for(i=o=a=l=0;l<c;++l)(n=t[l])&&(r=Math.abs(n.value))&&(u+=n.value,h+=r,i+=r*(n.x||0),o+=r*(n.y||0),a+=r*(n.z||0));u*=Math.sqrt(4/c),t.x=i/h,e>1&&(t.y=o/h),e>2&&(t.z=a/h)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{u+=s[n.data.index]}while(n=n.next)}t.value=u}function p(t,o,h,c,d){if(!t.value)return!0;var p=[h,c,d][e-1],f=t.x-n.x,m=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,y=p-o,v=f*f+m*m+g*g;if(y*y/u<v)return v<l&&(0===f&&(v+=(f=YP(r))*f),e>1&&0===m&&(v+=(m=YP(r))*m),e>2&&0===g&&(v+=(g=YP(r))*g),v<a&&(v=Math.sqrt(a*v)),n.vx+=f*t.value*i/v,e>1&&(n.vy+=m*t.value*i/v),e>2&&(n.vz+=g*t.value*i/v)),!0;if(!(t.length||v>=l)){(t.data!==n||t.next)&&(0===f&&(v+=(f=YP(r))*f),e>1&&0===m&&(v+=(m=YP(r))*m),e>2&&0===g&&(v+=(g=YP(r))*g),v<a&&(v=Math.sqrt(a*v)));do{t.data!==n&&(y=s[t.data.index]*i/v,n.vx+=f*y,e>1&&(n.vy+=m*y),e>2&&(n.vz+=g*y))}while(t=t.next)}}return h.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,c()},h.strength=function(t){return arguments.length?(o="function"==typeof t?t:XP(+t),c(),h):o},h.distanceMin=function(t){return arguments.length?(a=t*t,h):Math.sqrt(a)},h.distanceMax=function(t){return arguments.length?(l=t*t,h):Math.sqrt(l)},h.theta=function(t){return arguments.length?(u=t*t,h):Math.sqrt(u)},h}function Ok(){if(Ek)return Tk;return Ek=1,Tk=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var s=e[n];return s||(s=e[n]=[]),s.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],s=0;s<i.length;++s)i[s].callback===r&&i.splice(s,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t},Tk}var Ik,Dk,Lk,Uk,Fk,zk=function(){if(Ck)return Ak;Ck=1,Ak=function(s){"uniqueLinkId"in(s=s||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),s.multigraph=s.uniqueLinkId);void 0===s.multigraph&&(s.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var o=new Map,a=new Map,l={},u=0,h=s.multigraph?function(t,e,n){var s=i(t,e),o=l.hasOwnProperty(s);if(o||T(t,e)){o||(l[s]=0);var a="@"+ ++l[s];s=i(t+a,e+a)}return new r(t,e,n,s)}:function(t,e,n){var s=i(t,e),o=a.get(s);if(o)return o.data=n,o;return new r(t,e,n,s)},c=[],d=E,p=E,f=E,m=E,g={version:20,addNode:_,addLink:function(t,e,r){f();var i=b(t)||_(t),s=b(e)||_(e),o=h(t,e,r),l=a.has(o.id);a.set(o.id,o),n(i,o),t!==e&&n(s,o);return d(o,l?"update":"add"),m(),o},removeLink:function(t,e){void 0!==e&&(t=T(t,e));return S(t)},removeNode:x,getNode:b,getNodeCount:w,getLinkCount:M,getEdgeCount:M,getLinksCount:M,getNodesCount:w,getLinks:function(t){var e=b(t);return e?e.links:null},forEachNode:R,forEachLinkedNode:function(t,e,n){var r=b(t);if(r&&r.links&&"function"==typeof e)return n?function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value;if(s.fromId===e&&n(o.get(s.toId),s))return!0;i=r.next()}}(r.links,t,e):function(t,e,n){var r=t.values(),i=r.next();for(;!i.done;){var s=i.value,a=s.fromId===e?s.toId:s.fromId;if(n(o.get(a),s))return!0;i=r.next()}}(r.links,t,e)},forEachLink:function(t){if("function"==typeof t)for(var e=a.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),R((function(t){x(t.id)})),m()},hasLink:T,hasNode:b,getLink:T};return t(g),function(){var t=g.on;function e(){return g.beginUpdate=f=A,g.endUpdate=m=C,d=y,p=v,g.on=t,t.apply(g,arguments)}g.on=e}(),g;function y(t,e){c.push({link:t,changeType:e})}function v(t,e){c.push({node:t,changeType:e})}function _(t,n){if(void 0===t)throw new Error("Invalid node identifier");f();var r=b(t);return r?(r.data=n,p(r,"update")):(r=new e(t,n),p(r,"add")),o.set(t,r),m(),r}function b(t){return o.get(t)}function x(t){var e=b(t);if(!e)return!1;f();var n=e.links;return n&&(n.forEach(S),e.links=null),o.delete(t),p(e,"remove"),m(),!0}function w(){return o.size}function M(){return a.size}function S(t){if(!t)return!1;if(!a.get(t.id))return!1;f(),a.delete(t.id);var e=b(t.fromId),n=b(t.toId);return e&&e.links.delete(t),n&&n.links.delete(t),d(t,"remove"),m(),!0}function T(t,e){if(void 0!==t&&void 0!==e)return a.get(i(t,e))}function E(){}function A(){u+=1}function C(){0===(u-=1)&&c.length>0&&(g.fire("changed",c),c.length=0)}function R(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var e=o.values(),n=e.next();!n.done;){if(t(n.value))return!0;n=e.next()}}};var t=Ok();function e(t,e){this.id=t,this.links=null,this.data=e}function n(t,e){t.links?t.links.add(e):t.links=new Set([e])}function r(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function i(t,e){return t.toString()+" "+e.toString()}return Ak}(),Bk=p(zk),jk={exports:{}},Vk={exports:{}};function Gk(){return Dk||(Dk=1,Ik=function(t){return 0===t?"x":1===t?"y":2===t?"z":"c"+(t+1)}),Ik}function Hk(){if(Uk)return Lk;Uk=1;const t=Gk();return Lk=function(e){return function(n,r){let i=r&&r.indent||0,s=r&&void 0!==r.join?r.join:"\n",o=Array(i+1).join(" "),a=[];for(let r=0;r<e;++r){let e=t(r),i=0===r?"":o;a.push(i+n.replace(/{var}/g,e))}return a.join(s)}},Lk}var Wk,qk={exports:{}};var $k,Xk={exports:{}};var Yk,Kk={exports:{}};var Zk,Jk={exports:{}};var Qk,tO,eO,nO,rO,iO={exports:{}};var sO,oO,aO,lO,uO={exports:{}};function hO(){if(aO)return oO;aO=1,oO=function(l){var u=(eO||(eO=1,tO=function(t,e,n,r){this.from=t,this.to=e,this.length=n,this.coefficient=r}),tO),h=(rO||(rO=1,nO=function t(e,n){var r;if(e||(e={}),n)for(r in n)if(n.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof n[r];i&&typeof e[r]===s?"object"===s&&(e[r]=t(e[r],n[r])):e[r]=n[r]}return e}),nO),c=Ok();if(l){if(void 0!==l.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==l.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}l=h(l,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var d=o[l.dimensions];if(!d){var p=l.dimensions;d={Body:t(p,l.debug),createQuadTree:e(p),createBounds:n(p),createDragForce:r(p),createSpringForce:i(p),integrate:s(p)},o[p]=d}var f=d.Body,m=d.createQuadTree,g=d.createBounds,y=d.createDragForce,v=d.createSpringForce,_=d.integrate,b=function(){if(sO)return uO.exports;function t(t){return new e("number"==typeof t?t:+new Date)}function e(t){this.seed=t}function n(t){return Math.sqrt(2*Math.PI/t)*Math.pow(1/Math.E*(t+1/(12*t-1/(10*t))),t)}function r(){var t=this.seed;return t=4294967295&(3042594569^(t=4251993797+(t=4294967295&(3550635116+(t=374761393+(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+(t<<5)&4294967295)^t<<9))+(t<<3)&4294967295)^t>>>16),this.seed=t,(268435455&t)/268435456}return sO=1,uO.exports=t,uO.exports.random=t,uO.exports.randomIterator=function(e,n){var r=n||t();if("function"!=typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(t){var n,i,s;for(n=e.length-1;n>0;--n)i=r.next(n+1),s=e[i],e[i]=e[n],e[n]=s,t(s);e.length&&t(e[0])},shuffle:function(){var t,n,i;for(t=e.length-1;t>0;--t)n=r.next(t+1),i=e[n],e[n]=e[t],e[t]=i;return e}}},e.prototype.next=function(t){return Math.floor(this.nextDouble()*t)},e.prototype.nextDouble=r,e.prototype.uniform=r,e.prototype.gaussian=function(){var t,e,n;do{t=(e=2*this.nextDouble()-1)*e+(n=2*this.nextDouble()-1)*n}while(t>=1||0===t);return e*Math.sqrt(-2*Math.log(t)/t)},e.prototype.levy=function(){var t=1.5,e=Math.pow(n(2.5)*Math.sin(Math.PI*t/2)/(n(1.25)*t*Math.pow(2,.25)),1/t);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/t)},uO.exports}().random(42),x=[],w=[],M=m(l,b),S=g(x,l,b),T=v(l,b),E=y(l),A=[],C=new Map,R=0;k("nbody",(function(){if(0===x.length)return;M.insertBodies(x);var t=x.length;for(;t--;){var e=x[t];e.isPinned||(e.reset(),M.updateBodyForce(e),E.update(e))}})),k("spring",(function(){var t=w.length;for(;t--;)T.update(w[t])}));var N={bodies:x,quadTree:M,springs:w,settings:l,addForce:k,removeForce:function(t){var e=A.indexOf(C.get(t));if(e<0)return;A.splice(e,1),C.delete(t)},getForces:function(){return C},step:function(){for(var t=0;t<A.length;++t)A[t](R);var e=_(x,l.timeStep,l.adaptiveTimeStepWeight);return R+=1,e},addBody:function(t){if(!t)throw new Error("Body is required");return x.push(t),t},addBodyAt:function(t){if(!t)throw new Error("Body position is required");var e=(t=>new f(t))(t);return x.push(e),e},removeBody:function(t){if(t){var e=x.indexOf(t);if(!(e<0))return x.splice(e,1),0===x.length&&S.reset(),!0}},addSpring:function(t,e,n,r){if(!t||!e)throw new Error("Cannot add null spring to force simulator");"number"!=typeof n&&(n=-1);var i=new u(t,e,n,r>=0?r:-1);return w.push(i),i},getTotalMovement:function(){return 0},removeSpring:function(t){if(t){var e=w.indexOf(t);return e>-1?(w.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(t){return S.getBestNewPosition(t)},getBBox:P,getBoundingBox:P,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(t){return void 0!==t?(l.gravity=t,M.options({gravity:t}),this):l.gravity},theta:function(t){return void 0!==t?(l.theta=t,M.options({theta:t}),this):l.theta},random:b};return function(t,e){for(var n in t)a(t,e,n)}(l,N),c(N),N;function P(){return S.update(),S.box}function k(t,e){if(C.has(t))throw new Error("Force "+t+" is already added");C.set(t,e),A.push(e)}};var t=function(){if(Fk)return Vk.exports;Fk=1;const t=Hk();function e(t,e){return`\n${r(t,e)}\n${n(t)}\nreturn {Body: Body, Vector: Vector};\n`}function n(e){let n=t(e),r=n("{var}",{join:", "});return`\nfunction Body(${r}) {\n  this.isPinned = false;\n  this.pos = new Vector(${r});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${r}) {\n  ${n("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function r(e,n){let r=t(e),i="";return n&&(i=`${r("\n\t   var v{var};\n\tObject.defineProperty(this, '{var}', {\n\t  set: function(v) { \n\t    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n\t    v{var} = v; \n\t  },\n\t  get: function() { return v{var}; }\n\t});")}`),`function Vector(${r("{var}",{join:", "})}) {\n  ${i}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${r('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${r("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${r('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${r("this.{var} = ",{join:""})}0;\n  };`}return Vk.exports=function(t,n){let r=e(t,n),{Body:i}=new Function(r)();return i},Vk.exports.generateCreateBodyFunctionBody=e,Vk.exports.getVectorCode=r,Vk.exports.getBodyCode=n,Vk.exports}(),e=function(){if(Wk)return qk.exports;Wk=1;const t=Hk(),e=Gk();function n(n){let l=t(n),u=Math.pow(2,n),h=`\n${a()}\n${o(n)}\n${r(n)}\n${s(n)}\n${i(n)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(t){let e=[];for(let n=0;n<u;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("      node.")}\n      node.body = null;\n      node.mass = ${l("node.mass_{var} = ",{join:""})}0;\n      ${l("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${l("var d{var};",{indent:4})}\n    var r; \n    ${l("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${l("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${l("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${l("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${l("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${l("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < , treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${l("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let t=Array(11).join(" "),e=[];for(let n=0;n<u;++n)e.push(t+`if (node.quad${n}) {`),e.push(t+`  queue[pushIdx] = node.quad${n};`),e.push(t+"  queueLength += 1;"),e.push(t+"  pushIdx += 1;"),e.push(t+"}");return e.join("\n")}()}\n        }\n      }\n    }\n\n    ${l("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${l("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${l("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${l("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${l("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${l("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${l("root.min_{var} = {var}min;",{indent:4})}\n    ${l("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${l("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${l("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${l("var min_{var} = node.min_{var};",{indent:8})}\n        ${l("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(){let t=[],r=Array(8+1).join(" ");for(let i=0;i<n;++i)t.push(r+`if (${e(i)} > max_${e(i)}) {`),t.push(r+`  quadIdx = quadIdx + ${Math.pow(2,i)};`),t.push(r+`  min_${e(i)} = max_${e(i)};`),t.push(r+`  max_${e(i)} = node.max_${e(i)};`),t.push(r+"}");return t.join("\n")}()}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${l("child.min_{var} = min_{var};",{indent:10})}\n          ${l("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${l("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${l("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`;return h}function r(e){let n=t(e);return`\n  function isSamePosition(point1, point2) {\n    ${n("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${n("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function i(t){var e=Math.pow(2,t);return`\nfunction setChild(node, idx, child) {\n  ${function(){let t=[];for(let n=0;n<e;++n){let e=0===n?"  ":"  else ";t.push(`${e}if (idx === ${n}) node.quad${n} = child;`)}return t.join("\n")}()}\n}`}function s(t){return`function getChild(node, idx) {\n${function(){let e=[],n=Math.pow(2,t);for(let t=0;t<n;++t)e.push(`  if (idx === ${t}) return node.quad${t};`);return e.join("\n")}()}\n  return null;\n}`}function o(e){let n=t(e),r=Math.pow(2,e);var i=`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(t){let e=[];for(let n=0;n<r;++n)e.push(`${t}quad${n} = null;`);return e.join("\n")}("  this.")}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${n("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${n("this.min_{var} = 0;",{indent:2})}\n  ${n("this.max_{var} = 0;",{indent:2})}\n}\n`;return i}function a(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}return qk.exports=function(t){let e=n(t);return new Function(e)()},qk.exports.generateQuadTreeFunctionBody=n,qk.exports.getInsertStackCode=a,qk.exports.getQuadNodeCode=o,qk.exports.isSamePosition=r,qk.exports.getChildBodyCode=s,qk.exports.setChildBodyCode=i,qk.exports}(),n=function(){if($k)return Xk.exports;$k=1,Xk.exports=function(t){let n=e(t);return new Function("bodies","settings","random",n)},Xk.exports.generateFunctionBody=e;const t=Hk();function e(e){let n=t(e);return`\n  var boundingBox = {\n    ${n("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${n("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${n("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${n("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${n("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${n("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${n("var max_{var} = -Infinity;",{indent:4})}\n    ${n("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${n("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${n("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${n("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${n("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${n("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}return Xk.exports}(),r=function(){if(Yk)return Kk.exports;Yk=1;const t=Hk();function e(e){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${t(e)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}return Kk.exports=function(t){let n=e(t);return new Function("options",n)},Kk.exports.generateCreateDragForceFunctionBody=e,Kk.exports}(),i=function(){if(Zk)return Jk.exports;Zk=1;const t=Hk();function e(e){let n=t(e);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${n("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${n("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${n("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${n("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}return Jk.exports=function(t){let n=e(t);return new Function("options","random",n)},Jk.exports.generateCreateSpringForceFunctionBody=e,Jk.exports}(),s=function(){if(Qk)return iO.exports;Qk=1;const t=Hk();function e(e){let n=t(e);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${n("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${n("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${n("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${n("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${n("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${n("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${n("body.pos.{var} += d{var};",{indent:4})}\n\n    ${n("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${n("t{var} * t{var}",{join:" + "})})/length;\n`}return iO.exports=function(t){let n=e(t);return new Function("bodies","timeStep","adaptiveTimeStepWeight",n)},iO.exports.generateIntegratorFunctionBody=e,iO.exports}(),o={};function a(t,e,n){if(t.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=Number.isFinite(t[n]);e[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return t[n]=r,e}return t[n]}:function(r){return void 0!==r?(t[n]=r,e):t[n]}}}return oO}var cO=function(){if(lO)return jk.exports;lO=1,jk.exports=function(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var i=(r&&r.createSimulator||hO())(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var s=n.version>19?function(t){var e=n.getLinks(t);return e?1+e.size/3:1}:function(t){var e=n.getLinks(t);return e?1+e.length/3:1};r&&"function"==typeof r.nodeMass&&(s=r.nodeMass);var o=new Map,a={},l=0,u=i.settings.springTransform||e;l=0,n.forEachNode((function(t){m(t.id),l+=1})),n.forEachLink(y),n.on("changed",f);var h=!1,c={step:function(){if(0===l)return d(!0),!0;var t=i.step();c.lastMove=t,c.fire("step");var e=t/l<=.01;return d(e),e},getNodePosition:function(t){return b(t).pos},setNodePosition:function(t){var e=b(t);e.setPosition.apply(e,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(t){var e=a[t];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return i.getBBox()},forEachBody:p,pinNode:function(t,e){b(t.id).isPinned=!!e},isNodePinned:function(t){return b(t.id).isPinned},dispose:function(){n.off("changed",f),c.fire("disposed")},getBody:function(t){return o.get(t)},getSpring:function(t,e){var r;if(void 0===e)r="object"!=typeof t?t:t.id;else{var i=n.hasLink(t,e);if(!i)return;r=i.id}return a[r]},getForceVectorLength:function(){var t=0,e=0;return p((function(n){t+=Math.abs(n.force.x),e+=Math.abs(n.force.y)})),Math.sqrt(t*t+e*e)},simulator:i,graph:n,lastMove:0};return t(c),c;function d(t){var e;h!==t&&(h=t,e=t,c.fire("stable",e))}function p(t){o.forEach(t)}function f(t){for(var e=0;e<t.length;++e){var r=t[e];"add"===r.changeType?(r.node&&m(r.node.id),r.link&&y(r.link)):"remove"===r.changeType&&(r.node&&g(r.node),r.link&&v(r.link))}l=n.getNodesCount()}function m(t){var e=o.get(t);if(!e){var r=n.getNode(t);if(!r)throw new Error("initBody() was called with unknown node id");var s=r.position;if(!s){var a=function(t){var e=[];if(!t.links)return e;for(var n=Math.min(t.links.length,2),r=0;r<n;++r){var i=t.links[r],s=i.fromId!==t.id?o.get(i.fromId):o.get(i.toId);s&&s.pos&&e.push(s)}return e}(r);s=i.getBestNewBodyPosition(a)}(e=i.addBodyAt(s)).id=t,o.set(t,e),_(t),function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)}(r)&&(e.isPinned=!0)}}function g(t){var e=t.id,n=o.get(e);n&&(o.delete(e),i.removeBody(n))}function y(t){_(t.fromId),_(t.toId);var e=o.get(t.fromId),n=o.get(t.toId),r=i.addSpring(e,n,t.length);u(t,r),a[t.id]=r}function v(t){var e=a[t.id];if(e){var r=n.getNode(t.fromId),s=n.getNode(t.toId);r&&_(r.id),s&&_(s.id),delete a[t.id],i.removeSpring(e)}}function _(t){var e=o.get(t);if(e.mass=s(t),Number.isNaN(e.mass))throw new Error("Node mass should be a number")}function b(t){var e=o.get(t);return e||(m(t),e=o.get(t)),e}},jk.exports.simulator=hO();var t=Ok();function e(){}return jk.exports}(),dO=p(cO);function pO(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var fO="object"==typeof global&&global&&global.Object===Object&&global,mO="object"==typeof self&&self&&self.Object===Object&&self,gO=fO||mO||Function("return this")(),yO=function(){return gO.Date.now()},vO=/\s/;var _O=/^\s+/;function bO(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&vO.test(t.charAt(e)););return e}(t)+1).replace(_O,""):t}var xO=gO.Symbol,wO=Object.prototype,MO=wO.hasOwnProperty,SO=wO.toString,TO=xO?xO.toStringTag:void 0;var EO=Object.prototype.toString;var AO=xO?xO.toStringTag:void 0;function CO(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":AO&&AO in Object(t)?function(t){var e=MO.call(t,TO),n=t[TO];try{t[TO]=void 0;var r=!0}catch(t){}var i=SO.call(t);return r&&(e?t[TO]=n:delete t[TO]),i}(t):function(t){return EO.call(t)}(t)}var RO=/^[-+]0x[0-9a-f]+$/i,NO=/^0b[01]+$/i,PO=/^0o[0-7]+$/i,kO=parseInt;function OO(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==CO(t)}(t))return NaN;if(pO(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=pO(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=bO(t);var n=NO.test(t);return n||PO.test(t)?kO(t.slice(2),n?2:8):RO.test(t)?NaN:+t}var IO=Math.max,DO=Math.min;function LO(t,e,n){var r,i,s,o,a,l,u=0,h=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||c&&t-u>=s}function m(){var t=yO();if(f(t))return g(t);a=setTimeout(m,function(t){var n=e-(t-l);return c?DO(n,s-(t-u)):n}(t))}function g(t){return a=void 0,d&&r?p(t):(r=i=void 0,o)}function y(){var t=yO(),n=f(t);if(r=arguments,i=this,l=t,n){if(void 0===a)return function(t){return u=t,a=setTimeout(m,e),h?p(t):o}(l);if(c)return clearTimeout(a),a=setTimeout(m,e),p(l)}return void 0===a&&(a=setTimeout(m,e)),o}return e=OO(e)||0,pO(n)&&(h=!!n.leading,s=(c="maxWait"in n)?IO(OO(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=l=i=a=void 0},y.flush=function(){return void 0===a?o:g(yO())},y}function UO(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function FO(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function zO(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return UO(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?UO(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var BO=FO((function t(e,n){var r=n.default,i=void 0===r?null:r,s=n.triggerUpdate,o=void 0===s||s,a=n.onChange,l=void 0===a?function(t,e){}:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l}));function jO(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,r=t.props,i=void 0===r?{}:r,s=t.methods,o=void 0===s?{}:s,a=t.aliases,l=void 0===a?{}:a,u=t.init,h=void 0===u?function(){}:u,c=t.update,d=void 0===c?function(){}:c,p=Object.keys(i).map((function(t){return new BO(t,i[t])}));return function t(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var s=!!(this instanceof t?this.constructor:void 0),a=s?r.shift():void 0,u=r[0],c=void 0===u?{}:u,f=Object.assign({},n instanceof Function?n(c):n,{initialised:!1}),m={};function g(t){return y(t,c),v(),g}var y=function(t,e){h.call(g,t,f,e),f.initialised=!0},v=LO((function(){f.initialised&&(d.call(g,f,m),m={})}),1);return p.forEach((function(t){g[t.name]=function(t){var e=t.name,n=t.triggerUpdate,r=void 0!==n&&n,i=t.onChange,s=void 0===i?function(t,e){}:i,o=t.defaultVal,a=void 0===o?null:o;return function(t){var n=f[e];if(!arguments.length)return n;var i=void 0===t?a:t;return f[e]=i,s.call(g,i,f,n),!m.hasOwnProperty(e)&&(m[e]=n),r&&v(),g}}(t)})),Object.keys(o).forEach((function(t){g[t]=function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=o[t]).call.apply(e,[g,f].concat(r))}})),Object.entries(l).forEach((function(t){var e=zO(t,2),n=e[0],r=e[1];return g[n]=g[r]})),g.resetProps=function(){return p.forEach((function(t){g[t.name](t.defaultVal)})),g},g.resetProps(),f._rerender=v,s&&a&&g(a),g}}var VO=function(t){return"function"==typeof t?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}};let GO=class extends Map{constructor(t,e=WO){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(HO(this,t))}has(t){return super.has(HO(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(r),t.delete(r));return n}(this,t))}};function HO({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function WO(t){return null!==t&&"object"==typeof t?t.valueOf():t}function qO(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function $O(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function XO(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function YO(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function KO(t,e){return t.get(YO(t,e))}function ZO(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function JO(t,e,n){return t.set(YO(t,e),n),n}function QO(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nI(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function tI(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||rI(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eI(t){return function(t){if(Array.isArray(t))return XO(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||rI(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nI(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function rI(t,e){if(t){if("string"==typeof t)return XO(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?XO(t,e):void 0}}var iI=new WeakMap,sI=new WeakMap,oI=new WeakMap,aI=new WeakMap,lI=new WeakMap,uI=new WeakMap,hI=function(){return QO((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ZO(this,iI,new Map),ZO(this,sI,new Map),ZO(this,oI,(function(t){return t})),ZO(this,aI,(function(){return{}})),ZO(this,lI,(function(){})),ZO(this,uI,(function(){}))}),[{key:"getObj",value:function(t){return KO(iI,this).get(KO(oI,this).call(this,t))}},{key:"getData",value:function(t){return KO(sI,this).get(t)}},{key:"entries",value:function(){return eI(KO(sI,this).entries()).map((function(t){var e=tI(t,2),n=e[0];return[e[1],n]}))}},{key:"id",value:function(t){return JO(oI,this,VO(t)),this}},{key:"onCreateObj",value:function(t){return JO(aI,this,t),this}},{key:"onUpdateObj",value:function(t){return JO(lI,this,t),this}},{key:"onRemoveObj",value:function(t){return JO(uI,this,t),this}},{key:"digest",value:function(t){var e=this;t.filter((function(t){return!KO(iI,e).has(KO(oI,e).call(e,t))})).forEach((function(t){var n=KO(aI,e).call(e,t);KO(iI,e).set(KO(oI,e).call(e,t),n),KO(sI,e).set(n,t)}));var n=new Map(t.map((function(t){return[KO(oI,e).call(e,t),t]})));return KO(iI,this).forEach((function(t,r){n.has(r)?KO(lI,e).call(e,t,n.get(r)):(KO(uI,e).call(e,t,r),KO(iI,e).delete(r),KO(sI,e).delete(t))})),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function cI(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const dI=Symbol("implicit");var pI=function(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function fI(t){return fI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fI(t)}var mI=/^\s+/,gI=/\s+$/;function yI(t,e){if(e=e||{},(t=t||"")instanceof yI)return t;if(!(this instanceof yI))return new yI(t,e);var n=function(t){var e={r:0,g:0,b:0},n=1,r=null,i=null,s=null,o=!1,a=!1;"string"==typeof t&&(t=function(t){t=t.replace(mI,"").replace(gI,"").toLowerCase();var e,n=!1;if(II[t])t=II[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=HI.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=HI.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=HI.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=HI.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=HI.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=HI.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=HI.hex8.exec(t))return{r:zI(e[1]),g:zI(e[2]),b:zI(e[3]),a:GI(e[4]),format:n?"name":"hex8"};if(e=HI.hex6.exec(t))return{r:zI(e[1]),g:zI(e[2]),b:zI(e[3]),format:n?"name":"hex"};if(e=HI.hex4.exec(t))return{r:zI(e[1]+""+e[1]),g:zI(e[2]+""+e[2]),b:zI(e[3]+""+e[3]),a:GI(e[4]+""+e[4]),format:n?"name":"hex8"};if(e=HI.hex3.exec(t))return{r:zI(e[1]+""+e[1]),g:zI(e[2]+""+e[2]),b:zI(e[3]+""+e[3]),format:n?"name":"hex"};return!1}(t));"object"==fI(t)&&(WI(t.r)&&WI(t.g)&&WI(t.b)?(e=function(t,e,n){return{r:255*UI(t,255),g:255*UI(e,255),b:255*UI(n,255)}}(t.r,t.g,t.b),o=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):WI(t.h)&&WI(t.s)&&WI(t.v)?(r=jI(t.s),i=jI(t.v),e=function(t,e,n){t=6*UI(t,360),e=UI(e,100),n=UI(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6,u=[n,o,s,s,a,n][l],h=[a,n,n,o,s,s][l],c=[s,s,a,n,n,o][l];return{r:255*u,g:255*h,b:255*c}}(t.h,r,i),o=!0,a="hsv"):WI(t.h)&&WI(t.s)&&WI(t.l)&&(r=jI(t.s),s=jI(t.l),e=function(t,e,n){var r,i,s;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=UI(t,360),e=UI(e,100),n=UI(n,100),0===e)r=i=s=n;else{var a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,r,s),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a));return n=LI(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function vI(t,e,n){t=UI(t,255),e=UI(e,255),n=UI(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=(s+o)/2;if(s==o)r=i=0;else{var l=s-o;switch(i=a>.5?l/(2-s-o):l/(s+o),s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,l:a}}function _I(t,e,n){t=UI(t,255),e=UI(e,255),n=UI(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=s,l=s-o;if(i=0===s?0:l/s,s==o)r=0;else{switch(s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,v:a}}function bI(t,e,n,r){var i=[BI(Math.round(t).toString(16)),BI(Math.round(e).toString(16)),BI(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function xI(t,e,n,r){return[BI(VI(r)),BI(Math.round(t).toString(16)),BI(Math.round(e).toString(16)),BI(Math.round(n).toString(16))].join("")}function wI(t,e){e=0===e?0:e||10;var n=yI(t).toHsl();return n.s-=e/100,n.s=FI(n.s),yI(n)}function MI(t,e){e=0===e?0:e||10;var n=yI(t).toHsl();return n.s+=e/100,n.s=FI(n.s),yI(n)}function SI(t){return yI(t).desaturate(100)}function TI(t,e){e=0===e?0:e||10;var n=yI(t).toHsl();return n.l+=e/100,n.l=FI(n.l),yI(n)}function EI(t,e){e=0===e?0:e||10;var n=yI(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),yI(n)}function AI(t,e){e=0===e?0:e||10;var n=yI(t).toHsl();return n.l-=e/100,n.l=FI(n.l),yI(n)}function CI(t,e){var n=yI(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,yI(n)}function RI(t){var e=yI(t).toHsl();return e.h=(e.h+180)%360,yI(e)}function NI(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=yI(t).toHsl(),r=[yI(t)],i=360/e,s=1;s<e;s++)r.push(yI({h:(n.h+s*i)%360,s:n.s,l:n.l}));return r}function PI(t){var e=yI(t).toHsl(),n=e.h;return[yI(t),yI({h:(n+72)%360,s:e.s,l:e.l}),yI({h:(n+216)%360,s:e.s,l:e.l})]}function kI(t,e,n){e=e||6,n=n||30;var r=yI(t).toHsl(),i=360/n,s=[yI(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(yI(r));return s}function OI(t,e){e=e||6;for(var n=yI(t).toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/e;e--;)o.push(yI({h:r,s:i,v:s})),s=(s+a)%1;return o}yI.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=LI(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=_I(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=_I(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=vI(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=vI(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return bI(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var s=[BI(Math.round(t).toString(16)),BI(Math.round(e).toString(16)),BI(Math.round(n).toString(16)),BI(VI(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*UI(this._r,255))+"%",g:Math.round(100*UI(this._g,255))+"%",b:Math.round(100*UI(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*UI(this._r,255))+"%, "+Math.round(100*UI(this._g,255))+"%, "+Math.round(100*UI(this._b,255))+"%)":"rgba("+Math.round(100*UI(this._r,255))+"%, "+Math.round(100*UI(this._g,255))+"%, "+Math.round(100*UI(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(DI[bI(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+xI(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=yI(t);n="#"+xI(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return yI(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(TI,arguments)},brighten:function(){return this._applyModification(EI,arguments)},darken:function(){return this._applyModification(AI,arguments)},desaturate:function(){return this._applyModification(wI,arguments)},saturate:function(){return this._applyModification(MI,arguments)},greyscale:function(){return this._applyModification(SI,arguments)},spin:function(){return this._applyModification(CI,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(kI,arguments)},complement:function(){return this._applyCombination(RI,arguments)},monochromatic:function(){return this._applyCombination(OI,arguments)},splitcomplement:function(){return this._applyCombination(PI,arguments)},triad:function(){return this._applyCombination(NI,[3])},tetrad:function(){return this._applyCombination(NI,[4])}},yI.fromRatio=function(t,e){if("object"==fI(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:jI(t[r]));t=n}return yI(t,e)},yI.equals=function(t,e){return!(!t||!e)&&yI(t).toRgbString()==yI(e).toRgbString()},yI.random=function(){return yI.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},yI.mix=function(t,e,n){n=0===n?0:n||50;var r=yI(t).toRgb(),i=yI(e).toRgb(),s=n/100;return yI({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},
// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)
// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)
yI.readability=function(t,e){var n=yI(t),r=yI(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},yI.isReadable=function(t,e,n){var r,i,s=yI.readability(t,e);switch(i=!1,(r=function(t){var e,n;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==n&&"large"!==n&&(n="small");return{level:e,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},yI.mostReadable=function(t,e,n){var r,i,s,o,a=null,l=0;i=(n=n||{}).includeFallbackColors,s=n.level,o=n.size;for(var u=0;u<e.length;u++)(r=yI.readability(t,e[u]))>l&&(l=r,a=yI(e[u]));return yI.isReadable(t,a,{level:s,size:o})||!i?a:(n.includeFallbackColors=!1,yI.mostReadable(t,["#fff","#000"],n))};var II=yI.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},DI=yI.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(II);function LI(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function UI(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function FI(t){return Math.min(1,Math.max(0,t))}function zI(t){return parseInt(t,16)}function BI(t){return 1==t.length?"0"+t:""+t}function jI(t){return t<=1&&(t=100*t+"%"),t}function VI(t){return Math.round(255*parseFloat(t)).toString(16)}function GI(t){return zI(t)/255}var HI=function(){var t="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",e="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+e),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+e),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+e),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function WI(t){return!!HI.CSS_UNIT.exec(t)}function qI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function $I(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function XI(t,e,n){return e=rD(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,sD()?Reflect.construct(e,n||[],rD(t).constructor):e.apply(t,n))}function YI(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function KI(t,e){return t.get($I(t,e))}function ZI(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function JI(t,e,n){return t.set($I(t,e),n),n}function QI(t,e,n){if(sD())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}function tD(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,cD(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function eD(t,e,n){return(e=cD(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nD(){return nD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=rD(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},nD.apply(null,arguments)}function rD(t){return rD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rD(t)}function iD(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&aD(t,e)}function sD(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(sD=function(){return!!t})()}function oD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function aD(t,e){return aD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},aD(t,e)}function lD(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||pD(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uD(t,e,n,r){var i=nD(rD(t.prototype),e,n);return"function"==typeof i?function(t){return i.apply(n,t)}:i}function hD(t){return function(t){if(Array.isArray(t))return qI(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||pD(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cD(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function dD(t){return dD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dD(t)}function pD(t,e){if(t){if("string"==typeof t)return qI(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qI(t,e):void 0}}var fD=function(t){t instanceof Array?t.forEach(fD):(t.map&&t.map.dispose(),t.dispose())},mD=function(t){t.geometry&&t.geometry.dispose(),t.material&&fD(t.material),t.texture&&t.texture.dispose(),t.children&&t.children.forEach(mD)},gD=function(t){for(;t.children.length;){var e=t.children[0];t.remove(e),mD(e)}},yD=new WeakMap,vD=new WeakMap,_D=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.dataBindAttr,s=void 0===i?"__data":i,o=r.objBindAttr,a=void 0===o?"__threeObj":o;return YI(this,e),eD(n=XI(this,e),"scene",void 0),ZI(n,yD,void 0),ZI(n,vD,void 0),n.scene=t,JI(yD,n,s),JI(vD,n,a),n.onRemoveObj((function(){})),n}return iD(e,t),tD(e,[{key:"onCreateObj",value:function(t){var n=this;return uD(e,"onCreateObj",this)([function(e){var r=t(e);return e[KI(vD,n)]=r,r[KI(yD,n)]=e,n.scene.add(r),r}]),this}},{key:"onRemoveObj",value:function(t){var n=this;return uD(e,"onRemoveObj",this)([function(r,i){var s=uD(e,"getData",n)([r]);t(r,i),n.scene.remove(r),gD(r),delete s[KI(vD,n)]}]),this}}])}(hI),bD=function(t){return isNaN(t)?parseInt(yI(t).toHex(),16):t},xD=function(t){return isNaN(t)?yI(t).getAlpha():1},wD=function t(){var e=new GO,n=[],r=[],i=dI;function s(t){let s=e.get(t);if(void 0===s){if(i!==dI)return i;e.set(t,s=n.push(t)-1)}return r[s%r.length]}return s.domain=function(t){if(!arguments.length)return n.slice();n=[],e=new GO;for(const r of t)e.has(r)||e.set(r,n.push(r)-1);return s},s.range=function(t){return arguments.length?(r=Array.from(t),s):r.slice()},s.unknown=function(t){return arguments.length?(i=t,s):i},s.copy=function(){return t(n,r).unknown(i)},cI.apply(s,arguments),s}(pI);function MD(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=wD(e(t))}))}var SD=window.THREE?window.THREE:{Group:kE,Mesh:mE,MeshLambertMaterial:PA,Color:OT,BufferGeometry:rE,BufferAttribute:WT,Matrix4:jS,Vector3:cS,SphereGeometry:MA,CylinderGeometry:bA,TubeGeometry:SA,ConeGeometry:xA,Line:class extends fT{constructor(t=new rE,e=new YE){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)KE.fromBufferAttribute(e,t-1),ZE.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=KE.distanceTo(ZE);t.setAttribute("lineDistance",new YT(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),tA.copy(n.boundingSphere),tA.applyMatrix4(r),tA.radius+=i,!1===t.ray.intersectsSphere(tA))return;JE.copy(r).invert(),QE.copy(t.ray).applyMatrix4(JE);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=this.isLineSegments?2:1,u=n.index,h=n.attributes.position;if(null!==u){const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=u.getX(i),r=u.getX(i+1),s=rA(this,t,QE,a,n,r,i);s&&e.push(s)}if(this.isLineLoop){const i=u.getX(r-1),s=u.getX(n),o=rA(this,t,QE,a,i,s,r-1);o&&e.push(o)}}else{const n=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=rA(this,t,QE,a,i,i+1,i);n&&e.push(n)}if(this.isLineLoop){const i=rA(this,t,QE,a,r-1,n,r-1);i&&e.push(i)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}},LineBasicMaterial:YE,QuadraticBezierCurve3:vA,CubicBezierCurve3:yA,Box3:fS},TD={graph:Bk,forcelayout:dO},ED=(new SD.BufferGeometry).setAttribute?"setAttribute":"addAttribute",AD=(new SD.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",CD=jO({props:{jsonUrl:{onChange:function(t,e){var n=this;t&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(t).then((function(t){return t.json()})).then((function(t){e.fetchingJson=!1,e.onFinishLoading(t),n.graphData(t)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(t,e){var n=e.d3ForceLayout.force("charge");function r(t,e){t.forEach((function(t){delete t[e],delete t["v".concat(e)]}))}n&&n.strength(t>2?-60:-30),t<3&&r(e.graphData.nodes,"z"),t<2&&r(e.graphData.nodes,"y")}},dagMode:{onChange:function(t,e){!t&&"d3"===e.forceEngine&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=t.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.velocityDecay(t)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(t){return t._flushObjects=!0,t._rerender(),this},d3Force:function(t,e,n){return void 0===n?t.d3ForceLayout.force(e):(t.d3ForceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},tickFrame:function(t){var e,n,r,i,s="ngraph"!==t.forceEngine;return t.engineRunning&&function(){++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||s&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.layout[s?"tick":"step"](),t.onEngineTick());var e=VO(t.nodeThreeObjectExtend);t.nodeDataMapper.entries().forEach((function(n){var r=lD(n,2),i=r[0],o=r[1];if(o){var a=s?i:t.layout.getNodePosition(i[t.nodeId]),l=e(i);t.nodePositionUpdate&&t.nodePositionUpdate(l?o.children[0]:o,{x:a.x,y:a.y,z:a.z},i)&&!l||(o.position.x=a.x,o.position.y=a.y||0,o.position.z=a.z||0)}}));var n=VO(t.linkWidth),r=VO(t.linkCurvature),i=VO(t.linkCurveRotation),o=VO(t.linkThreeObjectExtend);function a(e){var n=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),o=n[s?"source":"from"],a=n[s?"target":"to"];if(o&&a&&o.hasOwnProperty("x")&&a.hasOwnProperty("x")){var l=r(e);if(l){var u,h=new SD.Vector3(o.x,o.y||0,o.z||0),c=new SD.Vector3(a.x,a.y||0,a.z||0),d=h.distanceTo(c),p=i(e);if(d>0){var f=a.x-o.x,m=a.y-o.y||0,g=(new SD.Vector3).subVectors(c,h),y=g.clone().multiplyScalar(l).cross(0!==f||0!==m?new SD.Vector3(0,0,1):new SD.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new SD.Vector3).addVectors(h,c).divideScalar(2));u=new SD.QuadraticBezierCurve3(h,y,c)}else{var v=70*l,_=-p,b=_+Math.PI/2;u=new SD.CubicBezierCurve3(h,new SD.Vector3(v*Math.cos(b),v*Math.sin(b),0).add(h),new SD.Vector3(v*Math.cos(_),v*Math.sin(_),0).add(h),c)}e.__curve=u}else e.__curve=null}}t.linkDataMapper.entries().forEach((function(e){var r=lD(e,2),i=r[0],l=r[1];if(l){var u=s?i:t.layout.getLinkPosition(t.layout.graph.getLink(i.source,i.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){a(i);var d=o(i);if(!t.linkPositionUpdate||!t.linkPositionUpdate(d?l.children[1]:l,{start:{x:h.x,y:h.y,z:h.z},end:{x:c.x,y:c.y,z:c.z}},i)||d){var p=30,f=i.__curve,m=l.children.length?l.children[0]:l;if("Line"===m.type){if(f){var g=f.getPoints(p);m.geometry.getAttribute("position").array.length!==3*g.length&&m.geometry[ED]("position",new SD.BufferAttribute(new Float32Array(3*g.length),3)),m.geometry.setFromPoints(g)}else{var y=m.geometry.getAttribute("position");y&&y.array&&6===y.array.length||m.geometry[ED]("position",y=new SD.BufferAttribute(new Float32Array(6),3)),y.array[0]=h.x,y.array[1]=h.y||0,y.array[2]=h.z||0,y.array[3]=c.x,y.array[4]=c.y||0,y.array[5]=c.z||0,y.needsUpdate=!0}m.geometry.computeBoundingSphere()}else if("Mesh"===m.type)if(f){m.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1));var v=Math.ceil(10*n(i))/10/2,_=new SD.TubeGeometry(f,p,v,t.linkResolution,!1);m.geometry.dispose(),m.geometry=_}else{if(!m.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var b=Math.ceil(10*n(i))/10/2,x=new SD.CylinderGeometry(b,b,1,t.linkResolution,1,!1);x[AD]((new SD.Matrix4).makeTranslation(0,.5,0)),x[AD]((new SD.Matrix4).makeRotationX(Math.PI/2)),m.geometry.dispose(),m.geometry=x}var w=new SD.Vector3(h.x,h.y||0,h.z||0),M=new SD.Vector3(c.x,c.y||0,c.z||0),S=w.distanceTo(M);m.position.x=w.x,m.position.y=w.y,m.position.z=w.z,m.scale.z=S,m.parent.localToWorld(M),m.lookAt(M)}}}}}))}(),e=VO(t.linkDirectionalArrowRelPos),n=VO(t.linkDirectionalArrowLength),r=VO(t.nodeVal),t.arrowDataMapper.entries().forEach((function(i){var o=lD(i,2),a=o[0],l=o[1];if(l){var u=s?a:t.layout.getLinkPosition(t.layout.graph.getLink(a.source,a.target).id),h=u[s?"source":"from"],c=u[s?"target":"to"];if(h&&c&&h.hasOwnProperty("x")&&c.hasOwnProperty("x")){var d=Math.cbrt(Math.max(0,r(h)||1))*t.nodeRelSize,p=Math.cbrt(Math.max(0,r(c)||1))*t.nodeRelSize,f=n(a),m=e(a),g=a.__curve?function(t){return a.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",h,c,t),y:e("y",h,c,t),z:e("z",h,c,t)}},y=a.__curve?a.__curve.getLength():Math.sqrt(["x","y","z"].map((function(t){return Math.pow((c[t]||0)-(h[t]||0),2)})).reduce((function(t,e){return t+e}),0)),v=d+f+(y-d-p-f)*m,_=g(v/y),b=g((v-f)/y);["x","y","z"].forEach((function(t){return l.position[t]=b[t]}));var x=QI(SD.Vector3,hD(["x","y","z"].map((function(t){return _[t]}))));l.parent.localToWorld(x),l.lookAt(x)}}})),i=VO(t.linkDirectionalParticleSpeed),t.graphData.links.forEach((function(e){var n=t.particlesDataMapper.getObj(e),r=n&&n.children,o=e.__singleHopPhotonsObj&&e.__singleHopPhotonsObj.children;if(o&&o.length||r&&r.length){var a=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),l=a[s?"source":"from"],u=a[s?"target":"to"];if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var h=i(e),c=e.__curve?function(t){return e.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",l,u,t),y:e("y",l,u,t),z:e("z",l,u,t)}};[].concat(hD(r||[]),hD(o||[])).forEach((function(t,e){var n="singleHopPhotons"===t.parent.__linkThreeObjType;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=n?0:e/r.length),t.__progressRatio+=h,t.__progressRatio>=1){if(n)return t.parent.remove(t),void gD(t);t.__progressRatio=t.__progressRatio%1}var i=t.__progressRatio,s=c(i);["x","y","z"].forEach((function(e){return t.position[e]=s[e]}))}))}}})),this},emitParticle:function(t,e){if(e&&t.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var n=new SD.Group;n.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=n,t.graphScene.add(n)}var r=VO(t.linkDirectionalParticleWidth),i=Math.ceil(10*r(e))/10/2,s=t.linkDirectionalParticleResolution,o=new SD.SphereGeometry(i,s,s),a=VO(t.linkColor),l=VO(t.linkDirectionalParticleColor)(e)||a(e)||"#f0f0f0",u=new SD.Color(bD(l)),h=3*t.linkOpacity,c=new SD.MeshLambertMaterial({color:u,transparent:!0,opacity:h});e.__singleHopPhotonsObj.add(new SD.Mesh(o,c))}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!t.initialised)return null;var n=function t(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new SD.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,hD((n.children||[]).filter((function(t){return!t.hasOwnProperty("__graphObjType")||"node"===t.__graphObjType&&e(t.__data)})).map(t)))}(t.graphScene);return n.length?Object.assign.apply(Object,hD(["x","y","z"].map((function(t){return eD({},t,[$O(n,(function(e){return e.min[t]})),qO(n,(function(e){return e.max[t]}))])})))):null}},stateInit:function(){return{d3ForceLayout:Pk().force("link",JP()).force("charge",kk()).force("center",wP()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.graphScene=t,e.nodeDataMapper=new _D(t,{objBindAttr:"__threeObj"}),e.linkDataMapper=new _D(t,{objBindAttr:"__lineObj"}),e.arrowDataMapper=new _D(t,{objBindAttr:"__arrowObj"}),e.particlesDataMapper=new _D(t,{objBindAttr:"__photonsObj"})},update:function(t,e){var n=function(t){return t.some((function(t){return e.hasOwnProperty(t)}))};if(t.engineRunning=!1,"function"==typeof t.onUpdate&&t.onUpdate(),null!==t.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&MD(t.graphData.nodes,VO(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&MD(t.graphData.links,VO(t.linkAutoColorBy),t.linkColor),t._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=VO(t.nodeThreeObject),i=VO(t.nodeThreeObjectExtend),s=VO(t.nodeVal),o=VO(t.nodeColor),a=VO(t.nodeVisibility),l={},u={};(t._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&t.nodeDataMapper.clear(),t.nodeDataMapper.onCreateObj((function(e){var n,s=r(e),o=i(e);return s&&t.nodeThreeObject===s&&(s=s.clone()),s&&!o?n=s:((n=new SD.Mesh).__graphDefaultObj=!0,s&&o&&n.add(s)),n.__graphObjType="node",n})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=s(n)||1,i=Math.cbrt(r)*t.nodeRelSize,a=t.nodeResolution;e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&e.geometry.parameters.radius===i&&e.geometry.parameters.widthSegments===a||(l.hasOwnProperty(r)||(l[r]=new SD.SphereGeometry(i,a,a)),e.geometry.dispose(),e.geometry=l[r]);var h=o(n),c=new SD.Color(bD(h||"#ffffaa")),d=t.nodeOpacity*xD(h);"MeshLambertMaterial"===e.material.type&&e.material.color.equals(c)&&e.material.opacity===d||(u.hasOwnProperty(h)||(u[h]=new SD.MeshLambertMaterial({color:c,transparent:!0,opacity:d})),e.material.dispose(),e.material=u[h])}})).digest(t.graphData.nodes.filter(a))}if(t._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=VO(t.linkThreeObject),c=VO(t.linkThreeObjectExtend),d=VO(t.linkMaterial),p=VO(t.linkVisibility),f=VO(t.linkColor),m=VO(t.linkWidth),g={},y={},v={},_=t.graphData.links.filter(p);if((t._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&t.linkDataMapper.clear(),t.linkDataMapper.onRemoveObj((function(t){var e=t.__data&&t.__data.__singleHopPhotonsObj;e&&(e.parent.remove(e),gD(e),delete t.__data.__singleHopPhotonsObj)})).onCreateObj((function(e){var n,r,i=h(e),s=c(e);if(i&&t.linkThreeObject===i&&(i=i.clone()),!i||s)if(!!m(e))n=new SD.Mesh;else{var o=new SD.BufferGeometry;o[ED]("position",new SD.BufferAttribute(new Float32Array(6),3)),n=new SD.Line(o)}return i?s?((r=new SD.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r})).onUpdateObj((function(e,n){if(e.__graphDefaultObj){var r=e.children.length?e.children[0]:e,i=Math.ceil(10*m(n))/10,s=!!i;if(s){var o=i/2,a=t.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==a){if(!g.hasOwnProperty(i)){var l=new SD.CylinderGeometry(o,o,1,a,1,!1);l[AD]((new SD.Matrix4).makeTranslation(0,.5,0)),l[AD]((new SD.Matrix4).makeRotationX(Math.PI/2)),g[i]=l}r.geometry.dispose(),r.geometry=g[i]}}var u=d(n);if(u)r.material=u;else{var h=f(n),c=new SD.Color(bD(h||"#f0f0f0")),p=t.linkOpacity*xD(h),_=s?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==_||!r.material.color.equals(c)||r.material.opacity!==p){var b=s?y:v;b.hasOwnProperty(h)||(b[h]=new SD[_]({color:c,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=b[h]}}}})).digest(_),t.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var b=VO(t.linkDirectionalArrowLength),x=VO(t.linkDirectionalArrowColor);t.arrowDataMapper.onCreateObj((function(){var t=new SD.Mesh(void 0,new SD.MeshLambertMaterial({transparent:!0}));return t.__linkThreeObjType="arrow",t})).onUpdateObj((function(e,n){var r=b(n),i=t.linkDirectionalArrowResolution;if(!e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||e.geometry.parameters.height!==r||e.geometry.parameters.radialSegments!==i){var s=new SD.ConeGeometry(.25*r,r,i);s.translate(0,r/2,0),s.rotateX(Math.PI/2),e.geometry.dispose(),e.geometry=s}var o=x(n)||f(n)||"#f0f0f0";e.material.color=new SD.Color(bD(o)),e.material.opacity=3*t.linkOpacity*xD(o)})).digest(_.filter(b))}if(t.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var w=VO(t.linkDirectionalParticles),M=VO(t.linkDirectionalParticleWidth),S=VO(t.linkDirectionalParticleColor),T={},E={};t.particlesDataMapper.onCreateObj((function(){var t=new SD.Group;return t.__linkThreeObjType="photons",t.__photonDataMapper=new _D(t),t})).onUpdateObj((function(e,n){var r,i=Math.round(Math.abs(w(n))),s=!!e.children.length&&e.children[0],o=Math.ceil(10*M(n))/10/2,a=t.linkDirectionalParticleResolution;s&&s.geometry.parameters.radius===o&&s.geometry.parameters.widthSegments===a?r=s.geometry:(E.hasOwnProperty(o)||(E[o]=new SD.SphereGeometry(o,a,a)),r=E[o],s&&s.geometry.dispose());var l,u=S(n)||f(n)||"#f0f0f0",h=new SD.Color(bD(u)),c=3*t.linkOpacity;s&&s.material.color.equals(h)&&s.material.opacity===c?l=s.material:(T.hasOwnProperty(u)||(T[u]=new SD.MeshLambertMaterial({color:h,transparent:!0,opacity:c})),l=T[u],s&&s.material.dispose()),e.__photonDataMapper.id((function(t){return t.idx})).onCreateObj((function(){return new SD.Mesh(r,l)})).onUpdateObj((function(t){t.geometry=r,t.material=l})).digest(hD(new Array(i)).map((function(t,e){return{idx:e}})))})).digest(_.filter(w))}}if(t._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){t.engineRunning=!1,t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]}));var A,C="ngraph"!==t.forceEngine;if(C){(A=t.d3ForceLayout).stop().alpha(1).numDimensions(t.numDimensions).nodes(t.graphData.nodes);var R=t.d3ForceLayout.force("link");R&&R.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var N=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===dD(t)?e(t):t}o.out.push(a)}));var h=[];return function t(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=function(){var s=n[o];if(-1!==r.indexOf(s)){var a=[].concat(hD(r.slice(r.indexOf(s))),[s]).map((function(t){return e(t.data)}));return h.some((function(t){return t.length===a.length&&t.every((function(t,e){return t===a[e]}))}))||(h.push(a),l(a)),1}i>s.depth&&(s.depth=i,t(s.out,[].concat(hD(r),[s]),i+(s.skip?0:1)))},o=0,a=n.length;o<a;o++)s()}(Object.values(u)),Object.assign.apply(Object,[{}].concat(hD(Object.entries(u).filter((function(t){return!lD(t,2)[1].skip})).map((function(t){var e=lD(t,2);return eD({},e[0],e[1].depth)})))))}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),P=Math.max.apply(Math,hD(Object.values(N||[]))),k=t.dagLevelDistance||t.graphData.nodes.length/(P||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var O=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[O]}))}if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var I=["rl","td","zout"].includes(t.dagMode),D=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[D]=function(e){return(N[e[t.nodeId]]-P/2)*k*(I?-1:1)}(e)}))}t.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?function(t,e,n,r){var i,s,o,a,l=XP(.1);function u(t){for(var l=0,u=i.length;l<u;++l){var h=i[l],c=h.x-e||1e-6,d=(h.y||0)-n||1e-6,p=(h.z||0)-r||1e-6,f=Math.sqrt(c*c+d*d+p*p),m=(a[l]-f)*o[l]*t/f;h.vx+=c*m,s>1&&(h.vy+=d*m),s>2&&(h.vz+=p*m)}}function h(){if(i){var e,n=i.length;for(o=new Array(n),a=new Array(n),e=0;e<n;++e)a[e]=+t(i[e],e,i),o[e]=isNaN(a[e])?0:+l(i[e],e,i)}}return"function"!=typeof t&&(t=XP(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),u.initialize=function(t,...e){i=t,s=e.find((t=>[1,2,3].includes(t)))||2,h()},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:XP(+t),h(),u):l},u.radius=function(e){return arguments.length?(t="function"==typeof e?e:XP(+e),h(),u):t},u.x=function(t){return arguments.length?(e=+t,u):e},u.y=function(t){return arguments.length?(n=+t,u):n},u.z=function(t){return arguments.length?(r=+t,u):r},u}((function(e){var n=N[e[t.nodeId]]||-1;return("radialin"===t.dagMode?P-n:n)*k})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null)}else{var L=TD.graph();t.graphData.nodes.forEach((function(e){L.addNode(e[t.nodeId])})),t.graphData.links.forEach((function(t){L.addLink(t.source,t.target)})),A=TD.forcelayout(L,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oD(Object(n),!0).forEach((function(e){eD(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oD(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({dimensions:t.numDimensions},t.ngraphPhysics)),A.graph=L}for(var U=0;U<t.warmupTicks&&!(C&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin);U++)A[C?"tick":"step"]();t.layout=A,this.resetCountdown()}t.engineRunning=!0,t.onFinishUpdate()}});var RD=function(t){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function r(){var n;YI(this,r);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=XI(this,r,[].concat(s))).__kapsuleInstance=QI(t,[].concat(hD(e?[n]:[]),s)),n}return iD(r,n),tD(r)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(t()).forEach((function(t){return n.prototype[t]=function(){var e,n=(e=this.__kapsuleInstance)[t].apply(e,arguments);return n===this.__kapsuleInstance?this:n}})),n}(CD,(window.THREE?window.THREE:{Group:kE}).Group,!0);const ND=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class PD{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=!0===t.object.isSkinnedMesh,this.refreshUniforms=ND,this.renderId=0}firstInitialization(t){return!1===this.renderObjects.has(t)&&(this.getRenderObjectData(t),!0)}getRenderObjectData(t){let e=this.renderObjects.get(t);if(void 0===e){const{geometry:n,material:r,object:i}=t;if(e={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(e.center=i.center.clone()),i.morphTargetInfluences&&(e.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==t.bundle&&(e.version=t.bundle.version),e.material.transmission>0){const{width:n,height:r}=t.context;e.bufferWidth=n,e.bufferHeight=r}this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const n in t){const r=t[n];e[n]={version:r.version}}return e}containsNode(t){const e=t.material;for(const t in e)if(e[t]&&e[t].isNode)return!0;return null!==t.renderer.nodes.modelViewMatrix||null!==t.renderer.nodes.modelNormalViewMatrix}getMaterialData(t){const e={};for(const n of this.refreshUniforms){const r=t[n];null!=r&&("object"==typeof r&&void 0!==r.clone?!0===r.isTexture?e[n]={id:r.id,version:r.version}:e[n]=r.clone():e[n]=r)}return e}equals(t){const{object:e,material:n,geometry:r}=t,i=this.getRenderObjectData(t);if(!0!==i.worldMatrix.equals(e.matrixWorld))return i.worldMatrix.copy(e.matrixWorld),!1;const s=i.material;for(const t in s){const e=s[t],r=n[t];if(void 0!==e.equals){if(!1===e.equals(r))return e.copy(r),!1}else if(!0===r.isTexture){if(e.id!==r.id||e.version!==r.version)return e.id=r.id,e.version=r.version,!1}else if(e!==r)return s[t]=r,!1}if(s.transmission>0){const{width:e,height:n}=t.context;if(i.bufferWidth!==e||i.bufferHeight!==n)return i.bufferWidth=e,i.bufferHeight=n,!1}const o=i.geometry,a=r.attributes,l=o.attributes,u=Object.keys(l),h=Object.keys(a);if(o.id!==r.id)return o.id=r.id,!1;if(u.length!==h.length)return i.geometry.attributes=this.getAttributesData(a),!1;for(const t of u){const e=l[t],n=a[t];if(void 0===n)return delete l[t],!1;if(e.version!==n.version)return e.version=n.version,!1}const c=r.index,d=o.indexVersion,p=c?c.version:null;if(d!==p)return o.indexVersion=p,!1;if(o.drawRange.start!==r.drawRange.start||o.drawRange.count!==r.drawRange.count)return o.drawRange.start=r.drawRange.start,o.drawRange.count=r.drawRange.count,!1;if(i.morphTargetInfluences){let t=!1;for(let n=0;n<i.morphTargetInfluences.length;n++)i.morphTargetInfluences[n]!==e.morphTargetInfluences[n]&&(t=!0);if(t)return!0}return i.center&&!1===i.center.equals(e.center)?(i.center.copy(e.center),!0):(null!==t.bundle&&(i.version=t.bundle.version),!0)}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t))return!0;const{renderId:n}=e;if(this.renderId!==n)return this.renderId=n,!0;const r=!0===t.object.static,i=null!==t.bundle&&!0===t.bundle.static&&this.getRenderObjectData(t).version===t.bundle.version;if(r||i)return!1;return!0!==this.equals(t)}}function kD(t,e=0){let n=3735928559^e,r=1103547991^e;if(t instanceof Array)for(let e,i=0;i<t.length;i++)e=t[i],n=Math.imul(n^e,2654435761),r=Math.imul(r^e,1597334677);else for(let e,i=0;i<t.length;i++)e=t.charCodeAt(i),n=Math.imul(n^e,2654435761),r=Math.imul(r^e,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}const OD=t=>kD(t),ID=(...t)=>kD(t);function DD(t,e=!1){const n=[];!0===t.isNode&&(n.push(t.id),t=t.getSelf());for(const{property:r,childNode:i}of LD(t))n.push(kD(r.slice(0,-4)),i.getCacheKey(e));return kD(n)}function*LD(t,e=!1){for(const n in t){if(!0===n.startsWith("_"))continue;const r=t[n];if(!0===Array.isArray(r))for(let t=0;t<r.length;t++){const i=r[t];i&&(!0===i.isNode||e&&"function"==typeof i.toJSON)&&(yield{property:n,index:t,childNode:i})}else if(r&&!0===r.isNode)yield{property:n,childNode:r};else if("object"==typeof r)for(const t in r){const i=r[t];i&&(!0===i.isNode||e&&"function"==typeof i.toJSON)&&(yield{property:n,index:t,childNode:i})}}}const UD=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),FD=new WeakMap;function zD(t){if(null==t)return null;const e=typeof t;return!0===t.isNode?"node":"number"===e?"float":"boolean"===e?"bool":"string"===e?"string":"function"===e?"shader":!0===t.isVector2?"vec2":!0===t.isVector3?"vec3":!0===t.isVector4?"vec4":!0===t.isMatrix2?"mat2":!0===t.isMatrix3?"mat3":!0===t.isMatrix4?"mat4":!0===t.isColor?"color":t instanceof ArrayBuffer?"ArrayBuffer":null}function BD(t,...e){const n=t?t.slice(-4):void 0;return 1===e.length&&("vec2"===n?e=[e[0],e[0]]:"vec3"===n?e=[e[0],e[0],e[0]]:"vec4"===n&&(e=[e[0],e[0],e[0],e[0]])),"color"===t?new OT(...e):"vec2"===n?new FM(...e):"vec3"===n?new cS(...e):"vec4"===n?new sS(...e):"mat2"===n?new gC(...e):"mat3"===n?new zM(...e):"mat4"===n?new jS(...e):"bool"===t?e[0]||!1:"float"===t||"int"===t||"uint"===t?e[0]||0:"string"===t?e[0]||"":"ArrayBuffer"===t?(r=e[0],Uint8Array.from(atob(r),(t=>t.charCodeAt(0))).buffer):null;var r}function jD(t){let e=FD.get(t);return void 0===e&&(e={},FD.set(t,e)),e}const VD="vertex",GD="none",HD="frame",WD="render",qD="object",$D="readOnly",XD="writeOnly",YD="readWrite",KD=["setup","analyze","generate"],ZD=["fragment","vertex","compute"],JD=["x","y","z","w"];let QD=0,tL=class extends EM{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=GD,this.updateBeforeType=GD,this.updateAfterType=GD,this.uuid=UM.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:QD++})}set needsUpdate(t){!0===t&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,HD)}onRenderUpdate(t){return this.onUpdate(t,WD)}onObjectUpdate(t){return this.onUpdate(t,qD)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of LD(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return!0!==(t=t||this.version!==this._cacheKeyVersion)&&null!==this._cacheKey||(this._cacheKey=ID(DD(this,t),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getMemberType(){return"void"}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let n=0;for(const t of this.getChildren())e["node"+n++]=t;return e.outputNode||null}analyze(t){if(1===t.increaseUsage(this)){const e=t.getNodeProperties(this);for(const n of Object.values(e))n&&!0===n.isNode&&n.build(t)}}generate(t,e){const{outputNode:n}=t.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(t,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const n=this.getShared(t);if(this!==n)return n.build(t,e);t.addNode(this),t.addChain(this);let r=null;const i=t.getBuildStage();if("setup"===i){this.updateReference(t);const e=t.getNodeProperties(this);if(!0!==e.initialized){e.initialized=!0;const n=this.setup(t),r=n&&!0===n.isNode;for(const n of Object.values(e))n&&!0===n.isNode&&n.build(t);r&&n.build(t),e.outputNode=n}}else if("analyze"===i)this.analyze(t);else if("generate"===i){if(1===this.generate.length){const n=this.getNodeType(t),i=t.getDataFromNode(this);r=i.snippet,void 0===r?(r=this.generate(t)||"",i.snippet=r):void 0!==i.flowCodes&&void 0!==t.context.nodeBlock&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),r=t.format(r,n,e)}else r=this.generate(t,e)||""}return t.removeChain(this),t.addSequentialNode(this),r}getSerializeChildren(){return LD(this)}serialize(t){const e=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:s}of e)void 0!==i?(void 0===n[r]&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=s.toJSON(t.meta).uuid):n[r]=s.toJSON(t.meta).uuid;Object.keys(n).length>0&&(t.inputNodes=n)}deserialize(t){if(void 0!==t.inputNodes){const e=t.meta.nodes;for(const n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){const r=[];for(const i of t.inputNodes[n])r.push(e[i]);this[n]=r}else if("object"==typeof t.inputNodes[n]){const r={};for(const i in t.inputNodes[n]){const s=t.inputNodes[n][i];r[i]=e[s]}this[n]=r}else{const r=t.inputNodes[n];this[n]=e[r]}}}toJSON(t){const{uuid:e,type:n}=this,r=void 0===t||"string"==typeof t;r&&(t={textures:{},images:{},nodes:{}});let i=t.nodes[e];function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(void 0===i&&(i={uuid:e,type:n,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){const e=s(t.textures),n=s(t.images),r=s(t.nodes);e.length>0&&(i.textures=e),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}};class eL extends tL{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){return`${this.node.build(t)}[ ${this.indexNode.build(t,"uint")} ]`}}class nL extends tL{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let n=null;for(const r of this.convertTo.split("|"))null!==n&&t.getTypeLength(e)!==t.getTypeLength(r)||(n=r);return n}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const n=this.node,r=this.getNodeType(t),i=n.build(t,r);return t.format(i,r,e)}}class rL extends tL{static get type(){return"TempNode"}constructor(t=null){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if("generate"===t.getBuildStage()){const n=t.getVectorType(this.getNodeType(t,e)),r=t.getDataFromNode(this);if(void 0!==r.propertyName)return t.format(r.propertyName,n,e);if("void"!==n&&"void"!==e&&this.hasDependencies(t)){const i=super.build(t,n),s=t.getVarFromNode(this,null,n),o=t.getPropertyName(s);return t.addLineFlowCode(`${o} = ${i}`,this),r.snippet=i,r.propertyName=o,t.format(r.propertyName,n,e)}}return super.build(t,e)}}class iL extends rL{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return null!==this.nodeType?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce(((e,n)=>e+t.getTypeLength(n.getNodeType(t))),0))}generate(t,e){const n=this.getNodeType(t),r=this.nodes,i=t.getComponentType(n),s=[];for(const e of r){let n=e.build(t);const r=t.getComponentType(e.getNodeType(t));r!==i&&(n=t.format(n,r,i)),s.push(n)}const o=`${t.getType(n)}( ${s.join(", ")} )`;return t.format(o,n,e)}}const sL=JD.join("");class oL extends tL{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(JD.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const n=this.node,r=t.getTypeLength(n.getNodeType(t));let i=null;if(r>1){let s=null;this.getVectorLength()>=r&&(s=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const o=n.build(t,s);i=this.components.length===r&&this.components===sL.slice(0,this.components.length)?t.format(o,s,e):t.format(`${o}.${this.components}`,this.getNodeType(t),e)}else i=n.build(t,e);return i}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class aL extends rL{static get type(){return"SetNode"}constructor(t,e,n){super(),this.sourceNode=t,this.components=e,this.targetNode=n}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:n,targetNode:r}=this,i=this.getNodeType(t),s=t.getComponentType(r.getNodeType(t)),o=t.getTypeFromLength(n.length,s),a=r.build(t,o),l=e.build(t,i),u=t.getTypeLength(i),h=[];for(let t=0;t<u;t++){const e=JD[t];e===n[0]?(h.push(a),t+=n.length-1):h.push(l+"."+e)}return`${t.getType(i)}( ${h.join(", ")} )`}}class lL extends rL{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:n}=this,r=this.getNodeType(t),i=n.build(t),s=t.getVarFromNode(this),o=t.getPropertyName(s);t.addLineFlowCode(o+" = "+i,this);const a=t.getTypeLength(r),l=[];let u=0;for(let t=0;t<a;t++){const n=JD[t];n===e[u]?(l.push("1.0 - "+o+"."+n),u++):l.push(o+"."+n)}return`${t.getType(r)}( ${l.join(", ")} )`}}class uL extends tL{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return null===this.nodeType?zD(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=zD(this.value),t.nodeType=this.nodeType,"ArrayBuffer"===t.valueType&&(t.value=function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?BD(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}const hL=/float|u?int/;class cL extends uL{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const n=this.getNodeType(t);return hL.test(n)&&hL.test(e)?t.generateConst(e,this.value):t.format(this.generateConst(t),n,e)}}class dL extends tL{static get type(){return"MemberNode"}constructor(t,e){super(),this.node=t,this.property=e,this.isMemberNode=!0}getNodeType(t){return this.node.getMemberType(t,this.property)}generate(t){return this.node.build(t)+"."+this.property}}let pL=null;const fL=new Map;function mL(t,e){if(fL.has(t))console.warn(`Redefinition of method chaining ${t}`);else{if("function"!=typeof e)throw new Error(`Node element ${t} is not a function`);fL.set(t,e)}}const gL=t=>t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),yL=t=>gL(t).split("").sort().join(""),vL={setup(t,e){const n=e.shift();return t(VL(n),...e)},get(t,e,n){if("string"==typeof e&&void 0===t[e]){if(!0!==t.isStackNode&&"assign"===e)return(...t)=>(pL.assign(n,...t),n);if(fL.has(e)){const r=fL.get(e);return t.isStackNode?(...t)=>n.add(r(...t)):(...t)=>r(n,...t)}if("self"===e)return t;if(e.endsWith("Assign")&&fL.has(e.slice(0,e.length-6))){const r=fL.get(e.slice(0,e.length-6));return t.isStackNode?(...t)=>n.assign(t[0],r(...t)):(...t)=>n.assign(r(n,...t))}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(e))return e=gL(e),jL(new oL(n,e));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(e))return e=yL(e.slice(3).toLowerCase()),n=>jL(new aL(t,e,n));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(e))return e=yL(e.slice(4).toLowerCase()),()=>jL(new lL(jL(t),e));if("width"===e||"height"===e||"depth"===e)return"width"===e?e="x":"height"===e?e="y":"depth"===e&&(e="z"),jL(new oL(t,e));if(!0===/^\d+$/.test(e))return jL(new eL(n,new cL(Number(e),"uint")));if(!0===/^get$/.test(e))return t=>jL(new dL(n,t))}return Reflect.get(t,e,n)},set:(t,e,n,r)=>"string"!=typeof e||void 0!==t[e]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(e)&&"width"!==e&&"height"!==e&&"depth"!==e&&!0!==/^\d+$/.test(e)?Reflect.set(t,e,n,r):(r[e].assign(n),!0)},_L=new WeakMap,bL=new WeakMap,xL=function(t,e=null){for(const n in t)t[n]=jL(t[n],e);return t},wL=function(t,e=null){const n=t.length;for(let r=0;r<n;r++)t[r]=jL(t[r],e);return t},ML=function(t,e=null,n=null,r=null){const i=t=>jL(null!==r?Object.assign(t,r):t);return null===e?(...e)=>i(new t(...GL(e))):null!==n?(n=jL(n),(...r)=>i(new t(e,...GL(r),n))):(...n)=>i(new t(e,...GL(n)))},SL=function(t,...e){return jL(new t(...GL(e)))};class TL extends tL{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}getMemberType(t,e){return this.getOutputNode(t).getMemberType(t,e)}call(t){const{shaderNode:e,inputNodes:n}=this,r=t.getNodeProperties(e);if(r.onceOutput)return r.onceOutput;let i=null;if(e.layout){let r=bL.get(t.constructor);void 0===r&&(r=new WeakMap,bL.set(t.constructor,r));let s=r.get(e);void 0===s&&(s=jL(t.buildFunctionNode(e)),r.set(e,s)),null!==t.currentFunctionNode&&t.currentFunctionNode.includes.push(s),i=jL(s.call(n))}else{const r=e.jsFunc,s=null!==n||r.length>1?r(n||[],t):r(t);i=jL(s)}return e.once&&(r.onceOutput=i),i}getOutputNode(t){const e=t.getNodeProperties(this);return null===e.outputNode&&(e.outputNode=this.setupOutput(t)),e.outputNode}setup(t){return this.getOutputNode(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){return this.getOutputNode(t).build(t,e)}}class EL extends tL{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return VL(t),jL(new TL(this,t))}setup(){return this.call()}}const AL=[!1,!0],CL=[0,1,2,3],RL=[-1,-2],NL=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],PL=new Map;for(const t of AL)PL.set(t,new cL(t));const kL=new Map;for(const t of CL)kL.set(t,new cL(t,"uint"));const OL=new Map([...kL].map((t=>new cL(t.value,"int"))));for(const t of RL)OL.set(t,new cL(t,"int"));const IL=new Map([...OL].map((t=>new cL(t.value))));for(const t of NL)IL.set(t,new cL(t));for(const t of NL)IL.set(-t,new cL(-t));const DL={bool:PL,uint:kL,ints:OL,float:IL},LL=new Map([...PL,...IL]),UL=(t,e)=>LL.has(t)?LL.get(t):!0===t.isNode?t:new cL(t,e),FL=function(t,e=null){return(...n)=>{if((0===n.length||!["bool","float","int","uint"].includes(t)&&n.every((t=>"object"!=typeof t)))&&(n=[BD(t,...n)]),1===n.length&&null!==e&&e.has(n[0]))return jL(e.get(n[0]));if(1===n.length){const e=UL(n[0],t);return(t=>{try{return t.getNodeType()}catch(t){return}})(e)===t?jL(e):jL(new nL(e,t))}const r=n.map((t=>UL(t)));return jL(new iL(r,t))}},zL=t=>"object"==typeof t&&null!==t?t.value:t;function BL(t,e){return new Proxy(new EL(t,e),vL)}const jL=(t,e=null)=>function(t,e=null){const n=zD(t);if("node"===n){let e=_L.get(t);return void 0===e&&(e=new Proxy(t,vL),_L.set(t,e),_L.set(e,e)),e}return null===e&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?jL(UL(t,e)):"shader"===n?qL(t):t}(t,e),VL=(t,e=null)=>new xL(t,e),GL=(t,e=null)=>new wL(t,e),HL=(...t)=>new ML(...t),WL=(...t)=>new SL(...t),qL=(t,e)=>{const n=new BL(t,e),r=(...t)=>{let e;return VL(t),e=t[0]&&t[0].isNode?[...t]:t[0],n.call(e)};return r.shaderNode=n,r.setLayout=t=>(n.setLayout(t),r),r.once=()=>(n.once=!0,r),r};mL("toGlobal",(t=>(t.global=!0,t)));const $L=t=>{pL=t},XL=()=>pL,YL=(...t)=>pL.If(...t);mL("append",(function(t){return pL&&pL.add(t),t}));const KL=new FL("color"),ZL=new FL("float",DL.float),JL=new FL("int",DL.ints),QL=new FL("uint",DL.uint),tU=new FL("bool",DL.bool),eU=new FL("vec2"),nU=new FL("ivec2"),rU=new FL("uvec2"),iU=new FL("bvec2"),sU=new FL("vec3"),oU=new FL("ivec3"),aU=new FL("uvec3"),lU=new FL("bvec3"),uU=new FL("vec4"),hU=new FL("ivec4"),cU=new FL("uvec4"),dU=new FL("bvec4"),pU=new FL("mat2"),fU=new FL("mat3"),mU=new FL("mat4");mL("toColor",KL),mL("toFloat",ZL),mL("toInt",JL),mL("toUint",QL),mL("toBool",tU),mL("toVec2",eU),mL("toIVec2",nU),mL("toUVec2",rU),mL("toBVec2",iU),mL("toVec3",sU),mL("toIVec3",oU),mL("toUVec3",aU),mL("toBVec3",lU),mL("toVec4",uU),mL("toIVec4",hU),mL("toUVec4",cU),mL("toBVec4",dU),mL("toMat2",pU),mL("toMat3",fU),mL("toMat4",mU);mL("element",HL(eL)),mL("convert",((t,e)=>jL(new nL(jL(t),e))));class gU extends rL{static get type(){return"ArrayNode"}constructor(t,e,n=null){super(t),this.count=e,this.values=n,this.isArrayNode=!0}getNodeType(t){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(t)),this.nodeType}getElementType(t){return this.getNodeType(t)}generate(t){const e=this.getNodeType(t);return t.generateArray(e,this.count,this.values)}}mL("toArray",((t,e)=>((...t)=>{let e;if(1===t.length){const n=t[0];e=new gU(null,n.length,n)}else{const n=t[0],r=t[1];e=new gU(n,r)}return jL(e)})(Array(e).fill(t))));class yU extends tL{static get type(){return"UniformGroupNode"}constructor(t,e=!1,n=1){super("string"),this.name=t,this.shared=e,this.order=n,this.isUniformGroup=!0}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const vU=t=>new yU(t),_U=(t,e=0)=>new yU(t,!0,e),bU=_U("frame"),xU=_U("render"),wU=vU("object");class MU extends uL{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=wU}label(t){return this.name=t,this}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const n=this.getSelf();return t=t.bind(n),super.onUpdate((e=>{const r=t(e,n);void 0!==r&&(this.value=r)}),e)}generate(t,e){const n=this.getNodeType(t),r=this.getUniformHash(t);let i=t.getNodeFromHash(r);void 0===i&&(t.setHashNode(this,r),i=this);const s=i.getInputType(t),o=t.getUniformFromNode(i,s,t.shaderStage,this.name||t.context.label),a=t.getPropertyName(o);return void 0!==t.context.label&&delete t.context.label,t.format(a,n,e)}}const SU=(t,e)=>{const n=(t=>null!=t?t.nodeType||t.convertTo||("string"==typeof t?t:null):null)(e||t),r=t&&!0===t.isNode?t.node&&t.node.value||t.value:t;return jL(new MU(r,n))};class TU extends tL{static get type(){return"PropertyNode"}constructor(t,e=null,n=!1){super(t),this.name=e,this.varying=n,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return!0===this.varying?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const EU=(t,e)=>jL(new TU(t,e,!0)),AU=WL(TU,"vec4","DiffuseColor"),CU=WL(TU,"vec3","EmissiveColor"),RU=WL(TU,"float","Roughness"),NU=WL(TU,"float","Metalness"),PU=WL(TU,"float","Clearcoat"),kU=WL(TU,"float","ClearcoatRoughness"),OU=WL(TU,"vec3","Sheen"),IU=WL(TU,"float","SheenRoughness"),DU=WL(TU,"float","Iridescence"),LU=WL(TU,"float","IridescenceIOR"),UU=WL(TU,"float","IridescenceThickness"),FU=WL(TU,"float","AlphaT"),zU=WL(TU,"float","Anisotropy"),BU=WL(TU,"vec3","AnisotropyT"),jU=WL(TU,"vec3","AnisotropyB"),VU=WL(TU,"color","SpecularColor"),GU=WL(TU,"float","SpecularF90"),HU=WL(TU,"float","Shininess"),WU=WL(TU,"vec4","Output"),qU=WL(TU,"float","dashSize"),$U=WL(TU,"float","gapSize"),XU=WL(TU,"float","IOR"),YU=WL(TU,"float","Transmission"),KU=WL(TU,"float","Thickness"),ZU=WL(TU,"float","AttenuationDistance"),JU=WL(TU,"color","AttenuationColor"),QU=WL(TU,"float","Dispersion");class tF extends rL{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return"void"!==e?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(!1===t.isAvailable("swizzleAssign")&&e.isSplitNode&&e.components.length>1){const n=t.getTypeLength(e.node.getNodeType(t));return JD.join("").slice(0,n)!==e.components}return!1}generate(t,e){const{targetNode:n,sourceNode:r}=this,i=this.needsSplitAssign(t),s=n.getNodeType(t),o=n.context({assign:!0}).build(t),a=r.build(t,s),l=r.getNodeType(t),u=t.getDataFromNode(this);let h;if(!0===u.initialized)"void"!==e&&(h=o);else if(i){const r=t.getVarFromNode(this,null,s),i=t.getPropertyName(r);t.addLineFlowCode(`${i} = ${a}`,this);const l=n.node.context({assign:!0}).build(t);for(let e=0;e<n.components.length;e++){const r=n.components[e];t.addLineFlowCode(`${l}.${r} = ${i}[ ${e} ]`,this)}"void"!==e&&(h=o)}else h=`${o} = ${a}`,"void"!==e&&"void"!==l||(t.addLineFlowCode(h,this),"void"!==e&&(h=o));return u.initialized=!0,t.format(h,s,e)}}mL("assign",HL(tF));class eF extends rL{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],n=this.functionNode,r=n.getInputs(t),i=this.parameters,s=(e,n)=>{const r=n.type;let i;return i="pointer"===r?"&"+e.build(t):e.build(t,r),i};if(Array.isArray(i))for(let t=0;t<i.length;t++)e.push(s(i[t],r[t]));else for(const t of r){const n=i[t.name];if(void 0===n)throw new Error(`FunctionCallNode: Input '${t.name}' not found in FunctionNode.`);e.push(s(n,t))}return`${n.build(t,"property")}( ${e.join(", ")} )`}}mL("call",((t,...e)=>(e=e.length>1||e[0]&&!0===e[0].isNode?GL(e):VL(e[0]),jL(new eF(jL(t),e)))));class nF extends rL{static get type(){return"OperatorNode"}constructor(t,e,n,...r){if(super(),r.length>0){let i=new nF(t,e,n);for(let e=0;e<r.length-1;e++)i=new nF(t,i,r[e]);e=i,n=r[r.length-1]}this.op=t,this.aNode=e,this.bNode=n,this.isOperatorNode=!0}getNodeType(t,e){const n=this.op,r=this.aNode,i=this.bNode,s=r.getNodeType(t),o=void 0!==i?i.getNodeType(t):null;if("void"===s||"void"===o)return"void";if("%"===n)return s;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return t.getIntegerType(s);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){const n=e?t.getTypeLength(e):Math.max(t.getTypeLength(s),t.getTypeLength(o));return n>1?`bvec${n}`:"bool"}if(t.isMatrix(s)){if("float"===o)return s;if(t.isVector(o))return t.getVectorFromMatrix(s);if(t.isMatrix(o))return s}else if(t.isMatrix(o)){if("float"===s)return o;if(t.isVector(s))return t.getVectorFromMatrix(o)}return t.getTypeLength(o)>t.getTypeLength(s)?o:s}generate(t,e){const n=this.op,r=this.aNode,i=this.bNode,s=this.getNodeType(t,e);let o=null,a=null;"void"!==s?(o=r.getNodeType(t),a=void 0!==i?i.getNodeType(t):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?t.isVector(o)?a=o:o!==a&&(o=a="float"):">>"===n||"<<"===n?(o=s,a=t.changeComponentType(a,"uint")):t.isMatrix(o)?"float"===a?a="float":t.isVector(a)?a=t.getVectorFromMatrix(o):t.isMatrix(a)||(o=a=s):o=t.isMatrix(a)?"float"===o?"float":t.isVector(o)?t.getVectorFromMatrix(a):a=s:a=s):o=a=s;const l=r.build(t,o),u=void 0!==i?i.build(t,a):null,h=t.getTypeLength(e),c=t.getFunctionOperator(n);return"void"!==e?"<"===n&&h>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThan",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} < ${u} )`,s,e):"<="===n&&h>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThanEqual",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} <= ${u} )`,s,e):">"===n&&h>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThan",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} > ${u} )`,s,e):">="===n&&h>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThanEqual",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} >= ${u} )`,s,e):"!"===n||"~"===n?t.format(`(${n}${l})`,o,e):c?t.format(`${c}( ${l}, ${u} )`,s,e):t.isMatrix(o)&&"float"===a?t.format(`( ${u} ${n} ${l} )`,s,e):"float"===o&&t.isMatrix(a)?t.format(`${l} ${n} ${u}`,s,e):t.format(`( ${l} ${n} ${u} )`,s,e):"void"!==o?c?t.format(`${c}( ${l}, ${u} )`,s,e):t.isMatrix(o)&&"float"===a?t.format(`${u} ${n} ${l}`,s,e):t.format(`${l} ${n} ${u}`,s,e):void 0}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const rF=HL(nF,"+"),iF=HL(nF,"-"),sF=HL(nF,"*"),oF=HL(nF,"/"),aF=HL(nF,"%"),lF=HL(nF,"=="),uF=HL(nF,"!="),hF=HL(nF,"<"),cF=HL(nF,">"),dF=HL(nF,"<="),pF=HL(nF,">="),fF=HL(nF,"&&"),mF=HL(nF,"||"),gF=HL(nF,"!"),yF=HL(nF,"^^"),vF=HL(nF,"&"),_F=HL(nF,"~"),bF=HL(nF,"|"),xF=HL(nF,"^"),wF=HL(nF,"<<"),MF=HL(nF,">>");mL("add",rF),mL("sub",iF),mL("mul",sF),mL("div",oF),mL("modInt",aF),mL("equal",lF),mL("notEqual",uF),mL("lessThan",hF),mL("greaterThan",cF),mL("lessThanEqual",dF),mL("greaterThanEqual",pF),mL("and",fF),mL("or",mF),mL("not",gF),mL("xor",yF),mL("bitAnd",vF),mL("bitNot",_F),mL("bitOr",bF),mL("bitXor",xF),mL("shiftLeft",wF),mL("shiftRight",MF);mL("remainder",((...t)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),aF(...t))));class SF extends rL{static get type(){return"MathNode"}constructor(t,e,n=null,r=null){super(),this.method=t,this.aNode=e,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(t){const e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,r=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),s=t.isMatrix(n)?0:t.getTypeLength(n),o=t.isMatrix(r)?0:t.getTypeLength(r);return i>s&&i>o?e:s>o?n:o>i?r:e}getNodeType(t){const e=this.method;return e===SF.LENGTH||e===SF.DISTANCE||e===SF.DOT?"float":e===SF.CROSS?"vec3":e===SF.ALL?"bool":e===SF.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===SF.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){let n=this.method;const r=this.getNodeType(t),i=this.getInputType(t),s=this.aNode,o=this.bNode,a=this.cNode,l=t.renderer.coordinateSystem;if(n===SF.TRANSFORM_DIRECTION){let n=s,r=o;t.isMatrix(n.getNodeType(t))?r=uU(sU(r),0):n=uU(sU(n),0);const i=sF(n,r).xyz;return zF(i).build(t,e)}if(n===SF.NEGATE)return t.format("( - "+s.build(t,i)+" )",r,e);if(n===SF.ONE_MINUS)return iF(1,s).build(t,e);if(n===SF.RECIPROCAL)return oF(1,s).build(t,e);if(n===SF.DIFFERENCE)return $F(iF(s,o)).build(t,e);{const u=[];return n===SF.CROSS||n===SF.MOD?u.push(s.build(t,r),o.build(t,r)):l===SM&&n===SF.STEP?u.push(s.build(t,1===t.getTypeLength(s.getNodeType(t))?"float":i),o.build(t,i)):l===SM&&(n===SF.MIN||n===SF.MAX)||n===SF.MOD?u.push(s.build(t,i),o.build(t,1===t.getTypeLength(o.getNodeType(t))?"float":i)):n===SF.REFRACT?u.push(s.build(t,i),o.build(t,i),a.build(t,"float")):n===SF.MIX?u.push(s.build(t,i),o.build(t,i),a.build(t,1===t.getTypeLength(a.getNodeType(t))?"float":i)):(l===TM&&n===SF.ATAN&&null!==o&&(n="atan2"),u.push(s.build(t,i)),null!==o&&u.push(o.build(t,i)),null!==a&&u.push(a.build(t,i))),t.format(`${t.getMethod(n,r)}( ${u.join(", ")} )`,r,e)}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}SF.ALL="all",SF.ANY="any",SF.RADIANS="radians",SF.DEGREES="degrees",SF.EXP="exp",SF.EXP2="exp2",SF.LOG="log",SF.LOG2="log2",SF.SQRT="sqrt",SF.INVERSE_SQRT="inversesqrt",SF.FLOOR="floor",SF.CEIL="ceil",SF.NORMALIZE="normalize",SF.FRACT="fract",SF.SIN="sin",SF.COS="cos",SF.TAN="tan",SF.ASIN="asin",SF.ACOS="acos",SF.ATAN="atan",SF.ABS="abs",SF.SIGN="sign",SF.LENGTH="length",SF.NEGATE="negate",SF.ONE_MINUS="oneMinus",SF.DFDX="dFdx",SF.DFDY="dFdy",SF.ROUND="round",SF.RECIPROCAL="reciprocal",SF.TRUNC="trunc",SF.FWIDTH="fwidth",SF.TRANSPOSE="transpose",SF.BITCAST="bitcast",SF.EQUALS="equals",SF.MIN="min",SF.MAX="max",SF.MOD="mod",SF.STEP="step",SF.REFLECT="reflect",SF.DISTANCE="distance",SF.DIFFERENCE="difference",SF.DOT="dot",SF.CROSS="cross",SF.POW="pow",SF.TRANSFORM_DIRECTION="transformDirection",SF.MIX="mix",SF.CLAMP="clamp",SF.REFRACT="refract",SF.SMOOTHSTEP="smoothstep",SF.FACEFORWARD="faceforward";const TF=ZL(1e-6),EF=ZL(Math.PI),AF=HL(SF,SF.ALL),CF=HL(SF,SF.ANY),RF=HL(SF,SF.RADIANS),NF=HL(SF,SF.DEGREES),PF=HL(SF,SF.EXP),kF=HL(SF,SF.EXP2),OF=HL(SF,SF.LOG),IF=HL(SF,SF.LOG2),DF=HL(SF,SF.SQRT),LF=HL(SF,SF.INVERSE_SQRT),UF=HL(SF,SF.FLOOR),FF=HL(SF,SF.CEIL),zF=HL(SF,SF.NORMALIZE),BF=HL(SF,SF.FRACT),jF=HL(SF,SF.SIN),VF=HL(SF,SF.COS),GF=HL(SF,SF.TAN),HF=HL(SF,SF.ASIN),WF=HL(SF,SF.ACOS),qF=HL(SF,SF.ATAN),$F=HL(SF,SF.ABS),XF=HL(SF,SF.SIGN),YF=HL(SF,SF.LENGTH),KF=HL(SF,SF.NEGATE),ZF=HL(SF,SF.ONE_MINUS),JF=HL(SF,SF.DFDX),QF=HL(SF,SF.DFDY),tz=HL(SF,SF.ROUND),ez=HL(SF,SF.RECIPROCAL),nz=HL(SF,SF.TRUNC),rz=HL(SF,SF.FWIDTH),iz=HL(SF,SF.TRANSPOSE);SF.BITCAST;const sz=HL(SF,SF.EQUALS),oz=HL(SF,SF.MIN),az=HL(SF,SF.MAX),lz=HL(SF,SF.MOD),uz=HL(SF,SF.STEP),hz=HL(SF,SF.REFLECT),cz=HL(SF,SF.DISTANCE),dz=HL(SF,SF.DIFFERENCE),pz=HL(SF,SF.DOT),fz=HL(SF,SF.CROSS),mz=HL(SF,SF.POW),gz=HL(SF,SF.POW,2),yz=HL(SF,SF.POW,3),vz=HL(SF,SF.POW,4),_z=HL(SF,SF.TRANSFORM_DIRECTION),bz=t=>pz(t,t),xz=HL(SF,SF.MIX),wz=(t,e=0,n=1)=>jL(new SF(SF.CLAMP,jL(t),jL(e),jL(n))),Mz=HL(SF,SF.REFRACT),Sz=HL(SF,SF.SMOOTHSTEP),Tz=HL(SF,SF.FACEFORWARD),Ez=qL((([t])=>{const e=pz(t.xy,eU(12.9898,78.233)),n=lz(e,EF);return BF(jF(n).mul(43758.5453))}));mL("all",AF),mL("any",CF),mL("equals",sz),mL("radians",RF),mL("degrees",NF),mL("exp",PF),mL("exp2",kF),mL("log",OF),mL("log2",IF),mL("sqrt",DF),mL("inverseSqrt",LF),mL("floor",UF),mL("ceil",FF),mL("normalize",zF),mL("fract",BF),mL("sin",jF),mL("cos",VF),mL("tan",GF),mL("asin",HF),mL("acos",WF),mL("atan",qF),mL("abs",$F),mL("sign",XF),mL("length",YF),mL("lengthSq",bz),mL("negate",KF),mL("oneMinus",ZF),mL("dFdx",JF),mL("dFdy",QF),mL("round",tz),mL("reciprocal",ez),mL("trunc",nz),mL("fwidth",rz),mL("atan2",((t,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),qF(t,e)))),mL("min",oz),mL("max",az),mL("mod",lz),mL("step",uz),mL("reflect",hz),mL("distance",cz),mL("dot",pz),mL("cross",fz),mL("pow",mz),mL("pow2",gz),mL("pow3",yz),mL("pow4",vz),mL("transformDirection",_z),mL("mix",((t,e,n)=>xz(e,n,t))),mL("clamp",wz),mL("refract",Mz),mL("smoothstep",((t,e,n)=>Sz(e,n,t))),mL("faceForward",Tz),mL("difference",dz),mL("saturate",(t=>wz(t))),mL("cbrt",(t=>sF(XF(t),mz($F(t),1/3)))),mL("transpose",iz),mL("rand",Ez);class Az extends tL{static get type(){return"ConditionalNode"}constructor(t,e,n=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=n}getNodeType(t){const{ifNode:e,elseNode:n}=t.getNodeProperties(this);if(void 0===e)return this.setup(t),this.getNodeType(t);const r=e.getNodeType(t);if(null!==n){const e=n.getNodeType(t);if(t.getTypeLength(e)>t.getTypeLength(r))return e}return r}setup(t){const e=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=t.context.nodeBlock;t.getDataFromNode(n).parentNodeBlock=i,null!==r&&(t.getDataFromNode(r).parentNodeBlock=i);const s=t.getNodeProperties(this);s.condNode=e,s.ifNode=n.context({nodeBlock:n}),s.elseNode=r?r.context({nodeBlock:r}):null}generate(t,e){const n=this.getNodeType(t),r=t.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;const{condNode:i,ifNode:s,elseNode:o}=t.getNodeProperties(this),a="void"!==e,l=a?((t,e)=>jL(new TU(t,e)))(n).build(t):"";r.nodeProperty=l;const u=i.build(t,"bool");t.addFlowCode(`\n${t.tab}if ( ${u} ) {\n\n`).addFlowTab();let h=s.build(t,n);if(h&&(h=a?l+" = "+h+";":"return "+h+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+h+"\n\n"+t.tab+"}"),null!==o){t.addFlowCode(" else {\n\n").addFlowTab();let e=o.build(t,n);e&&(e=a?l+" = "+e+";":"return "+e+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+e+"\n\n"+t.tab+"}\n\n")}else t.addFlowCode("\n\n");return t.format(l,n,e)}}const Cz=HL(Az);mL("select",Cz);mL("cond",((...t)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Cz(...t))));class Rz extends tL{static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value});const n=this.node.build(t);return t.setContext(e),n}generate(t,e){const n=t.getContext();t.setContext({...t.context,...this.value});const r=this.node.build(t,e);return t.setContext(n),r}}const Nz=HL(Rz);mL("context",Nz),mL("label",((t,e)=>Nz(t,{label:e})));class Pz extends tL{static get type(){return"VarNode"}constructor(t,e=null,n=!1){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0,this.readOnly=n}getHash(t){return this.name||super.getHash(t)}getMemberType(t,e){return this.node.getMemberType(t,e)}getElementType(t){return this.node.getElementType(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:n,readOnly:r}=this,{renderer:i}=t,s=!0===i.backend.isWebGPUBackend;let o=!1,a=!1;r&&(o=t.isDeterministic(e),a=s?r:o);const l=t.getVectorType(this.getNodeType(t)),u=e.build(t,l),h=t.getVarFromNode(this,n,l,void 0,a),c=t.getPropertyName(h);let d=c;if(a)if(s)d=o?`const ${c}`:`let ${c}`;else{const n=t.getArrayCount(e);d=`const ${t.getVar(h.type,c,n)}`}return t.addLineFlowCode(`${d} = ${u}`,this),c}}const kz=HL(Pz);mL("toVar",((t,e=null)=>kz(t,e).append())),mL("toConst",((t,e=null)=>kz(t,e,!0).append()));mL("temp",(t=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),kz(t))));class Oz extends tL{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let n=e.varying;if(void 0===n){const r=this.name,i=this.getNodeType(t);e.varying=n=t.getVaryingFromNode(this,r,i),e.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===t.shaderStage),n}setup(t){this.setupVarying(t)}analyze(t){return this.setupVarying(t),this.node.analyze(t)}generate(t){const e=t.getNodeProperties(this),n=this.setupVarying(t),r="fragment"===t.shaderStage&&!0===e.reassignPosition&&t.context.needsPositionReassign;if(void 0===e.propertyName||r){const i=this.getNodeType(t),s=t.getPropertyName(n,VD);t.flowNodeFromShaderStage(VD,this.node,i,s),e.propertyName=s,r?e.reassignPosition=!1:void 0===e.reassignPosition&&t.context.isPositionNodeInput&&(e.reassignPosition=!0)}return t.getPropertyName(n)}}const Iz=HL(Oz);mL("toVarying",Iz),mL("toVertexStage",(t=>Iz(t))),mL("varying",((...t)=>(console.warn("TSL.VaryingNode: .varying() has been renamed to .toVarying()."),Iz(...t)))),mL("vertexStage",((...t)=>(console.warn("TSL.VaryingNode: .vertexStage() has been renamed to .toVertexStage()."),Iz(...t))));const Dz=qL((([t])=>{const e=t.mul(.9478672986).add(.0521327014).pow(2.4),n=t.mul(.0773993808),r=t.lessThanEqual(.04045);return xz(e,n,r)})).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Lz=qL((([t])=>{const e=t.pow(.41666).mul(1.055).sub(.055),n=t.mul(12.92),r=t.lessThanEqual(.0031308);return xz(e,n,r)})).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Uz="WorkingColorSpace",Fz="OutputColorSpace";class zz extends rL{static get type(){return"ColorSpaceNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.source=e,this.target=n}resolveColorSpace(t,e){return e===Uz?YM.workingColorSpace:e===Fz?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,n=this.resolveColorSpace(t,this.source),r=this.resolveColorSpace(t,this.target);let i=e;return!1!==YM.enabled&&n!==r&&n&&r?(YM.getTransfer(n)===cM&&(i=uU(Dz(i.rgb),i.a)),YM.getPrimaries(n)!==YM.getPrimaries(r)&&(i=uU(fU(YM._getMatrix(new zM,n,r)).mul(i.rgb),i.a)),YM.getTransfer(r)===cM&&(i=uU(Lz(i.rgb),i.a)),i):i}}const Bz=(t,e)=>jL(new zz(jL(t),e,Uz));mL("toOutputColorSpace",(t=>jL(new zz(jL(t),Uz,Fz)))),mL("toWorkingColorSpace",(t=>jL(new zz(jL(t),Fz,Uz)))),mL("workingToColorSpace",((t,e)=>jL(new zz(jL(t),Uz,e)))),mL("colorSpaceToWorking",Bz);let jz=class extends eL{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}};class Vz extends tL{static get type(){return"ReferenceBaseNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=qD}setGroup(t){return this.group=t,this}element(t){return jL(new jz(this,jL(t)))}setNodeType(t){const e=SU(null,t).getSelf();null!==this.group&&e.setGroup(this.group),this.node=e}getNodeType(t){return null===this.node&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let t=1;t<e.length;t++)n=n[e[t]];return n}updateReference(t){return this.reference=null!==this.object?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}class Gz extends Vz{static get type(){return"RendererReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.renderer=n,this.setGroup(xU)}updateReference(t){return this.reference=null!==this.renderer?this.renderer:t.renderer,this.reference}}const Hz=(t,e,n=null)=>jL(new Gz(t,e,n));class Wz extends rL{static get type(){return"ToneMappingNode"}constructor(t,e=qz,n=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=n}customCacheKey(){return ID(this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,n=this.toneMapping;if(0===n)return e;let r=null;const i=t.renderer.library.getToneMappingFunction(n);return null!==i?r=uU(i(e.rgb,this.exposureNode),e.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=e),r}}const qz=Hz("toneMappingExposure","float");mL("toneMapping",((t,e,n)=>((t,e,n)=>jL(new Wz(t,jL(e),jL(n))))(e,n,t)));class $z extends uL{static get type(){return"BufferAttributeNode"}constructor(t,e=null,n=0,r=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=n,this.bufferOffset=r,this.usage=xM,this.instanced=!1,this.attribute=null,this.global=!0,t&&!0===t.isBufferAttribute&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(0===this.bufferStride&&0===this.bufferOffset){let e=t.globalCache.getData(this.value);return void 0===e&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return null===this.bufferType&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(null!==this.attribute)return;const e=this.getNodeType(t),n=this.value,r=t.getTypeLength(e),i=this.bufferStride||r,s=this.bufferOffset,o=!0===n.isInterleavedBuffer?n:new LE(n,i),a=new FE(o,r,s);o.setUsage(this.usage),this.attribute=a,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),r=t.getPropertyName(n);let i=null;if("vertex"===t.shaderStage||"compute"===t.shaderStage)this.name=r,i=r;else{i=Iz(this).build(t,e)}return i}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const Xz=(t,e=null,n=0,r=0)=>jL(new $z(t,e,n,r)),Yz=(t,e=null,n=0,r=0)=>Xz(t,e,n,r).setInstanced(!0),Kz=(t,e=null,n=0,r=0)=>((t,e=null,n=0,r=0)=>Xz(t,e,n,r).setUsage(wM))(t,e,n,r).setInstanced(!0);mL("toAttribute",(t=>Xz(t.value)));class Zz extends tL{static get type(){return"ComputeNode"}constructor(t,e,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=qD,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(t){return this.name=t,this}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let n=e[0];for(let t=1;t<e.length;t++)n*=e[t];this.dispatchCount=Math.ceil(t/n)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if("compute"===e){const e=this.computeNode.build(t,"void");""!==e&&t.addLineFlowCode(e,this)}}}mL("compute",((t,e,n)=>jL(new Zz(jL(t),e,n))));class Jz extends tL{static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){const e=t.getCache(),n=t.getCacheFromNode(this,this.parent);t.setCache(n);const r=this.node.getNodeType(t);return t.setCache(e),r}build(t,...e){const n=t.getCache(),r=t.getCacheFromNode(this,this.parent);t.setCache(r);const i=this.node.build(t,...e);return t.setCache(n),i}}const Qz=(t,e)=>jL(new Jz(jL(t),e));mL("cache",Qz);class tB extends tL{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return""!==e&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}mL("bypass",HL(tB));class eB extends tL{static get type(){return"RemapNode"}constructor(t,e,n,r=ZL(0),i=ZL(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:s}=this;let o=t.sub(e).div(n.sub(e));return!0===s&&(o=o.clamp()),o.mul(i.sub(r)).add(r)}}const nB=HL(eB,null,null,{doClamp:!1}),rB=HL(eB);mL("remap",nB),mL("remapClamp",rB);class iB extends tL{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const n=this.getNodeType(t),r=this.snippet;if("void"!==n)return t.format(`( ${r} )`,n,e);t.addLineFlowCode(r,this)}}const sB=HL(iB);mL("discard",(t=>(t?Cz(t,sB("discard")):sB("discard")).append()));class oB extends rL{static get type(){return"RenderOutputNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:t}){let e=this.colorNode||t.color;const n=(null!==this.toneMapping?this.toneMapping:t.toneMapping)||0,r=(null!==this.outputColorSpace?this.outputColorSpace:t.outputColorSpace)||aM;return 0!==n&&(e=e.toneMapping(n)),r!==aM&&r!==YM.workingColorSpace&&(e=e.workingToColorSpace(r)),e}}mL("renderOutput",((t,e=null,n=null)=>jL(new oB(jL(t),e,n))));class aB extends tL{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(null===e){const n=this.getAttributeName(t);if(t.hasGeometryAttribute(n)){const r=t.geometry.getAttribute(n);e=t.getTypeFromAttribute(r)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),n=this.getNodeType(t);if(!0===t.hasGeometryAttribute(e)){const r=t.geometry.getAttribute(e),i=t.getTypeFromAttribute(r),s=t.getAttribute(e,i);if("vertex"===t.shaderStage)return t.format(s.name,i,n);return Iz(this).build(t,n)}return console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(n)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const lB=(t,e)=>jL(new aB(t,e)),uB=(t=0)=>lB("uv"+(t>0?t:""),"vec2");class hB extends tL{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const n=this.textureNode.build(t,"property"),r=null===this.levelNode?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(t),e)}}const cB=HL(hB);class dB extends MU{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=HD}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&void 0!==n.width){const{width:t,height:e}=n;this.value=Math.log2(Math.max(t,e))}}}const pB=HL(dB);class fB extends MU{static get type(){return"TextureNode"}constructor(t,e=null,n=null,r=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=GD,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(null===e)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===hw?"uvec4":this.value.type===uw?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return uB(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return null===this._matrixUniform&&(this._matrixUniform=SU(this.value.matrix)),this._matrixUniform.mul(sU(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?WD:GD,this}setupUV(t,e){const n=this.value;return t.isFlipY()&&(n.image instanceof ImageBitmap&&!0===n.flipY||!0===n.isRenderTargetTexture||!0===n.isFramebufferTexture||!0===n.isDepthTexture)&&(e=this.sampler?e.flipY():e.setY(JL(cB(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;const n=this.value;if(!n||!0!==n.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;null!==r&&!0!==t.context.forceUVContext||!t.context.getUV||(r=t.context.getUV(this)),r||(r=this.getDefaultUV()),!0===this.updateMatrix&&(r=this.getTransformedUV(r)),r=this.setupUV(t,r);let i=this.levelNode;null===i&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),e.uvNode=r,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,!0===this.sampler?"vec2":"ivec2")}generateSnippet(t,e,n,r,i,s,o,a){const l=this.value;let u;return u=r?t.generateTextureLevel(l,e,n,r,s):i?t.generateTextureBias(l,e,n,i,s):a?t.generateTextureGrad(l,e,n,a,s):o?t.generateTextureCompare(l,e,n,o,s):!1===this.sampler?t.generateTextureLoad(l,e,n,s):t.generateTexture(l,e,n,s),u}generate(t,e){const n=this.value,r=t.getNodeProperties(this),i=super.generate(t,"property");if("sampler"===e)return i+"_sampler";if(t.isReference(e))return i;{const s=t.getDataFromNode(this);let o=s.propertyName;if(void 0===o){const{uvNode:e,levelNode:n,biasNode:a,compareNode:l,depthNode:u,gradNode:h}=r,c=this.generateUV(t,e),d=n?n.build(t,"float"):null,p=a?a.build(t,"float"):null,f=u?u.build(t,"int"):null,m=l?l.build(t,"float"):null,g=h?[h[0].build(t,"vec2"),h[1].build(t,"vec2")]:null,y=t.getVarFromNode(this);o=t.getPropertyName(y);const v=this.generateSnippet(t,i,c,d,p,f,m,g);t.addLineFlowCode(`${o} = ${v}`,this),s.snippet=v,s.propertyName=o}let a=o;const l=this.getNodeType(t);return t.needsToWorkingColorSpace(n)&&(a=Bz(sB(a,l),n.colorSpace).setup(t).build(t,l)),t.format(a,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(t)}sample(t){const e=this.clone();return e.uvNode=jL(t),e.referenceNode=this.getSelf(),jL(e)}blur(t){const e=this.clone();return e.biasNode=jL(t).mul(pB(e)),e.referenceNode=this.getSelf(),jL(e)}level(t){const e=this.clone();return e.levelNode=jL(t),e.referenceNode=this.getSelf(),jL(e)}size(t){return cB(this,t)}bias(t){const e=this.clone();return e.biasNode=jL(t),e.referenceNode=this.getSelf(),jL(e)}compare(t){const e=this.clone();return e.compareNode=jL(t),e.referenceNode=this.getSelf(),jL(e)}grad(t,e){const n=this.clone();return n.gradNode=[jL(t),jL(e)],n.referenceNode=this.getSelf(),jL(n)}depth(t){const e=this.clone();return e.depthNode=jL(t),e.referenceNode=this.getSelf(),jL(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;null!==e&&(e.value=t.matrix),!0===t.matrixAutoUpdate&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t}}const mB=HL(fB),gB=(...t)=>mB(...t).setSampler(!1);class yB extends MU{static get type(){return"BufferNode"}constructor(t,e,n=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=n}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const vB=(t,e,n)=>jL(new yB(t,e,n));class _B extends eL{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),n=this.getNodeType(),r=this.node.getPaddedType();return t.format(e,r,n)}}class bB extends yB{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null),this.array=t,this.elementType=null===e?zD(t[0]):e,this.paddedType=this.getPaddedType(),this.updateType=WD,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const t=this.elementType;let e="vec4";return"mat2"===t?e="mat2":!0===/mat/.test(t)?e="mat4":"i"===t.charAt(0)?e="ivec4":"u"===t.charAt(0)&&(e="uvec4"),e}update(){const{array:t,value:e}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let n=0;n<t.length;n++){e[4*n]=t[n]}else if("color"===n)for(let n=0;n<t.length;n++){const r=4*n,i=t[n];e[r]=i.r,e[r+1]=i.g,e[r+2]=i.b||0}else if("mat2"===n)for(let n=0;n<t.length;n++){const r=4*n,i=t[n];e[r]=i.elements[0],e[r+1]=i.elements[1],e[r+2]=i.elements[2],e[r+3]=i.elements[3]}else if("mat3"===n)for(let n=0;n<t.length;n++){const r=16*n,i=t[n];e[r]=i.elements[0],e[r+1]=i.elements[1],e[r+2]=i.elements[2],e[r+4]=i.elements[3],e[r+5]=i.elements[4],e[r+6]=i.elements[5],e[r+8]=i.elements[6],e[r+9]=i.elements[7],e[r+10]=i.elements[8],e[r+15]=1}else if("mat4"===n)for(let n=0;n<t.length;n++){const r=16*n,i=t[n];for(let t=0;t<i.elements.length;t++)e[r+t]=i.elements[t]}else for(let n=0;n<t.length;n++){const r=4*n,i=t[n];e[r]=i.x,e[r+1]=i.y,e[r+2]=i.z||0,e[r+3]=i.w||0}}setup(t){const e=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,s=t.getTypeLength(i);return"i"===n.charAt(0)&&(r=Int32Array),"u"===n.charAt(0)&&(r=Uint32Array),this.value=new r(e*s),this.bufferCount=e,this.bufferType=i,super.setup(t)}element(t){return jL(new _B(this,jL(t)))}}const xB=(t,e)=>jL(new bB(t,e)),wB=SU(0,"uint").setGroup(_U("cameraIndex")).toVarying("v_cameraIndex"),MB=SU("float").label("cameraNear").setGroup(xU).onRenderUpdate((({camera:t})=>t.near)),SB=SU("float").label("cameraFar").setGroup(xU).onRenderUpdate((({camera:t})=>t.far)),TB=qL((({camera:t})=>{let e;if(t.isArrayCamera&&t.cameras.length>0){const n=[];for(const e of t.cameras)n.push(e.projectionMatrix);e=xB(n).setGroup(xU).label("cameraProjectionMatrices").element(wB).toVar("cameraProjectionMatrix")}else e=SU("mat4").label("cameraProjectionMatrix").setGroup(xU).onRenderUpdate((({camera:t})=>t.projectionMatrix));return e})).once()(),EB=qL((({camera:t})=>{let e;if(t.isArrayCamera&&t.cameras.length>0){const n=[];for(const e of t.cameras)n.push(e.matrixWorldInverse);e=xB(n).setGroup(xU).label("cameraViewMatrices").element(wB).toVar("cameraViewMatrix")}else e=SU("mat4").label("cameraViewMatrix").setGroup(xU).onRenderUpdate((({camera:t})=>t.matrixWorldInverse));return e})).once()(),AB=SU(new cS).label("cameraPosition").setGroup(xU).onRenderUpdate((({camera:t},e)=>e.value.setFromMatrixPosition(t.matrixWorld)));class CB extends tL{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=qD,this._uniformNode=new MU(null)}getNodeType(){const t=this.scope;return t===CB.WORLD_MATRIX?"mat4":t===CB.POSITION||t===CB.VIEW_POSITION||t===CB.DIRECTION||t===CB.SCALE?"vec3":void 0}update(t){const e=this.object3d,n=this._uniformNode,r=this.scope;if(r===CB.WORLD_MATRIX)n.value=e.matrixWorld;else if(r===CB.POSITION)n.value=n.value||new cS,n.value.setFromMatrixPosition(e.matrixWorld);else if(r===CB.SCALE)n.value=n.value||new cS,n.value.setFromMatrixScale(e.matrixWorld);else if(r===CB.DIRECTION)n.value=n.value||new cS,e.getWorldDirection(n.value);else if(r===CB.VIEW_POSITION){const r=t.camera;n.value=n.value||new cS,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}}generate(t){const e=this.scope;return e===CB.WORLD_MATRIX?this._uniformNode.nodeType="mat4":e!==CB.POSITION&&e!==CB.VIEW_POSITION&&e!==CB.DIRECTION&&e!==CB.SCALE||(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}CB.WORLD_MATRIX="worldMatrix",CB.POSITION="position",CB.SCALE="scale",CB.VIEW_POSITION="viewPosition",CB.DIRECTION="direction",CB.DIRECTION,CB.WORLD_MATRIX;const RB=HL(CB,CB.POSITION);CB.SCALE,CB.VIEW_POSITION;class NB extends CB{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const PB=WL(NB,NB.WORLD_MATRIX),kB=SU(new zM).onObjectUpdate((({object:t},e)=>e.value.getNormalMatrix(t.matrixWorld))),OB=qL((t=>t.renderer.nodes.modelViewMatrix||IB)).once()().toVar("modelViewMatrix"),IB=EB.mul(PB),DB=lB("position","vec3"),LB=DB.toVarying("positionLocal"),UB=DB.toVarying("positionPrevious"),FB=PB.mul(LB).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),zB=LB.transformDirection(PB).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),BB=qL((t=>t.context.setupPositionView()),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),jB=BB.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class VB extends tL{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:n}=t;return e.coordinateSystem===SM&&1===n.side?"false":t.getFrontFacing()}}const GB=ZL(WL(VB)).mul(2).sub(1),HB=lB("normal","vec3"),WB=qL((t=>!1===t.geometry.hasAttribute("normal")?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),sU(0,1,0)):HB),"vec3").once()().toVar("normalLocal"),qB=BB.dFdx().cross(BB.dFdy()).normalize().toVar("normalFlat"),$B=qL((t=>{let e;return e=!0===t.material.flatShading?qB:Iz(QB(WB),"v_normalView").normalize(),e}),"vec3").once()().toVar("normalView"),XB=Iz($B.transformDirection(EB),"v_normalWorld").normalize().toVar("normalWorld"),YB=qL((t=>t.context.setupNormal().context({getUV:null})),"vec3").once()().mul(GB).toVar("transformedNormalView"),KB=YB.transformDirection(EB).toVar("transformedNormalWorld"),ZB=qL((t=>t.context.setupClearcoatNormal().context({getUV:null})),"vec3").once()().mul(GB).toVar("transformedClearcoatNormalView"),JB=qL((([t,e=PB])=>{const n=fU(e),r=t.div(sU(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz})),QB=qL((([t],e)=>{const n=e.renderer.nodes.modelNormalViewMatrix;if(null!==n)return n.transformDirection(t);const r=kB.mul(t);return EB.transformDirection(r)})),tj=SU(0).onReference((({material:t})=>t)).onRenderUpdate((({material:t})=>t.refractionRatio)),ej=jB.negate().reflect(YB),nj=jB.negate().refract(YB,tj),rj=ej.transformDirection(EB).toVar("reflectVector"),ij=nj.transformDirection(EB).toVar("reflectVector");class sj extends fB{static get type(){return"CubeTextureNode"}constructor(t,e=null,n=null,r=null){super(t,e,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===Wx?rj:t.mapping===qx?ij:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',t.mapping),sU(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const n=this.value;return t.renderer.coordinateSystem!==TM&&n.isRenderTargetTexture?e:sU(e.x.negate(),e.yz)}generateUV(t,e){return e.build(t,"vec3")}}const oj=HL(sj);class aj extends eL{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}}class lj extends tL{static get type(){return"ReferenceNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=qD}element(t){return jL(new aj(this,jL(t)))}setGroup(t){return this.group=t,this}label(t){return this.name=t,this}setNodeType(t){let e=null;e=null!==this.count?vB(null,t,this.count):Array.isArray(this.getValueFromReference())?xB(null,t):"texture"===t?mB(null):"cubeTexture"===t?oj(null):SU(null,t),null!==this.group&&e.setGroup(this.group),null!==this.name&&e.label(this.name),this.node=e.getSelf()}getNodeType(t){return null===this.node&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let t=1;t<e.length;t++)n=n[e[t]];return n}updateReference(t){return this.reference=null!==this.object?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const uj=(t,e,n)=>jL(new lj(t,e,n)),hj=(t,e,n,r)=>jL(new lj(t,e,r,n));class cj extends lj{static get type(){return"MaterialReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=null!==this.material?this.material:t.material,this.reference}}const dj=(t,e,n=null)=>jL(new cj(t,e,n)),pj=qL((t=>(!1===t.geometry.hasAttribute("tangent")&&t.geometry.computeTangents(),lB("tangent","vec4"))))(),fj=pj.xyz.toVar("tangentLocal"),mj=OB.mul(uU(fj,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView");var gj;const yj=fU(mj,Iz((gj=$B.cross(mj),gj.mul(pj.w).xyz),"v_bitangentView").normalize().toVar("bitangentView"),$B),vj=(()=>{let t=jU.cross(jB);return t=t.cross(jU).normalize(),t=xz(t,YB,zU.mul(RU.oneMinus()).oneMinus().pow2().pow2()).normalize(),t})(),_j=qL((t=>{const{eye_pos:e,surf_norm:n,mapN:r,uv:i}=t,s=e.dFdx(),o=e.dFdy(),a=i.dFdx(),l=i.dFdy(),u=n,h=o.cross(u),c=u.cross(s),d=h.mul(a.x).add(c.mul(l.x)),p=h.mul(a.y).add(c.mul(l.y)),f=d.dot(d).max(p.dot(p)),m=GB.mul(f.inverseSqrt());return rF(d.mul(r.x,m),p.mul(r.y,m),u.mul(r.z)).normalize()}));class bj extends rL{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=0}setup(t){const{normalMapType:e,scaleNode:n}=this;let r=this.node.mul(2).sub(1);null!==n&&(r=sU(r.xy.mul(n),r.z));let i=null;if(1===e)i=QB(r);else if(0===e){i=!0===t.hasGeometryAttribute("tangent")?yj.mul(r).normalize():_j({eye_pos:BB,surf_norm:$B,mapN:r,uv:uB()})}return i}}const xj=HL(bj),wj=qL((({textureNode:t,bumpScale:e})=>{const n=e=>t.cache().context({getUV:t=>e(t.uvNode||uB()),forceUVContext:!0}),r=ZL(n((t=>t)));return eU(ZL(n((t=>t.add(t.dFdx())))).sub(r),ZL(n((t=>t.add(t.dFdy())))).sub(r)).mul(e)})),Mj=qL((t=>{const{surf_pos:e,surf_norm:n,dHdxy:r}=t,i=e.dFdx().normalize(),s=n,o=e.dFdy().normalize().cross(s),a=s.cross(i),l=i.dot(o).mul(GB),u=l.sign().mul(r.x.mul(o).add(r.y.mul(a)));return l.abs().mul(n).sub(u).normalize()}));class Sj extends rL{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=null!==this.scaleNode?this.scaleNode:1,e=wj({textureNode:this.textureNode,bumpScale:t});return Mj({surf_pos:BB,surf_norm:$B,dHdxy:e})}}const Tj=HL(Sj),Ej=new Map;class Aj extends tL{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let n=Ej.get(t);return void 0===n&&(n=dj(t,e),Ej.set(t,n)),n}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache("map"===t?"map":t+"Map","texture")}setup(t){const e=t.context.material,n=this.scope;let r=null;if(n===Aj.COLOR){const t=void 0!==e.color?this.getColor(n):sU();r=e.map&&!0===e.map.isTexture?t.mul(this.getTexture("map")):t}else if(n===Aj.OPACITY){const t=this.getFloat(n);r=e.alphaMap&&!0===e.alphaMap.isTexture?t.mul(this.getTexture("alpha")):t}else if(n===Aj.SPECULAR_STRENGTH)r=e.specularMap&&!0===e.specularMap.isTexture?this.getTexture("specular").r:ZL(1);else if(n===Aj.SPECULAR_INTENSITY){const t=this.getFloat(n);r=e.specularIntensityMap&&!0===e.specularIntensityMap.isTexture?t.mul(this.getTexture(n).a):t}else if(n===Aj.SPECULAR_COLOR){const t=this.getColor(n);r=e.specularColorMap&&!0===e.specularColorMap.isTexture?t.mul(this.getTexture(n).rgb):t}else if(n===Aj.ROUGHNESS){const t=this.getFloat(n);r=e.roughnessMap&&!0===e.roughnessMap.isTexture?t.mul(this.getTexture(n).g):t}else if(n===Aj.METALNESS){const t=this.getFloat(n);r=e.metalnessMap&&!0===e.metalnessMap.isTexture?t.mul(this.getTexture(n).b):t}else if(n===Aj.EMISSIVE){const t=this.getFloat("emissiveIntensity"),i=this.getColor(n).mul(t);r=e.emissiveMap&&!0===e.emissiveMap.isTexture?i.mul(this.getTexture(n)):i}else if(n===Aj.NORMAL)e.normalMap?(r=xj(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=e.normalMapType):r=e.bumpMap?Tj(this.getTexture("bump").r,this.getFloat("bumpScale")):$B;else if(n===Aj.CLEARCOAT){const t=this.getFloat(n);r=e.clearcoatMap&&!0===e.clearcoatMap.isTexture?t.mul(this.getTexture(n).r):t}else if(n===Aj.CLEARCOAT_ROUGHNESS){const t=this.getFloat(n);r=e.clearcoatRoughnessMap&&!0===e.clearcoatRoughnessMap.isTexture?t.mul(this.getTexture(n).r):t}else if(n===Aj.CLEARCOAT_NORMAL)r=e.clearcoatNormalMap?xj(this.getTexture(n),this.getCache(n+"Scale","vec2")):$B;else if(n===Aj.SHEEN){const t=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=e.sheenColorMap&&!0===e.sheenColorMap.isTexture?t.mul(this.getTexture("sheenColor").rgb):t}else if(n===Aj.SHEEN_ROUGHNESS){const t=this.getFloat(n);r=e.sheenRoughnessMap&&!0===e.sheenRoughnessMap.isTexture?t.mul(this.getTexture(n).a):t,r=r.clamp(.07,1)}else if(n===Aj.ANISOTROPY)if(e.anisotropyMap&&!0===e.anisotropyMap.isTexture){const t=this.getTexture(n);r=pU(hV.x,hV.y,hV.y.negate(),hV.x).mul(t.rg.mul(2).sub(eU(1)).normalize().mul(t.b))}else r=hV;else if(n===Aj.IRIDESCENCE_THICKNESS){const t=uj("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const i=uj("0","float",e.iridescenceThicknessRange);r=t.sub(i).mul(this.getTexture(n).g).add(i)}else r=t}else if(n===Aj.TRANSMISSION){const t=this.getFloat(n);r=e.transmissionMap?t.mul(this.getTexture(n).r):t}else if(n===Aj.THICKNESS){const t=this.getFloat(n);r=e.thicknessMap?t.mul(this.getTexture(n).g):t}else if(n===Aj.IOR)r=this.getFloat(n);else if(n===Aj.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Aj.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const e=this.getNodeType(t);r=this.getCache(n,e)}return r}}Aj.ALPHA_TEST="alphaTest",Aj.COLOR="color",Aj.OPACITY="opacity",Aj.SHININESS="shininess",Aj.SPECULAR="specular",Aj.SPECULAR_STRENGTH="specularStrength",Aj.SPECULAR_INTENSITY="specularIntensity",Aj.SPECULAR_COLOR="specularColor",Aj.REFLECTIVITY="reflectivity",Aj.ROUGHNESS="roughness",Aj.METALNESS="metalness",Aj.NORMAL="normal",Aj.CLEARCOAT="clearcoat",Aj.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Aj.CLEARCOAT_NORMAL="clearcoatNormal",Aj.EMISSIVE="emissive",Aj.ROTATION="rotation",Aj.SHEEN="sheen",Aj.SHEEN_ROUGHNESS="sheenRoughness",Aj.ANISOTROPY="anisotropy",Aj.IRIDESCENCE="iridescence",Aj.IRIDESCENCE_IOR="iridescenceIOR",Aj.IRIDESCENCE_THICKNESS="iridescenceThickness",Aj.IOR="ior",Aj.TRANSMISSION="transmission",Aj.THICKNESS="thickness",Aj.ATTENUATION_DISTANCE="attenuationDistance",Aj.ATTENUATION_COLOR="attenuationColor",Aj.LINE_SCALE="scale",Aj.LINE_DASH_SIZE="dashSize",Aj.LINE_GAP_SIZE="gapSize",Aj.LINE_WIDTH="linewidth",Aj.LINE_DASH_OFFSET="dashOffset",Aj.POINT_SIZE="size",Aj.DISPERSION="dispersion",Aj.LIGHT_MAP="light",Aj.AO="ao";const Cj=WL(Aj,Aj.ALPHA_TEST),Rj=WL(Aj,Aj.COLOR),Nj=WL(Aj,Aj.SHININESS),Pj=WL(Aj,Aj.EMISSIVE),kj=WL(Aj,Aj.OPACITY),Oj=WL(Aj,Aj.SPECULAR),Ij=WL(Aj,Aj.SPECULAR_INTENSITY),Dj=WL(Aj,Aj.SPECULAR_COLOR),Lj=WL(Aj,Aj.SPECULAR_STRENGTH),Uj=WL(Aj,Aj.REFLECTIVITY),Fj=WL(Aj,Aj.ROUGHNESS),zj=WL(Aj,Aj.METALNESS),Bj=WL(Aj,Aj.NORMAL),jj=WL(Aj,Aj.CLEARCOAT),Vj=WL(Aj,Aj.CLEARCOAT_ROUGHNESS),Gj=WL(Aj,Aj.CLEARCOAT_NORMAL),Hj=WL(Aj,Aj.ROTATION),Wj=WL(Aj,Aj.SHEEN),qj=WL(Aj,Aj.SHEEN_ROUGHNESS),$j=WL(Aj,Aj.ANISOTROPY),Xj=WL(Aj,Aj.IRIDESCENCE),Yj=WL(Aj,Aj.IRIDESCENCE_IOR),Kj=WL(Aj,Aj.IRIDESCENCE_THICKNESS),Zj=WL(Aj,Aj.TRANSMISSION),Jj=WL(Aj,Aj.THICKNESS),Qj=WL(Aj,Aj.IOR),tV=WL(Aj,Aj.ATTENUATION_DISTANCE),eV=WL(Aj,Aj.ATTENUATION_COLOR),nV=WL(Aj,Aj.LINE_SCALE),rV=WL(Aj,Aj.LINE_DASH_SIZE),iV=WL(Aj,Aj.LINE_GAP_SIZE);Aj.LINE_WIDTH;const sV=WL(Aj,Aj.LINE_DASH_OFFSET),oV=WL(Aj,Aj.POINT_SIZE),aV=WL(Aj,Aj.DISPERSION),lV=WL(Aj,Aj.LIGHT_MAP),uV=WL(Aj,Aj.AO),hV=SU(new FM).onReference((function(t){return t.material})).onRenderUpdate((function({material:t}){this.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation))})),cV=qL((t=>t.context.setupModelViewProjection()),"vec4").once()().toVarying("v_modelViewProjection");class dV extends tL{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isIndexNode=!0}generate(t){const e=this.getNodeType(t),n=this.scope;let r,i;if(n===dV.VERTEX)r=t.getVertexIndex();else if(n===dV.INSTANCE)r=t.getInstanceIndex();else if(n===dV.DRAW)r=t.getDrawIndex();else if(n===dV.INVOCATION_LOCAL)r=t.getInvocationLocalIndex();else if(n===dV.INVOCATION_SUBGROUP)r=t.getInvocationSubgroupIndex();else{if(n!==dV.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);r=t.getSubgroupIndex()}if("vertex"===t.shaderStage||"compute"===t.shaderStage)i=r;else{i=Iz(this).build(t,e)}return i}}dV.VERTEX="vertex",dV.INSTANCE="instance",dV.SUBGROUP="subgroup",dV.INVOCATION_LOCAL="invocationLocal",dV.INVOCATION_SUBGROUP="invocationSubgroup",dV.DRAW="draw";const pV=WL(dV,dV.VERTEX),fV=WL(dV,dV.INSTANCE);dV.SUBGROUP,dV.INVOCATION_SUBGROUP,dV.INVOCATION_LOCAL;const mV=WL(dV,dV.DRAW);class gV extends tL{static get type(){return"InstanceNode"}constructor(t,e,n){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=HD,this.buffer=null,this.bufferColor=null}setup(t){const{count:e,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:i,instanceColorNode:s}=this;if(null===i){if(e<=1e3)i=vB(n.array,"mat4",Math.max(e,1)).element(fV);else{const t=new hC(n.array,16,1);this.buffer=t;const e=n.usage===wM?Kz:Yz,r=[e(t,"vec4",16,0),e(t,"vec4",16,4),e(t,"vec4",16,8),e(t,"vec4",16,12)];i=mU(...r)}this.instanceMatrixNode=i}if(r&&null===s){const t=new jE(r.array,3),e=r.usage===wM?Kz:Yz;this.bufferColor=t,s=sU(e(t,"vec3",3,0)),this.instanceColorNode=s}const o=i.mul(LB).xyz;if(LB.assign(o),t.hasGeometryAttribute("normal")){const t=JB(WB,i);WB.assign(t)}null!==this.instanceColorNode&&EU("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==wM&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==wM&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class yV extends gV{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:n,instanceColor:r}=t;super(e,n,r),this.instancedMesh=t}}const vV=HL(yV);class _V extends tL{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){null===this.batchingIdNode&&(null===t.getDrawIndex()?this.batchingIdNode=fV:this.batchingIdNode=mV);const e=qL((([t])=>{const e=JL(cB(gB(this.batchMesh._indirectTexture),0)),n=JL(t).modInt(e),r=JL(t).div(e);return gB(this.batchMesh._indirectTexture,nU(n,r)).x})).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=e(JL(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=cB(gB(r),0),s=ZL(n).mul(4).toInt().toVar(),o=s.modInt(i),a=s.div(JL(i)),l=mU(gB(r,nU(o,a)),gB(r,nU(o.add(1),a)),gB(r,nU(o.add(2),a)),gB(r,nU(o.add(3),a))),u=this.batchMesh._colorsTexture;if(null!==u){const t=qL((([t])=>{const e=cB(gB(u),0).x,n=t,r=n.modInt(e),i=n.div(e);return gB(u,nU(r,i)).rgb})).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),e=t(n);EU("vec3","vBatchColor").assign(e)}const h=fU(l);LB.assign(l.mul(LB));const c=WB.div(sU(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),d=h.mul(c).xyz;WB.assign(d),t.hasGeometryAttribute("tangent")&&fj.mulAssign(h)}}const bV=HL(_V),xV=new WeakMap;class wV extends tL{static get type(){return"SkinningNode"}constructor(t,e=!1){let n,r,i;super("void"),this.skinnedMesh=t,this.useReference=e,this.updateType=qD,this.skinIndexNode=lB("skinIndex","uvec4"),this.skinWeightNode=lB("skinWeight","vec4"),e?(n=uj("bindMatrix","mat4"),r=uj("bindMatrixInverse","mat4"),i=hj("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(n=SU(t.bindMatrix,"mat4"),r=SU(t.bindMatrixInverse,"mat4"),i=vB(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=r,this.boneMatricesNode=i,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=LB){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,o=t.element(n.x),a=t.element(n.y),l=t.element(n.z),u=t.element(n.w),h=i.mul(e),c=rF(o.mul(r.x).mul(h),a.mul(r.y).mul(h),l.mul(r.z).mul(h),u.mul(r.w).mul(h));return s.mul(c).xyz}getSkinnedNormal(t=this.boneMatricesNode,e=WB){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,o=t.element(n.x),a=t.element(n.y),l=t.element(n.z),u=t.element(n.w);let h=rF(r.x.mul(o),r.y.mul(a),r.z.mul(l),r.w.mul(u));return h=s.mul(h).mul(i),h.transformDirection(e).xyz}getPreviousSkinnedPosition(t){const e=t.object;return null===this.previousBoneMatricesNode&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=hj("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,UB)}needsPreviousBoneMatrices(t){const e=t.renderer.getMRT();return e&&e.has("velocity")||!0===jD(t.object).useVelocity}setup(t){this.needsPreviousBoneMatrices(t)&&UB.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(LB.assign(e),t.hasGeometryAttribute("normal")){const e=this.getSkinnedNormal();WB.assign(e),t.hasGeometryAttribute("tangent")&&fj.assign(e)}}generate(t,e){if("void"!==e)return LB.build(t,e)}update(t){const e=(this.useReference?t.object:this.skinnedMesh).skeleton;xV.get(e)!==t.frameId&&(xV.set(e,t.frameId),null!==this.previousBoneMatricesNode&&e.previousBoneMatrices.set(e.boneMatrices),e.update())}}class MV extends tL{static get type(){return"LoopNode"}constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode("i".charCodeAt(0)+t)}getProperties(t){const e=t.getNodeProperties(this);if(void 0!==e.stackNode)return e;const n={};for(let t=0,e=this.params.length-1;t<e;t++){const e=this.params[t],r=!0!==e.isNode&&e.name||this.getVarName(t),i=!0!==e.isNode&&e.type||"int";n[r]=sB(r,i)}const r=t.addStack();return e.returnsNode=this.params[this.params.length-1](n,r,t),e.stackNode=r,t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),n=this.params,r=e.stackNode;for(let e=0,r=n.length-1;e<r;e++){const r=n[e];let i=null,s=null,o=null,a=null,l=null,u=null;r.isNode?(a="int",o=this.getVarName(e),i="0",s=r.build(t,a),l="<"):(a=r.type||"int",o=r.name||this.getVarName(e),i=r.start,s=r.end,l=r.condition,u=r.update,"number"==typeof i?i=t.generateConst(a,i):i&&i.isNode&&(i=i.build(t,a)),"number"==typeof s?s=t.generateConst(a,s):s&&s.isNode&&(s=s.build(t,a)),void 0!==i&&void 0===s?(i+=" - 1",s="0",l=">="):void 0!==s&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(s)?">=":"<"));const h={start:i,end:s},c=h.start,d=h.end;let p="",f="",m="";u||(u="int"===a||"uint"===a?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),p+=t.getVar(a,o)+" = "+c,f+=o+" "+l+" "+d,m+=o+" "+u;const g=`for ( ${p}; ${f}; ${m} )`;t.addFlowCode((0===e?"\n":"")+t.tab+g+" {\n\n").addFlowTab()}const i=r.build(t,"void"),s=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode("\n"+t.tab+i);for(let e=0,n=this.params.length-1;e<n;e++)t.addFlowCode((0===e?"":t.tab)+"}\n\n").removeFlowTab();return t.addFlowTab(),s}}const SV=(...t)=>jL(new MV(GL(t,"int"))).append(),TV=new WeakMap,EV=new sS,AV=qL((({bufferMap:t,influence:e,stride:n,width:r,depth:i,offset:s})=>{const o=JL(pV).mul(n).add(s),a=o.div(r),l=o.sub(a.mul(r));return gB(t,nU(l,a)).depth(i).mul(e)}));class CV extends tL{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=SU(1),this.updateType=qD}setup(t){const{geometry:e}=t,n=void 0!==e.morphAttributes.position,r=e.hasAttribute("normal")&&void 0!==e.morphAttributes.normal,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,s=void 0!==i?i.length:0,{texture:o,stride:a,size:l}=function(t){const e=void 0!==t.morphAttributes.position,n=void 0!==t.morphAttributes.normal,r=void 0!==t.morphAttributes.color,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,s=void 0!==i?i.length:0;let o=TV.get(t);if(void 0===o||o.count!==s){void 0!==o&&o.texture.dispose();const a=t.morphAttributes.position||[],l=t.morphAttributes.normal||[],u=t.morphAttributes.color||[];let h=0;!0===e&&(h=1),!0===n&&(h=2),!0===r&&(h=3);let c=t.attributes.position.count*h,d=1;const p=4096;c>p&&(d=Math.ceil(c/p),c=p);const f=new Float32Array(c*d*4*s),m=new lS(f,c,d,s);m.type=cw,m.needsUpdate=!0;const g=4*h;for(let v=0;v<s;v++){const _=a[v],b=l[v],x=u[v],w=c*d*4*v;for(let M=0;M<_.count;M++){const S=M*g;!0===e&&(EV.fromBufferAttribute(_,M),f[w+S+0]=EV.x,f[w+S+1]=EV.y,f[w+S+2]=EV.z,f[w+S+3]=0),!0===n&&(EV.fromBufferAttribute(b,M),f[w+S+4]=EV.x,f[w+S+5]=EV.y,f[w+S+6]=EV.z,f[w+S+7]=0),!0===r&&(EV.fromBufferAttribute(x,M),f[w+S+8]=EV.x,f[w+S+9]=EV.y,f[w+S+10]=EV.z,f[w+S+11]=4===x.itemSize?EV.w:1)}}function y(){m.dispose(),TV.delete(t),t.removeEventListener("dispose",y)}o={count:s,texture:m,stride:h,size:new FM(c,d)},TV.set(t,o),t.addEventListener("dispose",y)}return o}(e);!0===n&&LB.mulAssign(this.morphBaseInfluence),!0===r&&WB.mulAssign(this.morphBaseInfluence);const u=JL(l.width);SV(s,(({i:t})=>{const e=ZL(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?e.assign(gB(this.mesh.morphTexture,nU(JL(t).add(1),JL(fV))).r):e.assign(uj("morphTargetInfluences","float").element(t).toVar()),!0===n&&LB.addAssign(AV({bufferMap:o,influence:e,stride:a,width:u,depth:t,offset:JL(0)})),!0===r&&WB.addAssign(AV({bufferMap:o,influence:e,stride:a,width:u,depth:t,offset:JL(1)}))}))}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce(((t,e)=>t+e),0)}}const RV=HL(CV);class NV extends tL{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class PV extends NV{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class kV extends Rz{static get type(){return"LightingContextNode"}constructor(t,e=null,n=null,r=null){super(t),this.lightingModel=e,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,n={directDiffuse:sU().toVar("directDiffuse"),directSpecular:sU().toVar("directSpecular"),indirectDiffuse:sU().toVar("indirectDiffuse"),indirectSpecular:sU().toVar("indirectSpecular")};return{radiance:sU().toVar("radiance"),irradiance:sU().toVar("irradiance"),iblIrradiance:sU().toVar("iblIrradiance"),ambientOcclusion:ZL(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const OV=HL(kV);class IV extends NV{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}let DV,LV;class UV extends tL{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===UV.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=GD;return this.scope!==UV.SIZE&&this.scope!==UV.VIEWPORT||(t=WD),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===UV.VIEWPORT?null!==e?LV.copy(e.viewport):(t.getViewport(LV),LV.multiplyScalar(t.getPixelRatio())):null!==e?(DV.width=e.width,DV.height=e.height):t.getDrawingBufferSize(DV)}setup(){const t=this.scope;let e=null;return e=t===UV.SIZE?SU(DV||(DV=new FM)):t===UV.VIEWPORT?SU(LV||(LV=new sS)):eU(BV.div(zV)),e}generate(t){if(this.scope===UV.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const n=t.getNodeProperties(zV).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}}UV.COORDINATE="coordinate",UV.VIEWPORT="viewport",UV.SIZE="size",UV.UV="uv";const FV=WL(UV,UV.UV),zV=WL(UV,UV.SIZE),BV=WL(UV,UV.COORDINATE),jV=WL(UV,UV.VIEWPORT);jV.zw,jV.xy;const VV=new FM;class GV extends fB{static get type(){return"ViewportTextureNode"}constructor(t=FV,e=null,n=null){null===n&&((n=new sA).minFilter=iw),super(n,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=HD}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(VV);const n=this.value;n.image.width===VV.width&&n.image.height===VV.height||(n.image.width=VV.width,n.image.height=VV.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const HV=HL(GV,null,null,{generateMipmaps:!0});let WV=null;class qV extends GV{static get type(){return"ViewportDepthTextureNode"}constructor(t=FV,e=null){null===WV&&(WV=new oA),super(t,e,WV)}}const $V=HL(qV);class XV extends tL{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===XV.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,n=this.valueNode;let r=null;if(e===XV.DEPTH_BASE)null!==n&&(r=QV().assign(n));else if(e===XV.DEPTH)r=t.isPerspectiveCamera?KV(BB.z,MB,SB):YV(BB.z,MB,SB);else if(e===XV.LINEAR_DEPTH)if(null!==n)if(t.isPerspectiveCamera){const t=ZV(n,MB,SB);r=YV(t,MB,SB)}else r=n;else r=YV(BB.z,MB,SB);return r}}XV.DEPTH_BASE="depthBase",XV.DEPTH="depth",XV.LINEAR_DEPTH="linearDepth";const YV=(t,e,n)=>t.add(e).div(e.sub(n)),KV=(t,e,n)=>e.add(t).mul(n).div(n.sub(e).mul(t)),ZV=(t,e,n)=>e.mul(n).div(n.sub(e).mul(t).sub(n)),JV=(t,e,n)=>{e=e.max(1e-6).toVar();const r=IF(t.negate().div(e)),i=IF(n.div(e));return r.div(i)},QV=HL(XV,XV.DEPTH_BASE),tG=WL(XV,XV.DEPTH);XV.LINEAR_DEPTH;$V(),tG.assign=t=>QV(t);const eG=HL(class extends tL{constructor(t){super("float"),this.name=t,this.isBuiltinNode=!0}generate(){return this.name}});class nG extends tL{static get type(){return"ClippingNode"}constructor(t=nG.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:n,unionPlanes:r}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===nG.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===nG.HARDWARE?this.setupHardwareClipping(r,t):this.setupDefault(n,r)}setupAlphaToCoverage(t,e){return qL((()=>{const n=ZL().toVar("distanceToPlane"),r=ZL().toVar("distanceToGradient"),i=ZL(1).toVar("clipOpacity"),s=e.length;if(!1===this.hardwareClipping&&s>0){const t=xB(e);SV(s,(({i:e})=>{const s=t.element(e);n.assign(BB.dot(s.xyz).negate().add(s.w)),r.assign(n.fwidth().div(2)),i.mulAssign(Sz(r.negate(),r,n))}))}const o=t.length;if(o>0){const e=xB(t),s=ZL(1).toVar("intersectionClipOpacity");SV(o,(({i:t})=>{const i=e.element(t);n.assign(BB.dot(i.xyz).negate().add(i.w)),r.assign(n.fwidth().div(2)),s.mulAssign(Sz(r.negate(),r,n).oneMinus())})),i.mulAssign(s.oneMinus())}AU.a.mulAssign(i),AU.a.equal(0).discard()}))()}setupDefault(t,e){return qL((()=>{const n=e.length;if(!1===this.hardwareClipping&&n>0){const t=xB(e);SV(n,(({i:e})=>{const n=t.element(e);BB.dot(n.xyz).greaterThan(n.w).discard()}))}const r=t.length;if(r>0){const e=xB(t),n=tU(!0).toVar("clipped");SV(r,(({i:t})=>{const r=e.element(t);n.assign(BB.dot(r.xyz).greaterThan(r.w).and(n))})),n.discard()}}))()}setupHardwareClipping(t,e){const n=t.length;return e.enableHardwareClipping(n),qL((()=>{const r=xB(t),i=eG(e.getClipDistance());SV(n,(({i:t})=>{const e=r.element(t),n=BB.dot(e.xyz).sub(e.w).negate();i.element(t).assign(n)}))}))()}}nG.ALPHA_TO_COVERAGE="alphaToCoverage",nG.DEFAULT="default",nG.HARDWARE="hardware";const rG=qL((([t])=>BF(sF(1e4,jF(sF(17,t.x).add(sF(.1,t.y)))).mul(rF(.1,$F(jF(sF(13,t.y).add(t.x)))))))),iG=qL((([t])=>rG(eU(rG(t.xy),t.z)))),sG=qL((([t])=>{const e=az(YF(JF(t.xyz)),YF(QF(t.xyz))),n=ZL(1).div(ZL(.05).mul(e)).toVar("pixScale"),r=eU(kF(UF(IF(n))),kF(FF(IF(n)))),i=eU(iG(UF(r.x.mul(t.xyz))),iG(UF(r.y.mul(t.xyz)))),s=BF(IF(n)),o=rF(sF(s.oneMinus(),i.x),sF(s,i.y)),a=oz(s,s.oneMinus()),l=sU(o.mul(o).div(sF(2,a).mul(iF(1,a))),o.sub(sF(.5,a)).div(iF(1,a)),iF(1,iF(1,o).mul(iF(1,o)).div(sF(2,a).mul(iF(1,a))))),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return wz(u,1e-6,1)})).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class oG extends LT{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+DD(this)}build(t){this.setup(t)}setupObserver(t){return new PD(t)}setup(t){t.context.setupNormal=()=>this.setupNormal(t),t.context.setupPositionView=()=>this.setupPositionView(t),t.context.setupModelViewProjection=()=>this.setupModelViewProjection(t);const e=t.renderer,n=e.getRenderTarget();t.addStack();const r=this.vertexNode||this.setupVertex(t);let i;t.stack.outputNode=r,this.setupHardwareClipping(t),null!==this.geometryNode&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();const s=this.setupClipping(t);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==n?!0===n.depthBuffer&&this.setupDepth(t):!0===e.depth&&this.setupDepth(t)),null===this.fragmentNode){this.setupDiffuseColor(t),this.setupVariants(t);const r=this.setupLighting(t);null!==s&&t.stack.add(s);const o=uU(r,AU.a).max(0);if(i=this.setupOutput(t,o),WU.assign(i),null!==this.outputNode&&(i=this.outputNode),null!==n){const t=e.getMRT(),n=this.mrtNode;null!==t?(i=t,null!==n&&(i=t.merge(n))):null!==n&&(i=n)}}else{let e=this.fragmentNode;!0!==e.isOutputStructNode&&(e=uU(e)),i=this.setupOutput(t,e)}t.stack.outputNode=i,t.addFlow("fragment",t.removeStack()),t.observer=this.setupObserver(t)}setupClipping(t){if(null===t.clippingContext)return null;const{unionPlanes:e,intersectionPlanes:n}=t.clippingContext;let r=null;if(e.length>0||n.length>0){const e=t.renderer.samples;this.alphaToCoverage&&e>1?r=jL(new nG(nG.ALPHA_TO_COVERAGE)):t.stack.add(jL(new nG))}return r}setupHardwareClipping(t){if(this.hardwareClipping=!1,null===t.clippingContext)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.add(jL(new nG(nG.HARDWARE))),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:n}=t;let r=this.depthNode;if(null===r){const t=e.getMRT();t&&t.has("depth")?r=t.get("depth"):!0===e.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?JV(BB.z,MB,SB):YV(BB.z,MB,SB))}null!==r&&tG.assign(r).append()}setupPositionView(){return OB.mul(LB).xyz}setupModelViewProjection(){return TB.mul(BB)}setupVertex(t){return t.addStack(),this.setupPosition(t),t.context.vertex=t.removeStack(),cV}setupPosition(t){const{object:e,geometry:n}=t;var r;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&RV(e).append(),!0===e.isSkinnedMesh&&(r=e,jL(new wV(r,!0))).append(),this.displacementMap){const t=dj("displacementMap","texture"),e=dj("displacementScale","float"),n=dj("displacementBias","float");LB.addAssign(WB.normalize().mul(t.x.mul(e).add(n)))}return e.isBatchedMesh&&bV(e).append(),e.isInstancedMesh&&e.instanceMatrix&&!0===e.instanceMatrix.isInstancedBufferAttribute&&vV(e).append(),null!==this.positionNode&&LB.assign(this.positionNode.context({isPositionNodeInput:!0})),LB}setupDiffuseColor({object:t,geometry:e}){let n=this.colorNode?uU(this.colorNode):Rj;if(!0===this.vertexColors&&e.hasAttribute("color")&&(n=uU(n.xyz.mul(lB("color","vec3")),n.a)),t.instanceColor){n=EU("vec3","vInstanceColor").mul(n)}if(t.isBatchedMesh&&t._colorsTexture){n=EU("vec3","vBatchColor").mul(n)}AU.assign(n);const r=this.opacityNode?ZL(this.opacityNode):kj;if(AU.a.assign(AU.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){const t=null!==this.alphaTestNode?ZL(this.alphaTestNode):Cj;AU.a.lessThanEqual(t).discard()}!0===this.alphaHash&&AU.a.lessThan(sG(LB)).discard(),!1===this.transparent&&1===this.blending&&!1===this.alphaToCoverage&&AU.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?sU(0):AU.rgb}setupNormal(){return this.normalNode?sU(this.normalNode):Bj}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?dj("envMap","cubeTexture"):dj("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new IV(lV)),e}setupLights(t){const e=[],n=this.setupEnvironment(t);n&&n.isLightingNode&&e.push(n);const r=this.setupLightMap(t);if(r&&r.isLightingNode&&e.push(r),null!==this.aoNode||t.material.aoMap){const t=null!==this.aoNode?this.aoNode:uV;e.push(new PV(t))}let i=this.lightsNode||t.lightsNode;return e.length>0&&(i=t.renderer.lighting.createNode([...i.getLights(),...e])),i}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,s=!0===this.lights||null!==this.lightsNode?this.setupLights(t):null;let o=this.setupOutgoingLight(t);if(s&&s.getScope().hasLights){const e=this.setupLightingModel(t);o=OV(s,e,n,r)}else null!==n&&(o=sU(null!==r?xz(o,n,r):n));return(i&&!0===i.isNode||e.emissive&&!0===e.emissive.isColor)&&(CU.assign(sU(i||Pj)),o=o.add(CU)),o}setupOutput(t,e){if(!0===this.fog){const n=t.fogNode;n&&(WU.assign(e),e=uU(n))}return e}setDefaultValues(t){for(const e in t){const n=t[e];void 0===this[e]&&(this[e]=n,n&&n.clone&&(this[e]=n.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const t in e)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,t)&&void 0!==e[t].get&&Object.defineProperty(this.constructor.prototype,t,e[t])}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{},nodes:{}});const n=LT.prototype.toJSON.call(this,t),r=LD(this);n.inputNodes={};for(const{property:e,childNode:i}of r)n.inputNodes[e]=i.toJSON(t).uuid;function i(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(e){const e=i(t.textures),r=i(t.images),s=i(t.nodes);e.length>0&&(n.textures=e),r.length>0&&(n.images=r),s.length>0&&(n.nodes=s)}return n}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.shadowPositionNode=t.shadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}}const aG=new YE;class lG extends oG{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(aG),this.setValues(t)}}const uG=new DA;class hG extends oG{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(uG),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode?ZL(this.offsetNode):sV,e=this.dashScaleNode?ZL(this.dashScaleNode):nV,n=this.dashSizeNode?ZL(this.dashSizeNode):rV,r=this.gapSizeNode?ZL(this.gapSizeNode):iV;qU.assign(n),$U.assign(r);const i=Iz(lB("lineDistance").mul(e));(t?i.add(t):i).mod(qU.add($U)).greaterThan(qU).discard()}}const cG=new NA;class dG extends oG{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(cG),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?ZL(this.opacityNode):kj;AU.assign(uU(jL(YB).mul(.5).add(.5),t))}}class pG extends rL{static get type(){return"EquirectUVNode"}constructor(t=zB){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan(t.x).mul(1/(2*Math.PI)).add(.5),n=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return eU(e,n)}}const fG=HL(pG);class mG extends PE{constructor(t=1,e={}){super(t,e),this.isCubeRenderTarget=!0}fromEquirectangularTexture(t,e){const n=e.minFilter,r=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i=new yE(5,5,5),s=fG(zB),o=new oG;o.colorNode=mB(e,s,0),o.side=1,o.blending=0;const a=new mE(i,o),l=new DE;l.add(a),e.minFilter===iw&&(e.minFilter=nw);const u=new RE(1,10,this),h=t.getMRT();return t.setMRT(null),u.update(t,l),t.setMRT(h),e.minFilter=n,e.currentGenerateMipmaps=r,a.geometry.dispose(),a.material.dispose(),this}}const gG=new WeakMap;class yG extends rL{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=oj();const e=new NE;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=WD}updateBefore(t){const{renderer:e,material:n}=t,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const t=r.isTextureNode?r.value:n[r.property];if(t&&t.isTexture){const n=t.mapping;if(n===$x||n===Xx){if(gG.has(t)){const e=gG.get(t);_G(e,t.mapping),this._cubeTexture=e}else{const n=t.image;if(function(t){return null!=t&&t.height>0}(n)){const r=new mG(n.height);r.fromEquirectangularTexture(e,t),_G(r.texture,t.mapping),this._cubeTexture=r.texture,gG.set(t,r.texture),t.addEventListener("dispose",vG)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function vG(t){const e=t.target;e.removeEventListener("dispose",vG);const n=gG.get(e);void 0!==n&&(gG.delete(e),n.dispose())}function _G(t,e){e===$x?t.mapping=Wx:e===Xx&&(t.mapping=qx)}const bG=HL(yG);class xG extends NV{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=bG(this.envNode)}}class wG extends NV{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=ZL(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class MG{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class SG extends MG{constructor(){super()}indirect(t,e,n){const r=t.ambientOcclusion,i=t.reflectedLight,s=n.context.irradianceLightMap;i.indirectDiffuse.assign(uU(0)),s?i.indirectDiffuse.addAssign(s):i.indirectDiffuse.addAssign(uU(1,1,1,0)),i.indirectDiffuse.mulAssign(r),i.indirectDiffuse.mulAssign(AU.rgb)}finish(t,e,n){const r=n.material,i=t.outgoingLight,s=n.context.environment;if(s)switch(r.combine){case 0:i.rgb.assign(xz(i.rgb,i.rgb.mul(s.rgb),Lj.mul(Uj)));break;case 1:i.rgb.assign(xz(i.rgb,s.rgb,Lj.mul(Uj)));break;case 2:i.rgb.addAssign(s.rgb.mul(Lj.mul(Uj)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine)}}}const TG=new UT;class EG extends oG{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(TG),this.setValues(t)}setupNormal(){return $B}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new xG(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new wG(lV)),e}setupOutgoingLight(){return AU.rgb}setupLightingModel(){return new SG}}const AG=qL((({f0:t,f90:e,dotVH:n})=>{const r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return t.mul(r.oneMinus()).add(e.mul(r))})),CG=qL((t=>t.diffuseColor.mul(1/Math.PI))),RG=qL((({dotNH:t})=>HU.mul(ZL(.5)).add(1).mul(ZL(1/Math.PI)).mul(t.pow(HU)))),NG=qL((({lightDirection:t})=>{const e=t.add(jB).normalize(),n=YB.dot(e).clamp(),r=jB.dot(e).clamp(),i=AG({f0:VU,f90:1,dotVH:r}),s=ZL(.25),o=RG({dotNH:n});return i.mul(s).mul(o)}));class PG extends SG{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const r=YB.dot(t).clamp().mul(e);n.directDiffuse.addAssign(r.mul(CG({diffuseColor:AU.rgb}))),!0===this.specular&&n.directSpecular.addAssign(r.mul(NG({lightDirection:t})).mul(Lj))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:n}){n.indirectDiffuse.addAssign(e.mul(CG({diffuseColor:AU}))),n.indirectDiffuse.mulAssign(t)}}const kG=new PA;class OG extends oG{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(kG),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new xG(e):null}setupLightingModel(){return new PG(!1)}}const IG=new CA;class DG extends oG{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(IG),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new xG(e):null}setupLightingModel(){return new PG}setupVariants(){const t=(this.shininessNode?ZL(this.shininessNode):Nj).max(1e-4);HU.assign(t);const e=this.specularNode||Oj;VU.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const LG=qL((t=>{if(!1===t.geometry.hasAttribute("normal"))return ZL(0);const e=$B.dFdx().abs().max($B.dFdy().abs());return e.x.max(e.y).max(e.z)})),UG=qL((t=>{const{roughness:e}=t,n=LG();let r=e.max(.0525);return r=r.add(n),r=r.min(1),r})),FG=qL((({alpha:t,dotNL:e,dotNV:n})=>{const r=t.pow2(),i=e.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),s=n.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return oF(.5,i.add(s).max(TF))})).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),zG=qL((({alphaT:t,alphaB:e,dotTV:n,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const l=a.mul(sU(t.mul(n),e.mul(r),o).length()),u=o.mul(sU(t.mul(i),e.mul(s),a).length());return oF(.5,l.add(u)).saturate()})).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),BG=qL((({alpha:t,dotNH:e})=>{const n=t.pow2(),r=e.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)})).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),jG=ZL(1/Math.PI),VG=qL((({alphaT:t,alphaB:e,dotNH:n,dotTH:r,dotBH:i})=>{const s=t.mul(e),o=sU(e.mul(r),t.mul(i),s.mul(n)),a=o.dot(o),l=s.div(a);return jG.mul(s.mul(l.pow2()))})).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),GG=qL((t=>{const{lightDirection:e,f0:n,f90:r,roughness:i,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=t,l=t.normalView||YB,u=i.pow2(),h=e.add(jB).normalize(),c=l.dot(e).clamp(),d=l.dot(jB).clamp(),p=l.dot(h).clamp(),f=jB.dot(h).clamp();let m,g,y=AG({f0:n,f90:r,dotVH:f});if(zL(o)&&(y=DU.mix(y,s)),zL(a)){const t=BU.dot(e),n=BU.dot(jB),r=BU.dot(h),i=jU.dot(e),s=jU.dot(jB),o=jU.dot(h);m=zG({alphaT:FU,alphaB:u,dotTV:n,dotBV:s,dotTL:t,dotBL:i,dotNV:d,dotNL:c}),g=VG({alphaT:FU,alphaB:u,dotNH:p,dotTH:r,dotBH:o})}else m=FG({alpha:u,dotNL:c,dotNV:d}),g=BG({alpha:u,dotNH:p});return y.mul(m).mul(g)})),HG=qL((({roughness:t,dotNV:e})=>{const n=uU(-1,-.0275,-.572,.022),r=uU(1,.0425,1.04,-.04),i=t.mul(n).add(r),s=i.x.mul(i.x).min(e.mul(-9.28).exp2()).mul(i.x).add(i.y);return eU(-1.04,1.04).mul(s).add(i.zw)})).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),WG=qL((t=>{const{dotNV:e,specularColor:n,specularF90:r,roughness:i}=t,s=HG({dotNV:e,roughness:i});return n.mul(s.x).add(r.mul(s.y))})),qG=qL((({f:t,f90:e,dotVH:n})=>{const r=n.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return t.sub(sU(e).mul(s)).div(s.oneMinus())})).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),$G=qL((({roughness:t,dotNH:e})=>{const n=t.pow2(),r=ZL(1).div(n),i=e.pow2().oneMinus().max(.0078125);return ZL(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)})).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),XG=qL((({dotNV:t,dotNL:e})=>ZL(1).div(ZL(4).mul(e.add(t).sub(e.mul(t)))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),YG=qL((({lightDirection:t})=>{const e=t.add(jB).normalize(),n=YB.dot(t).clamp(),r=YB.dot(jB).clamp(),i=YB.dot(e).clamp(),s=$G({roughness:IU,dotNH:i}),o=XG({dotNV:r,dotNL:n});return OU.mul(s).mul(o)})),KG=qL((({N:t,V:e,roughness:n})=>{const r=t.dot(e).saturate(),i=eU(n,r.oneMinus().sqrt());return i.assign(i.mul(.984375).add(.0078125)),i})).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),ZG=qL((({f:t})=>{const e=t.length();return az(e.mul(e).add(t.z).div(e.add(1)),0)})).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),JG=qL((({v1:t,v2:e})=>{const n=t.dot(e),r=n.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=n.greaterThan(0).select(o,az(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return t.cross(e).mul(a)})).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),QG=qL((({N:t,V:e,P:n,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const l=s.sub(i).toVar(),u=a.sub(i).toVar(),h=l.cross(u),c=sU().toVar();return YL(h.dot(n.sub(i)).greaterThanEqual(0),(()=>{const l=e.sub(t.mul(e.dot(t))).normalize(),u=t.cross(l).negate(),h=r.mul(fU(l,u,t).transpose()).toVar(),d=h.mul(i.sub(n)).normalize().toVar(),p=h.mul(s.sub(n)).normalize().toVar(),f=h.mul(o.sub(n)).normalize().toVar(),m=h.mul(a.sub(n)).normalize().toVar(),g=sU(0).toVar();g.addAssign(JG({v1:d,v2:p})),g.addAssign(JG({v1:p,v2:f})),g.addAssign(JG({v1:f,v2:m})),g.addAssign(JG({v1:m,v2:d})),c.assign(sU(ZG({f:g})))})),c})).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),tH=1/6,eH=t=>sF(tH,sF(t,sF(t,t.negate().add(3)).sub(3)).add(1)),nH=t=>sF(tH,sF(t,sF(t,sF(3,t).sub(6))).add(4)),rH=t=>sF(tH,sF(t,sF(t,sF(-3,t).add(3)).add(3)).add(1)),iH=t=>sF(tH,mz(t,3)),sH=t=>eH(t).add(nH(t)),oH=t=>rH(t).add(iH(t)),aH=t=>rF(-1,nH(t).div(eH(t).add(nH(t)))),lH=t=>rF(1,iH(t).div(rH(t).add(iH(t)))),uH=(t,e,n)=>{const r=t.uvNode,i=sF(r,e.zw).add(.5),s=UF(i),o=BF(i),a=sH(o.x),l=oH(o.x),u=aH(o.x),h=lH(o.x),c=aH(o.y),d=lH(o.y),p=eU(s.x.add(u),s.y.add(c)).sub(.5).mul(e.xy),f=eU(s.x.add(h),s.y.add(c)).sub(.5).mul(e.xy),m=eU(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),g=eU(s.x.add(h),s.y.add(d)).sub(.5).mul(e.xy),y=sH(o.y).mul(rF(a.mul(t.sample(p).level(n)),l.mul(t.sample(f).level(n)))),v=oH(o.y).mul(rF(a.mul(t.sample(m).level(n)),l.mul(t.sample(g).level(n))));return y.add(v)},hH=qL((([t,e=ZL(3)])=>{const n=eU(t.size(JL(e))),r=eU(t.size(JL(e.add(1)))),i=oF(1,n),s=oF(1,r),o=uH(t,uU(i,n),UF(e)),a=uH(t,uU(s,r),FF(e));return BF(e).mix(o,a)})),cH=qL((([t,e,n,r,i])=>{const s=sU(Mz(e.negate(),zF(t),oF(1,r))),o=sU(YF(i[0].xyz),YF(i[1].xyz),YF(i[2].xyz));return zF(s).mul(n.mul(o))})).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),dH=qL((([t,e])=>t.mul(wz(e.mul(2).sub(2),0,1)))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),pH=HV(),fH=HV(),mH=qL((([t,e,n],{material:r})=>{const i=(1===r.side?pH:fH).sample(t),s=IF(zV.x).mul(dH(e,n));return hH(i,s)})),gH=qL((([t,e,n])=>(YL(n.notEqual(0),(()=>{const r=OF(e).negate().div(n);return PF(r.negate().mul(t))})),sU(1)))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),yH=qL((([t,e,n,r,i,s,o,a,l,u,h,c,d,p,f])=>{let m,g;if(f){m=uU().toVar(),g=sU().toVar();const i=h.sub(1).mul(f.mul(.025)),s=sU(h.sub(i),h,h.add(i));SV({start:0,end:3},(({i:i})=>{const h=s.element(i),f=cH(t,e,c,h,a),y=o.add(f),v=u.mul(l.mul(uU(y,1))),_=eU(v.xy.div(v.w)).toVar();_.addAssign(1),_.divAssign(2),_.assign(eU(_.x,_.y.oneMinus()));const b=mH(_,n,h);m.element(i).assign(b.element(i)),m.a.addAssign(b.a),g.element(i).assign(r.element(i).mul(gH(YF(f),d,p).element(i)))})),m.a.divAssign(3)}else{const i=cH(t,e,c,h,a),s=o.add(i),f=u.mul(l.mul(uU(s,1))),y=eU(f.xy.div(f.w)).toVar();y.addAssign(1),y.divAssign(2),y.assign(eU(y.x,y.y.oneMinus())),m=mH(y,n,h),g=r.mul(gH(YF(i),d,p))}const y=g.rgb.mul(m.rgb),v=t.dot(e).clamp(),_=sU(WG({dotNV:v,specularColor:i,specularF90:s,roughness:n})),b=g.r.add(g.g,g.b).div(3);return uU(_.oneMinus().mul(y),m.a.oneMinus().mul(b).oneMinus())})),vH=fU(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),_H=(t,e)=>t.sub(e).div(t.add(e)).pow2(),bH=qL((({outsideIOR:t,eta2:e,cosTheta1:n,thinFilmThickness:r,baseF0:i})=>{const s=xz(t,e,Sz(0,.03,r)),o=t.div(s).pow2().mul(n.pow2().oneMinus()).oneMinus();YL(o.lessThan(0),(()=>sU(1)));const a=o.sqrt(),l=_H(s,t),u=AG({f0:l,f90:1,dotVH:n}),h=u.oneMinus(),c=s.lessThan(t).select(Math.PI,0),d=ZL(Math.PI).sub(c),p=(t=>{const e=t.sqrt();return sU(1).add(e).div(sU(1).sub(e))})(i.clamp(0,.9999)),f=_H(p,s.toVec3()),m=AG({f0:f,f90:1,dotVH:a}),g=sU(p.x.lessThan(s).select(Math.PI,0),p.y.lessThan(s).select(Math.PI,0),p.z.lessThan(s).select(Math.PI,0)),y=s.mul(r,a,2),v=sU(d).add(g),_=u.mul(m).clamp(1e-5,.9999),b=_.sqrt(),x=h.pow2().mul(m).div(sU(1).sub(_)),w=u.add(x).toVar(),M=x.sub(h).toVar();return SV({start:1,end:2,condition:"<=",name:"m"},(({m:t})=>{M.mulAssign(b);const e=((t,e)=>{const n=t.mul(2*Math.PI*1e-9),r=sU(54856e-17,44201e-17,52481e-17),i=sU(1681e3,1795300,2208400),s=sU(43278e5,93046e5,66121e5),o=ZL(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(e.x).cos()).mul(n.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(e).cos()).mul(n.pow2().negate().mul(s).exp());return a=sU(a.x.add(o),a.y,a.z).div(1.0685e-7),vH.mul(a)})(ZL(t).mul(y),ZL(t).mul(v)).mul(2);w.addAssign(M.mul(e))})),w.max(sU(0))})).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),xH=qL((({normal:t,viewDir:e,roughness:n})=>{const r=t.dot(e).saturate(),i=n.pow2(),s=Cz(n.lessThan(.25),ZL(-339.2).mul(i).add(ZL(161.4).mul(n)).sub(25.9),ZL(-8.48).mul(i).add(ZL(14.3).mul(n)).sub(9.95)),o=Cz(n.lessThan(.25),ZL(44).mul(i).sub(ZL(23.7).mul(n)).add(3.26),ZL(1.97).mul(i).sub(ZL(3.27).mul(n)).add(.72));return Cz(n.lessThan(.25),0,ZL(.1).mul(n).sub(.025)).add(s.mul(r).add(o).exp()).mul(1/Math.PI).saturate()})),wH=sU(.04),MH=ZL(1);class SH extends MG{constructor(t=!1,e=!1,n=!1,r=!1,i=!1,s=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(t){if(!0===this.clearcoat&&(this.clearcoatRadiance=sU().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=sU().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=sU().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=sU().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=sU().toVar("sheenSpecularIndirect")),!0===this.iridescence){const t=YB.dot(jB).clamp();this.iridescenceFresnel=bH({outsideIOR:ZL(1),eta2:LU,cosTheta1:t,thinFilmThickness:UU,baseF0:VU}),this.iridescenceF0=qG({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(!0===this.transmission){const e=FB,n=AB.sub(FB).normalize(),r=KB;t.backdrop=yH(r,n,RU,AU,VU,GU,e,PB,EB,TB,XU,KU,JU,ZU,this.dispersion?QU:null),t.backdropAlpha=YU,AU.a.mulAssign(xz(1,t.backdrop.a,YU))}}computeMultiscattering(t,e,n){const r=YB.dot(jB).clamp(),i=HG({roughness:RU,dotNV:r}),s=(this.iridescenceF0?DU.mix(VU,this.iridescenceF0):VU).mul(i.x).add(n.mul(i.y)),o=i.x.add(i.y).oneMinus(),a=VU.add(VU.oneMinus().mul(.047619)),l=s.mul(a).div(o.mul(a).oneMinus());t.addAssign(s),e.addAssign(l.mul(o))}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const r=YB.dot(t).clamp().mul(e);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(YG({lightDirection:t}))),!0===this.clearcoat){const n=ZB.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(n.mul(GG({lightDirection:t,f0:wH,f90:MH,roughness:kU,normalView:ZB})))}n.directDiffuse.addAssign(r.mul(CG({diffuseColor:AU.rgb}))),n.directSpecular.addAssign(r.mul(GG({lightDirection:t,f0:VU,f90:1,roughness:RU,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:s,ltc_2:o}){const a=e.add(n).sub(r),l=e.sub(n).sub(r),u=e.sub(n).add(r),h=e.add(n).add(r),c=YB,d=jB,p=BB.toVar(),f=KG({N:c,V:d,roughness:RU}),m=s.sample(f).toVar(),g=o.sample(f).toVar(),y=fU(sU(m.x,0,m.y),sU(0,1,0),sU(m.z,0,m.w)).toVar(),v=VU.mul(g.x).add(VU.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(t.mul(v).mul(QG({N:c,V:d,P:p,mInv:y,p0:a,p1:l,p2:u,p3:h}))),i.directDiffuse.addAssign(t.mul(AU).mul(QG({N:c,V:d,P:p,mInv:fU(1,0,0,0,1,0,0,0,1),p0:a,p1:l,p2:u,p3:h})))}indirect(t,e,n){this.indirectDiffuse(t,e,n),this.indirectSpecular(t,e,n),this.ambientOcclusion(t,e,n)}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(CG({diffuseColor:AU})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:n}){if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(e.mul(OU,xH({normal:YB,viewDir:jB,roughness:IU}))),!0===this.clearcoat){const t=ZB.dot(jB).clamp(),e=WG({dotNV:t,specularColor:wH,specularF90:MH,roughness:kU});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}const r=sU().toVar("singleScattering"),i=sU().toVar("multiScattering"),s=e.mul(1/Math.PI);this.computeMultiscattering(r,i,GU);const o=r.add(i),a=AU.mul(o.r.max(o.g).max(o.b).oneMinus());n.indirectSpecular.addAssign(t.mul(r)),n.indirectSpecular.addAssign(i.mul(s)),n.indirectDiffuse.addAssign(a.mul(s))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const n=YB.dot(jB).clamp().add(t),r=RU.mul(-16).oneMinus().negate().exp2(),i=t.sub(n.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(i)}finish(t){const{outgoingLight:e}=t;if(!0===this.clearcoat){const t=ZB.dot(jB).clamp(),n=AG({dotVH:t,f0:wH,f90:MH}),r=e.mul(PU.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(PU));e.assign(r)}if(!0===this.sheen){const t=OU.r.max(OU.g).max(OU.b).mul(.157).oneMinus(),n=e.mul(t).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(n)}}}const TH=ZL(1),EH=ZL(-2),AH=ZL(.8),CH=ZL(-1),RH=ZL(.4),NH=ZL(2),PH=ZL(.305),kH=ZL(3),OH=ZL(.21),IH=ZL(4),DH=ZL(4),LH=ZL(16),UH=qL((([t])=>{const e=sU($F(t)).toVar(),n=ZL(-1).toVar();return YL(e.x.greaterThan(e.z),(()=>{YL(e.x.greaterThan(e.y),(()=>{n.assign(Cz(t.x.greaterThan(0),0,3))})).Else((()=>{n.assign(Cz(t.y.greaterThan(0),1,4))}))})).Else((()=>{YL(e.z.greaterThan(e.y),(()=>{n.assign(Cz(t.z.greaterThan(0),2,5))})).Else((()=>{n.assign(Cz(t.y.greaterThan(0),1,4))}))})),n})).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),FH=qL((([t,e])=>{const n=eU().toVar();return YL(e.equal(0),(()=>{n.assign(eU(t.z,t.y).div($F(t.x)))})).ElseIf(e.equal(1),(()=>{n.assign(eU(t.x.negate(),t.z.negate()).div($F(t.y)))})).ElseIf(e.equal(2),(()=>{n.assign(eU(t.x.negate(),t.y).div($F(t.z)))})).ElseIf(e.equal(3),(()=>{n.assign(eU(t.z.negate(),t.y).div($F(t.x)))})).ElseIf(e.equal(4),(()=>{n.assign(eU(t.x.negate(),t.z).div($F(t.y)))})).Else((()=>{n.assign(eU(t.x,t.y).div($F(t.z)))})),sF(.5,n.add(1))})).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),zH=qL((([t])=>{const e=ZL(0).toVar();return YL(t.greaterThanEqual(AH),(()=>{e.assign(TH.sub(t).mul(CH.sub(EH)).div(TH.sub(AH)).add(EH))})).ElseIf(t.greaterThanEqual(RH),(()=>{e.assign(AH.sub(t).mul(NH.sub(CH)).div(AH.sub(RH)).add(CH))})).ElseIf(t.greaterThanEqual(PH),(()=>{e.assign(RH.sub(t).mul(kH.sub(NH)).div(RH.sub(PH)).add(NH))})).ElseIf(t.greaterThanEqual(OH),(()=>{e.assign(PH.sub(t).mul(IH.sub(kH)).div(PH.sub(OH)).add(kH))})).Else((()=>{e.assign(ZL(-2).mul(IF(sF(1.16,t))))})),e})).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),BH=qL((([t,e])=>{const n=t.toVar();n.assign(sF(2,n).sub(1));const r=sU(n,1).toVar();return YL(e.equal(0),(()=>{r.assign(r.zyx)})).ElseIf(e.equal(1),(()=>{r.assign(r.xzy),r.xz.mulAssign(-1)})).ElseIf(e.equal(2),(()=>{r.x.mulAssign(-1)})).ElseIf(e.equal(3),(()=>{r.assign(r.zyx),r.xz.mulAssign(-1)})).ElseIf(e.equal(4),(()=>{r.assign(r.xzy),r.xy.mulAssign(-1)})).ElseIf(e.equal(5),(()=>{r.z.mulAssign(-1)})),r})).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),jH=qL((([t,e,n,r,i,s])=>{const o=ZL(n),a=sU(e),l=wz(zH(o),EH,s),u=BF(l),h=UF(l),c=sU(VH(t,a,h,r,i,s)).toVar();return YL(u.notEqual(0),(()=>{const e=sU(VH(t,a,h.add(1),r,i,s)).toVar();c.assign(xz(c,e,u))})),c})),VH=qL((([t,e,n,r,i,s])=>{const o=ZL(n).toVar(),a=sU(e),l=ZL(UH(a)).toVar(),u=ZL(az(DH.sub(o),0)).toVar();o.assign(az(o,DH));const h=ZL(kF(o)).toVar(),c=eU(FH(a,l).mul(h.sub(2)).add(1)).toVar();return YL(l.greaterThan(2),(()=>{c.y.addAssign(h),l.subAssign(3)})),c.x.addAssign(l.mul(h)),c.x.addAssign(u.mul(sF(3,LH))),c.y.addAssign(sF(4,kF(s).sub(h))),c.x.mulAssign(r),c.y.mulAssign(i),t.sample(c).grad(eU(),eU())})),GH=qL((({envMap:t,mipInt:e,outputDirection:n,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=VF(r),u=n.mul(l).add(i.cross(n).mul(jF(r))).add(i.mul(i.dot(n).mul(l.oneMinus())));return VH(t,u,e,s,o,a)})),HH=qL((({n:t,latitudinal:e,poleAxis:n,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:c})=>{const d=sU(Cz(e,n,fz(n,r))).toVar();YL(AF(d.equals(sU(0))),(()=>{d.assign(sU(r.z,0,r.x.negate()))})),d.assign(zF(d));const p=sU().toVar();return p.addAssign(i.element(0).mul(GH({theta:0,axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:c}))),SV({start:JL(1),end:t},(({i:t})=>{YL(t.greaterThanEqual(s),(()=>{sB("break").append()}));const e=ZL(o.mul(ZL(t))).toVar();p.addAssign(i.element(t).mul(GH({theta:e.mul(-1),axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:c}))),p.addAssign(i.element(t).mul(GH({theta:e,axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:c})))})),uU(p,1)}));let WH=null;const qH=new WeakMap;function $H(t){let e=qH.get(t);if((void 0!==e?e.pmremVersion:-1)!==t.pmremVersion){const n=t.image;if(t.isCubeTexture){if(!function(t){if(null==t)return!1;let e=0;const n=6;for(let r=0;r<n;r++)void 0!==t[r]&&e++;return e===n}(n))return null;e=WH.fromCubemap(t,e)}else{if(!function(t){return null!=t&&t.height>0}(n))return null;e=WH.fromEquirectangular(t,e)}e.pmremVersion=t.pmremVersion,qH.set(t,e)}return e.texture}class XH extends rL{static get type(){return"PMREMNode"}constructor(t,e=null,n=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=n,this._generator=null;const r=new iS;r.isRenderTargetTexture=!0,this._texture=mB(r),this._width=SU(0),this._height=SU(0),this._maxMip=SU(0),this.updateBeforeType=WD}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=function(t){const e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:n,maxMip:e}}(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(){let t=this._pmrem;const e=t?t.pmremVersion:-1,n=this._value;e!==n.pmremVersion&&(t=!0===n.isPMREMTexture?n:$H(n),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(t){null===WH&&(WH=t.createPMREMGenerator()),this.updateBefore(t);let e=this.uvNode;null===e&&t.context.getUV&&(e=t.context.getUV(this));const n=this.value;t.renderer.coordinateSystem===SM&&!0!==n.isPMREMTexture&&!0===n.isRenderTargetTexture&&(e=sU(e.x.negate(),e.yz)),e=sU(e.x,e.y.negate(),e.z);let r=this.levelNode;return null===r&&t.context.getTextureLevel&&(r=t.context.getTextureLevel(this)),jH(this._texture,e,r,this._width,this._height,this._maxMip)}}const YH=HL(XH),KH=new WeakMap;class ZH extends NV{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const t=n.isTextureNode?n.value:e[n.property];let r=KH.get(t);void 0===r&&(r=YH(t),KH.set(t,r)),n=r}const r=e.envMap?uj("envMapIntensity","float",t.material):uj("environmentIntensity","float",t.scene),i=!0===e.useAnisotropy||e.anisotropy>0?vj:YB,s=n.context(JH(RU,i)).mul(r),o=n.context(QH(KB)).mul(Math.PI).mul(r),a=Qz(s),l=Qz(o);t.context.radiance.addAssign(a),t.context.iblIrradiance.addAssign(l);const u=t.context.lightingModel.clearcoatRadiance;if(u){const t=n.context(JH(kU,ZB)).mul(r),e=Qz(t);u.addAssign(e)}}}const JH=(t,e)=>{let n=null;return{getUV:()=>(null===n&&(n=jB.negate().reflect(e),n=t.mul(t).mix(n,e).normalize(),n=n.transformDirection(EB)),n),getTextureLevel:()=>t}},QH=t=>({getUV:()=>t,getTextureLevel:()=>ZL(1)}),tW=new EA;class eW extends oG{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(tW),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return null===e&&t.environmentNode&&(e=t.environmentNode),e?new ZH(e):null}setupLightingModel(){return new SH}setupSpecular(){const t=xz(sU(.04),AU.rgb,NU);VU.assign(t),GU.assign(1)}setupVariants(){const t=this.metalnessNode?ZL(this.metalnessNode):zj;NU.assign(t);let e=this.roughnessNode?ZL(this.roughnessNode):Fj;e=UG({roughness:e}),RU.assign(e),this.setupSpecular(),AU.assign(uU(AU.rgb.mul(t.oneMinus()),AU.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const nW=new AA;class rW extends eW{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(nW),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const t=this.iorNode?ZL(this.iorNode):Qj;XU.assign(t),VU.assign(xz(oz(gz(XU.sub(1).div(XU.add(1))).mul(Dj),sU(1)).mul(Ij),AU.rgb,NU)),GU.assign(xz(Ij,1,NU))}setupLightingModel(){return new SH(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const t=this.clearcoatNode?ZL(this.clearcoatNode):jj,e=this.clearcoatRoughnessNode?ZL(this.clearcoatRoughnessNode):Vj;PU.assign(t),kU.assign(UG({roughness:e}))}if(this.useSheen){const t=this.sheenNode?sU(this.sheenNode):Wj,e=this.sheenRoughnessNode?ZL(this.sheenRoughnessNode):qj;OU.assign(t),IU.assign(e)}if(this.useIridescence){const t=this.iridescenceNode?ZL(this.iridescenceNode):Xj,e=this.iridescenceIORNode?ZL(this.iridescenceIORNode):Yj,n=this.iridescenceThicknessNode?ZL(this.iridescenceThicknessNode):Kj;DU.assign(t),LU.assign(e),UU.assign(n)}if(this.useAnisotropy){const t=(this.anisotropyNode?eU(this.anisotropyNode):$j).toVar();zU.assign(t.length()),YL(zU.equal(0),(()=>{t.assign(eU(1,0))})).Else((()=>{t.divAssign(eU(zU)),zU.assign(zU.saturate())})),FU.assign(zU.pow2().mix(RU.pow2(),1)),BU.assign(yj[0].mul(t.x).add(yj[1].mul(t.y))),jU.assign(yj[1].mul(t.x).sub(yj[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?ZL(this.transmissionNode):Zj,e=this.thicknessNode?ZL(this.thicknessNode):Jj,n=this.attenuationDistanceNode?ZL(this.attenuationDistanceNode):tV,r=this.attenuationColorNode?sU(this.attenuationColorNode):eV;if(YU.assign(t),KU.assign(e),ZU.assign(n),JU.assign(r),this.useDispersion){const t=this.dispersionNode?ZL(this.dispersionNode):aV;QU.assign(t)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?sU(this.clearcoatNormalNode):Gj}setup(t){t.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(t),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const iW=qL((({normal:t,lightDirection:e,builder:n})=>{const r=t.dot(e),i=eU(r.mul(.5).add(.5),0);if(n.material.gradientMap){const t=dj("gradientMap","texture").context({getUV:()=>i});return sU(t.r)}{const t=i.fwidth().mul(.5);return xz(sU(.7),sU(1),Sz(ZL(.7).sub(t.x),ZL(.7).add(t.x),i.x))}}));class sW extends MG{direct({lightDirection:t,lightColor:e,reflectedLight:n},r,i){const s=iW({normal:HB,lightDirection:t,builder:i}).mul(e);n.directDiffuse.addAssign(s.mul(CG({diffuseColor:AU.rgb})))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:n}){n.indirectDiffuse.addAssign(e.mul(CG({diffuseColor:AU}))),n.indirectDiffuse.mulAssign(t)}}const oW=new RA;class aW extends oG{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(oW),this.setValues(t)}setupLightingModel(){return new sW}}class lW extends rL{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const t=sU(jB.z,0,jB.x.negate()).normalize(),e=jB.cross(t);return eU(t.dot(YB),e.dot(YB)).mul(.495).add(.5)}}const uW=WL(lW),hW=new IA;class cW extends oG{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(hW),this.setValues(t)}setupVariants(t){const e=uW;let n;n=t.material.matcap?dj("matcap","texture").context({getUV:()=>e}):sU(xz(.2,.8,e.y)),AU.rgb.mulAssign(n.rgb)}}class dW extends rL{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:n}=this;if("vec2"===this.getNodeType(t)){const t=e.cos(),r=e.sin();return pU(t,r,r.negate(),t).mul(n)}{const t=e,r=mU(uU(1,0,0,0),uU(0,VF(t.x),jF(t.x).negate(),0),uU(0,jF(t.x),VF(t.x),0),uU(0,0,0,1)),i=mU(uU(VF(t.y),0,jF(t.y),0),uU(0,1,0,0),uU(jF(t.y).negate(),0,VF(t.y),0),uU(0,0,0,1)),s=mU(uU(VF(t.z),jF(t.z).negate(),0,0),uU(jF(t.z),VF(t.z),0,0),uU(0,0,1,0),uU(0,0,0,1));return r.mul(i).mul(s).mul(uU(n,1)).xyz}}}const pW=HL(dW),fW=new zE;class mW extends oG{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(fW),this.setValues(t)}setupPositionView(t){const{object:e,camera:n}=t,r=this.sizeAttenuation,{positionNode:i,rotationNode:s,scaleNode:o}=this,a=OB.mul(sU(i||0));let l=eU(PB[0].xyz.length(),PB[1].xyz.length());if(null!==o&&(l=l.mul(ZL(o))),!1===r)if(n.isPerspectiveCamera)l=l.mul(a.z.negate());else{const t=ZL(2).div(TB.element(1).element(1));l=l.mul(t.mul(2))}let u=DB.xy;if(e.center&&!0===e.center.isVector2){const t=((t,e,n)=>jL(new Vz(t,e,n)))("center","vec2",e);u=u.sub(t.sub(.5))}u=u.mul(l);const h=ZL(s||Hj),c=pW(u,h);return uU(a.xy.add(c),a.zw)}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}const gW=new iA;class yW extends mW{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(gW),this.setValues(t)}setupPositionView(){const{positionNode:t}=this;return OB.mul(sU(t||LB)).xyz}setupVertex(t){const e=super.setupVertex(t);if(!0!==t.material.isNodeMaterial)return e;const{rotationNode:n,scaleNode:r,sizeNode:i}=this,s=DB.xy.toVar(),o=jV.z.div(jV.w);if(n&&n.isNode){const t=ZL(n);s.assign(pW(s,t))}let a=null!==i?eU(i):oV;return!0===this.sizeAttenuation&&(a=a.mul(a.div(BB.z.negate()))),r&&r.isNode&&(a=a.mul(eU(r))),s.mulAssign(a.mul(2)),s.assign(s.div(jV.z)),s.y.assign(s.y.mul(o)),s.assign(s.mul(e.w)),e.addAssign(uU(s,0,0)),e}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(t){this._useAlphaToCoverage!==t&&(this._useAlphaToCoverage=t,this.needsUpdate=!0)}}class vW extends MG{constructor(){super(),this.shadowNode=ZL(1).toVar("shadowMask")}direct({shadowMask:t}){this.shadowNode.mulAssign(t)}finish(t){AU.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(AU.rgb)}}const _W=new TA;class bW extends oG{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(_W),this.setValues(t)}setupLightingModel(){return new vW}}qL((({texture:t,uv:e})=>{const n=1e-4,r=sU().toVar();return YL(e.x.lessThan(n),(()=>{r.assign(sU(1,0,0))})).ElseIf(e.y.lessThan(n),(()=>{r.assign(sU(0,1,0))})).ElseIf(e.z.lessThan(n),(()=>{r.assign(sU(0,0,1))})).ElseIf(e.x.greaterThan(.9999),(()=>{r.assign(sU(-1,0,0))})).ElseIf(e.y.greaterThan(.9999),(()=>{r.assign(sU(0,-1,0))})).ElseIf(e.z.greaterThan(.9999),(()=>{r.assign(sU(0,0,-1))})).Else((()=>{const n=.01,i=t.sample(e.add(sU(-.01,0,0))).r.sub(t.sample(e.add(sU(n,0,0))).r),s=t.sample(e.add(sU(0,-.01,0))).r.sub(t.sample(e.add(sU(0,n,0))).r),o=t.sample(e.add(sU(0,0,-.01))).r.sub(t.sample(e.add(sU(0,0,n))).r);r.assign(sU(i,s,o))})),r.normalize()}));class xW{constructor(t,e){this.nodes=t,this.info=e,this._context=self,this._animationLoop=null,this._requestId=null}start(){const t=(e,n)=>{this._requestId=this._context.requestAnimationFrame(t),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(e,n)};t()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(t){this._animationLoop=t}getContext(){return this._context}setContext(t){this._context=t}dispose(){this.stop()}}class wW{constructor(){this.weakMap=new WeakMap}get(t){let e=this.weakMap;for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),void 0===e)return;return e.get(t[t.length-1])}set(t,e){let n=this.weakMap;for(let e=0;e<t.length-1;e++){const r=t[e];!1===n.has(r)&&n.set(r,new WeakMap),n=n.get(r)}return n.set(t[t.length-1],e),this}delete(t){let e=this.weakMap;for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),void 0===e)return!1;return e.delete(t[t.length-1])}}let MW=0;class SW{constructor(t,e,n,r,i,s,o,a,l,u){this.id=MW++,this._nodes=t,this._geometries=e,this.renderer=n,this.object=r,this.material=i,this.scene=s,this.camera=o,this.lightsNode=a,this.context=l,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=null!==u?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(t){this.clippingContext=t}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(t){for(const e of this.getBindings())if(e.name===t)return e}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(t){this.geometry=t,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,n=[],r=new Set;for(const i of t){const t=i.node&&i.node.attribute?i.node.attribute:e.getAttribute(i.name);if(void 0===t)continue;n.push(t);const s=t.isInterleavedBufferAttribute?t.data:t;r.add(s)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:n,group:r,drawRange:i}=this,s=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),a=null!==o,l=n.isInstancedBufferGeometry?n.instanceCount:t.count>1?t.count:1;if(0===l)return null;if(s.instanceCount=l,!0===t.isBatchedMesh)return s;let u=1;!0!==e.wireframe||t.isPoints||t.isLineSegments||t.isLine||t.isLineLoop||(u=2);let h=i.start*u,c=(i.start+i.count)*u;null!==r&&(h=Math.max(h,r.start*u),c=Math.min(c,(r.start+r.count)*u));const d=n.attributes.position;let p=1/0;a?p=o.count:null!=d&&(p=d.count),h=Math.max(h,0),c=Math.min(c,p);const f=c-h;return f<0||f===1/0?null:(s.vertexCount=f,s.firstVertex=h,s)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const n of Object.keys(t.attributes).sort()){const r=t.attributes[n];e+=n+",",r.data&&(e+=r.data.stride+","),r.offset&&(e+=r.offset+","),r.itemSize&&(e+=r.itemSize+","),r.normalized&&(e+="n,")}for(const n of Object.keys(t.morphAttributes).sort()){const r=t.morphAttributes[n];e+="morph-"+n+",";for(let t=0,n=r.length;t<n;t++){e+=r[t].id+","}}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e}=this;let n=e.customProgramCacheKey();for(const t of function(t){const e=Object.keys(t);let n=Object.getPrototypeOf(t);for(;n;){const t=Object.getOwnPropertyDescriptors(n);for(const n in t)if(void 0!==t[n]){const r=t[n];r&&"function"==typeof r.get&&e.push(n)}n=Object.getPrototypeOf(n)}return e}(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(t))continue;const r=e[t];let i;if(null!==r){const t=typeof r;"number"===t?i=0!==r?"1":"0":"object"===t?(i="{",r.isTexture&&(i+=r.mapping),i+="}"):i=String(r)}else i=String(r);n+=i+","}return n+=this.clippingContextCacheKey+",",t.geometry&&(n+=this.getGeometryCacheKey()),t.skeleton&&(n+=t.skeleton.bones.length+","),t.isBatchedMesh&&(n+=t._matricesTexture.uuid+",",null!==t._colorsTexture&&(n+=t._colorsTexture.uuid+",")),t.count>1&&(n+=t.uuid+","),n+=t.receiveShadow+",",kD(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=0;return!0!==this.material.isShadowPassMaterial&&(t=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(t=ID(t,this.camera.cameras.length)),this.object.receiveShadow&&(t=ID(t,1)),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const TW=[];class EW{constructor(t,e,n,r,i,s){this.renderer=t,this.nodes=e,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=s,this.chainMaps={}}get(t,e,n,r,i,s,o,a){const l=this.getChainMap(a);TW[0]=t,TW[1]=e,TW[2]=s,TW[3]=i;let u=l.get(TW);return void 0===u?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,n,r,i,s,o,a),l.set(TW,u)):(u.updateClipping(o),u.needsGeometryUpdate&&u.setGeometry(t.geometry),(u.version!==e.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(t,e,n,r,i,s,o,a)):u.version=e.version)),TW.length=0,u}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new wW)}dispose(){this.chainMaps={}}createRenderObject(t,e,n,r,i,s,o,a,l,u,h){const c=this.getChainMap(h),d=new SW(t,e,n,r,i,s,o,a,l,u);return d.onDispose=()=>{this.pipelines.delete(d),this.bindings.delete(d),this.nodes.delete(d),c.delete(d.getChainArray())},d}}class AW{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}delete(t){let e=null;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const CW=1,RW=2,NW=3,PW=4,kW=16;class OW extends AW{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return void 0!==e&&this.backend.destroyAttribute(t),e}update(t,e){const n=this.get(t);if(void 0===n.version)e===CW?this.backend.createAttribute(t):e===RW?this.backend.createIndexAttribute(t):e===NW?this.backend.createStorageAttribute(t):e===PW&&this.backend.createIndirectStorageAttribute(t),n.version=this._getBufferAttribute(t).version;else{const e=this._getBufferAttribute(t);(n.version<e.version||e.usage===wM)&&(this.backend.updateAttribute(t),n.version=e.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function IW(t){return null!==t.index?t.index.version:t.attributes.position.version}function DW(t){const e=[],n=t.index,r=t.attributes.position;if(null!==n){const t=n.array;for(let n=0,r=t.length;n<r;n+=3){const r=t[n+0],i=t[n+1],s=t[n+2];e.push(r,i,i,s,s,r)}}else{for(let t=0,n=r.array.length/3-1;t<n;t+=3){const n=t+0,r=t+1,i=t+2;e.push(n,r,r,i,i,n)}}const i=new(jM(e)?$T:qT)(e,1);return i.version=IW(t),i}class LW extends AW{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(t){const e=t.geometry;return super.has(e)&&!0===this.get(e).initialized}updateForRender(t){!1===this.has(t)&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry;this.get(e).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const r=e.index,i=t.getAttributes();null!==r&&this.attributes.delete(r);for(const t of i)this.attributes.delete(t);const s=this.wireframes.get(e);void 0!==s&&this.attributes.delete(s),e.removeEventListener("dispose",n)};e.addEventListener("dispose",n)}updateAttributes(t){const e=t.getAttributes();for(const t of e)t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute?this.updateAttribute(t,NW):this.updateAttribute(t,CW);const n=this.getIndex(t);null!==n&&this.updateAttribute(n,RW);const r=t.geometry.indirect;null!==r&&this.updateAttribute(r,PW)}updateAttribute(t,e){const n=this.info.render.calls;t.isInterleavedBufferAttribute?void 0===this.attributeCall.get(t)?(this.attributes.update(t,e),this.attributeCall.set(t,n)):this.attributeCall.get(t.data)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t.data,n),this.attributeCall.set(t,n)):this.attributeCall.get(t)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t,n))}getIndirect(t){return t.geometry.indirect}getIndex(t){const{geometry:e,material:n}=t;let r=e.index;if(!0===n.wireframe){const t=this.wireframes;let n=t.get(e);void 0===n?(n=DW(e),t.set(e,n)):n.version!==IW(e)&&(this.attributes.delete(n),n=DW(e),t.set(e,n)),r=n}return r}}class UW{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(t,e,n){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=n*(e/3):t.isPoints?this.render.points+=n*e:t.isLineSegments?this.render.lines+=n*(e/2):t.isLine?this.render.lines+=n*(e-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class FW{constructor(t){this.cacheKey=t,this.usedTimes=0}}class zW extends FW{constructor(t,e,n){super(t),this.vertexProgram=e,this.fragmentProgram=n}}class BW extends FW{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let jW=0;class VW{constructor(t,e,n,r=null,i=null){this.id=jW++,this.code=t,this.stage=e,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}}class GW extends AW{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:n}=this,r=this.get(t);if(this._needsComputeUpdate(t)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const s=this.nodes.getForCompute(t);let o=this.programs.compute.get(s.computeShader);void 0===o&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),o=new VW(s.computeShader,"compute",t.name,s.transforms,s.nodeAttributes),this.programs.compute.set(s.computeShader,o),n.createProgram(o));const a=this._getComputeCacheKey(t,o);let l=this.caches.get(a);void 0===l&&(i&&0===i.usedTimes&&this._releasePipeline(i),l=this._getComputePipeline(t,o,a,e)),l.usedTimes++,o.usedTimes++,r.version=t.version,r.pipeline=l}return r.pipeline}getForRender(t,e=null){const{backend:n}=this,r=this.get(t);if(this._needsRenderUpdate(t)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const s=t.getNodeBuilderState(),o=t.material?t.material.name:"";let a=this.programs.vertex.get(s.vertexShader);void 0===a&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),a=new VW(s.vertexShader,"vertex",o),this.programs.vertex.set(s.vertexShader,a),n.createProgram(a));let l=this.programs.fragment.get(s.fragmentShader);void 0===l&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),l=new VW(s.fragmentShader,"fragment",o),this.programs.fragment.set(s.fragmentShader,l),n.createProgram(l));const u=this._getRenderCacheKey(t,a,l);let h=this.caches.get(u);void 0===h?(i&&0===i.usedTimes&&this._releasePipeline(i),h=this._getRenderPipeline(t,a,l,u,e)):t.pipeline=h,h.usedTimes++,a.usedTimes++,l.usedTimes++,r.pipeline=h}return r.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,0===e.usedTimes&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,0===e.computeProgram.usedTimes&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,0===e.vertexProgram.usedTimes&&this._releaseProgram(e.vertexProgram),0===e.fragmentProgram.usedTimes&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,n,r){n=n||this._getComputeCacheKey(t,e);let i=this.caches.get(n);return void 0===i&&(i=new BW(n,e),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(t,e,n,r,i){r=r||this._getRenderCacheKey(t,e,n);let s=this.caches.get(r);return void 0===s&&(s=new zW(r,e,n),this.caches.set(r,s),t.pipeline=s,this.backend.createRenderPipeline(t,i)),s}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,n){return e.id+","+n.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,n=t.stage;this.programs[n].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return void 0===e.pipeline||e.version!==t.version}_needsRenderUpdate(t){return void 0===this.get(t).pipeline||this.backend.needsRenderUpdate(t)}}class HW extends AW{constructor(t,e,n,r,i,s){super(),this.backend=t,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=e,this.info=s,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const t of e){const n=this.get(t);void 0===n.bindGroup&&(this._init(t),this.backend.createBindings(t,e,0),n.bindGroup=t)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const t of e){const n=this.get(t);void 0===n.bindGroup&&(this._init(t),this.backend.createBindings(t,e,0),n.bindGroup=t)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isStorageBuffer){const t=e.attribute,n=t.isIndirectStorageBufferAttribute?PW:NW;this.attributes.update(t,n)}}_update(t,e){const{backend:n}=this;let r=!1,i=!0,s=0,o=0;for(const e of t.bindings){if(e.isNodeUniformsGroup){if(!1===this.nodes.updateGroup(e))continue}if(e.isUniformBuffer){e.update()&&n.updateBinding(e)}else if(e.isSampler)e.update();else if(e.isSampledTexture){const t=this.textures.get(e.texture);e.needsBindingsUpdate(t.generation)&&(r=!0);const a=e.update(),l=e.texture;a&&this.textures.updateTexture(l);const u=n.get(l);if(void 0!==u.externalTexture||t.isDefaultTexture?i=!1:(s=10*s+l.id,o+=l.version),!0===n.isWebGPUBackend&&void 0===u.texture&&void 0===u.externalTexture&&(console.error("Bindings._update: binding should be available:",e,a,l,e.textureNode.value,r),this.textures.updateTexture(l),r=!0),!0===l.isStorageTexture){const t=this.get(l);!0===e.store?t.needsMipmap=!0:this.textures.needsMipmaps(l)&&!0===t.needsMipmap&&(this.backend.generateMipmaps(l),t.needsMipmap=!1)}}}!0===r&&this.backend.updateBindings(t,e,i?s:0,o)}}function WW(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function qW(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function $W(t){return(t.transmission>0||t.transmissionNode)&&2===t.side&&!1===t.forceSinglePass}class XW{constructor(t,e,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,n),this.lightsArray=[],this.scene=e,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,n,r,i,s,o){let a=this.renderItems[this.renderItemsIndex];return void 0===a?(a={id:t.id,object:t,geometry:e,material:n,groupOrder:r,renderOrder:t.renderOrder,z:i,group:s,clippingContext:o},this.renderItems[this.renderItemsIndex]=a):(a.id=t.id,a.object=t,a.geometry=e,a.material=n,a.groupOrder=r,a.renderOrder=t.renderOrder,a.z=i,a.group=s,a.clippingContext=o),this.renderItemsIndex++,a}push(t,e,n,r,i,s,o){const a=this.getNextRenderItem(t,e,n,r,i,s,o);!0===t.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?($W(n)&&this.transparentDoublePass.push(a),this.transparent.push(a)):this.opaque.push(a)}unshift(t,e,n,r,i,s,o){const a=this.getNextRenderItem(t,e,n,r,i,s,o);!0===n.transparent||n.transmission>0?($W(n)&&this.transparentDoublePass.unshift(a),this.transparent.unshift(a)):this.opaque.unshift(a)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||WW),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||qW),this.transparent.length>1&&this.transparent.sort(e||qW)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const e=this.renderItems[t];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.groupOrder=null,e.renderOrder=null,e.z=null,e.group=null,e.clippingContext=null}}}const YW=[];class KW{constructor(t){this.lighting=t,this.lists=new wW}get(t,e){const n=this.lists;YW[0]=t,YW[1]=e;let r=n.get(YW);return void 0===r&&(r=new XW(this.lighting,t,e),n.set(YW,r)),YW.length=0,r}dispose(){this.lists=new wW}}let ZW=0;class JW{constructor(){this.id=ZW++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new sS,this.scissor=!1,this.scissorValue=new sS,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return QW(this)}}function QW(t){const{textures:e,activeCubeFace:n}=t,r=[n];for(const t of e)r.push(t.id);return OD(r)}const tq=[],eq=new DE,nq=new ME;class rq{constructor(){this.chainMaps={}}get(t,e,n=null){let r;if(tq[0]=t,tq[1]=e,null===n)r="default";else{const t=n.texture.format;r=`${n.textures.length}:${t}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const i=this._getChainMap(r);let s=i.get(tq);return void 0===s&&(s=new JW,i.set(tq,s)),tq.length=0,null!==n&&(s.sampleCount=0===n.samples?1:n.samples),s}getForClear(t=null){return this.get(eq,nq,t)}_getChainMap(t){return this.chainMaps[t]||(this.chainMaps[t]=new wW)}dispose(){this.chainMaps={}}}const iq=new cS;class sq extends AW{constructor(t,e,n){super(),this.renderer=t,this.backend=e,this.info=n}updateRenderTarget(t,e=0){const n=this.get(t),r=0===t.samples?1:t.samples,i=n.depthTextureMips||(n.depthTextureMips={}),s=t.textures,o=this.getSize(s[0]),a=o.width>>e,l=o.height>>e;let u=t.depthTexture||i[e];const h=!0===t.depthBuffer||!0===t.stencilBuffer;let c=!1;void 0===u&&h&&(u=new oA,u.format=t.stencilBuffer?Mw:ww,u.type=t.stencilBuffer?mw:hw,u.image.width=a,u.image.height=l,i[e]=u),n.width===o.width&&o.height===n.height||(c=!0,u&&(u.needsUpdate=!0,u.image.width=a,u.image.height=l)),n.width=o.width,n.height=o.height,n.textures=s,n.depthTexture=u||null,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,n.renderTarget=t,n.sampleCount!==r&&(c=!0,u&&(u.needsUpdate=!0),n.sampleCount=r);const d={sampleCount:r};if(!0!==t.isXRRenderTarget){for(let t=0;t<s.length;t++){const e=s[t];c&&(e.needsUpdate=!0),this.updateTexture(e,d)}u&&this.updateTexture(u,d)}if(!0!==n.initialized){n.initialized=!0;const e=()=>{t.removeEventListener("dispose",e);for(let t=0;t<s.length;t++)this._destroyTexture(s[t]);u&&this._destroyTexture(u),this.delete(t)};t.addEventListener("dispose",e)}}updateTexture(t,e={}){const n=this.get(t);if(!0===n.initialized&&n.version===t.version)return;const r=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,i=this.backend;if(r&&!0===n.initialized&&(i.destroySampler(t),i.destroyTexture(t)),t.isFramebufferTexture){const e=this.renderer.getRenderTarget();t.type=e?e.texture.type:sw}const{width:s,height:o,depth:a}=this.getSize(t);if(e.width=s,e.height=o,e.depth=a,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,s,o):1,r||!0===t.isStorageTexture)i.createSampler(t),i.createTexture(t,e),n.generation=t.version;else{if(!0!==n.initialized&&i.createSampler(t),t.version>0){const r=t.image;if(void 0===r)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===r.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const n=[];for(const e of t.images)n.push(e);e.images=n}else e.image=r;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(i.createTexture(t,e),n.isDefaultTexture=!1,n.generation=t.version),!0===t.source.dataReady&&i.updateTexture(t,e),e.needsMipmaps&&0===t.mipmaps.length&&i.generateMipmaps(t)}}else i.createDefaultTexture(t),n.isDefaultTexture=!0,n.generation=t.version}if(!0!==n.initialized){n.initialized=!0,n.generation=t.version,this.info.memory.textures++;const e=()=>{t.removeEventListener("dispose",e),this._destroyTexture(t),this.info.memory.textures--};t.addEventListener("dispose",e)}n.version=t.version}getSize(t,e=iq){let n=t.images?t.images[0]:t.image;return n?(void 0!==n.image&&(n=n.image),e.width=n.width||1,e.height=n.height||1,e.depth=t.isCubeTexture?6:n.depth||1):e.width=e.height=e.depth=1,e}getMipLevels(t,e,n){let r;return r=t.isCompressedTexture?t.mipmaps?t.mipmaps.length:1:Math.floor(Math.log2(Math.max(e,n)))+1,r}needsMipmaps(t){return this.isEnvironmentTexture(t)||!0===t.isCompressedTexture||t.generateMipmaps}isEnvironmentTexture(t){const e=t.mapping;return e===$x||e===Xx||e===Wx||e===qx}_destroyTexture(t){this.backend.destroySampler(t),this.backend.destroyTexture(t),this.delete(t)}}class oq extends OT{constructor(t,e,n,r=1){super(t,e,n),this.a=r}set(t,e,n,r=1){return this.a=r,super.set(t,e,n)}copy(t){return void 0!==t.a&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class aq extends TU{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class lq extends tL{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}getMemberType(t,e){return this.outputNode?this.outputNode.getMemberType(t,e):"void"}add(t){return this.nodes.push(t),this}If(t,e){const n=new BL(e);return this._currentCond=Cz(t,n),this.add(this._currentCond)}ElseIf(t,e){const n=new BL(e),r=Cz(t,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(t){return this._currentCond.elseNode=new BL(t),this}build(t,...e){const n=XL();$L(this);for(const e of this.nodes)e.build(t,"void");return $L(n),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}else(...t){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...t)}elseif(...t){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...t)}}const uq=HL(lq);new WE,new cS,new cS,new cS,new jS,new cS(0,0,-1),new sS,new cS,new cS,new sS,new FM;const hq=new oS;FV.flipX(),hq.depthTexture=new oA(1,1);const cq=new tC(-1,1,1,-1,0,1);class dq extends rE{constructor(t=!1){super();const e=!1===t?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new YT([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new YT(e,2))}}const pq=new dq;class fq extends mE{constructor(t=null){super(pq,t),this.camera=cq,this.isQuadMesh=!0}async renderAsync(t){return t.renderAsync(this,cq)}render(t){t.render(this,cq)}}const mq=new ZS,gq=new jS;class yq extends tL{static get type(){return"SceneNode"}constructor(t=yq.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,n=null!==this.scene?this.scene:t.scene;let r;return e===yq.BACKGROUND_BLURRINESS?r=uj("backgroundBlurriness","float",n):e===yq.BACKGROUND_INTENSITY?r=uj("backgroundIntensity","float",n):e===yq.BACKGROUND_ROTATION?r=SU("mat4").label("backgroundRotation").setGroup(xU).onRenderUpdate((()=>{const t=n.background;return null!==t&&t.isTexture&&300!==t.mapping?(mq.copy(n.backgroundRotation),mq.x*=-1,mq.y*=-1,mq.z*=-1,gq.makeRotationFromEuler(mq)):gq.identity(),gq})):console.error("THREE.SceneNode: Unknown scope:",e),r}}yq.BACKGROUND_BLURRINESS="backgroundBlurriness",yq.BACKGROUND_INTENSITY="backgroundIntensity",yq.BACKGROUND_ROTATION="backgroundRotation";const vq=WL(yq,yq.BACKGROUND_BLURRINESS),_q=WL(yq,yq.BACKGROUND_INTENSITY),bq=WL(yq,yq.BACKGROUND_ROTATION),xq=new FM;class wq extends fB{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return t.object.isQuadMesh&&this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class Mq extends wq{static get type(){return"PassMultipleTextureNode"}constructor(t,e,n=!1){super(t,null),this.textureName=e,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Sq extends rL{static get type(){return"PassNode"}constructor(t,e,n,r={}){super("vec4"),this.scope=t,this.scene=e,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new oA;i.isRenderTargetTexture=!0,i.name="depth";const s=new oS(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:dw,...r});s.texture.name="output",s.depthTexture=i,this.renderTarget=s,this._textures={output:s.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=SU(0),this._cameraFar=SU(0),this._mrt=null,this.isPassNode=!0,this.updateBeforeType=HD}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(t){let e=this._textures[t];if(void 0===e){e=this.renderTarget.texture.clone(),e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)}return e}getPreviousTexture(t){let e=this._previousTextures[t];return void 0===e&&(e=this.getTexture(t).clone(),this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(void 0!==e){const n=this._textures[t],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=e,this._textures[t]=e,this._previousTextures[t]=n,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return void 0===e&&(e=jL(new Mq(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return void 0===e&&(void 0===this._textureNodes[t]&&this.getTextureNode(t),e=jL(new Mq(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(void 0===e){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[t]=e=ZV(this.getTextureNode(t),n,r)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(void 0===e){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(t);this._linearDepthNodes[t]=e=YV(i,n,r)}return e}setup({renderer:t}){return this.renderTarget.samples=void 0===this.options.samples?t.samples:this.options.samples,!0===t.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.texture.type=t.getColorBufferType(),this.scope===Sq.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:n,camera:r}=this;this._pixelRatio=e.getPixelRatio();const i=e.getSize(xq);this.setSize(i.width,i.height);const s=e.getRenderTarget(),o=e.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const t in this._previousTextures)this.toggleTexture(t);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(n,r),e.setRenderTarget(s),e.setMRT(o)}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Sq.COLOR="color",Sq.DEPTH="depth";const Tq=qL((([t,e])=>t.mul(e).clamp())).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Eq=qL((([t,e])=>(t=t.mul(e)).div(t.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Aq=qL((([t,e])=>{const n=(t=(t=t.mul(e)).sub(.004).max(0)).mul(t.mul(6.2).add(.5)),r=t.mul(t.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)})).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Cq=qL((([t])=>{const e=t.mul(t.add(.0245786)).sub(90537e-9),n=t.mul(t.add(.432951).mul(.983729)).add(.238081);return e.div(n)})),Rq=qL((([t,e])=>{const n=fU(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=fU(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return t=t.mul(e).div(.6),t=n.mul(t),t=Cq(t),(t=r.mul(t)).clamp()})).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Nq=fU(sU(1.6605,-.1246,-.0182),sU(-.5876,1.1329,-.1006),sU(-.0728,-.0083,1.1187)),Pq=fU(sU(.6274,.0691,.0164),sU(.3293,.9195,.088),sU(.0433,.0113,.8956)),kq=qL((([t])=>{const e=sU(t).toVar(),n=sU(e.mul(e)).toVar(),r=sU(n.mul(n)).toVar();return ZL(15.5).mul(r.mul(n)).sub(sF(40.14,r.mul(e))).add(sF(31.96,r).sub(sF(6.868,n.mul(e))).add(sF(.4298,n).add(sF(.1191,e).sub(.00232))))})),Oq=qL((([t,e])=>{const n=sU(t).toVar(),r=fU(sU(.856627153315983,.137318972929847,.11189821299995),sU(.0951212405381588,.761241990602591,.0767994186031903),sU(.0482516061458583,.101439036467562,.811302368396859)),i=fU(sU(1.1271005818144368,-.1413297634984383,-.14132976349843826),sU(-.11060664309660323,1.157823702216272,-.11060664309660294),sU(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=ZL(-12.47393),o=ZL(4.026069);return n.mulAssign(e),n.assign(Pq.mul(n)),n.assign(r.mul(n)),n.assign(az(n,1e-10)),n.assign(IF(n)),n.assign(n.sub(s).div(o.sub(s))),n.assign(wz(n,0,1)),n.assign(kq(n)),n.assign(i.mul(n)),n.assign(mz(az(sU(0),n),sU(2.2))),n.assign(Nq.mul(n)),n.assign(wz(n,0,1)),n})).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Iq=qL((([t,e])=>{const n=ZL(.76),r=ZL(.15);t=t.mul(e);const i=oz(t.r,oz(t.g,t.b)),s=Cz(i.lessThan(.08),i.sub(sF(6.25,i.mul(i))),.04);t.subAssign(s);const o=az(t.r,az(t.g,t.b));YL(o.lessThan(n),(()=>t));const a=iF(1,n),l=iF(1,a.mul(a).div(o.add(a.sub(n))));t.mulAssign(l.div(o));const u=iF(1,oF(1,r.mul(o.sub(l)).add(1)));return xz(t,sU(l),u)})).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Dq extends tL{static get type(){return"CodeNode"}constructor(t="",e=[],n=""){super("code"),this.isCodeNode=!0,this.code=t,this.includes=e,this.language=n}isGlobal(){return!0}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const n of e)n.build(t);const n=t.getCodeFromNode(this,this.getNodeType(t));return n.code=this.code,n.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}class Lq extends Dq{static get type(){return"FunctionNode"}constructor(t="",e=[],n=""){super(t,e,n)}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let n=e.nodeFunction;return void 0===n&&(n=t.parser.parseFunction(this.code),e.nodeFunction=n),n}generate(t,e){super.generate(t);const n=this.getNodeFunction(t),r=n.name,i=n.type,s=t.getCodeFromNode(this,i);""!==r&&(s.name=r);const o=t.getPropertyName(s),a=this.getNodeFunction(t).getCode(o);return s.code=a+"\n","property"===e?o:t.format(`${o}()`,i,e)}}function Uq(t){let e;const n=t.context.getViewZ;return void 0!==n&&(e=n(this)),(e||BB.z).negate()}const Fq=qL((([t,e],n)=>{const r=Uq(n);return Sz(t,e,r)})),zq=qL((([t],e)=>{const n=Uq(e);return t.mul(t,n,n).negate().exp().oneMinus()})),Bq=qL((([t,e])=>uU(e.toFloat().mix(WU.rgb,t.toVec3()),WU.a)));HL(class extends tL{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:n}=t;!0===n.backend.isWebGLBackend?t.addFlowCode(`\t// ${e}Barrier \n`):t.addLineFlowCode(`${e}Barrier()`,this)}});class jq extends rL{static get type(){return"AtomicFunctionNode"}constructor(t,e,n,r=null){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=n,this.storeNode=r}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=this.method,n=this.getNodeType(t),r=this.getInputType(t),i=this.pointerNode,s=this.valueNode,o=[];o.push(`&${i.build(t,r)}`),null!==s&&o.push(s.build(t,r));const a=`${t.getMethod(e,n)}( ${o.join(", ")} )`;if(null!==this.storeNode){const e=this.storeNode.build(t,r);t.addLineFlowCode(`${e} = ${a}`,this)}else t.addLineFlowCode(a,this)}}let Vq;function Gq(t){Vq=Vq||new WeakMap;let e=Vq.get(t);return void 0===e&&Vq.set(t,e={}),e}function Hq(t){const e=Gq(t);return e.shadowMatrix||(e.shadowMatrix=SU("mat4").setGroup(xU).onRenderUpdate((()=>(!0!==t.castShadow&&t.shadow.updateMatrices(t),t.shadow.matrix))))}function Wq(t){const e=Gq(t);return e.position||(e.position=SU(new cS).setGroup(xU).onRenderUpdate(((e,n)=>n.value.setFromMatrixPosition(t.matrixWorld))))}function qq(t){const e=Gq(t);return e.viewPosition||(e.viewPosition=SU(new cS).setGroup(xU).onRenderUpdate((({camera:e},n)=>{n.value=n.value||new cS,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(e.matrixWorldInverse)})))}jq.ATOMIC_LOAD="atomicLoad",jq.ATOMIC_STORE="atomicStore",jq.ATOMIC_ADD="atomicAdd",jq.ATOMIC_SUB="atomicSub",jq.ATOMIC_MAX="atomicMax",jq.ATOMIC_MIN="atomicMin",jq.ATOMIC_AND="atomicAnd",jq.ATOMIC_OR="atomicOr",jq.ATOMIC_XOR="atomicXor",HL(jq);const $q=t=>EB.transformDirection(Wq(t).sub(function(t){const e=Gq(t);return e.targetPosition||(e.targetPosition=SU(new cS).setGroup(xU).onRenderUpdate(((e,n)=>n.value.setFromMatrixPosition(t.target.matrixWorld))))}(t))),Xq=(t,e)=>{for(const n of e)if(n.isAnalyticLightNode&&n.light.id===t)return n;return null},Yq=new WeakMap;class Kq extends tL{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=sU().toVar("totalDiffuse"),this.totalSpecularNode=sU().toVar("totalSpecular"),this.outgoingLightNode=sU().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const t=[],e=this._lights;for(let n=0;n<e.length;n++)t.push(e[n].id);return OD(t)}getHash(t){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(t);const e=[];for(const t of this._lightNodes)e.push(t.getSelf().getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getDataFromNode(this);for(const n of e.nodes)n.build(t)}setupLightsNode(t){const e=[],n=this._lightNodes,r=(t=>t.sort(((t,e)=>t.id-e.id)))(this._lights),i=t.renderer.library;for(const t of r)if(t.isNode)e.push(jL(t));else{let r=null;if(null!==n&&(r=Xq(t.id,n)),null===r){const n=i.getLightNodeClass(t.constructor);if(null===n){console.warn(`LightsNode.setupNodeLights: Light node not found for ${t.constructor.name}`);continue}let r=null;Yq.has(t)?r=Yq.get(t):(r=jL(new n(t)),Yq.set(t,r)),e.push(r)}}this._lightNodes=e}setupLights(t,e){for(const n of e)n.build(t)}setup(t){null===this._lightNodes&&this.setupLightsNode(t);const e=t.context,n=e.lightingModel;let r=this.outgoingLightNode;if(n){const{_lightNodes:i,totalDiffuseNode:s,totalSpecularNode:o}=this;e.outgoingLight=r;const a=t.addStack();t.getDataFromNode(this).nodes=a.nodes,n.start(e,a,t),this.setupLights(t,i),n.indirect(e,a,t);const{backdrop:l,backdropAlpha:u}=e,{directDiffuse:h,directSpecular:c,indirectDiffuse:d,indirectSpecular:p}=e.reflectedLight;let f=h.add(d);null!==l&&(f=sU(null!==u?u.mix(f,l):l),e.material.transparent=!0),s.assign(f),o.assign(c.add(p)),r.assign(s.add(o)),n.finish(e,a,t),r=r.bypass(t.removeStack())}return r}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class Zq extends tL{static get type(){return"ShadowBaseNode"}constructor(t){super(),this.light=t,this.updateBeforeType=WD,this.isShadowBaseNode=!0}setupShadowPosition({material:t}){Jq.assign(t.shadowPositionNode||FB)}dispose(){this.updateBeforeType=GD}}const Jq=sU().toVar("shadowPositionWorld");function Qq(t,e){return e=function(t,e={}){return e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.renderTarget=t.getRenderTarget(),e.activeCubeFace=t.getActiveCubeFace(),e.activeMipmapLevel=t.getActiveMipmapLevel(),e.renderObjectFunction=t.getRenderObjectFunction(),e.pixelRatio=t.getPixelRatio(),e.mrt=t.getMRT(),e.clearColor=t.getClearColor(e.clearColor||new OT),e.clearAlpha=t.getClearAlpha(),e.autoClear=t.autoClear,e.scissorTest=t.getScissorTest(),e}(t,e),t.setMRT(null),t.setRenderObjectFunction(null),t.setClearColor(0,1),t.autoClear=!0,e}const t$=new WeakMap,e$=qL((([t,e,n])=>{let r=FB.sub(t).length();return r=r.sub(e).div(n.sub(e)),r=r.saturate(),r})),n$=t=>{let e=t$.get(t);if(void 0===e){const n=t.isPointLight?(t=>{const e=t.shadow.camera,n=uj("near","float",e).setGroup(xU),r=uj("far","float",e).setGroup(xU),i=RB(t);return e$(i,n,r)})(t):null;e=new oG,e.colorNode=uU(0,0,0,1),e.depthNode=n,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,t$.set(t,e)}return e},r$=qL((({depthTexture:t,shadowCoord:e})=>mB(t,e.xy).compare(e.z))),i$=qL((({depthTexture:t,shadowCoord:e,shadow:n})=>{const r=(e,n)=>mB(t,e).compare(n),i=uj("mapSize","vec2",n).setGroup(xU),s=uj("radius","float",n).setGroup(xU),o=eU(1).div(i),a=o.x.negate().mul(s),l=o.y.negate().mul(s),u=o.x.mul(s),h=o.y.mul(s),c=a.div(2),d=l.div(2),p=u.div(2),f=h.div(2);return rF(r(e.xy.add(eU(a,l)),e.z),r(e.xy.add(eU(0,l)),e.z),r(e.xy.add(eU(u,l)),e.z),r(e.xy.add(eU(c,d)),e.z),r(e.xy.add(eU(0,d)),e.z),r(e.xy.add(eU(p,d)),e.z),r(e.xy.add(eU(a,0)),e.z),r(e.xy.add(eU(c,0)),e.z),r(e.xy,e.z),r(e.xy.add(eU(p,0)),e.z),r(e.xy.add(eU(u,0)),e.z),r(e.xy.add(eU(c,f)),e.z),r(e.xy.add(eU(0,f)),e.z),r(e.xy.add(eU(p,f)),e.z),r(e.xy.add(eU(a,h)),e.z),r(e.xy.add(eU(0,h)),e.z),r(e.xy.add(eU(u,h)),e.z)).mul(1/17)})),s$=qL((({depthTexture:t,shadowCoord:e,shadow:n})=>{const r=(e,n)=>mB(t,e).compare(n),i=uj("mapSize","vec2",n).setGroup(xU),s=eU(1).div(i),o=s.x,a=s.y,l=e.xy,u=BF(l.mul(i).add(.5));return l.subAssign(u.mul(s)),rF(r(l,e.z),r(l.add(eU(o,0)),e.z),r(l.add(eU(0,a)),e.z),r(l.add(s),e.z),xz(r(l.add(eU(o.negate(),0)),e.z),r(l.add(eU(o.mul(2),0)),e.z),u.x),xz(r(l.add(eU(o.negate(),a)),e.z),r(l.add(eU(o.mul(2),a)),e.z),u.x),xz(r(l.add(eU(0,a.negate())),e.z),r(l.add(eU(0,a.mul(2))),e.z),u.y),xz(r(l.add(eU(o,a.negate())),e.z),r(l.add(eU(o,a.mul(2))),e.z),u.y),xz(xz(r(l.add(eU(o.negate(),a.negate())),e.z),r(l.add(eU(o.mul(2),a.negate())),e.z),u.x),xz(r(l.add(eU(o.negate(),a.mul(2))),e.z),r(l.add(eU(o.mul(2),a.mul(2))),e.z),u.x),u.y)).mul(1/9)})),o$=qL((({depthTexture:t,shadowCoord:e})=>{const n=ZL(1).toVar(),r=mB(t).sample(e.xy).rg,i=uz(e.z,r.x);return YL(i.notEqual(ZL(1)),(()=>{const t=e.z.sub(r.x),s=az(0,r.y.mul(r.y));let o=s.div(s.add(t.mul(t)));o=wz(iF(o,.3).div(.95-.3)),n.assign(wz(az(i,o)))})),n})),a$=qL((({samples:t,radius:e,size:n,shadowPass:r})=>{const i=ZL(0).toVar(),s=ZL(0).toVar(),o=t.lessThanEqual(ZL(1)).select(ZL(0),ZL(2).div(t.sub(1))),a=t.lessThanEqual(ZL(1)).select(ZL(0),ZL(-1));SV({start:JL(0),end:JL(t),type:"int",condition:"<"},(({i:t})=>{const l=a.add(ZL(t).mul(o)),u=r.sample(rF(BV.xy,eU(0,l).mul(e)).div(n)).x;i.addAssign(u),s.addAssign(u.mul(u))})),i.divAssign(t),s.divAssign(t);const l=DF(s.sub(i.mul(i)));return eU(i,l)})),l$=qL((({samples:t,radius:e,size:n,shadowPass:r})=>{const i=ZL(0).toVar(),s=ZL(0).toVar(),o=t.lessThanEqual(ZL(1)).select(ZL(0),ZL(2).div(t.sub(1))),a=t.lessThanEqual(ZL(1)).select(ZL(0),ZL(-1));SV({start:JL(0),end:JL(t),type:"int",condition:"<"},(({i:t})=>{const l=a.add(ZL(t).mul(o)),u=r.sample(rF(BV.xy,eU(l,0).mul(e)).div(n));i.addAssign(u.x),s.addAssign(rF(u.y.mul(u.y),u.x.mul(u.x)))})),i.divAssign(t),s.divAssign(t);const l=DF(s.sub(i.mul(i)));return eU(i,l)})),u$=[r$,i$,s$,o$];let h$;const c$=new fq;class d$ extends Zq{static get type(){return"ShadowNode"}constructor(t,e=null){super(t),this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this.isShadowNode=!0}setupShadowFilter(t,{filterFn:e,depthTexture:n,shadowCoord:r,shadow:i}){const s=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),o=e({depthTexture:n,shadowCoord:r,shadow:i});return s.select(o,ZL(1))}setupShadowCoord(t,e){const{shadow:n}=this,{renderer:r}=t,i=uj("bias","float",n).setGroup(xU);let s,o=e;if(n.camera.isOrthographicCamera||!0!==r.logarithmicDepthBuffer)o=o.xyz.div(o.w),s=o.z,r.coordinateSystem===TM&&(s=s.mul(2).sub(1));else{const t=o.w;o=o.xy.div(t);const e=uj("near","float",n.camera).setGroup(xU),r=uj("far","float",n.camera).setGroup(xU);s=JV(t.negate(),e,r)}return o=sU(o.x,o.y.oneMinus(),s.add(i)),o}getShadowFilterFn(t){return u$[t]}setupShadow(t){const{renderer:e}=t,{light:n,shadow:r}=this,i=e.shadowMap.type,s=new oA(r.mapSize.width,r.mapSize.height);s.compareFunction=fM;const o=t.createRenderTarget(r.mapSize.width,r.mapSize.height);if(o.depthTexture=s,r.camera.updateProjectionMatrix(),3===i){s.compareFunction=null,this.vsmShadowMapVertical=t.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ew,type:dw}),this.vsmShadowMapHorizontal=t.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ew,type:dw});const e=mB(s),n=mB(this.vsmShadowMapVertical.texture),i=uj("blurSamples","float",r).setGroup(xU),o=uj("radius","float",r).setGroup(xU),a=uj("mapSize","vec2",r).setGroup(xU);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new oG);l.fragmentNode=a$({samples:i,radius:o,size:a,shadowPass:e}).context(t.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new oG),l.fragmentNode=l$({samples:i,radius:o,size:a,shadowPass:n}).context(t.getSharedContext()),l.name="VSMHorizontal"}const a=uj("intensity","float",r).setGroup(xU),l=uj("normalBias","float",r).setGroup(xU),u=Hq(n).mul(Jq.add(KB.mul(l))),h=this.setupShadowCoord(t,u),c=r.filterNode||this.getShadowFilterFn(e.shadowMap.type)||null;if(null===c)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const d=3===i?this.vsmShadowMapHorizontal.texture:s,p=this.setupShadowFilter(t,{filterFn:c,shadowTexture:o.texture,depthTexture:d,shadowCoord:h,shadow:r}),f=mB(o.texture,h),m=xz(1,p.rgb.mix(f,1),a.mul(f.a)).toVar();return this.shadowMap=o,this.shadow.map=o,m}setup(t){if(!1!==t.renderer.shadowMap.enabled)return qL((()=>{let e=this._node;return this.setupShadowPosition(t),null===e&&(this._node=e=this.setupShadow(t)),t.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),t.material.receivedShadowNode&&(e=t.material.receivedShadowNode(e)),e}))()}renderShadow(t){const{shadow:e,shadowMap:n,light:r}=this,{renderer:i,scene:s}=t;e.updateMatrices(r),n.setSize(e.mapSize.width,e.mapSize.height),i.render(s,e.camera)}updateShadow(t){const{shadowMap:e,light:n,shadow:r}=this,{renderer:i,scene:s,camera:o}=t,a=i.shadowMap.type,l=e.depthTexture.version;this._depthVersionCached=l,r.camera.layers.mask=o.layers.mask;const u=i.getRenderObjectFunction(),h=i.getMRT(),c=!!h&&h.has("velocity");h$=function(t,e,n){return n=function(t,e){return e=function(t,e={}){return e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial,e}(t,e),t.background=null,t.backgroundNode=null,t.overrideMaterial=null,e}(e,n=Qq(t,n)),n}(i,s,h$),s.overrideMaterial=n$(n),i.setRenderObjectFunction(((t,e,n,s,l,u,...h)=>{(!0===t.castShadow||t.receiveShadow&&3===a)&&(c&&(jD(t).useVelocity=!0),t.onBeforeShadow(i,t,o,r.camera,s,e.overrideMaterial,u),i.renderObject(t,e,n,s,l,u,...h),t.onAfterShadow(i,t,o,r.camera,s,e.overrideMaterial,u))})),i.setRenderTarget(e),this.renderShadow(t),i.setRenderObjectFunction(u),!0!==n.isPointLight&&3===a&&this.vsmPass(i),function(t,e,n){!function(t,e){t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),t.setRenderObjectFunction(e.renderObjectFunction),t.setPixelRatio(e.pixelRatio),t.setMRT(e.mrt),t.setClearColor(e.clearColor,e.clearAlpha),t.autoClear=e.autoClear,t.setScissorTest(e.scissorTest)}(t,n),function(t,e){t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial}(e,n)}(i,s,h$)}vsmPass(t){const{shadow:e}=this;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height),t.setRenderTarget(this.vsmShadowMapVertical),c$.material=this.vsmMaterialVertical,c$.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),c$.material=this.vsmMaterialHorizontal,c$.render(t)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(t){const{shadow:e}=this;(e.needsUpdate||e.autoUpdate)&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}class p$ extends NV{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.light=t,this.color=new OT,this.colorNode=t&&t.colorNode||SU(this.color).setGroup(xU),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=HD}customCacheKey(){return ID(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadowNode(){return((t,e)=>jL(new d$(t,e)))(this.light)}setupShadow(t){const{renderer:e}=t;if(!1===e.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const e=this.light.shadow.shadowNode;let r;r=void 0!==e?jL(e):this.setupShadowNode(t),this.shadowNode=r,this.shadowColorNode=n=this.colorNode.mul(r),this.baseColorNode=this.colorNode}this.colorNode=n}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const f$=qL((t=>{const{lightDistance:e,cutoffDistance:n,decayExponent:r}=t,i=e.pow(r).max(.01).reciprocal();return n.greaterThan(0).select(i.mul(e.div(n).pow4().oneMinus().clamp().pow2()),i)})),m$=new OT,g$=qL((([t,e])=>{const n=t.toVar(),r=$F(n),i=oF(1,az(r.x,az(r.y,r.z)));r.mulAssign(i),n.mulAssign(i.mul(e.mul(2).oneMinus()));const s=eU(n.xy).toVar(),o=e.mul(1.5).oneMinus();return YL(r.z.greaterThanEqual(o),(()=>{YL(n.z.greaterThan(0),(()=>{s.x.assign(iF(4,n.x))}))})).ElseIf(r.x.greaterThanEqual(o),(()=>{const t=XF(n.x);s.x.assign(n.z.mul(t).add(t.mul(2)))})).ElseIf(r.y.greaterThanEqual(o),(()=>{const t=XF(n.y);s.x.assign(n.x.add(t.mul(2)).add(2)),s.y.assign(n.z.mul(t).sub(2))})),eU(.125,.25).mul(s).add(eU(.375,.75)).flipY()})).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),y$=qL((({depthTexture:t,bd3D:e,dp:n,texelSize:r})=>mB(t,g$(e,r.y)).compare(n))),v$=qL((({depthTexture:t,bd3D:e,dp:n,texelSize:r,shadow:i})=>{const s=uj("radius","float",i).setGroup(xU),o=eU(-1,1).mul(s).mul(r.y);return mB(t,g$(e.add(o.xyy),r.y)).compare(n).add(mB(t,g$(e.add(o.yyy),r.y)).compare(n)).add(mB(t,g$(e.add(o.xyx),r.y)).compare(n)).add(mB(t,g$(e.add(o.yyx),r.y)).compare(n)).add(mB(t,g$(e,r.y)).compare(n)).add(mB(t,g$(e.add(o.xxy),r.y)).compare(n)).add(mB(t,g$(e.add(o.yxy),r.y)).compare(n)).add(mB(t,g$(e.add(o.xxx),r.y)).compare(n)).add(mB(t,g$(e.add(o.yxx),r.y)).compare(n)).mul(1/9)})),_$=qL((({filterFn:t,depthTexture:e,shadowCoord:n,shadow:r})=>{const i=n.xyz.toVar(),s=i.length(),o=SU("float").setGroup(xU).onRenderUpdate((()=>r.camera.near)),a=SU("float").setGroup(xU).onRenderUpdate((()=>r.camera.far)),l=uj("bias","float",r).setGroup(xU),u=SU(r.mapSize).setGroup(xU),h=ZL(1).toVar();return YL(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),(()=>{const n=s.sub(o).div(a.sub(o)).toVar();n.addAssign(l);const c=i.normalize(),d=eU(1).div(u.mul(eU(4,2)));h.assign(t({depthTexture:e,bd3D:c,dp:n,texelSize:d,shadow:r}))})),h})),b$=new sS,x$=new FM,w$=new FM;class M$ extends d${static get type(){return"PointShadowNode"}constructor(t,e=null){super(t,e)}getShadowFilterFn(t){return 0===t?y$:v$}setupShadowCoord(t,e){return e}setupShadowFilter(t,{filterFn:e,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:s}){return _$({filterFn:e,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:s})}renderShadow(t){const{shadow:e,shadowMap:n,light:r}=this,{renderer:i,scene:s}=t,o=e.getFrameExtents();w$.copy(e.mapSize),w$.multiply(o),n.setSize(w$.width,w$.height),x$.copy(e.mapSize);const a=i.autoClear,l=i.getClearColor(m$),u=i.getClearAlpha();i.autoClear=!1,i.setClearColor(e.clearColor,e.clearAlpha),i.clear();const h=e.getViewportCount();for(let t=0;t<h;t++){const o=e.getViewport(t),a=x$.x*o.x,l=w$.y-x$.y-x$.y*o.y;b$.set(a,l,x$.x*o.z,x$.y*o.w),n.viewport.copy(b$),e.updateMatrices(r,t),i.render(s,e.camera)}i.autoClear=a,i.setClearColor(l,u)}}const S$=qL((({color:t,lightViewPosition:e,cutoffDistance:n,decayExponent:r},i)=>{const s=i.context.lightingModel,o=e.sub(BB),a=o.normalize(),l=o.length(),u=f$({lightDistance:l,cutoffDistance:n,decayExponent:r}),h=t.mul(u),c=i.context.reflectedLight;s.direct({lightDirection:a,lightColor:h,reflectedLight:c},i.stack,i)}));class T$ extends p${static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=SU(0).setGroup(xU),this.decayExponentNode=SU(2).setGroup(xU)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setupShadowNode(){return((t,e)=>jL(new M$(t,e)))(this.light)}setup(t){super.setup(t),S$({color:this.colorNode,lightViewPosition:qq(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}qL((([t=uB()],{renderer:e,material:n})=>{const r=ZL(1).toVar(),i=bz(t.mul(2).sub(1));if(n.alphaToCoverage&&e.samples>1){const t=ZL(i.fwidth()).toVar();r.assign(Sz(t.oneMinus(),t.add(1),i).oneMinus())}else i.greaterThan(1).discard();return r}));const E$=qL((([t,e])=>{const n=t.x,r=t.y,i=t.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(1.023328).mul(r)),s=s.add(e.element(2).mul(1.023328).mul(i)),s=s.add(e.element(3).mul(1.023328).mul(n)),s=s.add(e.element(4).mul(.858086).mul(n).mul(r)),s=s.add(e.element(5).mul(.858086).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(.858086).mul(n).mul(i)),s=s.add(e.element(8).mul(.429043).mul(sF(n,n).sub(sF(r,r)))),s})),A$=new oq;class C$ extends AW{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,n){const r=this.renderer,i=this.nodes.getBackgroundNode(t)||t.background;let s=!1;if(null===i)r._clearColor.getRGB(A$,uM),A$.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(A$,uM),A$.a=1,s=!0;else if(!0===i.isNode){const n=this.get(t),s=i;A$.copy(r._clearColor);let o=n.backgroundMesh;if(void 0===o){const t=Nz(uU(s).mul(_q),{getUV:()=>bq.mul(XB),getTextureLevel:()=>vq});let e=cV;e=e.setZ(e.w);const r=new oG;r.name="Background.material",r.side=1,r.depthTest=!1,r.depthWrite=!1,r.fog=!1,r.lights=!1,r.vertexNode=e,r.colorNode=t,n.backgroundMeshNode=t,n.backgroundMesh=o=new mE(new MA(1,32,32),r),o.frustumCulled=!1,o.name="Background.mesh",o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)}}const a=s.getCacheKey();n.backgroundCacheKey!==a&&(n.backgroundMeshNode.node=uU(s).mul(_q),n.backgroundMeshNode.needsUpdate=!0,o.material.needsUpdate=!0,n.backgroundCacheKey=a),e.unshift(o,o.geometry,o.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",i);const o=r.xr.getEnvironmentBlendMode();if("additive"===o?A$.set(0,0,0,1):"alpha-blend"===o&&A$.set(0,0,0,0),!0===r.autoClear||!0===s){const t=n.clearColorValue;t.r=A$.r,t.g=A$.g,t.b=A$.b,t.a=A$.a,!0!==r.backend.isWebGLBackend&&!0!==r.alpha||(t.r*=t.a,t.g*=t.a,t.b*=t.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let R$=0;class N${constructor(t="",e=[],n=0,r=[]){this.name=t,this.bindings=e,this.index=n,this.bindingsReference=r,this.id=R$++}}class P${constructor(t,e,n,r,i,s,o,a,l,u=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=n,this.transforms=u,this.nodeAttributes=r,this.bindings=i,this.updateNodes=s,this.updateBeforeNodes=o,this.updateAfterNodes=a,this.observer=l,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings){if(!0!==e.bindings[0].groupNode.shared){const n=new N$(e.name,[],e.index,e);t.push(n);for(const t of e.bindings)n.bindings.push(t.clone())}else t.push(e)}return t}}class k${constructor(t,e,n=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=n}}class O${constructor(t,e,n){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=n.getSelf()}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class I${constructor(t,e,n=!1,r=null){this.isNodeVar=!0,this.name=t,this.type=e,this.readOnly=n,this.count=r}}class D$ extends I${constructor(t,e){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0}}class L${constructor(t,e,n=""){this.name=t,this.type=e,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let U$=0;class F${constructor(t=null){this.id=U$++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return void 0===e&&null!==this.parent&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class z${constructor(t,e){this.name=t,this.members=e,this.output=!1}}class B${constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0}setValue(t){this.value=t}getValue(){return this.value}}class j$ extends B${constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class V$ extends B${constructor(t,e=new FM){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class G$ extends B${constructor(t,e=new cS){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class H$ extends B${constructor(t,e=new sS){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class W$ extends B${constructor(t,e=new OT){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class q$ extends B${constructor(t,e=new gC){super(t,e),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class $$ extends B${constructor(t,e=new zM){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class X$ extends B${constructor(t,e=new jS){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Y$ extends j${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class K$ extends V${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Z$ extends G${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class J$ extends H${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Q$ extends W${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class tX extends q${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class eX extends $${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class nX extends X${constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const rX=[.125,.215,.35,.446,.526,.582],iX=20,sX=new tC(-1,1,1,-1,0,1),oX=new AE(90,1),aX=new OT;let lX=null,uX=0,hX=0;const cX=(1+Math.sqrt(5))/2,dX=1/cX,pX=[new cS(-cX,dX,0),new cS(cX,dX,0),new cS(-dX,0,cX),new cS(dX,0,cX),new cS(0,cX,-dX),new cS(0,cX,dX),new cS(-1,1,-1),new cS(1,1,-1),new cS(-1,1,1),new cS(1,1,1)],fX=new WeakMap,mX=[3,1,5,0,4,2],gX=BH(uB(),lB("faceIndex")).normalize(),yX=sU(gX.x,gX.y,gX.z);class vX{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,n=.1,r=100,i=null){if(this._setSize(256),!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const s=i||this._allocateTargets();return this.fromSceneAsync(t,e,n,r,s),s}lX=this._renderer.getRenderTarget(),uX=this._renderer.getActiveCubeFace(),hX=this._renderer.getActiveMipmapLevel();const s=i||this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,r,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}async fromSceneAsync(t,e=0,n=.1,r=100,i=null){return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(t,e,n,r,i)}fromEquirectangular(t,e=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(t);const n=e||this._allocateTargets();return this.fromEquirectangularAsync(t,n),n}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const n=e||this._allocateTargets();return this.fromCubemapAsync(t,e),n}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=wX(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=MX(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===Wx||t.mapping===qx?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(lX,uX,hX),t.scissorTest=!1,bX(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),lX=this._renderer.getRenderTarget(),uX=this._renderer.getActiveCubeFace(),hX=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:nw,minFilter:nw,generateMipmaps:!1,type:dw,format:_w,colorSpace:uM},r=_X(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_X(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(t){const e=[],n=[],r=[],i=[];let s=t;const o=t-4+1+rX.length;for(let a=0;a<o;a++){const o=Math.pow(2,s);n.push(o);let l=1/o;a>t-4?l=rX[a-t+4-1]:0===a&&(l=0),r.push(l);const u=1/(o-2),h=-u,c=1+u,d=[h,h,c,h,c,c,h,h,c,c,h,c],p=6,f=6,m=3,g=2,y=1,v=new Float32Array(m*f*p),_=new Float32Array(g*f*p),b=new Float32Array(y*f*p);for(let t=0;t<p;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0],i=mX[t];v.set(r,m*f*i),_.set(d,g*f*i);const s=[i,i,i,i,i,i];b.set(s,y*f*i)}const x=new rE;x.setAttribute("position",new WT(v,m)),x.setAttribute("uv",new WT(_,g)),x.setAttribute("faceIndex",new WT(b,y)),e.push(x),i.push(new mE(x,null)),s>4&&s--}return{lodPlanes:e,sizeLods:n,sigmas:r,lodMeshes:i}}(r)),this._blurMaterial=function(t,e,n){const r=xB(new Array(iX).fill(0)),i=SU(new cS(0,1,0)),s=SU(0),o=ZL(iX),a=SU(0),l=SU(1),u=mB(null),h=SU(0),c=ZL(1/e),d=ZL(1/n),p=ZL(t),f={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:yX,dTheta:s,samples:l,envMap:u,mipInt:h,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p},m=xX("blur");return m.fragmentNode=HH({...f,latitudinal:a.equal(1)}),fX.set(m,f),m}(r,t,e)}return r}async _compileMaterial(t){const e=new mE(this._lodPlanes[0],t);await this._renderer.compile(e,sX)}_sceneToCubeUV(t,e,n,r){const i=oX;i.near=e,i.far=n;const s=[1,1,1,1,-1,1],o=[1,-1,1,-1,1,-1],a=this._renderer,l=a.autoClear;a.getClearColor(aX),a.autoClear=!1;let u=this._backgroundBox;if(null===u){const t=new UT({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});u=new mE(new yE,t)}let h=!1;const c=t.background;c?c.isColor&&(u.material.color.copy(c),t.background=null,h=!0):(u.material.color.copy(aX),h=!0),a.setRenderTarget(r),a.clear(),h&&a.render(u,i);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1===n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e]));const l=this._cubeSize;bX(r,n*l,e>2?l:0,l,l),a.render(t,i)}a.autoClear=l,t.background=c}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===Wx||t.mapping===qx;r?null===this._cubemapMaterial&&(this._cubemapMaterial=wX(t)):null===this._equirectMaterial&&(this._equirectMaterial=MX(t));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=t;const s=this._lodMeshes[0];s.material=i;const o=this._cubeSize;bX(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,sX)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const r=this._lodPlanes.length;for(let e=1;e<r;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=pX[(r-e-1)%pX.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const u=this._lodMeshes[r];u.material=l;const h=fX.get(l),c=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*c):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):iX;f>iX&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<iX;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;t.texture.frame=(t.texture.frame||0)+1,h.envMap.value=t.texture,h.samples.value=f,h.weights.array=m,h.latitudinal.value="latitudinal"===s?1:0,o&&(h.poleAxis.value=o);const{_lodMax:y}=this;h.dTheta.value=d,h.mipInt.value=y-n;const v=this._sizeLods[r];bX(e,3*v*(r>y-4?r-y+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(u,sX)}}function _X(t,e,n){const r=new oS(t,e,n);return r.texture.mapping=Yx,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function bX(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function xX(t){const e=new oG;return e.depthTest=!1,e.depthWrite=!1,e.blending=0,e.name=`PMREM_${t}`,e}function wX(t){const e=xX("cubemap");return e.fragmentNode=oj(t,yX),e}function MX(t){const e=xX("equirect");return e.fragmentNode=mB(t,fG(yX),0),e}const SX=new WeakMap,TX=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),EX=t=>/e/g.test(t)?String(t).replace(/\+/g,""):(t=Number(t))+(t%1?"":".0");class AX{constructor(t,e,n){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=uq(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new F$,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let t=SX.get(this.renderer);return void 0===t&&(t=new wW,SX.set(this.renderer,t)),t}createRenderTarget(t,e,n){return new oS(t,e,n)}createCubeRenderTarget(t,e){return new mG(t,e)}createPMREMGenerator(){return new vX(this.renderer)}includes(t){return this.nodes.includes(t)}getOutputStructName(){}_getBindGroup(t,e){const n=this.getBindGroupsCache(),r=[];let i,s=!0;for(const t of e)r.push(t),s=s&&!0!==t.groupNode.shared;return s?(i=n.get(r),void 0===i&&(i=new N$(t,r,this.bindingsIndexes[t].group,r),n.set(r,i))):i=new N$(t,r,this.bindingsIndexes[t].group,r),i}getBindGroupArray(t,e){const n=this.bindings[e];let r=n[t];return void 0===r&&(void 0===this.bindingsIndexes[t]&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[t]=r=[]),r}getBindings(){let t=this.bindGroups;if(null===t){const e={},n=this.bindings;for(const t of ZD)for(const r in n[t]){const i=n[t][r];(e[r]||(e[r]=[])).push(...i)}t=[];for(const n in e){const r=e[n],i=this._getBindGroup(n,r);t.push(i)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort(((t,e)=>t.bindings[0].groupNode.order-e.bindings[0].groupNode.order));for(let e=0;e<t.length;e++){const n=t[e];this.bindingsIndexes[n.name].group=e,n.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){!1===this.nodes.includes(t)&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){!1===this.sequentialNodes.includes(t)&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes){t.getUpdateType()!==GD&&this.updateNodes.push(t.getSelf())}for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();e!==GD&&this.updateBeforeNodes.push(t.getSelf()),n!==GD&&this.updateAfterNodes.push(t.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===nw||t.magFilter===rw||t.magFilter===ew||t.magFilter===iw||t.minFilter===nw||t.minFilter===rw||t.minFilter===ew||t.minFilter===iw}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const n=this.getDataFromNode(t);return void 0===n.cache&&(n.cache=new F$(e?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=void 0===e.usageCount?1:e.usageCount+1,e.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(t,e){return this.getType(t)+"[ "+e+" ]"}generateArray(t,e,n=null){let r=this.generateArrayDeclaration(t,e)+"( ";for(let i=0;i<e;i++){const s=n?n[i]:null;r+=null!==s?s.build(this,t):this.generateConst(t),i<e-1&&(r+=", ")}return r+=" )",r}generateStruct(t,e,n=null){const r=[];for(const t of e){const{name:e,type:i}=t;n&&n[e]&&n[e].isNode?r.push(n[e].build(this,i)):r.push(this.generateConst(i))}return t+"( "+r.join(", ")+" )"}generateConst(t,e=null){if(null===e&&("float"===t||"int"===t||"uint"===t?e=0:"bool"===t?e=!1:"color"===t?e=new OT:"vec2"===t?e=new FM:"vec3"===t?e=new cS:"vec4"===t&&(e=new sS)),"float"===t)return EX(e);if("int"===t)return`${Math.round(e)}`;if("uint"===t)return e>=0?`${Math.round(e)}u`:"0u";if("bool"===t)return e?"true":"false";if("color"===t)return`${this.getType("vec3")}( ${EX(e.r)}, ${EX(e.g)}, ${EX(e.b)} )`;const n=this.getTypeLength(t),r=this.getComponentType(t),i=t=>this.generateConst(r,t);if(2===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)} )`;if(3===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)} )`;if(4===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)}, ${i(e.w)} )`;if(n>4&&e&&(e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return"color"===t?"vec3":t}hasGeometryAttribute(t){return this.geometry&&void 0!==this.geometry.getAttribute(t)}getAttribute(t,e){const n=this.attributes;for(const e of n)if(e.name===t)return e;const r=new k$(t,e);return n.push(r),r}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return"void"===t||"property"===t||"sampler"===t||"texture"===t||"cubeTexture"===t||"storageTexture"===t||"depthTexture"===t||"texture3D"===t}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===uw)return"int";if(e===hw)return"uint"}return"float"}getElementType(t){return"mat2"===t?"vec2":"mat3"===t?"vec3":"mat4"===t?"vec4":this.getComponentType(t)}getComponentType(t){if("float"===(t=this.getVectorType(t))||"bool"===t||"int"===t||"uint"===t)return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return null===e?null:"b"===e[1]?"bool":"i"===e[1]?"int":"u"===e[1]?"uint":"float"}getVectorType(t){return"color"===t?"vec3":"texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t?"vec4":t}getTypeFromLength(t,e="float"){if(1===t)return e;let n=function(t){return UD.get(t)}(t);const r="float"===e?"":e[0];return!0===/mat2/.test(e)&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(t){return TX.get(t.constructor)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const n=e.array,r=t.itemSize,i=t.normalized;let s;return t instanceof XT||!0===i||(s=this.getTypeFromArray(n)),this.getTypeFromLength(r,s)}getTypeLength(t){const e=this.getVectorType(t),n=/vec([2-4])/.exec(e);return null!==n?Number(n[1]):"float"===e||"bool"===e||"int"===e||"uint"===e?1:!0===/mat2/.test(t)?4:!0===/mat3/.test(t)?9:!0===/mat4/.test(t)?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return"int"===e||"uint"===e?t:this.changeComponentType(t,"int")}addStack(){return this.stack=uq(this.stack),this.stacks.push(XL()||this.stack),$L(this.stack),this.stack}removeStack(){const t=this.stack;return this.stack=t.parent,$L(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,n=null){let r=(n=null===n?t.isGlobal(this)?this.globalCache:this.cache:n).getData(t);return void 0===r&&(r={},n.setData(t,r)),void 0===r[e]&&(r[e]={}),r[e]}getNodeProperties(t,e="any"){const n=this.getDataFromNode(t,e);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const n=this.getDataFromNode(t);let r=n.bufferAttribute;if(void 0===r){const i=this.uniforms.index++;r=new k$("nodeAttribute"+i,e,t),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(t,e,n=null,r=this.shaderStage){const i=this.getDataFromNode(t,r);let s=i.structType;if(void 0===s){const t=this.structs.index++;null===n&&(n="StructType"+t),s=new z$(n,e),this.structs[r].push(s),i.structType=s}return s}getOutputStructTypeFromNode(t,e){const n=this.getStructTypeFromNode(t,e,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(t,e,n=this.shaderStage,r=null){const i=this.getDataFromNode(t,n,this.globalCache);let s=i.uniform;if(void 0===s){const o=this.uniforms.index++;s=new O$(r||"nodeUniform"+o,e,t),this.uniforms[n].push(s),i.uniform=s}return s}getArrayCount(t){let e=null;return t.isArrayNode?e=t.count:t.isVarNode&&t.node.isArrayNode&&(e=t.node.count),e}getVarFromNode(t,e=null,n=t.getNodeType(this),r=this.shaderStage,i=!1){const s=this.getDataFromNode(t,r);let o=s.variable;if(void 0===o){const a=i?"_const":"_var",l=this.vars[r]||(this.vars[r]=[]),u=this.vars[a]||(this.vars[a]=0);null===e&&(e=(i?"nodeConst":"nodeVar")+u,this.vars[a]++);const h=this.getArrayCount(t);o=new I$(e,n,i,h),i||l.push(o),s.variable=o}return o}isDeterministic(t){if(t.isMathNode)return this.isDeterministic(t.aNode)&&(!t.bNode||this.isDeterministic(t.bNode))&&(!t.cNode||this.isDeterministic(t.cNode));if(t.isOperatorNode)return this.isDeterministic(t.aNode)&&(!t.bNode||this.isDeterministic(t.bNode));if(t.isArrayNode){if(null!==t.values)for(const e of t.values)if(!this.isDeterministic(e))return!1;return!0}return!!t.isConstNode}getVaryingFromNode(t,e=null,n=t.getNodeType(this)){const r=this.getDataFromNode(t,"any");let i=r.varying;if(void 0===i){const t=this.varyings,s=t.length;null===e&&(e="nodeVarying"+s),i=new D$(e,n),t.push(i),r.varying=i}return i}getCodeFromNode(t,e,n=this.shaderStage){const r=this.getDataFromNode(t);let i=r.code;if(void 0===i){const t=this.codes[n]||(this.codes[n]=[]),s=t.length;i=new L$("nodeCode"+s,e),t.push(i),r.code=i}return i}addFlowCodeHierarchy(t,e){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(t);let i=!0,s=e;for(;s;){if(!0===r.get(s)){i=!1;break}s=this.getDataFromNode(s).parentNodeBlock}if(i)for(const t of n)this.addLineFlowCode(t)}addLineFlowCodeBlock(t,e,n){const r=this.getDataFromNode(t),i=r.flowCodes||(r.flowCodes=[]),s=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(e),s.set(n,!0)}addLineFlowCode(t,e=null){return""===t||(null!==e&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t+=";\n"),this.flow.code+=t),this}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),n=this.flowChildNode(t,e);return this.flowsData.set(t,n),n}buildFunctionNode(t){const e=new Lq,n=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=n,e}flowShaderNode(t){const e=t.layout,n={[Symbol.iterator](){let t=0;const e=Object.values(this);return{next:()=>({value:e[t],done:t++>=e.length})}}};for(const t of e.inputs)n[t.name]=new aq(t.type,t.name);t.layout=null;const r=t.call(n),i=this.flowStagesNode(r,e.type);return t.layout=e,i}flowStagesNode(t,e=null){const n=this.flow,r=this.vars,i=this.cache,s=this.buildStage,o=this.stack,a={code:""};this.flow=a,this.vars={},this.cache=new F$,this.stack=uq();for(const n of KD)this.setBuildStage(n),a.result=t.build(this,e);return a.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.cache=i,this.stack=o,this.setBuildStage(s),a}getFunctionOperator(){return null}flowChildNode(t,e=null){const n=this.flow,r={code:""};return this.flow=r,r.result=t.build(this,e),this.flow=n,r}flowNodeFromShaderStage(t,e,n=null,r=null){const i=this.shaderStage;this.setShaderStage(t);const s=this.flowChildNode(e,n);return null!==r&&(s.code+=`${this.tab+r} = ${s.result};\n`),this.flowCode[t]=this.flowCode[t]+s.code,this.setShaderStage(i),s}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(t,e,n=null){return`${null!==n?this.generateArrayDeclaration(t,n):this.getType(t)} ${e}`}getVars(t){let e="";const n=this.vars[t];if(void 0!==n)for(const t of n)e+=`${this.getVar(t.type,t.name)}; `;return e}getUniforms(){console.warn("Abstract function.")}getCodes(t){const e=this.codes[t];let n="";if(void 0!==e)for(const t of e)n+=t.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:t,material:e,renderer:n}=this;if(null!==e){let t=n.library.fromMaterial(e);null===t&&(console.error(`NodeMaterial: Material "${e.type}" is not compatible.`),t=new oG),t.build(this)}else this.addFlow("compute",t);for(const t of KD){this.setBuildStage(t),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of ZD){this.setShaderStage(e);const n=this.flowNodes[e];for(const e of n)"generate"===t?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(t,e){if("float"===e||"int"===e||"uint"===e)return new Y$(t);if("vec2"===e||"ivec2"===e||"uvec2"===e)return new K$(t);if("vec3"===e||"ivec3"===e||"uvec3"===e)return new Z$(t);if("vec4"===e||"ivec4"===e||"uvec4"===e)return new J$(t);if("color"===e)return new Q$(t);if("mat2"===e)return new tX(t);if("mat3"===e)return new eX(t);if("mat4"===e)return new nX(t);throw new Error(`Uniform "${e}" not declared.`)}format(t,e,n){if((e=this.getVectorType(e))===(n=this.getVectorType(n))||null===n||this.isReference(n))return t;const r=this.getTypeLength(e),i=this.getTypeLength(n);return 16===r&&9===i?`${this.getType(n)}(${t}[0].xyz, ${t}[1].xyz, ${t}[2].xyz)`:9===r&&4===i?`${this.getType(n)}(${t}[0].xy, ${t}[1].xy)`:r>4||i>4||0===i?t:r===i?`${this.getType(n)}( ${t} )`:r>i?this.format(`${t}.${"xyz".slice(0,i)}`,this.getTypeFromLength(i,this.getComponentType(e)),n):4===i&&r>1?`${this.getType(n)}( ${this.format(t,e,"vec3")}, 1.0 )`:2===r?`${this.getType(n)}( ${this.format(t,e,"vec2")}, 0.0 )`:(1===r&&i>1&&e!==this.getComponentType(n)&&(t=`${this.getType(this.getComponentType(n))}( ${t} )`),`${this.getType(n)}( ${t} )`)}getSignature(){return`// Three.js r${lx} - Node System\n`}createNodeMaterial(t="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${t}() instead.`)}}class CX{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let n=t.get(e);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},t.set(e,n)),n}updateBeforeNode(t){const e=t.getUpdateBeforeType(),n=t.updateReference(this);if(e===HD){const{frameMap:e}=this._getMaps(this.updateBeforeMap,n);e.get(n)!==this.frameId&&!1!==t.updateBefore(this)&&e.set(n,this.frameId)}else if(e===WD){const{renderMap:e}=this._getMaps(this.updateBeforeMap,n);e.get(n)!==this.renderId&&!1!==t.updateBefore(this)&&e.set(n,this.renderId)}else e===qD&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),n=t.updateReference(this);if(e===HD){const{frameMap:e}=this._getMaps(this.updateAfterMap,n);e.get(n)!==this.frameId&&!1!==t.updateAfter(this)&&e.set(n,this.frameId)}else if(e===WD){const{renderMap:e}=this._getMaps(this.updateAfterMap,n);e.get(n)!==this.renderId&&!1!==t.updateAfter(this)&&e.set(n,this.renderId)}else e===qD&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),n=t.updateReference(this);if(e===HD){const{frameMap:e}=this._getMaps(this.updateMap,n);e.get(n)!==this.frameId&&!1!==t.update(this)&&e.set(n,this.frameId)}else if(e===WD){const{renderMap:e}=this._getMaps(this.updateMap,n);e.get(n)!==this.renderId&&!1!==t.update(this)&&e.set(n,this.renderId)}else e===qD&&t.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class RX{constructor(t,e,n=null,r="",i=!1){this.type=t,this.name=e,this.count=n,this.qualifier=r,this.isConst=i}}RX.isNodeFunctionInput=!0;class NX extends p${static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,n=this.colorNode,r=$q(this.light),i=t.context.reflectedLight;e.direct({lightDirection:r,lightColor:n,reflectedLight:i},t.stack,t)}}const PX=new jS,kX=new jS;let OX=null;class IX extends p${static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=SU(new cS).setGroup(xU),this.halfWidth=SU(new cS).setGroup(xU),this.updateType=WD}update(t){super.update(t);const{light:e}=this,n=t.camera.matrixWorldInverse;kX.identity(),PX.copy(e.matrixWorld),PX.premultiply(n),kX.extractRotation(PX),this.halfWidth.value.set(.5*e.width,0,0),this.halfHeight.value.set(0,.5*e.height,0),this.halfWidth.value.applyMatrix4(kX),this.halfHeight.value.applyMatrix4(kX)}setup(t){let e,n;super.setup(t),t.isAvailable("float32Filterable")?(e=mB(OX.LTC_FLOAT_1),n=mB(OX.LTC_FLOAT_2)):(e=mB(OX.LTC_HALF_1),n=mB(OX.LTC_HALF_2));const{colorNode:r,light:i}=this,s=t.context.lightingModel,o=qq(i),a=t.context.reflectedLight;s.directRectArea({lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:a,ltc_1:e,ltc_2:n},t.stack,t)}static setLTC(t){OX=t}}class DX extends p${static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=SU(0).setGroup(xU),this.penumbraCosNode=SU(0).setGroup(xU),this.cutoffDistanceNode=SU(0).setGroup(xU),this.decayExponentNode=SU(0).setGroup(xU)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:n}=this;return Sz(e,n,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:n,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=qq(s).sub(BB),a=o.normalize(),l=a.dot($q(s)),u=this.getSpotAttenuation(l),h=o.length(),c=f$({lightDistance:h,cutoffDistance:r,decayExponent:i});let d=n.mul(u).mul(c);if(s.map){const t=function(t){const e=Gq(t);if(void 0===e.projectionUV){const n=Hq(t).mul(FB);e.projectionUV=n.xyz.div(n.w)}return e.projectionUV}(s),e=mB(s.map,t.xy).onRenderUpdate((()=>s.map));d=t.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(e),d)}const p=t.context.reflectedLight;e.direct({lightDirection:a,lightColor:d,reflectedLight:p},t.stack,t)}}class LX extends DX{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t){const e=this.light.iesMap;let n=null;if(e&&!0===e.isTexture){const r=t.acos().mul(1/Math.PI);n=mB(e,eU(r,0),0).r}else n=super.getSpotAttenuation(t);return n}}class UX extends p${static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class FX extends p${static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=Wq(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=SU(new OT).setGroup(xU)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:n,lightDirectionNode:r}=this,i=$B.dot(r).mul(.5).add(.5),s=xz(n,e,i);t.context.irradiance.addAssign(s)}}class zX extends p${static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let t=0;t<9;t++)e.push(new cS);this.lightProbe=xB(e)}update(t){const{light:e}=this;super.update(t);for(let t=0;t<9;t++)this.lightProbe.array[t].copy(e.sh.coefficients[t]).multiplyScalar(e.intensity)}setup(t){const e=E$(XB,this.lightProbe);t.context.irradiance.addAssign(e)}}class BX{parseFunction(){console.warn("Abstract function.")}}class jX{constructor(t,e,n="",r=""){this.type=t,this.inputs=e,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}jX.isNodeFunction=!0;const VX=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,GX=/[a-z_0-9]+/gi,HX="#pragma main";class WX extends jX{constructor(t){const{type:e,inputs:n,name:r,precision:i,inputsCode:s,blockCode:o,headerCode:a}=(t=>{const e=(t=t.trim()).indexOf(HX),n=-1!==e?t.slice(e+12):t,r=n.match(VX);if(null!==r&&5===r.length){const i=r[4],s=[];let o=null;for(;null!==(o=GX.exec(i));)s.push(o);const a=[];let l=0;for(;l<s.length;){const t="const"===s[l][0];!0===t&&l++;let e=s[l][0];"in"===e||"out"===e||"inout"===e?l++:e="";const n=s[l++][0];let r=Number.parseInt(s[l][0]);!1===Number.isNaN(r)?l++:r=null;const i=s[l++][0];a.push(new RX(n,i,r,e,t))}const u=n.substring(r[0].length),h=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:a,name:h,precision:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:u,headerCode:-1!==e?t.slice(0,e):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(t);super(e,n,r,i),this.inputsCode=s,this.blockCode=o,this.headerCode=a}getCode(t=this.name){let e;const n=this.blockCode;if(""!==n){const{type:r,inputsCode:i,headerCode:s,precision:o}=this;let a=`${r} ${t} ( ${i.trim()} )`;""!==o&&(a=`${o} ${a}`),e=s+a+n}else e="";return e}}class qX extends BX{parseFunction(t){return new WX(t)}}const $X=new WeakMap,XX=[],YX=[];class KX extends AW{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new CX,this.nodeBuilderCache=new Map,this.callHashCache=new wW,this.groupsData=new wW,this.cacheLib={}}updateGroup(t){const e=t.groupNode,n=e.name;if(n===wU.name)return!0;if(n===xU.name){const e=this.get(t),n=this.nodeFrame.renderId;return e.renderId!==n&&(e.renderId=n,!0)}if(n===bU.name){const e=this.get(t),n=this.nodeFrame.frameId;return e.frameId!==n&&(e.frameId=n,!0)}XX[0]=e,XX[1]=t;let r=this.groupsData.get(XX);return void 0===r&&this.groupsData.set(XX,r={}),XX.length=0,r.version!==e.version&&(r.version=e.version,!0)}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let n=e.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(t);if(n=r.get(i),void 0===n){const e=this.backend.createNodeBuilder(t.object,this.renderer);e.scene=t.scene,e.material=t.material,e.camera=t.camera,e.context.material=t.material,e.lightsNode=t.lightsNode,e.environmentNode=this.getEnvironmentNode(t.scene),e.fogNode=this.getFogNode(t.scene),e.clippingContext=t.clippingContext,e.build(),n=this._createNodeBuilderState(e),r.set(i,n)}n.usedTimes++,e.nodeBuilderState=n}return n}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,0===e.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let n=e.nodeBuilderState;if(void 0===n){const r=this.backend.createNodeBuilder(t,this.renderer);r.build(),n=this._createNodeBuilderState(r),e.nodeBuilderState=n}return n}_createNodeBuilderState(t){return new P$(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.observer,t.transforms)}getEnvironmentNode(t){this.updateEnvironment(t);let e=null;if(t.environmentNode&&t.environmentNode.isNode)e=t.environmentNode;else{const n=this.get(t);n.environmentNode&&(e=n.environmentNode)}return e}getBackgroundNode(t){this.updateBackground(t);let e=null;if(t.backgroundNode&&t.backgroundNode.isNode)e=t.backgroundNode;else{const n=this.get(t);n.backgroundNode&&(e=n.backgroundNode)}return e}getFogNode(t){return this.updateFog(t),t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){XX[0]=t,XX[1]=e;const n=this.renderer.info.calls,r=this.callHashCache.get(XX)||{};if(r.callId!==n){const i=this.getEnvironmentNode(t),s=this.getFogNode(t);e&&YX.push(e.getCacheKey(!0)),i&&YX.push(i.getCacheKey()),s&&YX.push(s.getCacheKey()),YX.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=OD(YX),this.callHashCache.set(XX,r),YX.length=0}return XX.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),n=t.background;if(n){const r=0===t.backgroundBlurriness&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&0===e.backgroundBlurriness;if(e.background!==n||r){const i=this.getCacheNode("background",n,(()=>{if(!0===n.isCubeTexture||n.mapping===$x||n.mapping===Xx||n.mapping===Yx){if(t.backgroundBlurriness>0||n.mapping===Yx)return YH(n);{let t;return t=!0===n.isCubeTexture?oj(n):mB(n),bG(t)}}if(!0===n.isTexture)return mB(n,FV.flipY()).setUpdateMatrix(!0);!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n)}),r);e.backgroundNode=i,e.background=n,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}getCacheNode(t,e,n,r=!1){const i=this.cacheLib[t]||(this.cacheLib[t]=new WeakMap);let s=i.get(e);return(void 0===s||r)&&(s=n(),i.set(e,s)),s}updateFog(t){const e=this.get(t),n=t.fog;if(n){if(e.fog!==n){const t=this.getCacheNode("fog",n,(()=>{if(n.isFogExp2){const t=uj("color","color",n).setGroup(xU),e=uj("density","float",n).setGroup(xU);return Bq(t,zq(e))}if(n.isFog){const t=uj("color","color",n).setGroup(xU),e=uj("near","float",n).setGroup(xU),r=uj("far","float",n).setGroup(xU);return Bq(t,Fq(e,r))}console.error("THREE.Renderer: Unsupported fog configuration.",n)}));e.fogNode=t,e.fog=n}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),n=t.environment;if(n){if(e.environment!==n){const t=this.getCacheNode("environment",n,(()=>!0===n.isCubeTexture?oj(n):!0===n.isTexture?mB(n):void console.error("Nodes: Unsupported environment configuration.",n)));e.environmentNode=t,e.environment=n}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,n=null,r=null,i=null){const s=this.nodeFrame;return s.renderer=t,s.scene=e,s.object=n,s.camera=r,s.material=i,s}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace}hasOutputChange(t){return $X.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,n=this.getOutputCacheKey(),r=mB(t,FV).renderOutput(e.toneMapping,e.currentColorSpace);return $X.set(t,n),r}updateBefore(t){const e=t.getNodeBuilderState();for(const n of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(n)}updateAfter(t){const e=t.getNodeBuilderState();for(const n of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(n)}updateForCompute(t){const e=this.getNodeFrame(),n=this.getForCompute(t);for(const t of n.updateNodes)e.updateNode(t)}updateForRender(t){const e=this.getNodeFrameForRender(t),n=t.getNodeBuilderState();for(const t of n.updateNodes)e.updateNode(t)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new CX,this.nodeBuilderCache=new Map,this.cacheLib={}}}const ZX=new WE;class JX{constructor(t=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new zM,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==t&&(this.viewNormalMatrix=t.viewNormalMatrix,this.clippingGroupContexts=t.clippingGroupContexts,this.shadowPass=t.shadowPass,this.viewMatrix=t.viewMatrix)}projectPlanes(t,e,n){const r=t.length;for(let i=0;i<r;i++){ZX.copy(t[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const r=e[n+i],s=ZX.normal;r.x=-s.x,r.y=-s.y,r.z=-s.z,r.w=ZX.constant}}updateGlobal(t,e){this.shadowPass=null!==t.overrideMaterial&&t.overrideMaterial.isShadowPassMaterial,this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(t,e){let n=!1;t.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(t.intersectionPlanes),this.unionPlanes=Array.from(t.unionPlanes),this.parentVersion=t.version),this.clipIntersection!==e.clipIntersection&&(this.clipIntersection=e.clipIntersection,this.clipIntersection?this.unionPlanes.length=t.unionPlanes.length:this.intersectionPlanes.length=t.intersectionPlanes.length);const r=e.clippingPlanes,i=r.length;let s,o;if(this.clipIntersection?(s=this.intersectionPlanes,o=t.intersectionPlanes.length):(s=this.unionPlanes,o=t.unionPlanes.length),s.length!==o+i){s.length=o+i;for(let t=0;t<i;t++)s[o+t]=new sS;n=!0}this.projectPlanes(r,s,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let e=this.clippingGroupContexts.get(t);return void 0===e&&(e=new JX(this),this.clippingGroupContexts.set(t,e)),e.update(this,t),e}get unionClippingCount(){return this.unionPlanes.length}}class QX{constructor(t,e){this.bundleGroup=t,this.camera=e}}const tY=[];class eY{constructor(){this.bundles=new wW}get(t,e){const n=this.bundles;tY[0]=t,tY[1]=e;let r=n.get(tY);return void 0===r&&(r=new QX(t,e),n.set(tY,r)),tY.length=0,r}dispose(){this.bundles=new wW}}class nY{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const n=this.getMaterialNodeClass(t.type);if(null!==n){e=new n;for(const n in t)e[n]=t[n]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,n){if(n.has(e))console.warn(`Redefinition of node ${e}`);else{if("function"!=typeof t)throw new Error(`Node class ${t.name} is not a class.`);if("function"==typeof e||"object"==typeof e)throw new Error(`Base class ${e} is not a class.`);n.set(e,t)}}addClass(t,e,n){if(n.has(e))console.warn(`Redefinition of node ${e.name}`);else{if("function"!=typeof t)throw new Error(`Node class ${t.name} is not a class.`);if("function"!=typeof e)throw new Error(`Base class ${e.name} is not a class.`);n.set(e,t)}}}const rY=new Kq,iY=[];class sY extends wW{constructor(){super()}createNode(t=[]){return(new Kq).setLights(t)}getNode(t,e){if(t.isQuadMesh)return rY;iY[0]=t,iY[1]=e;let n=this.get(iY);return void 0===n&&(n=this.createNode(),this.set(iY,n)),iY.length=0,n}}class oY extends oS{constructor(t=1,e=1,n={}){super(t,e,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(t){return super.copy(t),this.hasExternalTextures=t.hasExternalTextures,this.autoAllocateDepthBuffer=t.autoAllocateDepthBuffer,this}}const aY=new cS,lY=new cS;class uY extends EM{constructor(t){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=t,this._cameraL=new AE,this._cameraL.viewport=new sS,this._cameraR=new AE,this._cameraR.viewport=new sS,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new aC,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._currentRenderTarget=null,this._xrRenderTarget=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new FM,this._onSessionEvent=cY.bind(this),this._onSessionEnd=dY.bind(this),this._onInputSourcesChange=pY.bind(this),this._onAnimationFrame=fY.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers="undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(t){return this._getController(t).getTargetRaySpace()}getControllerGrip(t){return this._getController(t).getGripSpace()}getHand(t){return this._getController(t).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(t){this._foveation=t,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=t),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=t)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(t){this._framebufferScaleFactor=t,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(t){this._referenceSpaceType=t,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(t){this._customReferenceSpace=t}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}getSession(){return this._session}async setSession(t){const e=this._renderer,n=e.backend,r=e.getContext();if(this._session=t,null!==t){if(!0===n.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(this._currentRenderTarget=e.getRenderTarget(),t.addEventListener("select",this._onSessionEvent),t.addEventListener("selectstart",this._onSessionEvent),t.addEventListener("selectend",this._onSessionEvent),t.addEventListener("squeeze",this._onSessionEvent),t.addEventListener("squeezestart",this._onSessionEvent),t.addEventListener("squeezeend",this._onSessionEvent),t.addEventListener("end",this._onSessionEnd),t.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=e.getPixelRatio(),e.getSize(this._currentSize),this._currentAnimationContext=e._animation.getContext(),this._currentAnimationLoop=e._animation.getAnimationLoop(),e._animation.stop(),!0===this._useLayers){let n=null,i=null,s=null;e.depth&&(s=e.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,n=e.stencil?Mw:ww,i=e.stencil?mw:hw);const o={colorFormat:r.RGBA8,depthFormat:s,scaleFactor:this._framebufferScaleFactor},a=new XRWebGLBinding(t,r),l=a.createProjectionLayer(o);this._glBinding=a,this._glProjLayer=l,t.updateRenderState({layers:[l]}),e.setPixelRatio(1),e.setSize(l.textureWidth,l.textureHeight,!1),this._xrRenderTarget=new oY(l.textureWidth,l.textureHeight,{format:_w,type:sw,colorSpace:e.outputColorSpace,depthTexture:new oA(l.textureWidth,l.textureHeight,i,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:e.stencil,samples:e.samples}),this._xrRenderTarget.hasExternalTextures=!0}else{const n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(t,r,n);this._glBaseLayer=i,t.updateRenderState({baseLayer:i}),e.setPixelRatio(1),e.setSize(i.framebufferWidth,i.framebufferHeight,!1),this._xrRenderTarget=new oY(i.framebufferWidth,i.framebufferHeight,{format:_w,type:sw,colorSpace:e.outputColorSpace,stencilBuffer:e.stencil})}this.setFoveation(this.getFoveation()),this._referenceSpace=await t.requestReferenceSpace(this.getReferenceSpaceType()),e._animation.setAnimationLoop(this._onAnimationFrame),e._animation.setContext(t),e._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(t){const e=this._session;if(null===e)return;const n=t.near,r=t.far,i=this._cameraXR,s=this._cameraL,o=this._cameraR;i.near=o.near=s.near=n,i.far=o.far=s.far=r,this._currentDepthNear===i.near&&this._currentDepthFar===i.far||(e.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),s.layers.mask=2|t.layers.mask,o.layers.mask=4|t.layers.mask,i.layers.mask=s.layers.mask|o.layers.mask;const a=t.parent,l=i.cameras;hY(i,a);for(let t=0;t<l.length;t++)hY(l[t],a);2===l.length?function(t,e,n){aY.setFromMatrixPosition(e.matrixWorld),lY.setFromMatrixPosition(n.matrixWorld);const r=aY.distanceTo(lY),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],h=(i[8]-1)/i[0],c=(s[8]+1)/s[0],d=o*h,p=o*c,f=r/(-h+c),m=f*-h;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===i[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,n=a+f,i=d-m,s=p+(r-m),h=l*a/n*e,c=u*a/n*e;t.projectionMatrix.makePerspective(i,s,h,c,e,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(i,s,o):i.projectionMatrix.copy(s.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*NM*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,i,a)}_getController(t){let e=this._controllers[t];return void 0===e&&(e=new IE,this._controllers[t]=e),e}}function hY(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}function cY(t){const e=this._controllerInputSources.indexOf(t.inputSource);if(-1===e)return;const n=this._controllers[e];if(void 0!==n){const e=this.getReferenceSpace();n.update(t.inputSource,t.frame,e),n.dispatchEvent({type:t.type,data:t.inputSource})}}function dY(){const t=this._session,e=this._renderer;t.removeEventListener("select",this._onSessionEvent),t.removeEventListener("selectstart",this._onSessionEvent),t.removeEventListener("selectend",this._onSessionEvent),t.removeEventListener("squeeze",this._onSessionEvent),t.removeEventListener("squeezestart",this._onSessionEvent),t.removeEventListener("squeezeend",this._onSessionEvent),t.removeEventListener("end",this._onSessionEnd),t.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const e=this._controllerInputSources[t];null!==e&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(e))}this._currentDepthNear=null,this._currentDepthFar=null,e.backend.setXRTarget(null),e.setRenderTarget(this._currentRenderTarget),this._session=null,this._xrRenderTarget=null,this.isPresenting=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function pY(t){const e=this._controllers,n=this._controllerInputSources;for(let r=0;r<t.removed.length;r++){const i=t.removed[r],s=n.indexOf(i);s>=0&&(n[s]=null,e[s].disconnect(i))}for(let r=0;r<t.added.length;r++){const i=t.added[r];let s=n.indexOf(i);if(-1===s){for(let t=0;t<e.length;t++){if(t>=n.length){n.push(i),s=t;break}if(null===n[t]){n[t]=i,s=t;break}}if(-1===s)break}const o=e[s];o&&o.connect(i)}}function fY(t,e){if(void 0===e)return;const n=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,null!==a){const t=a.views;null!==this._glBaseLayer&&i.setXRTarget(s.framebuffer);let e=!1;t.length!==n.cameras.length&&(n.cameras.length=0,e=!0);for(let r=0;r<t.length;r++){const o=t[r];let a;if(!0===this._useLayers){const t=this._glBinding.getViewSubImage(this._glProjLayer,o);a=t.viewport,0===r&&i.setXRRenderTargetTextures(this._xrRenderTarget,t.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:t.depthStencilTexture)}else a=s.getViewport(o);let l=this._cameras[r];void 0===l&&(l=new AE,l.layers.enable(r),l.viewport=new sS,this._cameras[r]=l),l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.quaternion,l.scale),l.projectionMatrix.fromArray(o.projectionMatrix),l.projectionMatrixInverse.copy(l.projectionMatrix).invert(),l.viewport.set(a.x,a.y,a.width,a.height),0===r&&(n.matrix.copy(l.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),!0===e&&n.cameras.push(l)}r.setRenderTarget(this._xrRenderTarget)}for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t],r=this._controllers[t];null!==n&&void 0!==r&&r.update(n,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(t,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const mY=new DE,gY=new FM,yY=new sS,vY=new XE,_Y=new jS,bY=new sS;class xY{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:s=!1,antialias:o=!1,samples:a=0,getFallback:l=null,colorBufferType:u=dw}=e;this.domElement=t.getDomElement(),this.backend=t,this.samples=a||!0===o?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=lM,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=s,this.info=new UW,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new nY,this.lighting=new sY,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new sS(0,0,this._width,this._height),this._scissor=new sS(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new fq(new oG),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=!0===this.alpha?0:1;this._clearColor=new oq(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=u,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new uY(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(t,e,n)=>{await this.compileAsync(t,e);const r=this._renderLists.get(t,e),i=this._renderContexts.get(t,e,this._renderTarget),s=t.overrideMaterial||n.material,o=this._objects.get(n,s,t,e,r.lightsNode,i,i.clippingContext),{fragmentShader:a,vertexShader:l}=o.getNodeBuilderState();return{fragmentShader:a,vertexShader:l}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise((async(t,e)=>{let n=this.backend;try{await n.init(this)}catch(t){if(null===this._getFallback)return void e(t);try{this.backend=n=this._getFallback(t),await n.init(this)}catch(t){return void e(t)}}this._nodes=new KX(this,n),this._animation=new xW(this._nodes,this.info),this._attributes=new OW(n),this._background=new C$(this,this._nodes),this._geometries=new LW(this._attributes,this.info),this._textures=new sq(this,n,this.info),this._pipelines=new GW(n,this._nodes),this._bindings=new HW(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new EW(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new KW(this.lighting),this._bundles=new eY,this._renderContexts=new rq,this._animation.start(),this._initialized=!0,t()}))),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,n=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,s=this._currentRenderContext,o=this._currentRenderObjectFunction,a=this._compilationPromises,l=!0===t.isScene?t:mY;null===n&&(n=t);const u=this._renderTarget,h=this._renderContexts.get(n,e,u),c=this._activeMipmapLevel,d=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,r.renderId++,r.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new JX),h.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,u);const p=this._renderLists.get(t,e);if(p.begin(),this._projectObject(t,e,0,p,h.clippingContext),n!==t&&n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&p.pushLight(t)})),p.finish(),null!==u){this._textures.updateRenderTarget(u,c);const t=this._textures.get(u);h.textures=t.textures,h.depthTexture=t.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(l,p,h);const f=p.opaque,m=p.transparent,g=p.transparentDoublePass,y=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,e,l,y),!0===this.transparent&&m.length>0&&this._renderTransparents(m,g,e,l,y),r.renderId=i,this._currentRenderContext=s,this._currentRenderObjectFunction=o,this._compilationPromises=a,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(t,e){!1===this._initialized&&await this.init(),this._renderScene(t,e)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:\n\nMessage: ${t.message}`;t.reason&&(e+=`\nReason: ${t.reason}`),console.error(e),this._isDeviceLost=!0}_renderBundle(t,e,n){const{bundleGroup:r,camera:i,renderList:s}=t,o=this._currentRenderContext,a=this._bundles.get(r,i),l=this.backend.get(a);void 0===l.renderContexts&&(l.renderContexts=new Set);const u=r.version!==l.version,h=!1===l.renderContexts.has(o)||u;if(l.renderContexts.add(o),h){this.backend.beginBundle(o),(void 0===l.renderObjects||u)&&(l.renderObjects=[]),this._currentRenderBundle=a;const t=s.opaque;!0===this.opaque&&t.length>0&&this._renderObjects(t,i,e,n),this._currentRenderBundle=null,this.backend.finishBundle(o,a),l.version=r.version}else{const{renderObjects:t}=l;for(let e=0,n=t.length;e<n;e++){const n=t[e];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,a)}render(t,e){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(t,e);this._renderScene(t,e)}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this;if(!1===(0!==t)&&!1===(e!==uM))return null;const{width:n,height:r}=this.getDrawingBufferSize(gY),{depth:i,stencil:s}=this;let o=this._frameBufferTarget;return null===o&&(o=new oS(n,r,{depthBuffer:i,stencilBuffer:s,type:this._colorBufferType,format:_w,colorSpace:uM,generateMipmaps:!1,minFilter:nw,magFilter:nw,samples:this.samples}),o.isPostProcessingRenderTarget=!0,this._frameBufferTarget=o),o.depthBuffer=i,o.stencilBuffer=s,o.setSize(n,r),o.viewport.copy(this._viewport),o.scissor.copy(this._scissor),o.viewport.multiplyScalar(this._pixelRatio),o.scissor.multiplyScalar(this._pixelRatio),o.scissorTest=this._scissorTest,o}_renderScene(t,e,n=!0){if(!0===this._isDeviceLost)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=!0===t.isScene?t:mY,u=this._renderTarget,h=this._activeCubeFace,c=this._activeMipmapLevel;let d;null!==r?(d=r,this.setRenderTarget(d)):d=u;const p=this._renderContexts.get(t,e,d);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls;const f=this.coordinateSystem,m=this.xr;if(e.coordinateSystem!==f&&!1===m.isPresenting&&(e.coordinateSystem=f,e.updateProjectionMatrix(),e.isArrayCamera))for(const t of e.cameras)t.coordinateSystem=f,t.updateProjectionMatrix();!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===m.enabled&&!0===m.isPresenting&&(!0===m.cameraAutoUpdate&&m.updateCamera(e),e=m.getCamera());let g=this._viewport,y=this._scissor,v=this._pixelRatio;null!==d&&(g=d.viewport,y=d.scissor,v=1),this.getDrawingBufferSize(gY),yY.set(0,0,gY.width,gY.height);const _=void 0===g.minDepth?0:g.minDepth,b=void 0===g.maxDepth?1:g.maxDepth;p.viewportValue.copy(g).multiplyScalar(v).floor(),p.viewportValue.width>>=c,p.viewportValue.height>>=c,p.viewportValue.minDepth=_,p.viewportValue.maxDepth=b,p.viewport=!1===p.viewportValue.equals(yY),p.scissorValue.copy(y).multiplyScalar(v).floor(),p.scissor=this._scissorTest&&!1===p.scissorValue.equals(yY),p.scissorValue.width>>=c,p.scissorValue.height>>=c,p.clippingContext||(p.clippingContext=new JX),p.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,d),_Y.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),vY.setFromProjectionMatrix(_Y,f);const x=this._renderLists.get(t,e);if(x.begin(),this._projectObject(t,e,0,x,p.clippingContext),x.finish(),!0===this.sortObjects&&x.sort(this._opaqueSort,this._transparentSort),null!==d){this._textures.updateRenderTarget(d,c);const t=this._textures.get(d);p.textures=t.textures,p.depthTexture=t.depthTexture,p.width=t.width,p.height=t.height,p.renderTarget=d,p.depth=d.depthBuffer,p.stencil=d.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=c,p.height>>=c,p.activeCubeFace=h,p.activeMipmapLevel=c,p.occlusionQueryCount=x.occlusionQueryCount,this._background.update(l,x,p),this.backend.beginRender(p);const{bundles:w,lightsNode:M,transparentDoublePass:S,transparent:T,opaque:E}=x;if(w.length>0&&this._renderBundles(w,l,M),!0===this.opaque&&E.length>0&&this._renderObjects(E,e,l,M),!0===this.transparent&&T.length>0&&this._renderTransparents(T,S,e,l,M),this.backend.finishRender(p),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,null!==r){this.setRenderTarget(u,h,c);const t=this._quad;this._nodes.hasOutputChange(d.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(d.texture),t.material.needsUpdate=!0),this._renderScene(t,t.camera,!1)}return l.onAfterRender(this,t,e,d),p}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(t)}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,n){this._width=t,this._height=e,this._pixelRatio=n,this.domElement.width=Math.floor(t*n),this.domElement.height=Math.floor(e*n),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setSize(t,e,n=!0){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!0===n&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,n,r){const i=this._scissor;t.isVector4?i.copy(t):i.set(t,e,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t,this.backend.setScissorTest(t)}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,n,r,i=0,s=1){const o=this._viewport;t.isVector4?o.copy(t):o.set(t,e,n,r),o.minDepth=i,o.maxDepth=s}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,n=!0){if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(t,e,n);const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==r){this._textures.updateRenderTarget(r);const t=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=t.textures,i.depthTexture=t.depthTexture,i.width=t.width,i.height=t.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer}if(i.clearColorValue=this._clearColor,this.backend.clear(t,e,n,i),null!==r&&null===this._renderTarget){const t=this._quad;this._nodes.hasOutputChange(r.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(r.texture),t.material.needsUpdate=!0),this._renderScene(t,t.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,n=!0){!1===this._initialized&&await this.init(),this.clear(t,e,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return null!==this._renderTarget?0:this.toneMapping}get currentColorSpace(){return null!==this._renderTarget?uM:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach((t=>{null!==t&&t.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,n=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t);const e=this._nodes.nodeFrame,n=e.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,e.renderId=this.info.calls;const r=this.backend,i=this._pipelines,s=this._bindings,o=this._nodes,a=Array.isArray(t)?t:[t];if(void 0===a[0]||!0!==a[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(t);for(const e of a){if(!1===i.has(e)){const t=()=>{e.removeEventListener("dispose",t),i.delete(e),s.delete(e),o.delete(e)};e.addEventListener("dispose",t);const n=e.onInitFunction;null!==n&&n.call(e,{renderer:this})}o.updateForCompute(e),s.updateForCompute(e);const n=s.getForCompute(e),a=i.getForCompute(e,n);r.compute(t,e,n,a)}r.finishCompute(t),e.renderId=n}async computeAsync(t){!1===this._initialized&&await this.init(),this.compute(t)}async hasFeatureAsync(t){return!1===this._initialized&&await this.init(),this.backend.hasFeature(t)}async resolveTimestampsAsync(t="render"){return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(t)}hasFeature(t){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(t)}hasInitialized(){return this._initialized}async initTextureAsync(t){!1===this._initialized&&await this.init(),this._textures.updateTexture(t)}initTexture(t){!1===this._initialized&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(t)}copyFramebufferToTexture(t,e=null){if(null!==e)if(e.isVector2)e=bY.set(e.x,e.y,t.image.width,t.image.height).floor();else{if(!e.isVector4)return void console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");e=bY.copy(e).floor()}else e=bY.set(0,0,t.image.width,t.image.height);let n,r=this._currentRenderContext;null!==r?n=r.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),r=this._textures.get(n))),this._textures.updateTexture(t,{renderTarget:n}),this.backend.copyFramebufferToTexture(t,r,e)}copyTextureToTexture(t,e,n=null,r=null,i=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,n,r,i)}async readRenderTargetPixelsAsync(t,e,n,r,i,s=0,o=0){return this.backend.copyTextureToBuffer(t.textures[s],e,n,r,i,o)}_projectObject(t,e,n,r,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder,t.isClippingGroup&&t.enabled&&(i=i.getGroupContext(t));else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)r.pushLight(t);else if(t.isSprite){if(!t.frustumCulled||vY.intersectsSprite(t)){!0===this.sortObjects&&bY.setFromMatrixPosition(t.matrixWorld).applyMatrix4(_Y);const{geometry:e,material:s}=t;s.visible&&r.push(t,e,s,n,bY.z,null,i)}}else if(t.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||vY.intersectsObject(t))){const{geometry:e,material:s}=t;if(!0===this.sortObjects&&(null===e.boundingSphere&&e.computeBoundingSphere(),bY.copy(e.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(_Y)),Array.isArray(s)){const o=e.groups;for(let a=0,l=o.length;a<l;a++){const l=o[a],u=s[l.materialIndex];u&&u.visible&&r.push(t,e,u,n,bY.z,l,i)}}else s.visible&&r.push(t,e,s,n,bY.z,null,i)}if(!0===t.isBundleGroup&&void 0!==this.backend.beginBundle){const n=r;(r=this._renderLists.get(t,e)).begin(),n.pushBundle({bundleGroup:t,camera:e,renderList:r}),r.finish()}const s=t.children;for(let t=0,o=s.length;t<o;t++)this._projectObject(s[t],e,n,r,i)}_renderBundles(t,e,n){for(const r of t)this._renderBundle(r,e,n)}_renderTransparents(t,e,n,r,i){if(e.length>0){for(const{material:t}of e)t.side=1;this._renderObjects(e,n,r,i,"backSide");for(const{material:t}of e)t.side=0;this._renderObjects(t,n,r,i);for(const{material:t}of e)t.side=2}else this._renderObjects(t,n,r,i)}_renderObjects(t,e,n,r,i=null){for(let s=0,o=t.length;s<o;s++){const{object:o,geometry:a,material:l,group:u,clippingContext:h}=t[s];this._currentRenderObjectFunction(o,n,e,a,l,u,r,h,i)}}renderObject(t,e,n,r,i,s,o,a=null,l=null){let u,h,c;if(t.onBeforeRender(this,e,n,r,i,s),null!==e.overrideMaterial){const t=e.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(u=t.positionNode,t.positionNode=i.positionNode),t.alphaTest=i.alphaTest,t.alphaMap=i.alphaMap,t.transparent=i.transparent||i.transmission>0,t.isShadowPassMaterial&&(t.side=null===i.shadowSide?i.side:i.shadowSide,i.depthNode&&i.depthNode.isNode&&(c=t.depthNode,t.depthNode=i.depthNode),i.castShadowNode&&i.castShadowNode.isNode&&(h=t.colorNode,t.colorNode=i.castShadowNode)),i=t}!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,this._handleObjectFunction(t,i,e,n,o,s,a,"backSide"),i.side=0,this._handleObjectFunction(t,i,e,n,o,s,a,l),i.side=2):this._handleObjectFunction(t,i,e,n,o,s,a,l),void 0!==u&&(e.overrideMaterial.positionNode=u),void 0!==c&&(e.overrideMaterial.depthNode=c),void 0!==h&&(e.overrideMaterial.colorNode=h),t.onAfterRender(this,e,n,r,i,s)}_renderObjectDirect(t,e,n,r,i,s,o,a){const l=this._objects.get(t,e,n,r,i,this._currentRenderContext,o,a);l.drawRange=t.geometry.drawRange,l.group=s;const u=this._nodes.needsRefresh(l);if(u&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(l,this.info),u&&this._nodes.updateAfter(l)}_createObjectPipeline(t,e,n,r,i,s,o,a){const l=this._objects.get(t,e,n,r,i,this._currentRenderContext,o,a);l.drawRange=t.geometry.drawRange,l.group=s,this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.getForRender(l,this._compilationPromises),this._nodes.updateAfter(l)}get compile(){return this.compileAsync}}class wY{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}clone(){return Object.assign(new this.constructor,this)}}class MY extends wY{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e}get byteLength(){return(t=this._buffer.byteLength)+(kW-t%kW)%kW;var t}get buffer(){return this._buffer}update(){return!0}}class SY extends MY{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let TY=0;class EY extends SY{constructor(t,e){super("UniformBuffer_"+TY++,t?t.value:null),this.nodeUniform=t,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class AY extends SY{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(null===t){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){let t=0;for(let e=0,n=this.uniforms.length;e<n;e++){const n=this.uniforms[e],{boundary:r,itemSize:i}=n,s=t%kW;0!==s&&kW-s-r<0?t+=kW-s:s%r!=0&&(t+=s%r),n.offset=t/this.bytesPerElement,t+=i*this.bytesPerElement}return Math.ceil(t/kW)*kW}update(){let t=!1;for(const e of this.uniforms)!0===this.updateByType(e)&&(t=!0);return t}updateByType(t){return t.isNumberUniform?this.updateNumber(t):t.isVector2Uniform?this.updateVector2(t):t.isVector3Uniform?this.updateVector3(t):t.isVector4Uniform?this.updateVector4(t):t.isColorUniform?this.updateColor(t):t.isMatrix3Uniform?this.updateMatrix3(t):t.isMatrix4Uniform?this.updateMatrix4(t):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset,s=t.getType();if(n[i]!==r){this._getBufferForType(s)[i]=n[i]=r,e=!0}return e}updateVector2(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset,s=t.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){const t=this._getBufferForType(s);t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,e=!0}return e}updateVector3(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset,s=t.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const t=this._getBufferForType(s);t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,t[i+2]=n[i+2]=r.z,e=!0}return e}updateVector4(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset,s=t.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const t=this._getBufferForType(s);t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,t[i+2]=n[i+2]=r.z,t[i+3]=n[i+3]=r.w,e=!0}return e}updateColor(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const t=this.buffer;t[i+0]=n[i+0]=r.r,t[i+1]=n[i+1]=r.g,t[i+2]=n[i+2]=r.b,e=!0}return e}updateMatrix3(t){let e=!1;const n=this.values,r=t.getValue().elements,i=t.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const t=this.buffer;t[i+0]=n[i+0]=r[0],t[i+1]=n[i+1]=r[1],t[i+2]=n[i+2]=r[2],t[i+4]=n[i+4]=r[3],t[i+5]=n[i+5]=r[4],t[i+6]=n[i+6]=r[5],t[i+8]=n[i+8]=r[6],t[i+9]=n[i+9]=r[7],t[i+10]=n[i+10]=r[8],e=!0}return e}updateMatrix4(t){let e=!1;const n=this.values,r=t.getValue().elements,i=t.offset;if(!1===function(t,e,n){for(let r=0,i=e.length;r<i;r++)if(t[n+r]!==e[r])return!1;return!0}(n,r,i)){this.buffer.set(r,i),function(t,e,n){for(let r=0,i=e.length;r<i;r++)t[n+r]=e[r]}(n,r,i),e=!0}return e}_getBufferForType(t){return"int"===t||"ivec2"===t||"ivec3"===t||"ivec4"===t?new Int32Array(this.buffer.buffer):"uint"===t||"uvec2"===t||"uvec3"===t||"uvec4"===t?new Uint32Array(this.buffer.buffer):this.buffer}}let CY=0;class RY extends AY{constructor(t,e){super(t),this.id=CY++,this.groupNode=e,this.isNodeUniformsGroup=!0}}let NY=0;class PY extends wY{constructor(t,e){super(t),this.id=NY++,this.texture=e,this.version=e?e.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(t){const{texture:e}=this;return t!==this.generation?(this.generation=t,!0):e.isVideoTexture}update(){const{texture:t,version:e}=this;return e!==t.version&&(this.version=t.version,!0)}}class kY extends PY{constructor(t,e,n,r=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n,this.access=r}needsBindingsUpdate(t){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(t)}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class OY extends kY{constructor(t,e,n,r=null){super(t,e,n,r),this.isSampledCubeTexture=!0}}class IY extends kY{constructor(t,e,n,r=null){super(t,e,n,r),this.isSampledTexture3D=!0}}const DY={textureDimensions:"textureSize",equals:"equal"},LY={low:"lowp",medium:"mediump",high:"highp"},UY={swizzleAssign:!0,storageBuffer:!1},FY="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\n";class zY extends AX{constructor(t,e){super(t,e,new qX),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(t){return!0===t.isVideoTexture&&t.colorSpace!==aM}getMethod(t){return DY[t]||t}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),r=[];for(const t of e.inputs)r.push(this.getType(t.type)+" "+t.name);return`${this.getType(e.type)} ${e.name}( ${r.join(", ")} ) {\n\n\t${n.vars}\n\n${n.code}\n\treturn ${n.result};\n\n}`}setupPBO(t){const e=t.value;if(void 0===e.pbo){const t=e.array,n=e.count*e.itemSize,{itemSize:r}=e,i=e.array.constructor.name.toLowerCase().includes("int");let s=i?Tw:Sw;2===r?s=i?Aw:Ew:3===r?s=i?1032:vw:4===r&&(s=i?Cw:_w);const o={Float32Array:cw,Uint8Array:sw,Uint16Array:lw,Uint32Array:hw,Int8Array:ow,Int16Array:aw,Int32Array:uw,Uint8ClampedArray:sw},a=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r))));let l=Math.ceil(n/r/a);a*l*r<n&&l++;const u=a*l*r,h=new t.constructor(u);h.set(t,0),e.array=h;const c=new BE(e.array,a,l,s,o[e.array.constructor.name]||cw);c.needsUpdate=!0,c.isPBOTexture=!0;const d=new fB(c,null,null);d.setPrecision("high"),e.pboNode=d,e.pbo=d.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&!0!==t.node.isTextureNode&&!0!==t.node.isBufferNode?e.charAt(0)+"_"+t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:n}=t,r=e.value;if(this.renderer.backend.has(r)){this.renderer.backend.get(r).pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),s=this.getPropertyName(i);this.increaseUsage(n);const o=n.build(this,"uint"),a=this.getDataFromNode(t);let l=a.propertyName;if(void 0===l){const n=this.getVarFromNode(t);l=this.getPropertyName(n);const i=this.getDataFromNode(e);let u=i.propertySizeName;void 0===u&&(u=l+"Size",this.getVarFromNode(e,u,"uint"),this.addLineFlowCode(`${u} = uint( textureSize( ${s}, 0 ).x )`,t),i.propertySizeName=u);const{itemSize:h}=r,c="."+JD.join("").slice(0,h),d=`ivec2(${o} % ${u}, ${o} / ${u})`,p=this.generateTextureLoad(null,s,d,null,"0");let f="vec4";r.pbo.type===hw?f="uvec4":r.pbo.type===uw&&(f="ivec4"),this.addLineFlowCode(`${l} = ${f}(${p})${c}`,t),a.propertyName=l}return l}generateTextureLoad(t,e,n,r,i="0"){return r?`texelFetch( ${e}, ivec3( ${n}, ${r} ), ${i} )`:`texelFetch( ${e}, ${n}, ${i} )`}generateTexture(t,e,n,r){return t.isDepthTexture?`texture( ${e}, ${n} ).x`:(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${e}, ${n} )`)}generateTextureLevel(t,e,n,r){return`textureLod( ${e}, ${n}, ${r} )`}generateTextureBias(t,e,n,r){return`texture( ${e}, ${n}, ${r} )`}generateTextureGrad(t,e,n,r){return`textureGrad( ${e}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`texture( ${e}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}getVars(t){const e=[],n=this.vars[t];if(void 0!==n)for(const t of n)e.push(`${this.getVar(t.type,t.name,t.count)};`);return e.join("\n\t")}getUniforms(t){const e=this.uniforms[t],n=[],r={};for(const i of e){let e=null,s=!1;if("texture"===i.type){const t=i.node.value;let n="";!0===t.isDataTexture&&(t.type===hw?n="u":t.type===uw&&(n="i")),e=t.compareFunction?`sampler2DShadow ${i.name};`:!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture?`${n}sampler2DArray ${i.name};`:`${n}sampler2D ${i.name};`}else if("cubeTexture"===i.type)e=`samplerCube ${i.name};`;else if("texture3D"===i.type)e=`sampler3D ${i.name};`;else if("buffer"===i.type){const t=i.node,n=this.getType(t.bufferType),r=t.bufferCount,s=r>0?r:"";e=`${t.name} {\n\t${n} ${i.name}[${s}];\n};\n`}else{e=`${this.getVectorType(i.type)} ${this.getPropertyName(i,t)};`,s=!0}const o=i.node.precision;if(null!==o&&(e=LY[o]+" "+e),s){e="\t"+e;const t=i.groupNode.name;(r[t]||(r[t]=[])).push(e)}else e="uniform "+e,n.push(e)}let i="";for(const e in r){const n=r[e];i+=this._getGLSLUniformStruct(t+"_"+e,n.join("\n"))+"\n"}return i+=n.join("\n"),i}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==uw){let n=t;t.isInterleavedBufferAttribute&&(n=t.data);const r=n.array;!1==(r instanceof Uint32Array||r instanceof Int32Array)&&(e=e.slice(1))}return e}getAttributes(t){let e="";if("vertex"===t||"compute"===t){const t=this.getAttributesArray();let n=0;for(const r of t)e+=`layout( location = ${n++} ) in ${r.type} ${r.name};\n`}return e}getStructMembers(t){const e=[];for(const n of t.members)e.push(`\t${n.type} ${n.name};`);return e.join("\n")}getStructs(t){const e=[],n=this.structs[t],r=[];for(const t of n)if(t.output)for(const e of t.members)r.push(`layout( location = ${e.index} ) out ${e.type} ${e.name};`);else{let n="struct "+t.name+" {\n";n+=this.getStructMembers(t),n+="\n};\n",e.push(n)}return 0===r.length&&r.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+r.join("\n")+"\n\n"+e.join("\n")}getVaryings(t){let e="";const n=this.varyings;if("vertex"===t||"compute"===t)for(const r of n){"compute"===t&&(r.needsInterpolation=!0);const n=this.getType(r.type);if(r.needsInterpolation){e+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""} out ${n} ${r.name};\n`}else e+=`${n} ${r.name};\n`}else if("fragment"===t)for(const t of n)if(t.needsInterpolation){const n=this.getType(t.type);e+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""}in ${n} ${t.name};\n`}for(const n of this.builtins[t])e+=`${n};\n`;return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce(((t,e)=>t*e),1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(t)&&r.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if("vertex"===t){const e=this.renderer.backend.extensions;this.object.isBatchedMesh&&e.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const n=this.extensions[t];if(void 0!==n)for(const{name:t,behavior:r}of n.values())e.push(`#extension ${t} : ${r}`);return e.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(t){let e=UY[t];if(void 0===e){let n;switch(e=!1,t){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){const t=this.renderer.backend.extensions;t.has(n)&&(t.get(n),e=!0)}UY[t]=e}return e}isFlipY(){return!0}enableHardwareClipping(t){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${t} ]`)}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let n=0;n<t.length;n++){const r=t[n],i=this.getPropertyName(r.attributeNode);e+=`${r.varyingName} = ${i};\n\t`}return e}_getGLSLUniformStruct(t,e){return`\nlayout( std140 ) uniform ${t} {\n${e}\n};`}_getGLSLVertexCode(t){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions \n${t.extensions}\n\n// precision\n${FY}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\n\n// attributes\n${t.attributes}\n\n// codes\n${t.codes}\n\nvoid main() {\n\n\t// vars\n\t${t.vars}\n\n\t// transforms\n\t${t.transforms}\n\n\t// flow\n\t${t.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(t){return`#version 300 es\n\n${this.getSignature()}\n\n// precision\n${FY}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\n\n// codes\n${t.codes}\n\n// structs\n${t.structs}\n\nvoid main() {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}buildCode(){const t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let n="// code\n\n";n+=this.flowCode[e];const r=this.flowNodes[e],i=r[r.length-1];for(const t of r){const r=this.getFlowData(t),s=t.name;s&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${s}\n\t`),n+=`${r.code}\n\t`,t===i&&"compute"!==e&&(n+="// result\n\t","vertex"===e?(n+="gl_Position = ",n+=`${r.result};`):"fragment"===e&&(t.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${r.result};`)))}const s=t[e];s.extensions=this.getExtensions(e),s.uniforms=this.getUniforms(e),s.attributes=this.getAttributes(e),s.varyings=this.getVaryings(e),s.vars=this.getVars(e),s.structs=this.getStructs(e),s.codes=this.getCodes(e),s.transforms=this.getTransforms(e),s.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,n,r=null){const i=super.getUniformFromNode(t,e,n,r),s=this.getDataFromNode(t,n,this.globalCache);let o=s.uniformGPU;if(void 0===o){const r=t.groupNode,a=r.name,l=this.getBindGroupArray(a,n);if("texture"===e)o=new kY(i.name,i.node,r),l.push(o);else if("cubeTexture"===e)o=new OY(i.name,i.node,r),l.push(o);else if("texture3D"===e)o=new IY(i.name,i.node,r),l.push(o);else if("buffer"===e){t.name=`NodeBuffer_${t.id}`,i.name=`buffer${t.id}`;const e=new EY(t,r);e.name=t.name,l.push(e),o=e}else{const t=this.uniformGroups[n]||(this.uniformGroups[n]={});let s=t[a];void 0===s&&(s=new RY(n+"_"+a,r),t[a]=s,l.push(s)),o=this.getNodeUniform(i,e),s.addUniform(o)}s.uniformGPU=o}return i}}let BY=null,jY=null;class VY{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null}}async init(t){this.renderer=t}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(t="render"){if(!this.trackTimestamp)return void WM("WebGPURenderer: Timestamp tracking is disabled.");const e=this.timestampQueryPool[t];if(!e)return void WM(`WebGPURenderer: No timestamp query pool for type '${t}' found.`);const n=await e.resolveQueriesAsync();return this.renderer.info[t].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return BY=BY||new FM,this.renderer.getDrawingBufferSize(BY)}setScissorTest(){}getClearColor(){const t=this.renderer;return jY=jY||new oq,t.getClearColor(jY),jY.getRGB(jY,this.renderer.currentColorSpace),jY}getDomElement(){let t=this.domElement;return null===t&&(t=void 0!==this.parameters.canvas?this.parameters.canvas:GM(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${lx} webgpu`),this.domElement=t),t}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}dispose(){}}let GY,HY,WY=0;class qY{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class $Y{constructor(t){this.backend=t}createAttribute(t,e){const n=this.backend,{gl:r}=n,i=t.array,s=t.usage||r.STATIC_DRAW,o=t.isInterleavedBufferAttribute?t.data:t,a=n.get(o);let l,u=a.bufferGPU;if(void 0===u&&(u=this._createBuffer(r,e,i,s),a.bufferGPU=u,a.bufferType=e,a.version=o.version),i instanceof Float32Array)l=r.FLOAT;else if(i instanceof Uint16Array)l=t.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=r.SHORT;else if(i instanceof Uint32Array)l=r.UNSIGNED_INT;else if(i instanceof Int32Array)l=r.INT;else if(i instanceof Int8Array)l=r.BYTE;else if(i instanceof Uint8Array)l=r.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);l=r.UNSIGNED_BYTE}let h={bufferGPU:u,bufferType:e,type:l,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:l===r.INT||l===r.UNSIGNED_INT||t.gpuType===uw,id:WY++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const t=this._createBuffer(r,e,i,s);h=new qY(h,t)}n.set(t,h)}updateAttribute(t){const e=this.backend,{gl:n}=e,r=t.array,i=t.isInterleavedBufferAttribute?t.data:t,s=e.get(i),o=s.bufferType,a=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(n.bindBuffer(o,s.bufferGPU),0===a.length)n.bufferSubData(o,0,r);else{for(let t=0,e=a.length;t<e;t++){const e=a[t];n.bufferSubData(o,e.start*r.BYTES_PER_ELEMENT,r,e.start,e.count)}i.clearUpdateRanges()}n.bindBuffer(o,null),s.version=i.version}destroyAttribute(t){const e=this.backend,{gl:n}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const r=e.get(t);n.deleteBuffer(r.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:n}=e,r=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:i}=e.get(r),s=t.array,o=s.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const a=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await e.utils._clientWaitAsync();const l=new t.array.constructor(s.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.deleteBuffer(a),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(t,e,n,r){const i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,r),t.bindBuffer(e,null),i}}class XY{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const t=this.gl;GY={[_x]:t.FUNC_ADD,[bx]:t.FUNC_SUBTRACT,[xx]:t.FUNC_REVERSE_SUBTRACT},HY={[wx]:t.ZERO,[Mx]:t.ONE,[Sx]:t.SRC_COLOR,[Ex]:t.SRC_ALPHA,[kx]:t.SRC_ALPHA_SATURATE,[Nx]:t.DST_COLOR,[Cx]:t.DST_ALPHA,[Tx]:t.ONE_MINUS_SRC_COLOR,[Ax]:t.ONE_MINUS_SRC_ALPHA,[Px]:t.ONE_MINUS_DST_COLOR,[Rx]:t.ONE_MINUS_DST_ALPHA};const e=t.getParameter(t.SCISSOR_BOX),n=t.getParameter(t.VIEWPORT);this.currentScissor=(new sS).fromArray(e),this.currentViewport=(new sS).fromArray(n),this._tempVec4=new sS}enable(t){const{enabled:e}=this;!0!==e[t]&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;!1!==e[t]&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;0!==t?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:n}=this;t!==e&&(n.lineWidth(t),this.currentLineWidth=t)}setBlending(t,e,n,r,i,s,o,a){const{gl:l}=this;if(0!==t){if(!1===this.currentBlendingEnabled&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),5===t)i=i||e,s=s||n,o=o||r,e===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(l.blendEquationSeparate(GY[e],GY[i]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=i),n===this.currentBlendSrc&&r===this.currentBlendDst&&s===this.currentBlendSrcAlpha&&o===this.currentBlendDstAlpha||(l.blendFuncSeparate(HY[n],HY[r],HY[s],HY[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=s,this.currentBlendDstAlpha=o),this.currentBlending=t,this.currentPremultipledAlpha=!1;else if(t!==this.currentBlending||a!==this.currentPremultipledAlpha){if(this.currentBlendEquation===_x&&this.currentBlendEquationAlpha===_x||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=_x,this.currentBlendEquationAlpha=_x),a)switch(t){case 1:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.ONE,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=a}}else!0===this.currentBlendingEnabled&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1)}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}this.currentDepthFunc=t}}scissor(t,e,n,r){const i=this._tempVec4.set(t,e,n,r);if(!1===this.currentScissor.equals(i)){const{gl:t}=this;t.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(t,e,n,r){const i=this._tempVec4.set(t,e,n,r);if(!1===this.currentViewport.equals(i)){const{gl:t}=this;t.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(t){const e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,n){this.currentStencilFunc===t&&this.currentStencilRef===e&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(t,e,n),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=n)}setStencilOp(t,e,n){this.currentStencilFail===t&&this.currentStencilZFail===e&&this.currentStencilZPass===n||(this.gl.stencilOp(t,e,n),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=n)}setMaterial(t,e,n){const{gl:r}=this;2===t.side?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=1===t.side;e&&(i=!i),this.setFlipSided(i),1===t.blending&&!1===t.transparent?this.setBlending(0):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const s=t.stencilWrite;if(this.setStencilTest(s),s&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){const t=12288;for(let e=0;e<8;e++)e<n?this.enable(t+e):this.disable(t+e)}}setPolygonOffset(t,e,n){const{gl:r}=this;t?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===e&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t&&(this.gl.useProgram(t),this.currentProgram=t,!0)}bindFramebuffer(t,e){const{gl:n,currentBoundFramebuffers:r}=this;return r[t]!==e&&(n.bindFramebuffer(t,e),r[t]=e,t===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=e),t===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=e),!0)}drawBuffers(t,e){const{gl:n}=this;let r=[],i=!1;if(null!==t.textures){r=this.currentDrawbuffers.get(e),void 0===r&&(r=[],this.currentDrawbuffers.set(e,r));const s=t.textures;if(r.length!==s.length||r[0]!==n.COLOR_ATTACHMENT0){for(let t=0,e=s.length;t<e;t++)r[t]=n.COLOR_ATTACHMENT0+t;r.length=s.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(t){const{gl:e,currentTextureSlot:n,maxTextures:r}=this;void 0===t&&(t=e.TEXTURE0+r-1),n!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:s,maxTextures:o}=this;void 0===n&&(n=null===i?r.TEXTURE0+o-1:i);let a=s[n];void 0===a&&(a={type:void 0,texture:void 0},s[n]=a),a.type===t&&a.texture===e||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(t,e),a.type=t,a.texture=e)}bindBufferBase(t,e,n){const{gl:r}=this,i=`${t}-${e}`;return this.currentBoundBufferBases[i]!==n&&(r.bindBufferBase(t,e,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:n}=this,r=n[e];void 0!==r&&void 0!==r.type&&(t.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class YY{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=""){const{gl:n,extensions:r}=this;let i;if(t===sw)return n.UNSIGNED_BYTE;if(t===pw)return n.UNSIGNED_SHORT_4_4_4_4;if(t===fw)return n.UNSIGNED_SHORT_5_5_5_1;if(t===gw)return n.UNSIGNED_INT_5_9_9_9_REV;if(t===ow)return n.BYTE;if(t===aw)return n.SHORT;if(t===lw)return n.UNSIGNED_SHORT;if(t===uw)return n.INT;if(t===hw)return n.UNSIGNED_INT;if(t===cw)return n.FLOAT;if(t===dw)return n.HALF_FLOAT;if(t===yw)return n.ALPHA;if(t===vw)return n.RGB;if(t===_w)return n.RGBA;if(t===bw)return n.LUMINANCE;if(t===xw)return n.LUMINANCE_ALPHA;if(t===ww)return n.DEPTH_COMPONENT;if(t===Mw)return n.DEPTH_STENCIL;if(t===Sw)return n.RED;if(t===Tw)return n.RED_INTEGER;if(t===Ew)return n.RG;if(t===Aw)return n.RG_INTEGER;if(t===Cw)return n.RGBA_INTEGER;if(t===Rw||t===Nw||t===Pw||t===kw)if(e===lM){if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(t===Rw)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Nw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Pw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===kw)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===Rw)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Nw)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Pw)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===kw)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Ow||t===Iw||t===Dw||t===Lw){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===Ow)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Iw)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Dw)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Lw)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Uw||t===Fw||t===zw){if(i=r.get("WEBGL_compressed_texture_etc"),null===i)return null;if(t===Uw||t===Fw)return e===lM?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(t===zw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(t===Bw||t===jw||t===Vw||t===Gw||t===Hw||t===Ww||t===qw||t===$w||t===Xw||t===Yw||t===Kw||t===Zw||t===Jw||t===Qw){if(i=r.get("WEBGL_compressed_texture_astc"),null===i)return null;if(t===Bw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===jw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===Vw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===Gw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===Hw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===Ww)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===qw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===$w)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===Xw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Yw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===Kw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===Zw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Jw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===Qw)return e===lM?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===tM){if(i=r.get("EXT_texture_compression_bptc"),null===i)return null;if(t===tM)return e===lM?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(t===rM||t===iM||t===sM||t===oM){if(i=r.get("EXT_texture_compression_rgtc"),null===i)return null;if(t===tM)return i.COMPRESSED_RED_RGTC1_EXT;if(t===iM)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===sM)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===oM)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===mw?n.UNSIGNED_INT_24_8:void 0!==n[t]?n[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise(((n,r)=>{!function i(){const s=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(s===t.WAIT_FAILED)return t.deleteSync(e),void r();s!==t.TIMEOUT_EXPIRED?(t.deleteSync(e),n()):requestAnimationFrame(i)}()}))}}let KY,ZY,JY,QY=!1;class tK{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},!1===QY&&(this._init(),QY=!0)}_init(){const t=this.gl;KY={[Kx]:t.REPEAT,[Zx]:t.CLAMP_TO_EDGE,[Jx]:t.MIRRORED_REPEAT},ZY={[Qx]:t.NEAREST,[tw]:t.NEAREST_MIPMAP_NEAREST,[ew]:t.NEAREST_MIPMAP_LINEAR,[nw]:t.LINEAR,[rw]:t.LINEAR_MIPMAP_NEAREST,[iw]:t.LINEAR_MIPMAP_LINEAR},JY={[pM]:t.NEVER,[bM]:t.ALWAYS,[fM]:t.LESS,[gM]:t.LEQUAL,[mM]:t.EQUAL,[_M]:t.GEQUAL,[yM]:t.GREATER,[vM]:t.NOTEQUAL}}getGLTextureType(t){const{gl:e}=this;let n;return n=!0===t.isCubeTexture?e.TEXTURE_CUBE_MAP:!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:!0===t.isData3DTexture?e.TEXTURE_3D:e.TEXTURE_2D,n}getInternalFormat(t,e,n,r,i=!1){const{gl:s,extensions:o}=this;if(null!==t){if(void 0!==s[t])return s[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let a=e;return e===s.RED&&(n===s.FLOAT&&(a=s.R32F),n===s.HALF_FLOAT&&(a=s.R16F),n===s.UNSIGNED_BYTE&&(a=s.R8),n===s.UNSIGNED_SHORT&&(a=s.R16),n===s.UNSIGNED_INT&&(a=s.R32UI),n===s.BYTE&&(a=s.R8I),n===s.SHORT&&(a=s.R16I),n===s.INT&&(a=s.R32I)),e===s.RED_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.R8UI),n===s.UNSIGNED_SHORT&&(a=s.R16UI),n===s.UNSIGNED_INT&&(a=s.R32UI),n===s.BYTE&&(a=s.R8I),n===s.SHORT&&(a=s.R16I),n===s.INT&&(a=s.R32I)),e===s.RG&&(n===s.FLOAT&&(a=s.RG32F),n===s.HALF_FLOAT&&(a=s.RG16F),n===s.UNSIGNED_BYTE&&(a=s.RG8),n===s.UNSIGNED_SHORT&&(a=s.RG16),n===s.UNSIGNED_INT&&(a=s.RG32UI),n===s.BYTE&&(a=s.RG8I),n===s.SHORT&&(a=s.RG16I),n===s.INT&&(a=s.RG32I)),e===s.RG_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RG8UI),n===s.UNSIGNED_SHORT&&(a=s.RG16UI),n===s.UNSIGNED_INT&&(a=s.RG32UI),n===s.BYTE&&(a=s.RG8I),n===s.SHORT&&(a=s.RG16I),n===s.INT&&(a=s.RG32I)),e===s.RGB&&(n===s.FLOAT&&(a=s.RGB32F),n===s.HALF_FLOAT&&(a=s.RGB16F),n===s.UNSIGNED_BYTE&&(a=s.RGB8),n===s.UNSIGNED_SHORT&&(a=s.RGB16),n===s.UNSIGNED_INT&&(a=s.RGB32UI),n===s.BYTE&&(a=s.RGB8I),n===s.SHORT&&(a=s.RGB16I),n===s.INT&&(a=s.RGB32I),n===s.UNSIGNED_BYTE&&(a=r===lM&&!1===i?s.SRGB8:s.RGB8),n===s.UNSIGNED_SHORT_5_6_5&&(a=s.RGB565),n===s.UNSIGNED_SHORT_5_5_5_1&&(a=s.RGB5_A1),n===s.UNSIGNED_SHORT_4_4_4_4&&(a=s.RGB4),n===s.UNSIGNED_INT_5_9_9_9_REV&&(a=s.RGB9_E5)),e===s.RGB_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RGB8UI),n===s.UNSIGNED_SHORT&&(a=s.RGB16UI),n===s.UNSIGNED_INT&&(a=s.RGB32UI),n===s.BYTE&&(a=s.RGB8I),n===s.SHORT&&(a=s.RGB16I),n===s.INT&&(a=s.RGB32I)),e===s.RGBA&&(n===s.FLOAT&&(a=s.RGBA32F),n===s.HALF_FLOAT&&(a=s.RGBA16F),n===s.UNSIGNED_BYTE&&(a=s.RGBA8),n===s.UNSIGNED_SHORT&&(a=s.RGBA16),n===s.UNSIGNED_INT&&(a=s.RGBA32UI),n===s.BYTE&&(a=s.RGBA8I),n===s.SHORT&&(a=s.RGBA16I),n===s.INT&&(a=s.RGBA32I),n===s.UNSIGNED_BYTE&&(a=r===lM&&!1===i?s.SRGB8_ALPHA8:s.RGBA8),n===s.UNSIGNED_SHORT_4_4_4_4&&(a=s.RGBA4),n===s.UNSIGNED_SHORT_5_5_5_1&&(a=s.RGB5_A1)),e===s.RGBA_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RGBA8UI),n===s.UNSIGNED_SHORT&&(a=s.RGBA16UI),n===s.UNSIGNED_INT&&(a=s.RGBA32UI),n===s.BYTE&&(a=s.RGBA8I),n===s.SHORT&&(a=s.RGBA16I),n===s.INT&&(a=s.RGBA32I)),e===s.DEPTH_COMPONENT&&(n===s.UNSIGNED_SHORT&&(a=s.DEPTH_COMPONENT16),n===s.UNSIGNED_INT&&(a=s.DEPTH_COMPONENT24),n===s.FLOAT&&(a=s.DEPTH_COMPONENT32F)),e===s.DEPTH_STENCIL&&n===s.UNSIGNED_INT_24_8&&(a=s.DEPTH24_STENCIL8),a!==s.R16F&&a!==s.R32F&&a!==s.RG16F&&a!==s.RG32F&&a!==s.RGBA16F&&a!==s.RGBA32F||o.get("EXT_color_buffer_float"),a}setTextureParameters(t,e){const{gl:n,extensions:r,backend:i}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,e.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(t,n.TEXTURE_WRAP_S,KY[e.wrapS]),n.texParameteri(t,n.TEXTURE_WRAP_T,KY[e.wrapT]),t!==n.TEXTURE_3D&&t!==n.TEXTURE_2D_ARRAY||n.texParameteri(t,n.TEXTURE_WRAP_R,KY[e.wrapR]),n.texParameteri(t,n.TEXTURE_MAG_FILTER,ZY[e.magFilter]);const s=void 0!==e.mipmaps&&e.mipmaps.length>0,o=e.minFilter===nw&&s?iw:e.minFilter;if(n.texParameteri(t,n.TEXTURE_MIN_FILTER,ZY[o]),e.compareFunction&&(n.texParameteri(t,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(t,n.TEXTURE_COMPARE_FUNC,JY[e.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(e.magFilter===Qx)return;if(e.minFilter!==ew&&e.minFilter!==iw)return;if(e.type===cw&&!1===r.has("OES_texture_float_linear"))return;if(e.anisotropy>1){const s=r.get("EXT_texture_filter_anisotropic");n.texParameterf(t,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(t);let s=r[i];void 0===s&&(s=e.createTexture(),n.state.bindTexture(i,s),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST),r[i]=s),n.set(t,{textureGPU:s,glTextureType:i,isDefault:!0})}createTexture(t,e){const{gl:n,backend:r}=this,{levels:i,width:s,height:o,depth:a}=e,l=r.utils.convert(t.format,t.colorSpace),u=r.utils.convert(t.type),h=this.getInternalFormat(t.internalFormat,l,u,t.colorSpace,t.isVideoTexture),c=n.createTexture(),d=this.getGLTextureType(t);r.state.bindTexture(d,c),this.setTextureParameters(d,t),t.isDataArrayTexture||t.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,h,s,o,a):t.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,h,s,o,a):t.isVideoTexture||n.texStorage2D(d,i,h,s,o),r.set(t,{textureGPU:c,glTextureType:d,glFormat:l,glType:u,glInternalFormat:h})}copyBufferToTexture(t,e){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:s,glFormat:o,glType:a}=r.get(e),{width:l,height:u}=e.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,t),r.state.bindTexture(s,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(s,0,0,0,l,u,o,a,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(t,e){const{gl:n}=this,{width:r,height:i}=e,{textureGPU:s,glTextureType:o,glFormat:a,glType:l,glInternalFormat:u}=this.backend.get(t);if(t.isRenderTargetTexture||void 0===s)return;const h=t=>t.isDataTexture?t.image.data:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||t instanceof OffscreenCanvas?t:t.data;if(this.backend.state.bindTexture(o,s),this.setTextureParameters(o,t),t.isCompressedTexture){const r=t.mipmaps,i=e.image;for(let e=0;e<r.length;e++){const s=r[e];t.isCompressedArrayTexture?t.format!==n.RGBA?null!==a?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,e,0,0,0,s.width,s.height,i.depth,a,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,e,0,0,0,s.width,s.height,i.depth,a,l,s.data):null!==a?n.compressedTexSubImage2D(n.TEXTURE_2D,e,0,0,s.width,s.height,a,s.data):console.warn("Unsupported compressed texture format")}}else if(t.isCubeTexture){const t=e.images;for(let e=0;e<6;e++){const s=h(t[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,r,i,a,l,s)}}else if(t.isDataArrayTexture){const t=e.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,t.width,t.height,t.depth,a,l,t.data)}else if(t.isData3DTexture){const t=e.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,t.width,t.height,t.depth,a,l,t.data)}else if(t.isVideoTexture)t.update(),n.texImage2D(o,0,u,a,l,e.image);else{const t=h(e.image);n.texSubImage2D(o,0,0,0,r,i,a,l,t)}}generateMipmaps(t){const{gl:e,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(t);n.state.bindTexture(i,r),e.generateMipmap(i)}deallocateRenderBuffers(t){const{gl:e,backend:n}=this;if(t){const r=n.get(t);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const t in r.framebuffers)e.deleteFramebuffer(r.framebuffers[t]);delete r.framebuffers}if(r.depthRenderbuffer&&(e.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(e.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(e.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let t=0;t<r.msaaRenderbuffers.length;t++)e.deleteRenderbuffer(r.msaaRenderbuffers[t]);delete r.msaaRenderbuffers}}}destroyTexture(t){const{gl:e,backend:n}=this,{textureGPU:r,renderTarget:i}=n.get(t);this.deallocateRenderBuffers(i),e.deleteTexture(r),n.delete(t)}copyTextureToTexture(t,e,n=null,r=null,i=0){const{gl:s,backend:o}=this,{state:a}=this.backend,{textureGPU:l,glTextureType:u,glType:h,glFormat:c}=o.get(e);let d,p,f,m,g,y;null!==n?(d=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.min.x,m=n.min.y):(d=t.image.width,p=t.image.height,f=0,m=0),null!==r?(g=r.x,y=r.y):(g=0,y=0),a.bindTexture(u,l),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment);const v=s.getParameter(s.UNPACK_ROW_LENGTH),_=s.getParameter(s.UNPACK_IMAGE_HEIGHT),b=s.getParameter(s.UNPACK_SKIP_PIXELS),x=s.getParameter(s.UNPACK_SKIP_ROWS),w=s.getParameter(s.UNPACK_SKIP_IMAGES),M=t.isCompressedTexture?t.mipmaps[i]:t.image;if(s.pixelStorei(s.UNPACK_ROW_LENGTH,M.width),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,M.height),s.pixelStorei(s.UNPACK_SKIP_PIXELS,f),s.pixelStorei(s.UNPACK_SKIP_ROWS,m),t.isRenderTargetTexture||t.isDepthTexture){const n=o.get(t),r=o.get(e),i=o.get(n.renderTarget),l=o.get(r.renderTarget),u=i.framebuffers[n.cacheKey],h=l.framebuffers[r.cacheKey];a.bindFramebuffer(s.READ_FRAMEBUFFER,u),a.bindFramebuffer(s.DRAW_FRAMEBUFFER,h);let c=s.COLOR_BUFFER_BIT;t.isDepthTexture&&(c=s.DEPTH_BUFFER_BIT),s.blitFramebuffer(f,m,d,p,g,y,d,p,c,s.NEAREST),a.bindFramebuffer(s.READ_FRAMEBUFFER,null),a.bindFramebuffer(s.DRAW_FRAMEBUFFER,null)}else t.isDataTexture?s.texSubImage2D(s.TEXTURE_2D,i,g,y,d,p,c,h,M.data):t.isCompressedTexture?s.compressedTexSubImage2D(s.TEXTURE_2D,i,g,y,M.width,M.height,c,M.data):s.texSubImage2D(s.TEXTURE_2D,i,g,y,d,p,c,h,M);s.pixelStorei(s.UNPACK_ROW_LENGTH,v),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,_),s.pixelStorei(s.UNPACK_SKIP_PIXELS,b),s.pixelStorei(s.UNPACK_SKIP_ROWS,x),s.pixelStorei(s.UNPACK_SKIP_IMAGES,w),0===i&&e.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D),a.unbindTexture()}copyFramebufferToTexture(t,e,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:s}=this.backend.get(t),{x:o,y:a,z:l,w:u}=n,h=!0===t.isDepthTexture||e.renderTarget&&e.renderTarget.samples>0,c=e.renderTarget?e.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const n=0!==o||0!==a;let h,d;if(!0===t.isDepthTexture?(h=r.DEPTH_BUFFER_BIT,d=r.DEPTH_ATTACHMENT,e.stencil&&(h|=r.STENCIL_BUFFER_BIT)):(h=r.COLOR_BUFFER_BIT,d=r.COLOR_ATTACHMENT0),n){const t=this.backend.get(e.renderTarget),n=t.framebuffers[e.getCacheKey()],d=t.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,d);const p=c-a-u;r.blitFramebuffer(o,p,o+l,p+u,o,p,o+l,p+u,h,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,p,l,u),i.unbindTexture()}else{const t=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,t),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,d,r.TEXTURE_2D,s,0),r.blitFramebuffer(0,0,l,u,0,0,l,u,h,r.NEAREST),r.deleteFramebuffer(t)}}else i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,c-u-a,l,u),i.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e,n,r=!1){const{gl:i}=this,s=e.renderTarget,{depthTexture:o,depthBuffer:a,stencilBuffer:l,width:u,height:h}=s;if(i.bindRenderbuffer(i.RENDERBUFFER,t),a&&!l){let e=i.DEPTH_COMPONENT24;if(!0===r){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,s.samples,e,u,h)}else n>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(e=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,e,u,h)):i.renderbufferStorage(i.RENDERBUFFER,e,u,h);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t)}else a&&l&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,u,h):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,h),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t))}async copyTextureToBuffer(t,e,n,r,i,s){const{backend:o,gl:a}=this,{textureGPU:l,glFormat:u,glType:h}=this.backend.get(t),c=a.createFramebuffer();a.bindFramebuffer(a.READ_FRAMEBUFFER,c);const d=t.isCubeTexture?a.TEXTURE_CUBE_MAP_POSITIVE_X+s:a.TEXTURE_2D;a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,d,l,0);const p=this._getTypedArrayType(h),f=r*i*this._getBytesPerTexel(h,u),m=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.bufferData(a.PIXEL_PACK_BUFFER,f,a.STREAM_READ),a.readPixels(e,n,r,i,u,h,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,g),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteFramebuffer(c),g}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:n}=this;let r=0;return t===n.UNSIGNED_BYTE&&(r=1),t!==n.UNSIGNED_SHORT_4_4_4_4&&t!==n.UNSIGNED_SHORT_5_5_5_1&&t!==n.UNSIGNED_SHORT_5_6_5&&t!==n.UNSIGNED_SHORT&&t!==n.HALF_FLOAT||(r=2),t!==n.UNSIGNED_INT&&t!==n.FLOAT||(r=4),e===n.RGBA?4*r:e===n.RGB?3*r:e===n.ALPHA?r:void 0}}class eK{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return void 0===e&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class nK{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const rK={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class iK{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:n,mode:r,object:i,type:s,info:o,index:a}=this;0!==a?n.drawElements(r,e,s,t):n.drawArrays(r,t,e),o.update(i,e,r,1)}renderInstances(t,e,n){const{gl:r,mode:i,type:s,index:o,object:a,info:l}=this;0!==n&&(0!==o?r.drawElementsInstanced(i,e,s,t,n):r.drawArraysInstanced(i,t,e,n),l.update(a,e,i,n))}renderMultiDraw(t,e,n){const{extensions:r,mode:i,object:s,info:o}=this;if(0===n)return;const a=r.get("WEBGL_multi_draw");if(null===a)for(let r=0;r<n;r++)this.render(t[r],e[r]);else{0!==this.index?a.multiDrawElementsWEBGL(i,e,0,this.type,t,0,n):a.multiDrawArraysWEBGL(i,t,0,e,0,n);let r=0;for(let t=0;t<n;t++)r+=e[t];o.update(s,r,i,1)}}renderMultiDrawInstances(t,e,n,r){const{extensions:i,mode:s,object:o,info:a}=this;if(0===n)return;const l=i.get("WEBGL_multi_draw");if(null===l)for(let i=0;i<n;i++)this.renderInstances(t[i],e[i],r[i]);else{0!==this.index?l.multiDrawElementsInstancedWEBGL(s,e,0,this.type,t,0,r,0,n):l.multiDrawArraysInstancedWEBGL(s,t,0,e,0,r,0,n);let i=0;for(let t=0;t<n;t++)i+=e[t]*r[t];a.update(o,i,s,1)}}}class sK{constructor(t=256){this.trackTimestamp=!0,this.maxQueries=t,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class oK extends sK{constructor(t,e,n=2048){if(super(n),this.gl=t,this.type=e,this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query"),!this.ext)return console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),void(this.trackTimestamp=!1);this.queries=[];for(let e=0;e<this.maxQueries;e++)this.queries.push(t.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(t){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return WM(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(e,"inactive"),this.queryOffsets.set(t.id,e),e}beginQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t.id);if(null==e)return;if(null!==this.activeQuery)return;const n=this.queries[e];if(n)try{"inactive"===this.queryStates.get(e)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=e,this.queryStates.set(e,"started"))}catch(t){console.error("Error in beginQuery:",t),this.activeQuery=null,this.queryStates.set(e,"inactive")}}endQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t.id);if(null!=e&&this.activeQuery===e)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(e,"ended"),this.activeQuery=null}catch(t){console.error("Error in endQuery:",t),this.queryStates.set(e,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const t=[];for(const[e,n]of this.queryStates)if("ended"===n){const n=this.queries[e];t.push(this.resolveQuery(n))}if(0===t.length)return this.lastValue;const e=(await Promise.all(t)).reduce(((t,e)=>t+e),0);return this.lastValue=e,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,e}catch(t){return console.error("Error resolving queries:",t),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(t){return new Promise((e=>{if(this.isDisposed)return void e(this.lastValue);let n,r=!1;const i=t=>{r||(r=!0,n&&(clearTimeout(n),n=null),e(t))},s=()=>{if(this.isDisposed)i(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void i(this.lastValue);if(!this.gl.getQueryParameter(t,this.gl.QUERY_RESULT_AVAILABLE))return void(n=setTimeout(s,1));const r=this.gl.getQueryParameter(t,this.gl.QUERY_RESULT);e(Number(r)/1e6)}catch(t){console.error("Error checking query:",t),e(this.lastValue)}};s()}))}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const t of this.queries)this.gl.deleteQuery(t);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class aK extends VY{constructor(t={}){super(t),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=!0===t.trackTimestamp,this._currentContext=null,this._knownBindings=new WeakSet,this._xrFamebuffer=null}init(t){super.init(t);const e=this.parameters,n=void 0!==e.context?e.context:t.domElement.getContext("webgl2",{antialias:!1,alpha:!0,depth:!1,stencil:!1});function r(e){e.preventDefault();const n={api:"WebGL",message:e.statusMessage||"Unknown reason",reason:null,originalEvent:e};t.onDeviceLost(n)}this._onContextLost=r,t.domElement.addEventListener("webglcontextlost",r,!1),this.gl=n,this.extensions=new eK(this),this.capabilities=new nK(this),this.attributeUtils=new $Y(this),this.textureUtils=new tK(this),this.bufferRenderer=new iK(this),this.state=new XY(this),this.utils=new YY(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return SM}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(t){this._xrFamebuffer=t}setXRRenderTargetTextures(t,e,n=null){const r=this.gl;if(this.set(t.texture,{textureGPU:e,glInternalFormat:r.RGBA8}),null!==n){const e=t.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(t.depthTexture,{textureGPU:n,glInternalFormat:e}),t.autoAllocateDepthBuffer=!1,!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided")}}initTimestampQuery(t){if(!this.disjoint||!this.trackTimestamp)return;const e=t.isComputeNode?"compute":"render";this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new oK(this.gl,e,2048));const n=this.timestampQueryPool[e];null!==n.allocateQueriesForContext(t)&&n.beginQuery(t)}prepareTimestampBuffer(t){if(!this.disjoint||!this.trackTimestamp)return;const e=t.isComputeNode?"compute":"render";this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(t){const{state:e,gl:n}=this,r=this.get(t);if(this.initTimestampQuery(t),r.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1),t.viewport?this.updateViewport(t):e.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),t.scissor){const{x:n,y:r,width:i,height:s}=t.scissorValue;e.scissor(n,t.height-s-r,i,s)}const i=t.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:n}=this,r=this.get(t),i=r.previousContext,s=t.occlusionQueryCount;s>0&&(s>r.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const o=t.textures;if(null!==o)for(let t=0;t<o.length;t++){const e=o[t];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=i,null!==t.textures&&t.renderTarget){const r=this.get(t.renderTarget),{samples:i}=t.renderTarget;if(i>0&&!1===this._useMultisampledRTT(t.renderTarget)){const i=r.framebuffers[t.getCacheKey()],s=e.COLOR_BUFFER_BIT,o=r.msaaFrameBuffer,a=t.textures;n.bindFramebuffer(e.READ_FRAMEBUFFER,o),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,i);for(let n=0;n<a.length;n++)if(t.scissor){const{x:n,y:i,width:o,height:a}=t.scissorValue,l=t.height-a-i;e.blitFramebuffer(n,l,n+o,l+a,n,l,n+o,l+a,s,e.NEAREST),e.invalidateSubFramebuffer(e.READ_FRAMEBUFFER,r.invalidationArray,n,l,o,a)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,s,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,r.invalidationArray)}}null!==i&&(this._setFramebuffer(i),i.viewport?this.updateViewport(i):n.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)),this.prepareTimestampBuffer(t)}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=e;if(n&&r){const t=new WeakSet,{gl:i}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const s=()=>{let o=0;for(let e=0;e<n.length;e++){const s=n[e];null!==s&&(i.getQueryParameter(s,i.QUERY_RESULT_AVAILABLE)&&(0===i.getQueryParameter(s,i.QUERY_RESULT)&&t.add(r[e]),n[e]=null,i.deleteQuery(s),o++))}o<n.length?requestAnimationFrame(s):e.occluded=t};s()}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}updateViewport(t){const{state:e}=this,{x:n,y:r,width:i,height:s}=t.viewportValue;e.viewport(n,t.height-s-r,i,s)}setScissorTest(t){this.state.setScissorTest(t)}clear(t,e,n,r=null,i=!0){const{gl:s}=this;if(null===r){const t=this.getClearColor();t.r*=t.a,t.g*=t.a,t.b*=t.a,r={textures:null,clearColorValue:t}}let o=0;if(t&&(o|=s.COLOR_BUFFER_BIT),e&&(o|=s.DEPTH_BUFFER_BIT),n&&(o|=s.STENCIL_BUFFER_BIT),0!==o){let a;if(r.clearColorValue?a=r.clearColorValue:(a=this.getClearColor(),a.r*=a.a,a.g*=a.a,a.b*=a.a),e&&this.state.setDepthMask(!0),null===r.textures)s.clearColor(a.r,a.g,a.b,a.a),s.clear(o);else{if(i&&this._setFramebuffer(r),t)for(let t=0;t<r.textures.length;t++)s.clearBufferfv(s.COLOR,t,[a.r,a.g,a.b,a.a]);e&&n?s.clearBufferfi(s.DEPTH_STENCIL,0,1,0):e?s.clearBufferfv(s.DEPTH,0,[1]):n&&s.clearBufferiv(s.STENCIL,0,[0])}}}beginCompute(t){const{state:e,gl:n}=this;e.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(t)}compute(t,e,n,r){const{state:i,gl:s}=this;!1===this.discard&&(s.enable(s.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:a,attributes:l}=this.get(r),u=this._getVaoKey(null,l),h=this.vaoCache[u];void 0===h?this._createVao(null,l):s.bindVertexArray(h),i.useProgram(o),this._bindUniforms(n);const c=this._getTransformFeedback(a);s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,c),s.beginTransformFeedback(s.POINTS),l[0].isStorageInstancedBufferAttribute?s.drawArraysInstanced(s.POINTS,0,1,e.count):s.drawArrays(s.POINTS,0,e.count),s.endTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null);for(let t=0;t<a.length;t++){const e=a[t];e.pbo&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(t){const e=this.gl;this.discard=!1,e.disable(e.RASTERIZER_DISCARD),this.prepareTimestampBuffer(t),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(t){const{object:e,pipeline:n,material:r,context:i,hardwareClippingPlanes:s}=t,{programGPU:o}=this.get(n),{gl:a,state:l}=this,u=this.get(i),h=t.getDrawParameters();if(null===h)return;this._bindUniforms(t.getBindings());const c=e.isMesh&&e.matrixWorld.determinant()<0;l.setMaterial(r,c,s),l.useProgram(o);const d=this.get(t);let p=d.staticVao;if(void 0===p||d.geometryId!==t.geometry.id){const e=this._getVaoKey(t.getIndex(),t.getAttributes());if(p=this.vaoCache[e],void 0===p){let e;({vaoGPU:p,staticVao:e}=this._createVao(t.getIndex(),t.getAttributes())),e&&(d.staticVao=p,d.geometryId=t.geometry.id)}}a.bindVertexArray(p);const f=t.getIndex(),m=u.lastOcclusionObject;if(m!==e&&void 0!==m){if(null!==m&&!0===m.occlusionTest&&(a.endQuery(a.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),!0===e.occlusionTest){const t=a.createQuery();a.beginQuery(a.ANY_SAMPLES_PASSED,t),u.occlusionQueries[u.occlusionQueryIndex]=t,u.occlusionQueryObjects[u.occlusionQueryIndex]=e}u.lastOcclusionObject=e}const g=this.bufferRenderer;e.isPoints?g.mode=a.POINTS:e.isLineSegments?g.mode=a.LINES:e.isLine?g.mode=a.LINE_STRIP:e.isLineLoop?g.mode=a.LINE_LOOP:!0===r.wireframe?(l.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),g.mode=a.LINES):g.mode=a.TRIANGLES;const{vertexCount:y,instanceCount:v}=h;let{firstVertex:_}=h;if(g.object=e,null!==f){_*=f.array.BYTES_PER_ELEMENT;const t=this.get(f);g.index=f.count,g.type=t.type}else g.index=0;const b=()=>{e.isBatchedMesh?null!==e._multiDrawInstances?g.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?g.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):WM("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):v>1?g.renderInstances(_,y,v):g.render(_,y)};if(t.camera.isArrayCamera&&t.camera.cameras.length>0){const n=this.get(t.camera),r=t.camera.cameras,i=t.getBindingGroup("cameraIndex").bindings[0];if(void 0===n.indexesGPU||n.indexesGPU.length!==r.length){const t=new Uint32Array([0,0,0,0]),e=[];for(let n=0,i=r.length;n<i;n++){const r=a.createBuffer();t[0]=n,a.bindBuffer(a.UNIFORM_BUFFER,r),a.bufferData(a.UNIFORM_BUFFER,t,a.STATIC_DRAW),e.push(r)}n.indexesGPU=e}const s=this.get(i),o=this.renderer.getPixelRatio();for(let i=0,u=r.length;i<u;i++){const u=r[i];if(e.layers.test(u.layers)){const e=u.viewport,r=e.x*o,h=e.y*o,c=e.width*o,d=e.height*o;l.viewport(Math.floor(r),Math.floor(t.context.height-d-h),Math.floor(c),Math.floor(d)),l.bindBufferBase(a.UNIFORM_BUFFER,s.index,n.indexesGPU[i]),b()}}}else b();a.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}async copyTextureToBuffer(t,e,n,r,i,s){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i,s)}createSampler(){}destroySampler(){}createNodeBuilder(t,e){return new zY(t,e)}createProgram(t){const e=this.gl,{stage:n,code:r}=t,i="fragment"===n?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(i,r),e.compileShader(i),this.set(t,{shaderGPU:i})}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){const n=this.gl,r=t.pipeline,{fragmentProgram:i,vertexProgram:s}=r,o=n.createProgram(),a=this.get(i).shaderGPU,l=this.get(s).shaderGPU;if(n.attachShader(o,a),n.attachShader(o,l),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:a,vertexShader:l}),null!==e&&this.parallel){const i=new Promise((e=>{const i=this.parallel,s=()=>{n.getProgramParameter(o,i.COMPLETION_STATUS_KHR)?(this._completeCompile(t,r),e()):requestAnimationFrame(s)};s()}));e.push(i)}else this._completeCompile(t,r)}_handleSource(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=i;t<s;t++){const i=t+1;r.push(`${i===e?">":" "} ${i}: ${n[t]}`)}return r.join("\n")}_getShaderErrors(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(t.getShaderSource(e),r)}return i}_logProgramError(t,e,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,i=r.getProgramInfoLog(t).trim();if(!1===r.getProgramParameter(t,r.LINK_STATUS))if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,t,n,e);else{const s=this._getShaderErrors(r,n,"vertex"),o=this._getShaderErrors(r,e,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(t,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+s+"\n"+o)}else""!==i&&console.warn("THREE.WebGLProgram: Program Info Log:",i)}}_completeCompile(t,e){const{state:n,gl:r}=this,i=this.get(e),{programGPU:s,fragmentShader:o,vertexShader:a}=i;!1===r.getProgramParameter(s,r.LINK_STATUS)&&this._logProgramError(s,o,a),n.useProgram(s);const l=t.getBindings();this._setupBindings(l,s),this.set(e,{programGPU:s})}createComputePipeline(t,e){const{state:n,gl:r}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:s}=t,o=r.createProgram(),a=this.get(i).shaderGPU,l=this.get(s).shaderGPU,u=s.transforms,h=[],c=[];for(let t=0;t<u.length;t++){const e=u[t];h.push(e.varyingName),c.push(e.attributeNode)}r.attachShader(o,a),r.attachShader(o,l),r.transformFeedbackVaryings(o,h,r.SEPARATE_ATTRIBS),r.linkProgram(o),!1===r.getProgramParameter(o,r.LINK_STATUS)&&this._logProgramError(o,a,l),n.useProgram(o),this._setupBindings(e,o);const d=s.attributes,p=[],f=[];for(let t=0;t<d.length;t++){const e=d[t].node.attribute;p.push(e),this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER)}for(let t=0;t<c.length;t++){const e=c[t].attribute;this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER);const n=this.get(e);f.push(n)}this.set(t,{programGPU:o,transformBuffers:f,attributes:p})}createBindings(t,e){if(!1===this._knownBindings.has(e)){this._knownBindings.add(e);let t=0,n=0;for(const r of e){this.set(r,{textures:n,uniformBuffers:t});for(const e of r.bindings)e.isUniformBuffer&&t++,e.isSampledTexture&&n++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,n=this.get(t);let r=n.uniformBuffers,i=n.textures;for(const n of t.bindings)if(n.isUniformsGroup||n.isUniformBuffer){const t=n.buffer,i=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,t,e.DYNAMIC_DRAW),this.set(n,{index:r++,bufferGPU:i})}else if(n.isSampledTexture){const{textureGPU:t,glTextureType:e}=this.get(n.texture);this.set(n,{index:i++,textureGPU:t,glTextureType:e})}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const n=this.get(t).bufferGPU,r=t.buffer;e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}hasFeature(t){const e=Object.keys(rK).filter((e=>rK[e]===t)),n=this.extensions;for(let t=0;t<e.length;t++)if(n.has(e[t]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,n=null,r=null,i=0){this.textureUtils.copyTextureToTexture(t,e,n,r,i)}copyFramebufferToTexture(t,e,n){this.textureUtils.copyFramebufferToTexture(t,e,n)}_setFramebuffer(t){const{gl:e,state:n}=this;let r=null;if(null!==t.textures){const i=t.renderTarget,s=this.get(i),{samples:o,depthBuffer:a,stencilBuffer:l}=i,u=!0===i.isWebGLCubeRenderTarget,h=!0===i.isRenderTarget3D,c=!0===i.isRenderTargetArray,d=!0===i.isXRRenderTarget,p=!0===d&&!0===i.hasExternalTextures;let f=s.msaaFrameBuffer,m=s.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),y=this._useMultisampledRTT(i),v=QW(t);let _;if(u?(s.cubeFramebuffers||(s.cubeFramebuffers={}),_=s.cubeFramebuffers[v]):d&&!1===p?_=this._xrFamebuffer:(s.framebuffers||(s.framebuffers={}),_=s.framebuffers[v]),void 0===_){_=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,_);const r=t.textures;if(u){s.cubeFramebuffers[v]=_;const{textureGPU:t}=this.get(r[0]),n=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,t,0)}else{s.framebuffers[v]=_;for(let n=0;n<r.length;n++){const i=r[n],s=this.get(i);s.renderTarget=t.renderTarget,s.cacheKey=v;const a=e.COLOR_ATTACHMENT0+n;if(h||c){const t=this.renderer._activeCubeFace;e.framebufferTextureLayer(e.FRAMEBUFFER,a,s.textureGPU,0,t)}else y?g.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,e.TEXTURE_2D,s.textureGPU,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,a,e.TEXTURE_2D,s.textureGPU,0)}n.drawBuffers(t,_)}if(i.isXRRenderTarget&&!0===i.autoAllocateDepthBuffer){const n=e.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,t,0,y),s.xrDepthRenderbuffer=n}else if(null!==t.depthTexture){const n=this.get(t.depthTexture),r=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;n.renderTarget=t.renderTarget,n.cacheKey=v,y?g.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,r,e.TEXTURE_2D,n.textureGPU,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,n.textureGPU,0)}}else if(d&&p){n.bindFramebuffer(e.FRAMEBUFFER,_);const r=this.get(t.textures[0]);y?g.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.textureGPU,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.textureGPU,0);const a=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const t=s.xrDepthRenderbuffer;e.bindRenderbuffer(e.RENDERBUFFER,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,a,e.RENDERBUFFER,t)}else{const n=this.get(t.depthTexture);y?g.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,e.TEXTURE_2D,n.textureGPU,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,a,e.TEXTURE_2D,n.textureGPU,0)}}if(o>0&&!1===y){if(void 0===f){const r=[];f=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,f);const i=[],u=t.textures;for(let n=0;n<u.length;n++){if(i[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i[n]),r.push(e.COLOR_ATTACHMENT0+n),a){const t=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;r.push(t)}const s=t.textures[n],u=this.get(s);e.renderbufferStorageMultisample(e.RENDERBUFFER,o,u.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,i[n])}if(s.msaaFrameBuffer=f,s.msaaRenderbuffers=i,void 0===m){m=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,t,o),s.depthRenderbuffer=m;const n=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;r.push(n)}s.invalidationArray=r}r=s.msaaFrameBuffer}else r=_}n.bindFramebuffer(e.FRAMEBUFFER,r)}_getVaoKey(t,e){let n="";if(null!==t){n+=":"+this.get(t).id}for(let t=0;t<e.length;t++){n+=":"+this.get(e[t]).id}return n}_createVao(t,e){const{gl:n}=this,r=n.createVertexArray();let i="",s=!0;if(n.bindVertexArray(r),null!==t){const e=this.get(t);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.bufferGPU),i+=":"+e.id}for(let t=0;t<e.length;t++){const r=e[t],o=this.get(r);let a,l;i+=":"+o.id,n.bindBuffer(n.ARRAY_BUFFER,o.bufferGPU),n.enableVertexAttribArray(t),(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&(s=!1),!0===r.isInterleavedBufferAttribute?(a=r.data.stride*o.bytesPerElement,l=r.offset*o.bytesPerElement):(a=0,l=0),o.isInteger?n.vertexAttribIPointer(t,r.itemSize,o.type,a,l):n.vertexAttribPointer(t,r.itemSize,o.type,r.normalized,a,l),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?n.vertexAttribDivisor(t,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(t,r.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[i]=r,{vaoGPU:r,staticVao:s}}_getTransformFeedback(t){let e="";for(let n=0;n<t.length;n++)e+=":"+t[n].id;let n=this.transformFeedbackCache[e];if(void 0!==n)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let e=0;e<t.length;e++){const n=t[e];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,e,n.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=n,n}_setupBindings(t,e){const n=this.gl;for(const r of t)for(const t of r.bindings){const r=this.get(t).index;if(t.isUniformsGroup||t.isUniformBuffer){const i=n.getUniformBlockIndex(e,t.name);n.uniformBlockBinding(e,i,r)}else if(t.isSampledTexture){const i=n.getUniformLocation(e,t.name);n.uniform1i(i,r)}}}_bindUniforms(t){const{gl:e,state:n}=this;for(const r of t)for(const t of r.bindings){const r=this.get(t),i=r.index;t.isUniformsGroup||t.isUniformBuffer?n.bindBufferBase(e.UNIFORM_BUFFER,i,r.bufferGPU):t.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,e.TEXTURE0+i)}}_useMultisampledRTT(t){return t.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==t.autoAllocateDepthBuffer}dispose(){const t=this.extensions.get("WEBGL_lose_context");t&&t.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const lK="point-list",uK="line-list",hK="line-strip",cK="triangle-list",dK="triangle-strip",pK="never",fK="less",mK="equal",gK="less-equal",yK="greater",vK="not-equal",_K="greater-equal",bK="always",xK="store",wK="load",MK="clear",SK="ccw",TK="none",EK="front",AK="back",CK="uint16",RK="uint32",NK={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},PK="clamp-to-edge",kK="repeat",OK="mirror-repeat",IK="linear",DK="nearest",LK="zero",UK="one",FK="src",zK="one-minus-src",BK="src-alpha",jK="one-minus-src-alpha",VK="dst",GK="one-minus-dst",HK="dst-alpha",WK="one-minus-dst-alpha",qK="src-alpha-saturated",$K="constant",XK="one-minus-constant",YK="add",KK="subtract",ZK="reverse-subtract",JK="min",QK="max",tZ=0,eZ=15,nZ="keep",rZ="zero",iZ="replace",sZ="invert",oZ="increment-clamp",aZ="decrement-clamp",lZ="increment-wrap",uZ="decrement-wrap",hZ="storage",cZ="read-only-storage",dZ="write-only",pZ="read-only",fZ="read-write",mZ="float",gZ="unfilterable-float",yZ="depth",vZ="sint",_Z="uint",bZ="2d",xZ="3d",wZ="2d",MZ="2d-array",SZ="cube",TZ="3d",EZ="all",AZ="vertex",CZ="instance",RZ={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class NZ extends wY{constructor(t,e){super(t),this.texture=e,this.version=e?e.version:0,this.isSampler=!0}}class PZ extends NZ{constructor(t,e,n){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n}update(){this.texture=this.textureNode.value}}class kZ extends MY{constructor(t,e){super(t,e?e.array:null),this.attribute=e,this.isStorageBuffer=!0}}let OZ=0;class IZ extends kZ{constructor(t,e){super("StorageBuffer_"+OZ++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:YD,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class DZ extends AW{constructor(t){super(),this.device=t;this.mipmapSampler=t.createSampler({minFilter:IK}),this.flipYSampler=t.createSampler({minFilter:DK}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=t.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=t.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=t.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(t){let e=this.transferPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({label:`mipmap-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:dK,stripIndexFormat:RK},layout:"auto"}),this.transferPipelines[t]=e),e}getFlipYPipeline(t){let e=this.flipYPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({label:`flipY-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:dK,stripIndexFormat:RK},layout:"auto"}),this.flipYPipelines[t]=e),e}flipY(t,e,n=0){const r=e.format,{width:i,height:s}=e.size,o=this.getTransferPipeline(r),a=this.getFlipYPipeline(r),l=this.device.createTexture({size:{width:i,height:s,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:wZ,baseArrayLayer:n}),h=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:wZ,baseArrayLayer:0}),c=this.device.createCommandEncoder({}),d=(t,e,n)=>{const r=t.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:e}]}),s=c.beginRenderPass({colorAttachments:[{view:n,loadOp:MK,storeOp:xK,clearValue:[0,0,0,0]}]});s.setPipeline(t),s.setBindGroup(0,i),s.draw(4,1,0,0),s.end()};d(o,u,h),d(a,h,u),this.device.queue.submit([c.finish()]),l.destroy()}generateMipmaps(t,e,n=0){const r=this.get(t);void 0===r.useCount&&(r.useCount=0,r.layers=[]);const i=r.layers[n]||this._mipmapCreateBundles(t,e,n),s=this.device.createCommandEncoder({});this._mipmapRunBundles(s,i),this.device.queue.submit([s.finish()]),0!==r.useCount&&(r.layers[n]=i),r.useCount++}_mipmapCreateBundles(t,e,n){const r=this.getTransferPipeline(e.format),i=r.getBindGroupLayout(0);let s=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:wZ,baseArrayLayer:n});const o=[];for(let a=1;a<e.mipLevelCount;a++){const l=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:s}]}),u=t.createView({baseMipLevel:a,mipLevelCount:1,dimension:wZ,baseArrayLayer:n}),h={colorAttachments:[{view:u,loadOp:MK,storeOp:xK,clearValue:[0,0,0,0]}]},c=this.device.createRenderBundleEncoder({colorFormats:[e.format]});c.setPipeline(r),c.setBindGroup(0,l),c.draw(4,1,0,0),o.push({renderBundles:[c.finish()],passDescriptor:h}),s=u}return o}_mipmapRunBundles(t,e){const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}}const LZ={[pM]:"never",[fM]:"less",[mM]:"equal",[gM]:"less-equal",[yM]:"greater",[_M]:"greater-equal",[bM]:"always",[vM]:"not-equal"},UZ=[0,1,3,2,4,5];class FZ{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new oA,this.depthTexture.name="depthBuffer"}createSampler(t){const e=this.backend,n=e.device,r=e.get(t),i={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};i.magFilter===IK&&i.minFilter===IK&&i.mipmapFilter===IK&&(i.maxAnisotropy=t.anisotropy),t.isDepthTexture&&null!==t.compareFunction&&(i.compare=LZ[t.compareFunction]),r.sampler=n.createSampler(i)}createDefaultTexture(t){let e;const n=zZ(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(n):t.isVideoTexture?this.backend.get(t).externalTexture=this._getDefaultVideoFrame():e=this._getDefaultTextureGPU(n),this.backend.get(t).texture=e}createTexture(t,e={}){const n=this.backend,r=n.get(t);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===e.needsMipmaps&&(e.needsMipmaps=!1),void 0===e.levels&&(e.levels=1),void 0===e.depth&&(e.depth=1);const{width:i,height:s,depth:o,levels:a}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(t),u=t.internalFormat||e.format||zZ(t,n.device);r.format=u;const{samples:h,primarySamples:c,isMSAA:d}=n.utils.getTextureSampleData(t);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===t.isStorageTexture&&(p|=GPUTextureUsage.STORAGE_BINDING),!0!==t.isCompressedTexture&&!0!==t.isCompressedArrayTexture&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const f={label:t.name,size:{width:i,height:s,depthOrArrayLayers:o},mipLevelCount:a,sampleCount:c,dimension:l,format:u,usage:p};if(t.isVideoTexture){const e=t.source.data,n=new VideoFrame(e);f.size.width=n.displayWidth,f.size.height=n.displayHeight,n.close(),r.externalTexture=e}else{if(void 0===u)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);r.texture=n.device.createTexture(f)}if(d){const t=Object.assign({},f);t.label=t.label+"-msaa",t.sampleCount=h,r.msaaTexture=n.device.createTexture(t)}r.initialized=!0,r.textureDescriptorGPU=f}destroyTexture(t){const e=this.backend,n=e.get(t);void 0!==n.texture&&n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),e.delete(t)}destroySampler(t){delete this.backend.get(t).sampler}generateMipmaps(t){const e=this.backend.get(t);if(t.isCubeTexture)for(let t=0;t<6;t++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,t);else{const n=t.image.depth||1;for(let t=0;t<n;t++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,t)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const t=this.backend,{width:e,height:n}=t.getDrawingBufferSize();return this.colorBuffer=t.device.createTexture({label:"colorBuffer",size:{width:e,height:n,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.samples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(t=!0,e=!1){const n=this.backend,{width:r,height:i}=n.getDrawingBufferSize(),s=this.depthTexture,o=n.get(s).texture;let a,l;if(e?(a=Mw,l=mw):t&&(a=ww,l=hw),void 0!==o){if(s.image.width===r&&s.image.height===i&&s.format===a&&s.type===l)return o;this.destroyTexture(s)}return s.name="depthBuffer",s.format=a,s.type=l,s.image.width=r,s.image.height=i,this.createTexture(s,{width:r,height:i}),n.get(s).texture}updateTexture(t,e){const n=this.backend.get(t),{textureDescriptorGPU:r}=n;if(!t.isRenderTargetTexture&&void 0!==r){if(t.isDataTexture)this._copyBufferToTexture(e.image,n.texture,r,0,t.flipY);else if(t.isDataArrayTexture||t.isData3DTexture)for(let i=0;i<e.image.depth;i++)this._copyBufferToTexture(e.image,n.texture,r,i,t.flipY,i);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,n.texture,r);else if(t.isCubeTexture)this._copyCubeMapToTexture(e.images,n.texture,r,t.flipY);else if(t.isVideoTexture){const e=t.source.data;n.externalTexture=e}else this._copyImageToTexture(e.image,n.texture,r,0,t.flipY);n.version=t.version,t.onUpdate&&t.onUpdate(t)}}async copyTextureToBuffer(t,e,n,r,i,s){const o=this.backend.device,a=this.backend.get(t),l=a.texture,u=a.textureDescriptorGPU.format,h=this._getBytesPerTexel(u);let c=r*h;c=256*Math.ceil(c/256);const d=o.createBuffer({size:r*i*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:e,y:n,z:s}},{buffer:d,bytesPerRow:c},{width:r,height:i});const f=this._getTypedArrayType(u);o.queue.submit([p.finish()]),await d.mapAsync(GPUMapMode.READ);return new f(d.getMappedRange())}_isEnvironmentTexture(t){const e=t.mapping;return e===$x||e===Xx||e===Wx||e===qx}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(void 0===e){const n=new iS;n.minFilter=Qx,n.magFilter=Qx,this.createTexture(n,{width:1,height:1,format:t}),this.defaultTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultTexture[t];if(void 0===e){const n=new NE;n.minFilter=Qx,n.magFilter=Qx,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultVideoFrame(){let t=this.defaultVideoFrame;if(null===t){const e={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=t=new VideoFrame(new Uint8Array([0,0,0,255]),e)}return t}_copyCubeMapToTexture(t,e,n,r){for(let i=0;i<6;i++){const s=t[i],o=!0===r?UZ[i]:i;s.isDataTexture?this._copyBufferToTexture(s.image,e,n,o,r):this._copyImageToTexture(s,e,n,o,r)}}_copyImageToTexture(t,e,n,r,i){this.backend.device.queue.copyExternalImageToTexture({source:t,flipY:i},{texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1})}_getPassUtils(){let t=this._passUtils;return null===t&&(this._passUtils=t=new DZ(this.backend.device)),t}_generateMipmaps(t,e,n=0){this._getPassUtils().generateMipmaps(t,e,n)}_flipY(t,e,n=0){this._getPassUtils().flipY(t,e,n)}_copyBufferToTexture(t,e,n,r,i,s=0){const o=this.backend.device,a=t.data,l=this._getBytesPerTexel(n.format),u=t.width*l;o.queue.writeTexture({texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},a,{offset:t.width*t.height*l*s,bytesPerRow:u},{width:t.width,height:t.height,depthOrArrayLayers:1}),!0===i&&this._flipY(e,n,r)}_copyCompressedBufferToTexture(t,e,n){const r=this.backend.device,i=this._getBlockData(n.format),s=n.size.depthOrArrayLayers>1;for(let o=0;o<t.length;o++){const a=t[o],l=a.width,u=a.height,h=s?n.size.depthOrArrayLayers:1,c=Math.ceil(l/i.width)*i.byteLength,d=c*Math.ceil(u/i.height);for(let t=0;t<h;t++)r.queue.writeTexture({texture:e,mipLevel:o,origin:{x:0,y:0,z:t}},a.data,{offset:t*d,bytesPerRow:c,rowsPerImage:Math.ceil(u/i.height)},{width:Math.ceil(l/i.width)*i.width,height:Math.ceil(u/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(t){return t===NK.BC1RGBAUnorm||t===NK.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:t===NK.BC2RGBAUnorm||t===NK.BC2RGBAUnormSRGB||t===NK.BC3RGBAUnorm||t===NK.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===NK.BC4RUnorm||t===NK.BC4RSNorm?{byteLength:8,width:4,height:4}:t===NK.BC5RGUnorm||t===NK.BC5RGSnorm||t===NK.BC6HRGBUFloat||t===NK.BC6HRGBFloat||t===NK.BC7RGBAUnorm||t===NK.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===NK.ETC2RGB8Unorm||t===NK.ETC2RGB8UnormSRGB||t===NK.ETC2RGB8A1Unorm||t===NK.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:t===NK.ETC2RGBA8Unorm||t===NK.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:t===NK.EACR11Unorm||t===NK.EACR11Snorm?{byteLength:8,width:4,height:4}:t===NK.EACRG11Unorm||t===NK.EACRG11Snorm||t===NK.ASTC4x4Unorm||t===NK.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:t===NK.ASTC5x4Unorm||t===NK.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:t===NK.ASTC5x5Unorm||t===NK.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:t===NK.ASTC6x5Unorm||t===NK.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:t===NK.ASTC6x6Unorm||t===NK.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:t===NK.ASTC8x5Unorm||t===NK.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:t===NK.ASTC8x6Unorm||t===NK.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:t===NK.ASTC8x8Unorm||t===NK.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:t===NK.ASTC10x5Unorm||t===NK.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:t===NK.ASTC10x6Unorm||t===NK.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:t===NK.ASTC10x8Unorm||t===NK.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:t===NK.ASTC10x10Unorm||t===NK.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:t===NK.ASTC12x10Unorm||t===NK.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:t===NK.ASTC12x12Unorm||t===NK.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(t){let e=PK;return t===Kx?e=kK:t===Jx&&(e=OK),e}_convertFilterMode(t){let e=IK;return t!==Qx&&t!==tw&&t!==ew||(e=DK),e}_getBytesPerTexel(t){return t===NK.R8Unorm||t===NK.R8Snorm||t===NK.R8Uint||t===NK.R8Sint?1:t===NK.R16Uint||t===NK.R16Sint||t===NK.R16Float||t===NK.RG8Unorm||t===NK.RG8Snorm||t===NK.RG8Uint||t===NK.RG8Sint?2:t===NK.R32Uint||t===NK.R32Sint||t===NK.R32Float||t===NK.RG16Uint||t===NK.RG16Sint||t===NK.RG16Float||t===NK.RGBA8Unorm||t===NK.RGBA8UnormSRGB||t===NK.RGBA8Snorm||t===NK.RGBA8Uint||t===NK.RGBA8Sint||t===NK.BGRA8Unorm||t===NK.BGRA8UnormSRGB||t===NK.RGB9E5UFloat||t===NK.RGB10A2Unorm||t===NK.RG11B10UFloat||t===NK.Depth32Float||t===NK.Depth24Plus||t===NK.Depth24PlusStencil8||t===NK.Depth32FloatStencil8?4:t===NK.RG32Uint||t===NK.RG32Sint||t===NK.RG32Float||t===NK.RGBA16Uint||t===NK.RGBA16Sint||t===NK.RGBA16Float?8:t===NK.RGBA32Uint||t===NK.RGBA32Sint||t===NK.RGBA32Float?16:void 0}_getTypedArrayType(t){return t===NK.R8Uint?Uint8Array:t===NK.R8Sint?Int8Array:t===NK.R8Unorm?Uint8Array:t===NK.R8Snorm?Int8Array:t===NK.RG8Uint?Uint8Array:t===NK.RG8Sint?Int8Array:t===NK.RG8Unorm?Uint8Array:t===NK.RG8Snorm?Int8Array:t===NK.RGBA8Uint?Uint8Array:t===NK.RGBA8Sint?Int8Array:t===NK.RGBA8Unorm?Uint8Array:t===NK.RGBA8Snorm?Int8Array:t===NK.R16Uint?Uint16Array:t===NK.R16Sint?Int16Array:t===NK.RG16Uint?Uint16Array:t===NK.RG16Sint?Int16Array:t===NK.RGBA16Uint?Uint16Array:t===NK.RGBA16Sint?Int16Array:t===NK.R16Float||t===NK.RG16Float||t===NK.RGBA16Float?Uint16Array:t===NK.R32Uint?Uint32Array:t===NK.R32Sint?Int32Array:t===NK.R32Float?Float32Array:t===NK.RG32Uint?Uint32Array:t===NK.RG32Sint?Int32Array:t===NK.RG32Float?Float32Array:t===NK.RGBA32Uint?Uint32Array:t===NK.RGBA32Sint?Int32Array:t===NK.RGBA32Float?Float32Array:t===NK.BGRA8Unorm||t===NK.BGRA8UnormSRGB?Uint8Array:t===NK.RGB10A2Unorm||t===NK.RGB9E5UFloat||t===NK.RG11B10UFloat?Uint32Array:t===NK.Depth32Float?Float32Array:t===NK.Depth24Plus||t===NK.Depth24PlusStencil8?Uint32Array:t===NK.Depth32FloatStencil8?Float32Array:void 0}_getDimension(t){let e;return e=t.isData3DTexture?xZ:bZ,e}}function zZ(t,e=null){const n=t.format,r=t.type,i=t.colorSpace;let s;if(!0===t.isCompressedTexture||!0===t.isCompressedArrayTexture)switch(n){case Nw:s=i===lM?NK.BC1RGBAUnormSRGB:NK.BC1RGBAUnorm;break;case Pw:s=i===lM?NK.BC2RGBAUnormSRGB:NK.BC2RGBAUnorm;break;case kw:s=i===lM?NK.BC3RGBAUnormSRGB:NK.BC3RGBAUnorm;break;case Fw:s=i===lM?NK.ETC2RGB8UnormSRGB:NK.ETC2RGB8Unorm;break;case zw:s=i===lM?NK.ETC2RGBA8UnormSRGB:NK.ETC2RGBA8Unorm;break;case Bw:s=i===lM?NK.ASTC4x4UnormSRGB:NK.ASTC4x4Unorm;break;case jw:s=i===lM?NK.ASTC5x4UnormSRGB:NK.ASTC5x4Unorm;break;case Vw:s=i===lM?NK.ASTC5x5UnormSRGB:NK.ASTC5x5Unorm;break;case Gw:s=i===lM?NK.ASTC6x5UnormSRGB:NK.ASTC6x5Unorm;break;case Hw:s=i===lM?NK.ASTC6x6UnormSRGB:NK.ASTC6x6Unorm;break;case Ww:s=i===lM?NK.ASTC8x5UnormSRGB:NK.ASTC8x5Unorm;break;case qw:s=i===lM?NK.ASTC8x6UnormSRGB:NK.ASTC8x6Unorm;break;case $w:s=i===lM?NK.ASTC8x8UnormSRGB:NK.ASTC8x8Unorm;break;case Xw:s=i===lM?NK.ASTC10x5UnormSRGB:NK.ASTC10x5Unorm;break;case Yw:s=i===lM?NK.ASTC10x6UnormSRGB:NK.ASTC10x6Unorm;break;case Kw:s=i===lM?NK.ASTC10x8UnormSRGB:NK.ASTC10x8Unorm;break;case Zw:s=i===lM?NK.ASTC10x10UnormSRGB:NK.ASTC10x10Unorm;break;case Jw:s=i===lM?NK.ASTC12x10UnormSRGB:NK.ASTC12x10Unorm;break;case Qw:s=i===lM?NK.ASTC12x12UnormSRGB:NK.ASTC12x12Unorm;break;case _w:s=i===lM?NK.RGBA8UnormSRGB:NK.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}else switch(n){case _w:switch(r){case ow:s=NK.RGBA8Snorm;break;case aw:s=NK.RGBA16Sint;break;case lw:s=NK.RGBA16Uint;break;case hw:s=NK.RGBA32Uint;break;case uw:s=NK.RGBA32Sint;break;case sw:s=i===lM?NK.RGBA8UnormSRGB:NK.RGBA8Unorm;break;case dw:s=NK.RGBA16Float;break;case cw:s=NK.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case vw:if(r===gw)s=NK.RGB9E5UFloat;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",r);break;case Sw:switch(r){case ow:s=NK.R8Snorm;break;case aw:s=NK.R16Sint;break;case lw:s=NK.R16Uint;break;case hw:s=NK.R32Uint;break;case uw:s=NK.R32Sint;break;case sw:s=NK.R8Unorm;break;case dw:s=NK.R16Float;break;case cw:s=NK.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case Ew:switch(r){case ow:s=NK.RG8Snorm;break;case aw:s=NK.RG16Sint;break;case lw:s=NK.RG16Uint;break;case hw:s=NK.RG32Uint;break;case uw:s=NK.RG32Sint;break;case sw:s=NK.RG8Unorm;break;case dw:s=NK.RG16Float;break;case cw:s=NK.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case ww:switch(r){case lw:s=NK.Depth16Unorm;break;case hw:s=NK.Depth24Plus;break;case cw:s=NK.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case Mw:switch(r){case mw:s=NK.Depth24PlusStencil8;break;case cw:e&&!1===e.features.has(RZ.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=NK.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case Tw:switch(r){case uw:s=NK.R32Sint;break;case hw:s=NK.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case Aw:switch(r){case uw:s=NK.RG32Sint;break;case hw:s=NK.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case Cw:switch(r){case uw:s=NK.RGBA32Sint;break;case hw:s=NK.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}return s}const BZ=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,jZ=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,VZ={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class GZ extends jX{constructor(t){const{type:e,inputs:n,name:r,inputsCode:i,blockCode:s,outputType:o}=(t=>{const e=(t=t.trim()).match(BZ);if(null!==e&&4===e.length){const n=e[2],r=[];let i=null;for(;null!==(i=jZ.exec(n));)r.push({name:i[1],type:i[2]});const s=[];for(let t=0;t<r.length;t++){const{name:e,type:n}=r[t];let i=n;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=n.split("<")[0]),i=VZ[i]),s.push(new RX(i,e))}const o=t.substring(e[0].length),a=e[3]||"void",l=void 0!==e[1]?e[1]:"";return{type:VZ[a]||a,inputs:s,name:l,inputsCode:n,blockCode:o,outputType:a}}throw new Error("FunctionNode: Function is not a WGSL code.")})(t);super(e,n,r),this.inputsCode=i,this.blockCode=s,this.outputType=o}getCode(t=this.name){const e="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class HZ extends BX{parseFunction(t){return new GZ(t)}}const WZ="undefined"!=typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},qZ={[$D]:"read",[XD]:"write",[YD]:"read_write"},$Z={[Kx]:"repeat",[Zx]:"clamp",[Jx]:"mirror"},XZ={vertex:WZ?WZ.VERTEX:1,fragment:WZ?WZ.FRAGMENT:2,compute:WZ?WZ.COMPUTE:4},YZ={instance:!0,swizzleAssign:!1,storageBuffer:!0},KZ={"^^":"tsl_xor"},ZZ={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},JZ={},QZ={tsl_xor:new Dq("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Dq("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Dq("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Dq("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Dq("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Dq("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Dq("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Dq("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Dq("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Dq("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Dq("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Dq("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Dq("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},tJ={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!=typeof navigator&&/Windows/g.test(navigator.userAgent)&&(QZ.pow_float=new Dq("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),QZ.pow_vec2=new Dq("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[QZ.pow_float]),QZ.pow_vec3=new Dq("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[QZ.pow_float]),QZ.pow_vec4=new Dq("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[QZ.pow_float]),tJ.pow_float="tsl_pow_float",tJ.pow_vec2="tsl_pow_vec2",tJ.pow_vec3="tsl_pow_vec3",tJ.pow_vec4="tsl_pow_vec4");let eJ="";!0!==("undefined"!=typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(eJ+="diagnostic( off, derivative_uniformity );\n");class nJ extends AX{constructor(t,e){super(t,e,new HZ),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(t){return!0===t.isVideoTexture&&t.colorSpace!==aM}_generateTextureSample(t,e,n,r,i=this.shaderStage){return"fragment"===i?r?`textureSample( ${e}, ${e}_sampler, ${n}, ${r} )`:`textureSample( ${e}, ${e}_sampler, ${n} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n):this.generateTextureLod(t,e,n,r,"0")}_generateVideoSample(t,e,n=this.shaderStage){if("fragment"===n)return`textureSampleBaseClampToEdge( ${t}, ${t}_sampler, vec2<f32>( ${e}.x, 1.0 - ${e}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(t,e,n,r,i,s=this.shaderStage){return"fragment"!==s&&"compute"!==s||!1!==this.isUnfilterable(t)?this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,r):this.generateTextureLod(t,e,n,i,r):`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${r} )`}generateWrapFunction(t){const e=`tsl_coord_${$Z[t.wrapS]}S_${$Z[t.wrapT]}_${t.isData3DTexture?"3d":"2d"}T`;let n=JZ[e];if(void 0===n){const r=[],i=t.isData3DTexture?"vec3f":"vec2f";let s=`fn ${e}( coord : ${i} ) -> ${i} {\n\n\treturn ${i}(\n`;const o=(t,e)=>{t===Kx?(r.push(QZ.repeatWrapping_float),s+=`\t\ttsl_repeatWrapping_float( coord.${e} )`):t===Zx?(r.push(QZ.clampWrapping_float),s+=`\t\ttsl_clampWrapping_float( coord.${e} )`):t===Jx?(r.push(QZ.mirrorWrapping_float),s+=`\t\ttsl_mirrorWrapping_float( coord.${e} )`):(s+=`\t\tcoord.${e}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${t}" for vertex shader.`))};o(t.wrapS,"x"),s+=",\n",o(t.wrapT,"y"),t.isData3DTexture&&(s+=",\n",o(t.wrapR,"z")),s+="\n\t);\n\n}\n",JZ[e]=n=new Dq(s,r)}return n.build(this),e}generateArrayDeclaration(t,e){return`array< ${this.getType(t)}, ${e} >`}generateTextureDimension(t,e,n){const r=this.getDataFromNode(t,this.shaderStage,this.globalCache);void 0===r.dimensionsSnippet&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(void 0===r.dimensionsSnippet[n]){let s,o;const{primarySamples:a}=this.renderer.backend.utils.getTextureSampleData(t),l=a>1;o=t.isData3DTexture?"vec3<u32>":"vec2<u32>",s=l||t.isVideoTexture||t.isStorageTexture?e:`${e}${n?`, u32( ${n} )`:""}`,i=new Pz(new iB(`textureDimensions( ${s} )`,o)),r.dimensionsSnippet[n]=i,(t.isDataArrayTexture||t.isData3DTexture)&&(r.arrayLayerCount=new Pz(new iB(`textureNumLayers(${e})`,"u32"))),t.isTextureCube&&(r.cubeFaceCount=new Pz(new iB("6u","u32")))}return i.build(this)}generateFilteredTexture(t,e,n,r="0u"){this._include("biquadraticTexture");return`tsl_biquadraticTexture( ${e}, ${this.generateWrapFunction(t)}( ${n} ), ${this.generateTextureDimension(t,e,r)}, u32( ${r} ) )`}generateTextureLod(t,e,n,r,i="0u"){const s=this.generateWrapFunction(t),o=this.generateTextureDimension(t,e,i),a=t.isData3DTexture?"vec3":"vec2",l=`${a}<u32>(${s}(${n}) * ${a}<f32>(${o}))`;return this.generateTextureLoad(t,e,l,r,i)}generateTextureLoad(t,e,n,r,i="0u"){return!0===t.isVideoTexture||!0===t.isStorageTexture?`textureLoad( ${e}, ${n} )`:r?`textureLoad( ${e}, ${n}, ${r}, u32( ${i} ) )`:`textureLoad( ${e}, ${n}, u32( ${i} ) )`}generateTextureStore(t,e,n,r){return`textureStore( ${e}, ${n}, ${r} )`}isSampleCompare(t){return!0===t.isDepthTexture&&null!==t.compareFunction}isUnfilterable(t){return"float"!==this.getComponentTypeFromTexture(t)||!this.isAvailable("float32Filterable")&&!0===t.isDataTexture&&t.type===cw||!1===this.isSampleCompare(t)&&t.minFilter===Qx&&t.magFilter===Qx||this.renderer.backend.utils.getTextureSampleData(t).primarySamples>1}generateTexture(t,e,n,r,i=this.shaderStage){let s=null;return s=!0===t.isVideoTexture?this._generateVideoSample(e,n,i):this.isUnfilterable(t)?this.generateTextureLod(t,e,n,r,"0",i):this._generateTextureSample(t,e,n,r,i),s}generateTextureGrad(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleGrad( ${e}, ${e}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${s} shader.`)}generateTextureCompare(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}generateTextureLevel(t,e,n,r,i,s=this.shaderStage){let o=null;return o=!0===t.isVideoTexture?this._generateVideoSample(e,n,s):this._generateTextureSampleLevel(t,e,n,r,i,s),o}generateTextureBias(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${s} shader.`)}getPropertyName(t,e=this.shaderStage){if(!0===t.isNodeVarying&&!0===t.needsInterpolation){if("vertex"===e)return`varyings.${t.name}`}else if(!0===t.isNodeUniform){const e=t.name,n=t.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?e:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?this.isCustomStruct(t)?e:e+".value":t.groupNode.name+"."+e}return super.getPropertyName(t)}getOutputStructName(){return"output"}_getUniformGroupCount(t){return Object.keys(this.uniforms[t]).length}getFunctionOperator(t){const e=KZ[t];return void 0!==e?(this._include(e),e):null}getNodeAccess(t,e){return"compute"!==e?$D:t.access}getStorageAccess(t,e){return qZ[this.getNodeAccess(t,e)]}getUniformFromNode(t,e,n,r=null){const i=super.getUniformFromNode(t,e,n,r),s=this.getDataFromNode(t,n,this.globalCache);if(void 0===s.uniformGPU){let o;const a=t.groupNode,l=a.name,u=this.getBindGroupArray(l,n);if("texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e){let r=null;const s=this.getNodeAccess(t,n);if("texture"===e||"storageTexture"===e?r=new kY(i.name,i.node,a,s):"cubeTexture"===e?r=new OY(i.name,i.node,a,s):"texture3D"===e&&(r=new IY(i.name,i.node,a,s)),r.store=!0===t.isStorageTextureNode,r.setVisibility(XZ[n]),"fragment"!==n&&"compute"!==n||!1!==this.isUnfilterable(t.value)||!1!==r.store)u.push(r),o=[r];else{const t=new PZ(`${i.name}_sampler`,i.node,a);t.setVisibility(XZ[n]),u.push(t,r),o=[t,r]}}else if("buffer"===e||"storageBuffer"===e||"indirectStorageBuffer"===e){const s=new("buffer"===e?EY:IZ)(t,a);s.setVisibility(XZ[n]),u.push(s),o=s,i.name=r||"NodeBuffer_"+i.id}else{const t=this.uniformGroups[n]||(this.uniformGroups[n]={});let r=t[l];void 0===r&&(r=new RY(l,a),r.setVisibility(XZ[n]),t[l]=r,u.push(r)),o=this.getNodeUniform(i,e),r.addUniform(o)}s.uniformGPU=o}return i}getBuiltin(t,e,n,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(t)&&i.set(t,{name:t,property:e,type:n}),e}hasBuiltin(t,e=this.shaderStage){return void 0!==this.builtins[e]&&this.builtins[e].has(t)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),r=[];for(const t of e.inputs)r.push(t.name+" : "+this.getType(t.type));let i=`fn ${e.name}( ${r.join(", ")} ) -> ${this.getType(e.type)} {\n${n.vars}\n${n.code}\n`;return n.result&&(i+=`\treturn ${n.result};\n`),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],n=this.directives[t];if(void 0!==n)for(const t of n)e.push(`enable ${t};`);return e.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(t){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${t} >`,"vertex")}getBuiltins(t){const e=[],n=this.builtins[t];if(void 0!==n)for(const{name:t,property:r,type:i}of n.values())e.push(`@builtin( ${t} ) ${r} : ${i}`);return e.join(",\n\t")}getScopedArray(t,e,n,r){return!1===this.scopedArrays.has(t)&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:n,bufferCount:r}),t}getScopedArrays(t){if("compute"!==t)return;const e=[];for(const{name:t,scope:n,bufferType:r,bufferCount:i}of this.scopedArrays.values()){const s=this.getType(r);e.push(`var<${n}> ${t}: array< ${s}, ${i} >;`)}return e.join("\n")}getAttributes(t){const e=[];if("compute"===t&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===t||"compute"===t){const t=this.getBuiltins("attribute");t&&e.push(t);const n=this.getAttributesArray();for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.name,s=this.getType(r.type);e.push(`@location( ${t} ) ${i} : ${s}`)}}return e.join(",\n\t")}getStructMembers(t){const e=[];for(const n of t.members){const r=t.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),e.push(`\t${r+n.name} : ${i}`)}return e.join(",\n")}getStructs(t){let e="";const n=this.structs[t];if(n.length>0){const t=[];for(const e of n){let n=`struct ${e.name} {\n`;n+=this.getStructMembers(e),n+="\n};",t.push(n)}e="\n"+t.join("\n\n")+"\n"}return e}getVar(t,e,n=null){let r=`var ${e} : `;return r+=null!==n?this.generateArrayDeclaration(t,n):this.getType(t),r}getVars(t){const e=[],n=this.vars[t];if(void 0!==n)for(const t of n)e.push(`\t${this.getVar(t.type,t.name,t.count)};`);return`\n${e.join("\n")}\n`}getVaryings(t){const e=[];if("vertex"===t&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===t||"fragment"===t){const n=this.varyings,r=this.vars[t];for(let i=0;i<n.length;i++){const s=n[i];if(s.needsInterpolation){let t=`@location( ${i} )`;/^(int|uint|ivec|uvec)/.test(s.type)&&(t+=" @interpolate( flat )"),e.push(`${t} ${s.name} : ${this.getType(s.type)}`)}else"vertex"===t&&!1===r.includes(s)&&r.push(s)}}const n=this.getBuiltins(t);n&&e.push(n);const r=e.join(",\n\t");return"vertex"===t?this._getWGSLStruct("VaryingsStruct","\t"+r):r}isCustomStruct(t){return t.value.isStorageBufferAttribute&&null!==t.node.structTypeNode}getUniforms(t){const e=this.uniforms[t],n=[],r=[],i=[],s={};for(const i of e){const e=i.groupNode.name,o=this.bindingsIndexes[e];if("texture"===i.type||"cubeTexture"===i.type||"storageTexture"===i.type||"texture3D"===i.type){const e=i.node.value;let r;"fragment"!==t&&"compute"!==t||!1!==this.isUnfilterable(e)||!0===i.node.isStorageTextureNode||(this.isSampleCompare(e)?n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler_comparison;`):n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler;`));let s="";const{primarySamples:a}=this.renderer.backend.utils.getTextureSampleData(e);if(a>1&&(s="_multisampled"),!0===e.isCubeTexture)r="texture_cube<f32>";else if(!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture)r="texture_2d_array<f32>";else if(!0===e.isDepthTexture)r=`texture_depth${s}_2d`;else if(!0===e.isVideoTexture)r="texture_external";else if(!0===e.isData3DTexture)r="texture_3d<f32>";else if(!0===i.node.isStorageTextureNode){r=`texture_storage_2d<${zZ(e)}, ${this.getStorageAccess(i.node,t)}>`}else{r=`texture${s}_2d<${this.getComponentTypeFromTexture(e).charAt(0)}32>`}n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name} : ${r};`)}else if("buffer"===i.type||"storageBuffer"===i.type||"indirectStorageBuffer"===i.type){const e=i.node,n=this.getType(e.getNodeType(this)),s=e.bufferCount,a=s>0&&"buffer"===i.type?", "+s:"",l=e.isStorageBufferNode?`storage, ${this.getStorageAccess(e,t)}`:"uniform";if(this.isCustomStruct(i))r.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var<${l}> ${i.name} : ${n};`);else{const t=`\tvalue : array< ${e.isAtomic?`atomic<${n}>`:`${n}`}${a} >`;r.push(this._getWGSLStructBinding(i.name,t,l,o.binding++,o.group))}}else{const t=this.getType(this.getVectorType(i.type)),e=i.groupNode.name;(s[e]||(s[e]={index:o.binding++,id:o.group,snippets:[]})).snippets.push(`\t${i.name} : ${t}`)}}for(const t in s){const e=s[t];i.push(this._getWGSLStructBinding(t,e.snippets.join(",\n"),"uniform",e.index,e.id))}let o=n.join("\n");return o+=r.join("\n"),o+=i.join("\n"),o}buildCode(){const t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){this.shaderStage=e;const n=t[e];n.uniforms=this.getUniforms(e),n.attributes=this.getAttributes(e),n.varyings=this.getVaryings(e),n.structs=this.getStructs(e),n.vars=this.getVars(e),n.codes=this.getCodes(e),n.directives=this.getDirectives(e),n.scopedArrays=this.getScopedArrays(e);let r="// code\n\n";r+=this.flowCode[e];const i=this.flowNodes[e],s=i[i.length-1],o=s.outputNode,a=void 0!==o&&!0===o.isOutputStructNode;for(const t of i){const i=this.getFlowData(t),l=t.name;if(l&&(r.length>0&&(r+="\n"),r+=`\t// flow -> ${l}\n`),r+=`${i.code}\n\t`,t===s&&"compute"!==e)if(r+="// result\n\n\t","vertex"===e)r+=`varyings.Vertex = ${i.result};`;else if("fragment"===e)if(a)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${i.result};`;else{let t="\t@location(0) color: vec4<f32>";const e=this.getBuiltins("output");e&&(t+=",\n\t"+e),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",t),n.structs+="\nvar<private> output : OutputStruct;",r+=`output.color = ${i.result};\n\n\treturn output;`}}n.flow=r}this.shaderStage=null,null!==this.material?(this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment)):this.computeShader=this._getWGSLComputeCode(t.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(t,e=null){let n;return null!==e&&(n=this._getWGSLMethod(t+"_"+e)),void 0===n&&(n=this._getWGSLMethod(t)),n||t}getType(t){return ZZ[t]||t}isAvailable(t){let e=YZ[t];return void 0===e&&("float32Filterable"===t?e=this.renderer.hasFeature("float32-filterable"):"clipDistance"===t&&(e=this.renderer.hasFeature("clip-distances")),YZ[t]=e),e}_getWGSLMethod(t){return void 0!==QZ[t]&&this._include(t),tJ[t]}_include(t){const e=QZ[t];return e.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}\n// directives\n${t.directives}\n\n// structs\n${t.structs}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${t.codes}\n\n@vertex\nfn main( ${t.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(t){return`${this.getSignature()}\n// global\n${eJ}\n\n// structs\n${t.structs}\n\n// uniforms\n${t.uniforms}\n\n// codes\n${t.codes}\n\n@fragment\nfn main( ${t.varyings} ) -> ${t.returnType} {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}_getWGSLComputeCode(t,e){return`${this.getSignature()}\n// directives\n${t.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${t.scopedArrays}\n\n// structs\n${t.structs}\n\n// uniforms\n${t.uniforms}\n\n// codes\n${t.codes}\n\n@compute @workgroup_size( ${e} )\nfn main( ${t.attributes} ) {\n\n\t// system\n\tinstanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${e}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${e});\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}_getWGSLStruct(t,e){return`\nstruct ${t} {\n${e}\n};`}_getWGSLStructBinding(t,e,n,r=0,i=0){const s=t+"Struct";return`${this._getWGSLStruct(s,e)}\n@binding( ${r} ) @group( ${i} )\nvar<${n}> ${t} : ${s};`}}class rJ{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return null!==t.depthTexture?e=this.getTextureFormatGPU(t.depthTexture):t.depth&&t.stencil?e=NK.Depth24PlusStencil8:t.depth&&(e=NK.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getTextureSampleData(t){let e;if(t.isFramebufferTexture)e=1;else if(t.isDepthTexture&&!t.renderTarget){const t=this.backend.renderer,n=t.getRenderTarget();e=n?n.samples:t.samples}else t.renderTarget&&(e=t.renderTarget.samples);e=e||1;const n=e>1&&null!==t.renderTarget&&!0!==t.isDepthTexture&&!0!==t.isFramebufferTexture;return{samples:e,primarySamples:n?1:e,isMSAA:n}}getCurrentColorFormat(t){let e;return e=null!==t.textures?this.getTextureFormatGPU(t.textures[0]):this.getPreferredCanvasFormat(),e}getCurrentColorSpace(t){return null!==t.textures?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){return t.isPoints?lK:t.isLineSegments||t.isMesh&&!0===e.wireframe?uK:t.isLine?hK:t.isMesh?cK:void 0}getSampleCount(t){let e=1;return t>1&&(e=Math.pow(2,Math.floor(Math.log2(t))),2===e&&(e=4)),e}getSampleCountRenderContext(t){return null!==t.textures?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(void 0===t)return navigator.gpu.getPreferredCanvasFormat();if(t===sw)return NK.BGRA8Unorm;if(t===dw)return NK.RGBA16Float;throw new Error("Unsupported outputType")}}const iJ=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),sJ=new Map([[XT,["float16"]]]),oJ=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class aJ{constructor(t){this.backend=t}createAttribute(t,e){const n=this._getBufferAttribute(t),r=this.backend,i=r.get(n);let s=i.buffer;if(void 0===s){const o=r.device;let a=n.array;if(!1===t.normalized)if(a.constructor===Int16Array)a=new Int32Array(a);else if(a.constructor===Uint16Array&&(a=new Uint32Array(a),e&GPUBufferUsage.INDEX))for(let t=0;t<a.length;t++)65535===a[t]&&(a[t]=4294967295);if(n.array=a,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){a=new a.constructor(4*n.count);for(let t=0;t<n.count;t++)a.set(n.array.subarray(3*t,3*t+3),4*t);n.itemSize=4,n.array=a}const l=a.byteLength+(4-a.byteLength%4)%4;s=o.createBuffer({label:n.name,size:l,usage:e,mappedAtCreation:!0}),new a.constructor(s.getMappedRange()).set(a),s.unmap(),i.buffer=s}}updateAttribute(t){const e=this._getBufferAttribute(t),n=this.backend,r=n.device,i=n.get(e).buffer,s=e.array,o=this._isTypedArray(s),a=e.updateRanges;if(0===a.length)r.queue.writeBuffer(i,0,s,0);else{const t=o?1:s.BYTES_PER_ELEMENT;for(let e=0,n=a.length;e<n;e++){const n=a[e],o=n.start*t,l=n.count*t;r.queue.writeBuffer(i,0,s,o,l)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),n=new Map;for(let t=0;t<e.length;t++){const r=e[t],i=r.array.BYTES_PER_ELEMENT,s=this._getBufferAttribute(r);let o=n.get(s);if(void 0===o){let t,e;!0===r.isInterleavedBufferAttribute?(t=r.data.stride*i,e=r.data.isInstancedInterleavedBuffer?CZ:AZ):(t=r.itemSize*i,e=r.isInstancedBufferAttribute?CZ:AZ),!1!==r.normalized||r.array.constructor!==Int16Array&&r.array.constructor!==Uint16Array||(t=4),o={arrayStride:t,attributes:[],stepMode:e},n.set(s,o)}const a=this._getVertexFormat(r),l=!0===r.isInterleavedBufferAttribute?r.offset*i:0;o.attributes.push({shaderLocation:t,offset:l,format:a})}return Array.from(n.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,n=e.device,r=e.get(this._getBufferAttribute(t)).buffer,i=r.size,s=n.createBuffer({label:`${t.name}_readback`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({label:`readback_encoder_${t.name}`});o.copyBufferToBuffer(r,0,s,0,i);const a=o.finish();n.queue.submit([a]),await s.mapAsync(GPUMapMode.READ);const l=s.getMappedRange(),u=new t.array.constructor(l.slice(0));return s.unmap(),u.buffer}_getVertexFormat(t){const{itemSize:e,normalized:n}=t,r=t.array.constructor,i=t.constructor;let s;if(1===e)s=oJ.get(r);else{const t=(sJ.get(i)||iJ.get(r))[n?1:0];if(t){const n=r.BYTES_PER_ELEMENT*e,i=4*Math.floor((n+3)/4)/r.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");s=`${t}x${i}`}}return s||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),s}_isTypedArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class lJ{constructor(t){this.backend=t,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(t){const e=this.backend,n=e.device,r=[];let i=0;for(const n of t.bindings){const t={binding:i++,visibility:n.visibility};if(n.isUniformBuffer||n.isStorageBuffer){const e={};n.isStorageBuffer&&(4&n.visibility&&(n.access===YD||n.access===XD)?e.type=hZ:e.type=cZ),t.buffer=e}else if(n.isSampler){const e={};n.texture.isDepthTexture&&null!==n.texture.compareFunction&&(e.type="comparison"),t.sampler=e}else if(n.isSampledTexture&&n.texture.isVideoTexture)t.externalTexture={};else if(n.isSampledTexture&&n.store){const e={};e.format=this.backend.get(n.texture).texture.format;const r=n.access;e.access=r===YD?fZ:r===XD?dZ:pZ,t.storageTexture=e}else if(n.isSampledTexture){const r={},{primarySamples:i}=e.utils.getTextureSampleData(n.texture);if(i>1&&(r.multisampled=!0,n.texture.isDepthTexture||(r.sampleType=gZ)),n.texture.isDepthTexture)r.sampleType=yZ;else if(n.texture.isDataTexture||n.texture.isDataArrayTexture||n.texture.isData3DTexture){const t=n.texture.type;t===uw?r.sampleType=vZ:t===hw?r.sampleType=_Z:t===cw&&(this.backend.hasFeature("float32-filterable")?r.sampleType=mZ:r.sampleType=gZ)}n.isSampledCubeTexture?r.viewDimension=SZ:n.texture.isDataArrayTexture||n.texture.isCompressedArrayTexture?r.viewDimension=MZ:n.isSampledTexture3D&&(r.viewDimension=TZ),t.texture=r}else console.error(`WebGPUBindingUtils: Unsupported binding "${n}".`);r.push(t)}return n.createBindGroupLayout({entries:r})}createBindings(t,e,n,r=0){const{backend:i,bindGroupLayoutCache:s}=this,o=i.get(t);let a,l=s.get(t.bindingsReference);void 0===l&&(l=this.createBindingsLayout(t),s.set(t.bindingsReference,l)),n>0&&(void 0===o.groups&&(o.groups=[],o.versions=[]),o.versions[n]===r&&(a=o.groups[n])),void 0===a&&(a=this.createBindGroup(t,l),n>0&&(o.groups[n]=a,o.versions[n]=r)),o.group=a,o.layout=l}updateBinding(t){const e=this.backend,n=e.device,r=t.buffer,i=e.get(t).buffer;n.queue.writeBuffer(i,0,r,0)}createBindGroupIndex(t,e){const n=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=t[0],s=n.createBuffer({label:"bindingCameraIndex_"+i,size:16,usage:r});n.queue.writeBuffer(s,0,t,0);const o=[{binding:0,resource:{buffer:s}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+i,layout:e,entries:o})}createBindGroup(t,e){const n=this.backend,r=n.device;let i=0;const s=[];for(const e of t.bindings){if(e.isUniformBuffer){const t=n.get(e);if(void 0===t.buffer){const n=e.byteLength,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,s=r.createBuffer({label:"bindingBuffer_"+e.name,size:n,usage:i});t.buffer=s}s.push({binding:i,resource:{buffer:t.buffer}})}else if(e.isStorageBuffer){const t=n.get(e);if(void 0===t.buffer){const r=e.attribute;t.buffer=n.get(r).buffer}s.push({binding:i,resource:{buffer:t.buffer}})}else if(e.isSampler){const t=n.get(e.texture);s.push({binding:i,resource:t.sampler})}else if(e.isSampledTexture){const t=n.get(e.texture);let o;if(void 0!==t.externalTexture)o=r.importExternalTexture({source:t.externalTexture});else{const n=e.store?1:t.texture.mipLevelCount,r=`view-${t.texture.width}-${t.texture.height}-${n}`;if(o=t[r],void 0===o){const i=EZ;let s;s=e.isSampledCubeTexture?SZ:e.isSampledTexture3D?TZ:e.texture.isDataArrayTexture||e.texture.isCompressedArrayTexture?MZ:wZ,o=t[r]=t.texture.createView({aspect:i,dimension:s,mipLevelCount:n})}}s.push({binding:i,resource:o})}i++}return r.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:s})}}class uJ{constructor(t){this.backend=t}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:n,material:r,geometry:i,pipeline:s}=t,{vertexProgram:o,fragmentProgram:a}=s,l=this.backend,u=l.device,h=l.utils,c=l.get(s),d=[];for(const e of t.getBindings()){const t=l.get(e);d.push(t.layout)}const p=l.attributeUtils.createShaderVertexBuffers(t);let f;!0===r.transparent&&0!==r.blending&&(f=this._getBlending(r));let m={};!0===r.stencilWrite&&(m={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),y=[];if(null!==t.context.textures){const e=t.context.textures;for(let t=0;t<e.length;t++){const n=h.getTextureFormatGPU(e[t]);y.push({format:n,blend:f,writeMask:g})}}else{const e=h.getCurrentColorFormat(t.context);y.push({format:e,blend:f,writeMask:g})}const v=l.get(o).module,_=l.get(a).module,b=this._getPrimitiveState(n,i,r),x=this._getDepthCompare(r),w=h.getCurrentDepthStencilFormat(t.context),M=this._getSampleCount(t.context),S={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},v,{buffers:p}),fragment:Object.assign({},_,{targets:y}),primitive:b,multisample:{count:M,alphaToCoverageEnabled:r.alphaToCoverage&&M>1},layout:u.createPipelineLayout({bindGroupLayouts:d})},T={},E=t.context.depth,A=t.context.stencil;if(!0!==E&&!0!==A||(!0===E&&(T.format=w,T.depthWriteEnabled=r.depthWrite,T.depthCompare=x),!0===A&&(T.stencilFront=m,T.stencilBack={},T.stencilReadMask=r.stencilFuncMask,T.stencilWriteMask=r.stencilWriteMask),S.depthStencil=T),null===e)c.pipeline=u.createRenderPipeline(S);else{const t=new Promise((t=>{u.createRenderPipelineAsync(S).then((e=>{c.pipeline=e,t()}))}));e.push(t)}}createBundleEncoder(t){const e=this.backend,{utils:n,device:r}=e,i=n.getCurrentDepthStencilFormat(t),s={label:"renderBundleEncoder",colorFormats:[n.getCurrentColorFormat(t)],depthStencilFormat:i,sampleCount:this._getSampleCount(t)};return r.createRenderBundleEncoder(s)}createComputePipeline(t,e){const n=this.backend,r=n.device,i=n.get(t.computeProgram).module,s=n.get(t),o=[];for(const t of e){const e=n.get(t);o.push(e.layout)}s.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(t){let e,n;const r=t.blending,i=t.blendSrc,s=t.blendDst,o=t.blendEquation;if(5===r){const r=null!==t.blendSrcAlpha?t.blendSrcAlpha:i,a=null!==t.blendDstAlpha?t.blendDstAlpha:s,l=null!==t.blendEquationAlpha?t.blendEquationAlpha:o;e={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(l)}}else{const i=(t,r,i,s)=>{e={srcFactor:t,dstFactor:r,operation:YK},n={srcFactor:i,dstFactor:s,operation:YK}};if(t.premultipliedAlpha)switch(r){case 1:i(UK,jK,UK,jK);break;case 2:i(UK,UK,UK,UK);break;case 3:i(LK,zK,LK,UK);break;case 4:i(LK,FK,LK,BK)}else switch(r){case 1:i(BK,jK,UK,jK);break;case 2:i(BK,UK,BK,UK);break;case 3:i(LK,zK,LK,UK);break;case 4:i(LK,FK,LK,FK)}}if(void 0!==e&&void 0!==n)return{color:e,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(t){let e;switch(t){case 200:e=LK;break;case 201:e=UK;break;case 202:e=FK;break;case 203:e=zK;break;case Ex:e=BK;break;case Ax:e=jK;break;case 208:e=VK;break;case 209:e=GK;break;case 206:e=HK;break;case 207:e=WK;break;case 210:e=qK;break;case 211:e=$K;break;case 212:e=XK;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const n=t.stencilFunc;switch(n){case 512:e=pK;break;case 519:e=bK;break;case 513:e=fK;break;case 515:e=gK;break;case 514:e=mK;break;case 518:e=_K;break;case 516:e=yK;break;case 517:e=vK;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return e}_getStencilOperation(t){let e;switch(t){case dM:e=nZ;break;case 0:e=rZ;break;case 7681:e=iZ;break;case 5386:e=sZ;break;case 7682:e=oZ;break;case 7683:e=aZ;break;case 34055:e=lZ;break;case 34056:e=uZ;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case _x:e=YK;break;case 101:e=KK;break;case 102:e=ZK;break;case 103:e=JK;break;case 104:e=QK;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,n){const r={},i=this.backend.utils;switch(r.topology=i.getPrimitiveTopology(t,n),null!==e.index&&!0===t.isLine&&!0!==t.isLineSegments&&(r.stripIndexFormat=e.index.array instanceof Uint16Array?CK:RK),n.side){case 0:r.frontFace=SK,r.cullMode=AK;break;case 1:r.frontFace=SK,r.cullMode=EK;break;case 2:r.frontFace=SK,r.cullMode=TK;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return r}_getColorWriteMask(t){return!0===t.colorWrite?eZ:tZ}_getDepthCompare(t){let e;if(!1===t.depthTest)e=bK;else{const n=t.depthFunc;switch(n){case 0:e=pK;break;case 1:e=bK;break;case 2:e=fK;break;case 3:e=gK;break;case 4:e=mK;break;case 5:e=_K;break;case 6:e=yK;break;case 7:e=vK;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return e}}class hJ extends sK{constructor(t,e,n=2048){super(n),this.device=t,this.type=e,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${e}`});const r=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${e}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${e}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(t){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return WM(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(t.id,e),e}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const t=new Map(this.queryOffsets),e=this.currentQueryIndex,n=8*e;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,e,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=r.finish();if(this.device.queue.submit([i]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const s=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let o=0;for(const[,e]of t){const t=s[e],n=s[e+1];o+=Number(n-t)/1e6}return this.resultBuffer.unmap(),this.lastValue=o,o}catch(t){return console.error("Error resolving queries:",t),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(t){console.error("Error waiting for pending resolve:",t)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(t){console.error("Error unmapping buffer:",t)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class cJ extends VY{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===t.alpha||t.alpha,this.parameters.requiredLimits=void 0===t.requiredLimits?{}:t.requiredLimits,this.trackTimestamp=!0===t.trackTimestamp,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new rJ(this),this.attributeUtils=new aJ(this),this.bindingUtils=new lJ(this),this.pipelineUtils=new uJ(this),this.textureUtils=new FZ(this),this.occludedResolveCache=new Map}async init(t){await super.init(t);const e=this.parameters;let n;if(void 0===e.device){const t={powerPreference:e.powerPreference},r="undefined"!=typeof navigator?await navigator.gpu.requestAdapter(t):null;if(null===r)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(RZ),s=[];for(const t of i)r.features.has(t)&&s.push(t);const o={requiredFeatures:s,requiredLimits:e.requiredLimits};n=await r.requestDevice(o)}else n=e.device;n.lost.then((e=>{const n={api:"WebGPU",message:e.message||"Unknown reason",reason:e.reason||null,originalEvent:e};t.onDeviceLost(n)}));const r=void 0!==e.context?e.context:t.domElement.getContext("webgpu");this.device=n,this.context=r;const i=e.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(RZ.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i}),this.updateSize()}get coordinateSystem(){return TM}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let t=this.defaultRenderPassdescriptor;if(null===t){const e=this.renderer;t={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(t.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const n=t.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=t}const e=t.colorAttachments[0];return this.renderer.samples>0?e.resolveTarget=this.context.getCurrentTexture().createView():e.view=this.context.getCurrentTexture().createView(),t}_getRenderPassDescriptor(t,e={}){const n=t.renderTarget,r=this.get(n);let i=r.descriptors;if(void 0===i||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==n.activeMipmapLevel||r.activeCubeFace!==t.activeCubeFace||r.samples!==n.samples||r.loadOp!==e.loadOp){i={},r.descriptors=i;const t=()=>{n.removeEventListener("dispose",t),this.delete(n)};n.addEventListener("dispose",t)}const s=t.getCacheKey();let o=i[s];if(void 0===o){const a=t.textures,l=[];let u;for(let r=0;r<a.length;r++){const i=this.get(a[r]),s={label:`colorAttachment_${r}`,baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,arrayLayerCount:1,dimension:wZ};n.isRenderTarget3D?(u=t.activeCubeFace,s.baseArrayLayer=0,s.dimension=TZ,s.depthOrArrayLayers=a[r].image.depth):n.isRenderTargetArray&&(s.dimension=MZ,s.depthOrArrayLayers=a[r].image.depth);const o=i.texture.createView(s);let h,c;void 0!==i.msaaTexture?(h=i.msaaTexture.createView(),c=o):(h=o,c=void 0),l.push({view:h,depthSlice:u,resolveTarget:c,loadOp:wK,storeOp:xK,...e})}if(o={colorAttachments:l},t.depth){const e={view:this.get(t.depthTexture).texture.createView()};o.depthStencilAttachment=e}i[s]=o,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=t.activeMipmapLevel,r.activeCubeFace=t.activeCubeFace,r.dimensions=n.dimensions,r.depthSlice=u,r.loadOp=l[0].loadOp}return o}beginRender(t){const e=this.get(t),n=this.device,r=t.occlusionQueryCount;let i,s;r>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${t.id}`}),e.occlusionQuerySet=i,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(r),e.lastOcclusionObject=null),s=null===t.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(t,{loadOp:wK}),this.initTimestampQuery(t,s),s.occlusionQuerySet=i;const o=s.depthStencilAttachment;if(null!==t.textures){const e=s.colorAttachments;for(let n=0;n<e.length;n++){const r=e[n];t.clearColor?(r.clearValue=0===n?t.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=MK,r.storeOp=xK):(r.loadOp=wK,r.storeOp=xK)}}else{const e=s.colorAttachments[0];t.clearColor?(e.clearValue=t.clearColorValue,e.loadOp=MK,e.storeOp=xK):(e.loadOp=wK,e.storeOp=xK)}t.depth&&(t.clearDepth?(o.depthClearValue=t.clearDepthValue,o.depthLoadOp=MK,o.depthStoreOp=xK):(o.depthLoadOp=wK,o.depthStoreOp=xK)),t.stencil&&(t.clearStencil?(o.stencilClearValue=t.clearStencilValue,o.stencilLoadOp=MK,o.stencilStoreOp=xK):(o.stencilLoadOp=wK,o.stencilStoreOp=xK));const a=n.createCommandEncoder({label:"renderContext_"+t.id}),l=a.beginRenderPass(s);if(e.descriptor=s,e.encoder=a,e.currentPass=l,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[],t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:n,width:r,height:i}=t.scissorValue;l.setScissorRect(e,n,r,i)}}finishRender(t){const e=this.get(t),n=t.occlusionQueryCount;if(e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),n>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery(),e.currentPass.end(),n>0){const r=8*n;let i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));const s=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,n,i,0),e.encoder.copyBufferToBuffer(i,0,s,0,r),e.occlusionQueryBuffer=s,this.resolveOccludedAsync(t)}if(this.device.queue.submit([e.encoder.finish()]),null!==t.textures){const e=t.textures;for(let t=0;t<e.length;t++){const n=e[t];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=e;if(n&&r){const t=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const i=n.getMappedRange(),s=new BigUint64Array(i);for(let e=0;e<r.length;e++)s[e]===BigInt(0)&&t.add(r[e]);n.destroy(),e.occluded=t}}updateViewport(t){const{currentPass:e}=this.get(t),{x:n,y:r,width:i,height:s,minDepth:o,maxDepth:a}=t.viewportValue;e.setViewport(n,r,i,s,o,a)}clear(t,e,n,r=null){const i=this.device,s=this.renderer;let o,a,l,u,h=[];if(t){const t=this.getClearColor();if(!0===this.renderer.alpha){const e=t.a;a={r:t.r*e,g:t.g*e,b:t.b*e,a:e}}else a={r:t.r,g:t.g,b:t.b,a:t.a}}if(null===r){l=s.depth,u=s.stencil;const e=this._getDefaultRenderPassDescriptor();if(t){h=e.colorAttachments;const t=h[0];t.clearValue=a,t.loadOp=MK,t.storeOp=xK}(l||u)&&(o=e.depthStencilAttachment)}else{if(l=r.depth,u=r.stencil,t){h=this._getRenderPassDescriptor(r,{loadOp:MK,clearValue:a}).colorAttachments}if(l||u){o={view:this.get(r.depthTexture).texture.createView()}}}l&&(e?(o.depthLoadOp=MK,o.depthClearValue=s.getClearDepth(),o.depthStoreOp=xK):(o.depthLoadOp=wK,o.depthStoreOp=xK)),u&&(n?(o.stencilLoadOp=MK,o.stencilClearValue=s.getClearStencil(),o.stencilStoreOp=xK):(o.stencilLoadOp=wK,o.stencilStoreOp=xK));const c=i.createCommandEncoder({label:"clear"});c.beginRenderPass({colorAttachments:h,depthStencilAttachment:o}).end(),i.queue.submit([c.finish()])}beginCompute(t){const e=this.get(t),n={label:"computeGroup_"+t.id};this.initTimestampQuery(t,n),e.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+t.id}),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(n)}compute(t,e,n,r){const{passEncoderGPU:i}=this.get(t),s=this.get(r).pipeline;i.setPipeline(s);for(let t=0,e=n.length;t<e;t++){const e=n[t],r=this.get(e);i.setBindGroup(t,r.group)}const o=this.device.limits.maxComputeWorkgroupsPerDimension,a=this.get(e);void 0===a.dispatchSize&&(a.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=a;e.dispatchCount>o?(l.x=Math.min(e.dispatchCount,o),l.y=Math.ceil(e.dispatchCount/o)):l.x=e.dispatchCount,i.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.device.queue.submit([e.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(t,e){const{object:n,context:r,pipeline:i}=t,s=t.getBindings(),o=this.get(r),a=this.get(i).pipeline,l=o.currentSets,u=o.currentPass,h=t.getDrawParameters();if(null===h)return;l.pipeline!==a&&(u.setPipeline(a),l.pipeline=a);const c=l.bindingGroups;for(let t=0,e=s.length;t<e;t++){const e=s[t],n=this.get(e);c[e.index]!==e.id&&(u.setBindGroup(e.index,n.group),c[e.index]=e.id)}const d=t.getIndex(),p=null!==d;if(!0===p&&l.index!==d){const t=this.get(d).buffer,e=d.array instanceof Uint16Array?CK:RK;u.setIndexBuffer(t,e),l.index=d}const f=t.getVertexBuffers();for(let t=0,e=f.length;t<e;t++){const e=f[t];if(l.attributes[t]!==e){const n=this.get(e).buffer;u.setVertexBuffer(t,n),l.attributes[t]=e}}if(void 0!==o.occlusionQuerySet){const t=o.lastOcclusionObject;t!==n&&(null!==t&&!0===t.occlusionTest&&(u.endOcclusionQuery(),o.occlusionQueryIndex++),!0===n.occlusionTest&&(u.beginOcclusionQuery(o.occlusionQueryIndex),o.occlusionQueryObjects[o.occlusionQueryIndex]=n),o.lastOcclusionObject=n)}const m=()=>{if(!0===n.isBatchedMesh){const t=n._multiDrawStarts,e=n._multiDrawCounts,r=n._multiDrawCount,i=n._multiDrawInstances;for(let n=0;n<r;n++){const r=i?i[n]:1,s=r>1?0:n;!0===p?u.drawIndexed(e[n],r,t[n]/d.array.BYTES_PER_ELEMENT,0,s):u.draw(e[n],r,t[n],s)}}else if(!0===p){const{vertexCount:r,instanceCount:i,firstVertex:s}=h,o=t.getIndirect();if(null!==o){const t=this.get(o).buffer;u.drawIndexedIndirect(t,0)}else u.drawIndexed(r,i,s,0,0);e.update(n,r,i)}else{const{vertexCount:r,instanceCount:i,firstVertex:s}=h,o=t.getIndirect();if(null!==o){const t=this.get(o).buffer;u.drawIndirect(t,0)}else u.draw(r,i,s,0);e.update(n,r,i)}};if(t.camera.isArrayCamera&&t.camera.cameras.length>0){const e=this.get(t.camera),i=t.camera.cameras,s=t.getBindingGroup("cameraIndex");if(void 0===e.indexesGPU||e.indexesGPU.length!==i.length){const t=this.get(s),n=[],r=new Uint32Array([0,0,0,0]);for(let e=0,s=i.length;e<s;e++){r[0]=e;const i=this.bindingUtils.createBindGroupIndex(r,t.layout);n.push(i)}e.indexesGPU=n}const o=this.renderer.getPixelRatio();for(let t=0,a=i.length;t<a;t++){const a=i[t];if(n.layers.test(a.layers)){const n=a.viewport;u.setViewport(Math.floor(n.x*o),Math.floor(n.y*o),Math.floor(n.width*o),Math.floor(n.height*o),r.viewportValue.minDepth,r.viewportValue.maxDepth),u.setBindGroup(s.index,e.indexesGPU[t]),m()}}}else m()}needsRenderUpdate(t){const e=this.get(t),{object:n,material:r}=t,i=this.utils,s=i.getSampleCountRenderContext(t.context),o=i.getCurrentColorSpace(t.context),a=i.getCurrentColorFormat(t.context),l=i.getCurrentDepthStencilFormat(t.context),u=i.getPrimitiveTopology(n,r);let h=!1;return e.material===r&&e.materialVersion===r.version&&e.transparent===r.transparent&&e.blending===r.blending&&e.premultipliedAlpha===r.premultipliedAlpha&&e.blendSrc===r.blendSrc&&e.blendDst===r.blendDst&&e.blendEquation===r.blendEquation&&e.blendSrcAlpha===r.blendSrcAlpha&&e.blendDstAlpha===r.blendDstAlpha&&e.blendEquationAlpha===r.blendEquationAlpha&&e.colorWrite===r.colorWrite&&e.depthWrite===r.depthWrite&&e.depthTest===r.depthTest&&e.depthFunc===r.depthFunc&&e.stencilWrite===r.stencilWrite&&e.stencilFunc===r.stencilFunc&&e.stencilFail===r.stencilFail&&e.stencilZFail===r.stencilZFail&&e.stencilZPass===r.stencilZPass&&e.stencilFuncMask===r.stencilFuncMask&&e.stencilWriteMask===r.stencilWriteMask&&e.side===r.side&&e.alphaToCoverage===r.alphaToCoverage&&e.sampleCount===s&&e.colorSpace===o&&e.colorFormat===a&&e.depthStencilFormat===l&&e.primitiveTopology===u&&e.clippingContextCacheKey===t.clippingContextCacheKey||(e.material=r,e.materialVersion=r.version,e.transparent=r.transparent,e.blending=r.blending,e.premultipliedAlpha=r.premultipliedAlpha,e.blendSrc=r.blendSrc,e.blendDst=r.blendDst,e.blendEquation=r.blendEquation,e.blendSrcAlpha=r.blendSrcAlpha,e.blendDstAlpha=r.blendDstAlpha,e.blendEquationAlpha=r.blendEquationAlpha,e.colorWrite=r.colorWrite,e.depthWrite=r.depthWrite,e.depthTest=r.depthTest,e.depthFunc=r.depthFunc,e.stencilWrite=r.stencilWrite,e.stencilFunc=r.stencilFunc,e.stencilFail=r.stencilFail,e.stencilZFail=r.stencilZFail,e.stencilZPass=r.stencilZPass,e.stencilFuncMask=r.stencilFuncMask,e.stencilWriteMask=r.stencilWriteMask,e.side=r.side,e.alphaToCoverage=r.alphaToCoverage,e.sampleCount=s,e.colorSpace=o,e.colorFormat=a,e.depthStencilFormat=l,e.primitiveTopology=u,e.clippingContextCacheKey=t.clippingContextCacheKey,h=!0),h}getRenderCacheKey(t){const{object:e,material:n}=t,r=this.utils,i=t.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(e,n),t.getGeometryCacheKey(),t.clippingContextCacheKey].join()}createSampler(t){this.textureUtils.createSampler(t)}destroySampler(t){this.textureUtils.destroySampler(t)}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}async copyTextureToBuffer(t,e,n,r,i,s){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i,s)}initTimestampQuery(t,e){if(!this.trackTimestamp)return;const n=t.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new hJ(this.device,n,2048));const r=this.timestampQueryPool[n],i=r.allocateQueriesForContext(t);e.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(t,e){return new nJ(t,e)}createProgram(t){this.get(t).module={module:this.device.createShaderModule({code:t.code,label:t.stage+(""!==t.name?`_${t.name}`:"")}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const n=this.get(t),r=n.currentPass.finish();this.get(e).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t,e,n,r){this.bindingUtils.createBindings(t,e,n,r)}updateBindings(t,e,n,r){this.bindingUtils.createBindings(t,e,n,r)}updateBinding(t){this.bindingUtils.updateBinding(t)}createIndexAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(t){return this.device.features.has(t)}copyTextureToTexture(t,e,n=null,r=null,i=0){let s=0,o=0,a=0,l=0,u=0,h=0,c=t.image.width,d=t.image.height;null!==n&&(l=n.x,u=n.y,h=n.z||0,c=n.width,d=n.height),null!==r&&(s=r.x,o=r.y,a=r.z||0);const p=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),f=this.get(t).texture,m=this.get(e).texture;p.copyTextureToTexture({texture:f,mipLevel:i,origin:{x:l,y:u,z:h}},{texture:m,mipLevel:i,origin:{x:s,y:o,z:a}},[c,d,1]),this.device.queue.submit([p.finish()])}copyFramebufferToTexture(t,e,n){const r=this.get(e);let i=null;i=e.renderTarget?t.isDepthTexture?this.get(e.depthTexture).texture:this.get(e.textures[0]).texture:t.isDepthTexture?this.textureUtils.getDepthBuffer(e.depth,e.stencil):this.context.getCurrentTexture();const s=this.get(t).texture;if(i.format!==s.format)return void console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,s.format);let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),o.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:s},[n.z,n.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t),r.currentPass){const{descriptor:t}=r;for(let e=0;e<t.colorAttachments.length;e++)t.colorAttachments[e].loadOp=wK;if(e.depth&&(t.depthStencilAttachment.depthLoadOp=wK),e.stencil&&(t.depthStencilAttachment.stencilLoadOp=wK),r.currentPass=o.beginRenderPass(t),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.viewport&&this.updateViewport(e),e.scissor){const{x:t,y:n,width:i,height:s}=e.scissorValue;r.currentPass.setScissorRect(t,n,i,s)}}else this.device.queue.submit([o.finish()])}}class dJ extends XA{constructor(t,e,n,r,i,s){super(t,e,n,r,i,s),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class pJ extends nY{constructor(){super(),this.addMaterial(DG,"MeshPhongMaterial"),this.addMaterial(eW,"MeshStandardMaterial"),this.addMaterial(rW,"MeshPhysicalMaterial"),this.addMaterial(aW,"MeshToonMaterial"),this.addMaterial(EG,"MeshBasicMaterial"),this.addMaterial(OG,"MeshLambertMaterial"),this.addMaterial(dG,"MeshNormalMaterial"),this.addMaterial(cW,"MeshMatcapMaterial"),this.addMaterial(lG,"LineBasicMaterial"),this.addMaterial(hG,"LineDashedMaterial"),this.addMaterial(yW,"PointsMaterial"),this.addMaterial(mW,"SpriteMaterial"),this.addMaterial(bW,"ShadowMaterial"),this.addLight(T$,QA),this.addLight(NX,nC),this.addLight(IX,iC),this.addLight(DX,XA),this.addLight(UX,rC),this.addLight(FX,VA),this.addLight(zX,oC),this.addLight(LX,dJ),this.addToneMapping(Tq,1),this.addToneMapping(Eq,2),this.addToneMapping(Aq,3),this.addToneMapping(Rq,4),this.addToneMapping(Oq,6),this.addToneMapping(Iq,7)}}class fJ extends xY{constructor(t={}){let e;t.forceWebGL?e=aK:(e=cJ,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new aK(t)));super(new e(t),t),this.library=new pJ,this.isWebGPURenderer=!0}}const mJ={type:"change"},gJ={type:"start"},yJ={type:"end"},vJ=1e-6,_J=-1,bJ=0,xJ=1,wJ=2,MJ=3,SJ=4,TJ=new FM,EJ=new FM,AJ=new cS,CJ=new cS,RJ=new cS,NJ=new hS,PJ=new cS,kJ=new cS,OJ=new cS,IJ=new cS;class DJ extends yC{constructor(t,e=null){super(t,e),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:ux,MIDDLE:hx,RIGHT:cx},this.state=_J,this.keyState=_J,this.target=new cS,this._lastPosition=new cS,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new cS,this._movePrev=new FM,this._moveCurr=new FM,this._lastAxis=new cS,this._zoomStart=new FM,this._zoomEnd=new FM,this._panStart=new FM,this._panEnd=new FM,this._pointers=[],this._pointerPositions={},this._onPointerMove=UJ.bind(this),this._onPointerDown=LJ.bind(this),this._onPointerUp=FJ.bind(this),this._onPointerCancel=zJ.bind(this),this._onContextMenu=qJ.bind(this),this._onMouseWheel=WJ.bind(this),this._onKeyDown=jJ.bind(this),this._onKeyUp=BJ.bind(this),this._onTouchStart=$J.bind(this),this._onTouchMove=XJ.bind(this),this._onTouchEnd=YJ.bind(this),this._onMouseDown=VJ.bind(this),this._onMouseMove=GJ.bind(this),this._onMouseUp=HJ.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==e&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>vJ&&(this.dispatchEvent(mJ),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>vJ||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(mJ),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=_J,this.keyState=_J,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(mJ),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(EJ.copy(this._panEnd).sub(this._panStart),EJ.lengthSq()){if(this.object.isOrthographicCamera){const t=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,e=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;EJ.x*=t,EJ.y*=e}EJ.multiplyScalar(this._eye.length()*this.panSpeed),CJ.copy(this._eye).cross(this.object.up).setLength(EJ.x),CJ.add(AJ.copy(this.object.up).setLength(EJ.y)),this.object.position.add(CJ),this.target.add(CJ),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(EJ.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){IJ.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let t=IJ.length();t?(this._eye.copy(this.object.position).sub(this.target),PJ.copy(this._eye).normalize(),kJ.copy(this.object.up).normalize(),OJ.crossVectors(kJ,PJ).normalize(),kJ.setLength(this._moveCurr.y-this._movePrev.y),OJ.setLength(this._moveCurr.x-this._movePrev.x),IJ.copy(kJ.add(OJ)),RJ.crossVectors(IJ,this._eye).normalize(),t*=this.rotateSpeed,NJ.setFromAxisAngle(RJ,t),this._eye.applyQuaternion(NJ),this.object.up.applyQuaternion(NJ),this._lastAxis.copy(RJ),this._lastAngle=t):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),NJ.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(NJ),this.object.up.applyQuaternion(NJ)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let t;this.state===SJ?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=UM.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==t&&t>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=UM.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(t,e){return TJ.set((t-this.screen.left)/this.screen.width,(e-this.screen.top)/this.screen.height),TJ}_getMouseOnCircle(t,e){return TJ.set((t-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-e))/this.screen.width),TJ}_addPointer(t){this._pointers.push(t)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId==t.pointerId)return void this._pointers.splice(e,1)}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new FM,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[e.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function LJ(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t))}function UJ(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function FJ(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchEnd(t):this._onMouseUp(),this._removePointer(t),0===this._pointers.length&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function zJ(t){this._removePointer(t)}function BJ(){!1!==this.enabled&&(this.keyState=_J,window.addEventListener("keydown",this._onKeyDown))}function jJ(t){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===_J&&(t.code!==this.keys[bJ]||this.noRotate?t.code!==this.keys[xJ]||this.noZoom?t.code!==this.keys[wJ]||this.noPan||(this.keyState=wJ):this.keyState=xJ:this.keyState=bJ))}function VJ(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case hx:this.state=xJ;break;case ux:this.state=bJ;break;case cx:this.state=wJ;break;default:this.state=_J}const n=this.keyState!==_J?this.keyState:this.state;n!==bJ||this.noRotate?n!==xJ||this.noZoom?n!==wJ||this.noPan||(this._panStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(gJ)}function GJ(t){const e=this.keyState!==_J?this.keyState:this.state;e!==bJ||this.noRotate?e!==xJ||this.noZoom?e!==wJ||this.noPan||this._panEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)))}function HJ(){this.state=_J,this.dispatchEvent(yJ)}function WJ(t){if(!1!==this.enabled&&!0!==this.noZoom){switch(t.preventDefault(),t.deltaMode){case 2:this._zoomStart.y-=.025*t.deltaY;break;case 1:this._zoomStart.y-=.01*t.deltaY;break;default:this._zoomStart.y-=25e-5*t.deltaY}this.dispatchEvent(gJ),this.dispatchEvent(yJ)}}function qJ(t){!1!==this.enabled&&t.preventDefault()}function $J(t){if(this._trackPointer(t),1===this._pointers.length)this.state=MJ,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=SJ;const t=this._pointers[0].pageX-this._pointers[1].pageX,e=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+e*e);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(gJ)}function XJ(t){if(this._trackPointer(t),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY));else{const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+r*r);const i=(t.pageX+e.x)/2,s=(t.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s))}}function YJ(t){switch(this._pointers.length){case 0:this.state=_J;break;case 1:this.state=MJ,this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=SJ;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==t.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(yJ)}const KJ={type:"change"},ZJ={type:"start"},JJ={type:"end"},QJ=new BS,tQ=new WE,eQ=Math.cos(70*UM.DEG2RAD),nQ=new cS,rQ=2*Math.PI,iQ=-1,sQ=0,oQ=1,aQ=2,lQ=3,uQ=4,hQ=5,cQ=6,dQ=1e-6;class pQ extends yC{constructor(t,e=null){super(t,e),this.state=iQ,this.enabled=!0,this.target=new cS,this.cursor=new cS,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ux,MIDDLE:hx,RIGHT:cx},this.touches={ONE:dx,TWO:fx},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new cS,this._lastQuaternion=new hS,this._lastTargetPosition=new cS,this._quat=(new hS).setFromUnitVectors(t.up,new cS(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new mC,this._sphericalDelta=new mC,this._scale=1,this._panOffset=new cS,this._rotateStart=new FM,this._rotateEnd=new FM,this._rotateDelta=new FM,this._panStart=new FM,this._panEnd=new FM,this._panDelta=new FM,this._dollyStart=new FM,this._dollyEnd=new FM,this._dollyDelta=new FM,this._dollyDirection=new cS,this._mouse=new FM,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=mQ.bind(this),this._onPointerDown=fQ.bind(this),this._onPointerUp=gQ.bind(this),this._onContextMenu=MQ.bind(this),this._onMouseWheel=_Q.bind(this),this._onKeyDown=bQ.bind(this),this._onTouchStart=xQ.bind(this),this._onTouchMove=wQ.bind(this),this._onMouseDown=yQ.bind(this),this._onMouseMove=vQ.bind(this),this._interceptControlDown=SQ.bind(this),this._interceptControlUp=TQ.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(KJ),this.update(),this.state=iQ}update(t=null){const e=this.object.position;nQ.copy(e).sub(this.target),nQ.applyQuaternion(this._quat),this._spherical.setFromVector3(nQ),this.autoRotate&&this.state===iQ&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=rQ:n>Math.PI&&(n-=rQ),r<-Math.PI?r+=rQ:r>Math.PI&&(r-=rQ),this._spherical.theta=n<=r?Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=t!=this._spherical.radius}if(nQ.setFromSpherical(this._spherical),nQ.applyQuaternion(this._quatInverse),e.copy(this.target).add(nQ),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=nQ.length();t=this._clampDistance(e*this._scale);const n=e-t;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),i=!!n}else if(this.object.isOrthographicCamera){const e=new cS(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=n!==this.object.zoom;const r=new cS(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(e),this.object.updateMatrixWorld(),t=nQ.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(QJ.origin.copy(this.object.position),QJ.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(QJ.direction))<eQ?this.object.lookAt(this.target):(tQ.setFromNormalAndCoplanarPoint(this.object.up,this.target),QJ.intersectPlane(tQ,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,!!(i||this._lastPosition.distanceToSquared(this.object.position)>dQ||8*(1-this._lastQuaternion.dot(this.object.quaternion))>dQ||this._lastTargetPosition.distanceToSquared(this.target)>dQ)&&(this.dispatchEvent(KJ),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?rQ/60*this.autoRotateSpeed*t:rQ/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){nQ.setFromMatrixColumn(e,0),nQ.multiplyScalar(-t),this._panOffset.add(nQ)}_panUp(t,e){!0===this.screenSpacePanning?nQ.setFromMatrixColumn(e,1):(nQ.setFromMatrixColumn(e,0),nQ.crossVectors(this.object.up,nQ)),nQ.multiplyScalar(t),this._panOffset.add(nQ)}_pan(t,e){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;nQ.copy(r).sub(this.target);let i=nQ.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/n.clientHeight,this.object.matrix),this._panUp(2*e*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=t-n.left,i=e-n.top,s=n.width,o=n.height;this._mouse.x=r/s*2-1,this._mouse.y=-i/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(rQ*this._rotateDelta.x/e.clientHeight),this._rotateUp(rQ*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(rQ*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-rQ*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(rQ*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-rQ*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panStart.set(n,r)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(rQ*this._rotateDelta.x/e.clientHeight),this._rotateUp(rQ*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new FM,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function fQ(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function mQ(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function gQ(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(JJ),this.state=iQ;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y})}}function yQ(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case hx:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=oQ;break;case ux:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=aQ}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=sQ}break;case cx:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=sQ}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=aQ}break;default:this.state=iQ}this.state!==iQ&&this.dispatchEvent(ZJ)}function vQ(t){switch(this.state){case sQ:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case oQ:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case aQ:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function _Q(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===iQ&&(t.preventDefault(),this.dispatchEvent(ZJ),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(JJ))}function bQ(t){!1!==this.enabled&&this._handleKeyDown(t)}function xQ(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case dx:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=lQ;break;case px:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=uQ;break;default:this.state=iQ}break;case 2:switch(this.touches.TWO){case fx:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=hQ;break;case mx:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=cQ;break;default:this.state=iQ}break;default:this.state=iQ}this.state!==iQ&&this.dispatchEvent(ZJ)}function wQ(t){switch(this._trackPointer(t),this.state){case lQ:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case uQ:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case hQ:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case cQ:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=iQ}}function MQ(t){!1!==this.enabled&&t.preventDefault()}function SQ(t){if("Control"===t.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function TQ(t){if("Control"===t.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const EQ={type:"change"},AQ=1e-6,CQ=new hS;class RQ extends yC{constructor(t,e=null){super(t,e),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new cS(0,0,0),this._rotationVector=new cS(0,0,0),this._lastQuaternion=new hS,this._lastPosition=new cS,this._status=0,this._onKeyDown=NQ.bind(this),this._onKeyUp=PQ.bind(this),this._onPointerMove=OQ.bind(this),this._onPointerDown=kQ.bind(this),this._onPointerUp=IQ.bind(this),this._onPointerCancel=DQ.bind(this),this._onContextMenu=LQ.bind(this),null!==e&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(t){if(!1===this.enabled)return;const e=this.object,n=t*this.movementSpeed,r=t*this.rollSpeed;e.translateX(this._moveVector.x*n),e.translateY(this._moveVector.y*n),e.translateZ(this._moveVector.z*n),CQ.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),e.quaternion.multiply(CQ),(this._lastPosition.distanceToSquared(e.position)>AQ||8*(1-this._lastQuaternion.dot(e.quaternion))>AQ)&&(this.dispatchEvent(EQ),this._lastQuaternion.copy(e.quaternion),this._lastPosition.copy(e.position))}_updateMovementVector(){const t=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-t+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function NQ(t){if(!t.altKey&&!1!==this.enabled){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function PQ(t){if(!1!==this.enabled){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function kQ(t){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(t.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function OQ(t){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),n=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(t.pageX-e.offset[0]-n)/n,this._moveState.pitchDown=(t.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function IQ(t){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(t.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function DQ(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function LQ(t){!1!==this.enabled&&t.preventDefault()}const UQ={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class FQ{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const zQ=new tC(-1,1,1,-1,0,1);const BQ=new class extends rE{constructor(){super(),this.setAttribute("position",new YT([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new YT([0,2,0,0,2,0],2))}};class jQ{constructor(t){this._mesh=new mE(BQ,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,zQ)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class VQ extends FQ{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof wE?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=xE.clone(t.uniforms),this.material=new wE({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new jQ(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class GQ extends FQ{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const r=t.getContext(),i=t.state;let s,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,s,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class HQ extends FQ{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class WQ{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===e){const n=t.getSize(new FM);this._width=n.width,this._height=n.height,(e=new aS(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:dw})).texture.name="EffectComposer.rt1"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new VQ(UQ),this.copyPass.material.blending=0,this.clock=new lC}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,r=this.passes.length;e<r;e++){const r=this.passes[e];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),r.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==GQ&&(r instanceof GQ?n=!0:r instanceof HQ&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new FM);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class qQ extends FQ{constructor(t,e,n=null,r=null,i=null){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new OT}render(t,e,n){const r=t.autoClear;let i,s;t.autoClear=!1,null!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(t.getClearColor(this._oldClearColor),t.setClearColor(this.clearColor,t.getClearAlpha())),null!==this.clearAlpha&&(i=t.getClearAlpha(),t.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),null!==this.clearColor&&t.setClearColor(this._oldClearColor),null!==this.clearAlpha&&t.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=s),t.autoClear=r}}function $Q(){return $Q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$Q.apply(null,arguments)}function XQ(t,e){return XQ=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},XQ(t,e)}function YQ(t){return YQ=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},YQ(t)}function KQ(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(KQ=function(){return!!t})()}function ZQ(t){var e="function"==typeof Map?new Map:void 0;return ZQ=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(KQ())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&XQ(i,n.prototype),i}(t,arguments,YQ(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),XQ(n,t)},ZQ(t)}var JQ={1:"Passed invalid arguments to hsl, please pass multiple numbers e.g. hsl(360, 0.75, 0.4) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75 }).\n\n",2:"Passed invalid arguments to hsla, please pass multiple numbers e.g. hsla(360, 0.75, 0.4, 0.7) or an object e.g. rgb({ hue: 255, saturation: 0.4, lightness: 0.75, alpha: 0.7 }).\n\n",3:"Passed an incorrect argument to a color function, please pass a string representation of a color.\n\n",4:"Couldn't generate valid rgb string from %s, it returned %s.\n\n",5:"Couldn't parse the color string. Please provide the color as a string in hex, rgb, rgba, hsl or hsla notation.\n\n",6:"Passed invalid arguments to rgb, please pass multiple numbers e.g. rgb(255, 205, 100) or an object e.g. rgb({ red: 255, green: 205, blue: 100 }).\n\n",7:"Passed invalid arguments to rgba, please pass multiple numbers e.g. rgb(255, 205, 100, 0.75) or an object e.g. rgb({ red: 255, green: 205, blue: 100, alpha: 0.75 }).\n\n",8:"Passed invalid argument to toColorString, please pass a RgbColor, RgbaColor, HslColor or HslaColor object.\n\n",9:"Please provide a number of steps to the modularScale helper.\n\n",10:"Please pass a number or one of the predefined scales to the modularScale helper as the ratio.\n\n",11:'Invalid value passed as base to modularScale, expected number or em string but got "%s"\n\n',12:'Expected a string ending in "px" or a number passed as the first argument to %s(), got "%s" instead.\n\n',13:'Expected a string ending in "px" or a number passed as the second argument to %s(), got "%s" instead.\n\n',14:'Passed invalid pixel value ("%s") to %s(), please pass a value like "12px" or 12.\n\n',15:'Passed invalid base value ("%s") to %s(), please pass a value like "12px" or 12.\n\n',16:"You must provide a template to this method.\n\n",17:"You passed an unsupported selector state to this method.\n\n",18:"minScreen and maxScreen must be provided as stringified numbers with the same units.\n\n",19:"fromSize and toSize must be provided as stringified numbers with the same units.\n\n",20:"expects either an array of objects or a single object with the properties prop, fromSize, and toSize.\n\n",21:"expects the objects in the first argument array to have the properties `prop`, `fromSize`, and `toSize`.\n\n",22:"expects the first argument object to have the properties `prop`, `fromSize`, and `toSize`.\n\n",23:"fontFace expects a name of a font-family.\n\n",24:"fontFace expects either the path to the font file(s) or a name of a local copy.\n\n",25:"fontFace expects localFonts to be an array.\n\n",26:"fontFace expects fileFormats to be an array.\n\n",27:"radialGradient requries at least 2 color-stops to properly render.\n\n",28:"Please supply a filename to retinaImage() as the first argument.\n\n",29:"Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.\n\n",30:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",31:"The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation\n\n",32:"To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s')\n\n",33:"The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation\n\n",34:"borderRadius expects a radius value as a string or number as the second argument.\n\n",35:'borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.\n\n',36:"Property must be a string value.\n\n",37:"Syntax Error at %s.\n\n",38:"Formula contains a function that needs parentheses at %s.\n\n",39:"Formula is missing closing parenthesis at %s.\n\n",40:"Formula has too many closing parentheses at %s.\n\n",41:"All values in a formula must have the same unit or be unitless.\n\n",42:"Please provide a number of steps to the modularScale helper.\n\n",43:"Please pass a number or one of the predefined scales to the modularScale helper as the ratio.\n\n",44:"Invalid value passed as base to modularScale, expected number or em/rem string but got %s.\n\n",45:"Passed invalid argument to hslToColorString, please pass a HslColor or HslaColor object.\n\n",46:"Passed invalid argument to rgbToColorString, please pass a RgbColor or RgbaColor object.\n\n",47:"minScreen and maxScreen must be provided as stringified numbers with the same units.\n\n",48:"fromSize and toSize must be provided as stringified numbers with the same units.\n\n",49:"Expects either an array of objects or a single object with the properties prop, fromSize, and toSize.\n\n",50:"Expects the objects in the first argument array to have the properties prop, fromSize, and toSize.\n\n",51:"Expects the first argument object to have the properties prop, fromSize, and toSize.\n\n",52:"fontFace expects either the path to the font file(s) or a name of a local copy.\n\n",53:"fontFace expects localFonts to be an array.\n\n",54:"fontFace expects fileFormats to be an array.\n\n",55:"fontFace expects a name of a font-family.\n\n",56:"linearGradient requries at least 2 color-stops to properly render.\n\n",57:"radialGradient requries at least 2 color-stops to properly render.\n\n",58:"Please supply a filename to retinaImage() as the first argument.\n\n",59:"Passed invalid argument to triangle, please pass correct pointingDirection e.g. 'right'.\n\n",60:"Passed an invalid value to `height` or `width`. Please provide a pixel based unit.\n\n",61:"Property must be a string value.\n\n",62:"borderRadius expects a radius value as a string or number as the second argument.\n\n",63:'borderRadius expects one of "top", "bottom", "left" or "right" as the first argument.\n\n',64:"The animation shorthand only takes 8 arguments. See the specification for more information: http://mdn.io/animation.\n\n",65:"To pass multiple animations please supply them in arrays, e.g. animation(['rotate', '2s'], ['move', '1s'])\\nTo pass a single animation please supply them in simple values, e.g. animation('rotate', '2s').\n\n",66:"The animation shorthand arrays can only have 8 elements. See the specification for more information: http://mdn.io/animation.\n\n",67:"You must provide a template to this method.\n\n",68:"You passed an unsupported selector state to this method.\n\n",69:'Expected a string ending in "px" or a number passed as the first argument to %s(), got %s instead.\n\n',70:'Expected a string ending in "px" or a number passed as the second argument to %s(), got %s instead.\n\n',71:'Passed invalid pixel value %s to %s(), please pass a value like "12px" or 12.\n\n',72:'Passed invalid base value %s to %s(), please pass a value like "12px" or 12.\n\n',73:"Please provide a valid CSS variable.\n\n",74:"CSS variable not found and no default was provided.\n\n",75:"important requires a valid style object, got a %s instead.\n\n",76:"fromSize and toSize must be provided as stringified numbers with the same units as minScreen and maxScreen.\n\n",77:'remToPx expects a value in "rem" but you provided it in "%s".\n\n',78:'base must be set in "px" or "%" but you set it in "%s".\n'};function QQ(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r,i=e[0],s=[];for(r=1;r<e.length;r+=1)s.push(e[r]);return s.forEach((function(t){i=i.replace(/%[a-z]/,t)})),i}var t0=function(t){function e(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t.call(this,QQ.apply(void 0,[JQ[e]].concat(r)))||this)}return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,XQ(t,e)}(e,t),e}(ZQ(Error));function e0(t){return Math.round(255*t)}function n0(t,e,n){return e0(t)+","+e0(e)+","+e0(n)}function r0(t,e,n,r){if(void 0===r&&(r=n0),0===e)return r(n,n,n);var i=(t%360+360)%360/60,s=(1-Math.abs(2*n-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,l=0,u=0;i>=0&&i<1?(a=s,l=o):i>=1&&i<2?(a=o,l=s):i>=2&&i<3?(l=s,u=o):i>=3&&i<4?(l=o,u=s):i>=4&&i<5?(a=o,u=s):i>=5&&i<6&&(a=s,u=o);var h=n-s/2;return r(a+h,l+h,u+h)}var i0={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var s0=/^#[a-fA-F0-9]{6}$/,o0=/^#[a-fA-F0-9]{8}$/,a0=/^#[a-fA-F0-9]{3}$/,l0=/^#[a-fA-F0-9]{4}$/,u0=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,h0=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,c0=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,d0=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function p0(t){if("string"!=typeof t)throw new t0(3);var e=function(t){if("string"!=typeof t)return t;var e=t.toLowerCase();return i0[e]?"#"+i0[e]:t}(t);if(e.match(s0))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(o0)){var n=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:n}}if(e.match(a0))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(l0)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=u0.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=h0.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=c0.exec(e);if(o){var a="rgb("+r0(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=u0.exec(a);if(!l)throw new t0(4,e,a);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var u=d0.exec(e.substring(0,50));if(u){var h="rgb("+r0(parseInt(""+u[1],10),parseInt(""+u[2],10)/100,parseInt(""+u[3],10)/100)+")",c=u0.exec(h);if(!c)throw new t0(4,e,h);return{red:parseInt(""+c[1],10),green:parseInt(""+c[2],10),blue:parseInt(""+c[3],10),alpha:parseFloat(""+u[4])>1?parseFloat(""+u[4])/100:parseFloat(""+u[4])}}throw new t0(5)}function f0(t){return function(t){var e,n=t.red/255,r=t.green/255,i=t.blue/255,s=Math.max(n,r,i),o=Math.min(n,r,i),a=(s+o)/2;if(s===o)return void 0!==t.alpha?{hue:0,saturation:0,lightness:a,alpha:t.alpha}:{hue:0,saturation:0,lightness:a};var l=s-o,u=a>.5?l/(2-s-o):l/(s+o);switch(s){case n:e=(r-i)/l+(r<i?6:0);break;case r:e=(i-n)/l+2;break;default:e=(n-r)/l+4}return e*=60,void 0!==t.alpha?{hue:e,saturation:u,lightness:a,alpha:t.alpha}:{hue:e,saturation:u,lightness:a}}(p0(t))}var m0=function(t){return 7===t.length&&t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?"#"+t[1]+t[3]+t[5]:t};function g0(t){var e=t.toString(16);return 1===e.length?"0"+e:e}function y0(t){return g0(Math.round(255*t))}function v0(t,e,n){return m0("#"+y0(t)+y0(e)+y0(n))}function _0(t,e,n){return r0(t,e,n,v0)}function b0(t,e,n){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n)return m0("#"+g0(t)+g0(e)+g0(n));if("object"==typeof t&&void 0===e&&void 0===n)return m0("#"+g0(t.red)+g0(t.green)+g0(t.blue));throw new t0(6)}function x0(t,e,n,r){if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?b0(t.red,t.green,t.blue):"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")";throw new t0(7)}function w0(t){if("object"!=typeof t)throw new t0(8);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&"number"==typeof t.alpha}(t))return x0(t);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return b0(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&"number"==typeof t.alpha}(t))return function(t,e,n,r){if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?_0(t.hue,t.saturation,t.lightness):"rgba("+r0(t.hue,t.saturation,t.lightness)+","+t.alpha+")";throw new t0(2)}(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return function(t,e,n){if("object"==typeof t&&void 0===e&&void 0===n)return _0(t.hue,t.saturation,t.lightness);throw new t0(1)}(t);throw new t0(8)}function M0(t,e,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=e?t.apply(this,r):M0(t,e,r)}}function S0(t){return M0(t,t.length,[])}function T0(t,e,n){return Math.max(t,Math.min(e,n))}S0((function(t,e){if("transparent"===e)return e;var n=f0(e);return w0($Q({},n,{hue:n.hue+parseFloat(t)}))})),S0((function(t,e){if("transparent"===e)return e;var n=f0(e);return w0($Q({},n,{lightness:T0(0,1,n.lightness-parseFloat(t))}))})),S0((function(t,e){if("transparent"===e)return e;var n=f0(e);return w0($Q({},n,{saturation:T0(0,1,n.saturation-parseFloat(t))}))})),S0((function(t,e){if("transparent"===e)return e;var n=f0(e);return w0($Q({},n,{lightness:T0(0,1,n.lightness+parseFloat(t))}))}));var E0=S0((function(t,e,n){if("transparent"===e)return n;if("transparent"===n)return e;if(0===t)return n;var r=p0(e),i=$Q({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=p0(n),o=$Q({},s,{alpha:"number"==typeof s.alpha?s.alpha:1}),a=i.alpha-o.alpha,l=2*parseFloat(t)-1,u=((l*a==-1?l:l+a)/(1+l*a)+1)/2,h=1-u;return x0({red:Math.floor(i.red*u+o.red*h),green:Math.floor(i.green*u+o.green*h),blue:Math.floor(i.blue*u+o.blue*h),alpha:i.alpha*parseFloat(t)+o.alpha*(1-parseFloat(t))})})),A0=E0;var C0=S0((function(t,e){if("transparent"===e)return e;var n=p0(e);return x0($Q({},n,{alpha:T0(0,1,(100*("number"==typeof n.alpha?n.alpha:1)+100*parseFloat(t))/100)}))})),R0=C0;S0((function(t,e){if("transparent"===e)return e;var n=f0(e);return w0($Q({},n,{saturation:T0(0,1,n.saturation+parseFloat(t))}))})),S0((function(t,e){return"transparent"===e?e:w0($Q({},f0(e),{hue:parseFloat(t)}))})),S0((function(t,e){return"transparent"===e?e:w0($Q({},f0(e),{lightness:parseFloat(t)}))})),S0((function(t,e){return"transparent"===e?e:w0($Q({},f0(e),{saturation:parseFloat(t)}))})),S0((function(t,e){return"transparent"===e?e:A0(parseFloat(t),"rgb(0, 0, 0)",e)})),S0((function(t,e){return"transparent"===e?e:A0(parseFloat(t),"rgb(255, 255, 255)",e)})),S0((function(t,e){if("transparent"===e)return e;var n=p0(e);return x0($Q({},n,{alpha:T0(0,1,+(100*("number"==typeof n.alpha?n.alpha:1)-100*parseFloat(t)).toFixed(2)/100)}))}));var N0=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return t},Out:function(t){return t},InOut:function(t){return t}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(t){var e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-N0.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*N0.Bounce.In(2*t):.5*N0.Bounce.Out(2*t-1)+.5}}),generatePow:function(t){return void 0===t&&(t=4),t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(2*e,t)/2:(1-Math.pow(2-2*e,t))/2+.5}}}}),P0=function(){return performance.now()},k0=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,t)}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var s=i[r];null===(t=s._group)||void 0===t||t.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var i=r[n];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},t.prototype.allStopped=function(){return this.getAll().every((function(t){return!t.isPlaying()}))},t.prototype.update=function(t,e){void 0===t&&(t=P0()),void 0===e&&(e=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],s=!e;i&&!1===i.update(t,s)&&!e&&this.remove(i)}n=Object.keys(this._tweensAddedDuringUpdate)}},t}(),O0={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),s=O0.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t}}},I0=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),D0=new k0,L0=function(){function t(t,e){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=N0.Linear.None,this._interpolationFunction=O0.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=I0.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=t,"object"==typeof e?(this._group=e,e.add(this)):!0===e&&(this._group=D0,D0.add(this))}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.getDuration=function(){return this._duration},t.prototype.to=function(t,e){if(void 0===e&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e<0?0:e,this},t.prototype.duration=function(t){return void 0===t&&(t=1e3),this._duration=t<0?0:t,this},t.prototype.dynamic=function(t){return void 0===t&&(t=!1),this._isDynamic=t,this},t.prototype.start=function(t,e){if(void 0===t&&(t=P0()),void 0===e&&(e=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},t.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},t.prototype._setupProperties=function(t,e,n,r,i){for(var s in n){var o=t[s],a=Array.isArray(o),l=a?"array":typeof o,u=!a&&Array.isArray(n[s]);if("undefined"!==l&&"function"!==l){if(u){if(0===(g=n[s]).length)continue;for(var h=[o],c=0,d=g.length;c<d;c+=1){var p=this._handleRelativeValue(o,g[c]);if(isNaN(p)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(p)}u&&(n[s]=h)}if("object"!==l&&!a||!o||u)(void 0===e[s]||i)&&(e[s]=o),a||(e[s]*=1),r[s]=u?n[s].slice().reverse():e[s]||0;else{e[s]=a?[]:{};var f=o;for(var m in f)e[s][m]=f[m];r[s]=a?[]:{};var g=n[s];if(!this._isDynamic){var y={};for(var m in g)y[m]=g[m];n[s]=g=y}this._setupProperties(f,e[s],g,r[s],i)}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},t.prototype.pause=function(t){return void 0===t&&(t=P0()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t),this},t.prototype.resume=function(t){return void 0===t&&(t=P0()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},t.prototype.remove=function(){var t;return null===(t=this._group)||void 0===t||t.remove(this),this},t.prototype.delay=function(t){return void 0===t&&(t=0),this._delayTime=t,this},t.prototype.repeat=function(t){return void 0===t&&(t=0),this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return void 0===t&&(t=!1),this._yoyo=t,this},t.prototype.easing=function(t){return void 0===t&&(t=N0.Linear.None),this._easingFunction=t,this},t.prototype.interpolation=function(t){return void 0===t&&(t=O0.Linear),this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(e,n){var r,i,s=this;if(void 0===e&&(e=P0()),void 0===n&&(n=t.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),l=this._duration+this._repeat*a,u=function(){if(0===s._duration)return 1;if(o>l)return 1;var t=Math.trunc(o/a),e=o-t*a,n=Math.min(e/s._duration,1);return 0===n&&o===s._duration?1:n}(),h=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),0===this._duration||o>=this._duration){if(this._repeat>0){var c=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=c),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*c,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var d=0,p=this._chainedTweens.length;d<p;d++)this._chainedTweens[d].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var s=e[i]||0,o=n[i],a=Array.isArray(t[i]),l=Array.isArray(o);!a&&l?t[i]=this._interpolationFunction(o,r):"object"==typeof o&&o?this._updateProperties(t[i],s,o,r):"number"==typeof(o=this._handleRelativeValue(s,o))&&(t[i]=s+(o-s)*r)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t.autoStartOnUpdate=!1,t}();I0.nextId;var U0=D0;U0.getAll.bind(U0),U0.removeAll.bind(U0),U0.add.bind(U0),U0.remove.bind(U0),U0.update.bind(U0);var F0="http://www.w3.org/1999/xhtml",z0={svg:"http://www.w3.org/2000/svg",xhtml:F0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function B0(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),z0.hasOwnProperty(e)?{space:z0[e],local:t}:t}function j0(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===F0&&e.documentElement.namespaceURI===F0?e.createElement(t):e.createElementNS(n,t)}}function V0(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function G0(t){var e=B0(t);return(e.local?V0:j0)(e)}function H0(){}function W0(t){return null==t?H0:function(){return this.querySelector(t)}}function q0(){return[]}function $0(t){return function(){return function(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}(t.apply(this,arguments))}}function X0(t){return function(e){return e.matches(t)}}var Y0=Array.prototype.find;function K0(){return this.firstElementChild}var Z0=Array.prototype.filter;function J0(){return Array.from(this.children)}function Q0(t){return new Array(t.length)}function t1(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function e1(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new t1(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function n1(t,e,n,r,i,s,o){var a,l,u,h=new Map,c=e.length,d=s.length,p=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(p[a]=u=o.call(l,l.__data__,a,e)+"",h.has(u)?i[a]=l:h.set(u,l));for(a=0;a<d;++a)u=o.call(t,s[a],a,s)+"",(l=h.get(u))?(r[a]=l,l.__data__=s[a],h.delete(u)):n[a]=new t1(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&h.get(p[a])===l&&(i[a]=l)}function r1(t){return t.__data__}function i1(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function s1(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function o1(t){return function(){this.removeAttribute(t)}}function a1(t){return function(){this.removeAttributeNS(t.space,t.local)}}function l1(t,e){return function(){this.setAttribute(t,e)}}function u1(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function h1(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function c1(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function d1(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function p1(t){return function(){this.style.removeProperty(t)}}function f1(t,e,n){return function(){this.style.setProperty(t,e,n)}}function m1(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function g1(t){return function(){delete this[t]}}function y1(t,e){return function(){this[t]=e}}function v1(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function _1(t){return t.trim().split(/^|\s+/)}function b1(t){return t.classList||new x1(t)}function x1(t){this._node=t,this._names=_1(t.getAttribute("class")||"")}function w1(t,e){for(var n=b1(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function M1(t,e){for(var n=b1(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function S1(t){return function(){w1(this,t)}}function T1(t){return function(){M1(this,t)}}function E1(t,e){return function(){(e.apply(this,arguments)?w1:M1)(this,t)}}function A1(){this.textContent=""}function C1(t){return function(){this.textContent=t}}function R1(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function N1(){this.innerHTML=""}function P1(t){return function(){this.innerHTML=t}}function k1(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function O1(){this.nextSibling&&this.parentNode.appendChild(this)}function I1(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function D1(){return null}function L1(){var t=this.parentNode;t&&t.removeChild(this)}function U1(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function F1(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function z1(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function B1(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function j1(t,e,n){var r=d1(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function V1(t,e){return function(){return j1(this,t,e)}}function G1(t,e){return function(){return j1(this,t,e.apply(this,arguments))}}t1.prototype={constructor:t1,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},x1.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var H1=[null];function W1(t,e){this._groups=t,this._parents=e}W1.prototype={constructor:W1,select:function(t){"function"!=typeof t&&(t=W0(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),h=0;h<l;++h)(s=a[h])&&(o=t.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),u[h]=o);return new W1(r,this._parents)},selectAll:function(t){t="function"==typeof t?$0(t):function(t){return null==t?q0:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,u=0;u<l;++u)(o=a[u])&&(r.push(t.call(o,o.__data__,u,a)),i.push(o));return new W1(r,i)},selectChild:function(t){return this.select(null==t?K0:function(t){return function(){return Y0.call(this.children,t)}}("function"==typeof t?t:X0(t)))},selectChildren:function(t){return this.selectAll(null==t?J0:function(t){return function(){return Z0.call(this.children,t)}}("function"==typeof t?t:X0(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new W1(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,r1);var n=e?n1:e1,r=this._parents,i=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],c=i[u],d=c.length,p=i1(t.call(h,h&&h.__data__,u,r)),f=p.length,m=a[u]=new Array(f),g=o[u]=new Array(f);n(h,c,m,g,l[u]=new Array(d),p,e);for(var y,v,_=0,b=0;_<f;++_)if(y=m[_]){for(_>=b&&(b=_+1);!(v=g[b])&&++b<f;);y._next=v||null}}return(o=new W1(o,r))._enter=a,o._exit=l,o},enter:function(){return new W1(this._enter||this._groups.map(Q0),this._parents)},exit:function(){return new W1(this._exit||this._groups.map(Q0),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u,h=n[l],c=r[l],d=h.length,p=a[l]=new Array(d),f=0;f<d;++f)(u=h[f]||c[f])&&(p[f]=u);for(;l<i;++l)a[l]=n[l];return new W1(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=s1);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),h=0;h<l;++h)(o=a[h])&&(u[h]=o);u.sort(e)}return new W1(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=B0(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?a1:o1:"function"==typeof e?n.local?c1:h1:n.local?u1:l1)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?p1:"function"==typeof e?m1:f1)(t,e,null==n?"":n)):function(t,e){return t.style.getPropertyValue(e)||d1(t).getComputedStyle(t,null).getPropertyValue(e)}(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?g1:"function"==typeof e?v1:y1)(t,e)):this.node()[t]},classed:function(t,e){var n=_1(t+"");if(arguments.length<2){for(var r=b1(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?E1:e?S1:T1)(n,e))},text:function(t){return arguments.length?this.each(null==t?A1:("function"==typeof t?R1:C1)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?N1:("function"==typeof t?k1:P1)(t)):this.node().innerHTML},raise:function(){return this.each(O1)},lower:function(){return this.each(I1)},append:function(t){var e="function"==typeof t?t:G0(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:G0(t),r=null==e?D1:"function"==typeof e?e:W0(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(L1)},clone:function(t){return this.select(t?F1:U1)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?B1:z1,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,h=a.length;u<h;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?G1:V1)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};var q1,$1,X1,Y1,K1,Z1,J1,Q1,t2,e2,n2,r2,i2={},s2=[],o2=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,a2=Array.isArray;function l2(t,e){for(var n in e)t[n]=e[n];return t}function u2(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function h2(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==i?++X1:i,__i:-1,__u:0};return null==i&&null!=$1.vnode&&$1.vnode(s),s}function c2(t){return t.children}function d2(t,e){this.props=t,this.context=e}function p2(t,e){if(null==e)return t.__?p2(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?p2(t):null}function f2(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return f2(t)}}function m2(t){(!t.__d&&(t.__d=!0)&&K1.push(t)&&!g2.__r++||Z1!==$1.debounceRendering)&&((Z1=$1.debounceRendering)||J1)(g2)}function g2(){var t,e,n,r,i,s,o,a;for(K1.sort(Q1);t=K1.shift();)t.__d&&(e=K1.length,r=void 0,s=(i=(n=t).__v).__e,o=[],a=[],n.__P&&((r=l2({},i)).__v=i.__v+1,$1.vnode&&$1.vnode(r),M2(n.__P,r,i,n.__n,n.__P.namespaceURI,32&i.__u?[s]:null,o,null==s?p2(i):s,!!(32&i.__u),a),r.__v=i.__v,r.__.__k[r.__i]=r,S2(o,r,a),r.__e!=s&&f2(r)),K1.length>e&&K1.sort(Q1));g2.__r=0}function y2(t,e,n,r,i,s,o,a,l,u,h){var c,d,p,f,m,g,y=r&&r.__k||s2,v=e.length;for(l=function(t,e,n,r,i){var s,o,a,l,u,h=n.length,c=h,d=0;for(t.__k=new Array(i),s=0;s<i;s++)null!=(o=e[s])&&"boolean"!=typeof o&&"function"!=typeof o?(l=s+d,(o=t.__k[s]="string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?h2(null,o,null,null,null):a2(o)?h2(c2,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?h2(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,-1!==(u=o.__i=_2(o,n,l,c))&&(c--,(a=n[u])&&(a.__u|=2)),null==a||null===a.__v?(-1==u&&d--,"function"!=typeof o.type&&(o.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,o.__u|=4))):t.__k[s]=null;if(c)for(s=0;s<h;s++)null!=(a=n[s])&&!(2&a.__u)&&(a.__e==r&&(r=p2(a)),E2(a,a));return r}(n,e,y,l,v),c=0;c<v;c++)null!=(p=n.__k[c])&&(d=-1===p.__i?i2:y[p.__i]||i2,p.__i=c,g=M2(t,p,d,i,s,o,a,l,u,h),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&T2(d.ref,null,p),h.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),4&p.__u||d.__k===p.__k?l=v2(p,l,t):"function"==typeof p.type&&void 0!==g?l=g:f&&(l=f.nextSibling),p.__u&=-7);return n.__e=m,l}function v2(t,e,n){var r,i;if("function"==typeof t.type){for(r=t.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=t,e=v2(r[i],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=p2(t)),n.insertBefore(t.__e,e||null),e=t.__e);do{e=e&&e.nextSibling}while(null!=e&&8==e.nodeType);return e}function _2(t,e,n,r){var i,s,o=t.key,a=t.type,l=e[n];if(null===l||l&&o==l.key&&a===l.type&&!(2&l.__u))return n;if(r>(null==l||2&l.__u?0:1))for(i=n-1,s=n+1;i>=0||s<e.length;){if(i>=0){if((l=e[i])&&!(2&l.__u)&&o==l.key&&a===l.type)return i;i--}if(s<e.length){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s++}}return-1}function b2(t,e,n){"-"==e[0]?t.setProperty(e,null==n?"":n):t[e]=null==n?"":"number"!=typeof n||o2.test(e)?n:n+"px"}function x2(t,e,n,r,i){var s;t:if("style"==e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof r&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||b2(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||b2(t.style,e,n[e])}else if("o"==e[0]&&"n"==e[1])s=e!=(e=e.replace(t2,"$1")),e=e.toLowerCase()in t||"onFocusOut"==e||"onFocusIn"==e?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=e2,t.addEventListener(e,s?r2:n2,s)):t.removeEventListener(e,s?r2:n2,s);else{if("http://www.w3.org/2000/svg"==i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=e&&"height"!=e&&"href"!=e&&"list"!=e&&"form"!=e&&"tabIndex"!=e&&"download"!=e&&"rowSpan"!=e&&"colSpan"!=e&&"role"!=e&&"popover"!=e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&"-"!=e[4]?t.removeAttribute(e):t.setAttribute(e,"popover"==e&&1==n?"":n))}}function w2(t){return function(e){if(this.l){var n=this.l[e.type+t];if(null==e.t)e.t=e2++;else if(e.t<n.u)return;return n($1.event?$1.event(e):e)}}}function M2(t,e,n,r,i,s,o,a,l,u){var h,c,d,p,f,m,g,y,v,_,b,x,w,M,S,T,E,A=e.type;if(void 0!==e.constructor)return null;128&n.__u&&(l=!!(32&n.__u),s=[a=e.__e=n.__e]),(h=$1.__b)&&h(e);t:if("function"==typeof A)try{if(y=e.props,v="prototype"in A&&A.prototype.render,_=(h=A.contextType)&&r[h.__c],b=h?_?_.props.value:h.__:r,n.__c?g=(c=e.__c=n.__c).__=c.__E:(v?e.__c=c=new A(y,b):(e.__c=c=new d2(y,b),c.constructor=A,c.render=A2),_&&_.sub(c),c.props=y,c.state||(c.state={}),c.context=b,c.__n=r,d=c.__d=!0,c.__h=[],c._sb=[]),v&&null==c.__s&&(c.__s=c.state),v&&null!=A.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=l2({},c.__s)),l2(c.__s,A.getDerivedStateFromProps(y,c.__s))),p=c.props,f=c.state,c.__v=e,d)v&&null==A.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),v&&null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(v&&null==A.getDerivedStateFromProps&&y!==p&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(y,b),!c.__e&&(null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(y,c.__s,b)||e.__v==n.__v)){for(e.__v!=n.__v&&(c.props=y,c.state=c.__s,c.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some((function(t){t&&(t.__=e)})),x=0;x<c._sb.length;x++)c.__h.push(c._sb[x]);c._sb=[],c.__h.length&&o.push(c);break t}null!=c.componentWillUpdate&&c.componentWillUpdate(y,c.__s,b),v&&null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(p,f,m)}))}if(c.context=b,c.props=y,c.__P=t,c.__e=!1,w=$1.__r,M=0,v){for(c.state=c.__s,c.__d=!1,w&&w(e),h=c.render(c.props,c.state,c.context),S=0;S<c._sb.length;S++)c.__h.push(c._sb[S]);c._sb=[]}else do{c.__d=!1,w&&w(e),h=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++M<25);c.state=c.__s,null!=c.getChildContext&&(r=l2(l2({},r),c.getChildContext())),v&&!d&&null!=c.getSnapshotBeforeUpdate&&(m=c.getSnapshotBeforeUpdate(p,f)),a=y2(t,a2(T=null!=h&&h.type===c2&&null==h.key?h.props.children:h)?T:[T],e,n,r,i,s,o,a,l,u),c.base=e.__e,e.__u&=-161,c.__h.length&&o.push(c),g&&(c.__E=c.__=null)}catch(t){if(e.__v=null,l||null!=s)if(t.then){for(e.__u|=l?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(E=s.length;E--;)u2(s[E]);else e.__e=n.__e,e.__k=n.__k;$1.__e(t,e,n)}else null==s&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=function(t,e,n,r,i,s,o,a,l){var u,h,c,d,p,f,m,g=n.props,y=e.props,v=e.type;if("svg"==v?i="http://www.w3.org/2000/svg":"math"==v?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),null!=s)for(u=0;u<s.length;u++)if((p=s[u])&&"setAttribute"in p==!!v&&(v?p.localName==v:3==p.nodeType)){t=p,s[u]=null;break}if(null==t){if(null==v)return document.createTextNode(y);t=document.createElementNS(i,v,y.is&&y),a&&($1.__m&&$1.__m(e,s),a=!1),s=null}if(null===v)g===y||a&&t.data===y||(t.data=y);else{if(s=s&&q1.call(t.childNodes),g=n.props||i2,!a&&null!=s)for(g={},u=0;u<t.attributes.length;u++)g[(p=t.attributes[u]).name]=p.value;for(u in g)if(p=g[u],"children"==u);else if("dangerouslySetInnerHTML"==u)c=p;else if(!(u in y)){if("value"==u&&"defaultValue"in y||"checked"==u&&"defaultChecked"in y)continue;x2(t,u,null,p,i)}for(u in y)p=y[u],"children"==u?d=p:"dangerouslySetInnerHTML"==u?h=p:"value"==u?f=p:"checked"==u?m=p:a&&"function"!=typeof p||g[u]===p||x2(t,u,p,g[u],i);if(h)a||c&&(h.__html===c.__html||h.__html===t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(c&&(t.innerHTML=""),y2(t,a2(d)?d:[d],e,n,r,"foreignObject"==v?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&p2(n,0),a,l),null!=s)for(u=s.length;u--;)u2(s[u]);a||(u="value","progress"==v&&null==f?t.removeAttribute("value"):void 0!==f&&(f!==t[u]||"progress"==v&&!f||"option"==v&&f!==g[u])&&x2(t,u,f,g[u],i),u="checked",void 0!==m&&m!==t[u]&&x2(t,u,m,g[u],i))}return t}(n.__e,e,n,r,i,s,o,l,u);return(h=$1.diffed)&&h(e),128&e.__u?void 0:a}function S2(t,e,n){for(var r=0;r<n.length;r++)T2(n[r],n[++r],n[++r]);$1.__c&&$1.__c(e,t),t.some((function(e){try{t=e.__h,e.__h=[],t.some((function(t){t.call(e)}))}catch(t){$1.__e(t,e.__v)}}))}function T2(t,e,n){try{if("function"==typeof t){var r="function"==typeof t.__u;r&&t.__u(),r&&null==e||(t.__u=t(e))}else t.current=e}catch(t){$1.__e(t,n)}}function E2(t,e,n){var r,i;if($1.unmount&&$1.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||T2(r,null,e)),null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){$1.__e(t,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&E2(r[i],e,n||"function"!=typeof t.type);n||u2(t.__e),t.__c=t.__=t.__e=void 0}function A2(t,e,n){return this.constructor(t,n)}function C2(t,e,n){var r,i,s;e==document&&(e=document.documentElement),$1.__&&$1.__(t,e),r=!1?null:e.__k,i=[],s=[],M2(e,t=e.__k=function(t,e,n){var r,i,s,o={};for(s in e)"key"==s?r=e[s]:"ref"==s?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?q1.call(arguments,2):n),"function"==typeof t&&null!=t.defaultProps)for(s in t.defaultProps)void 0===o[s]&&(o[s]=t.defaultProps[s]);return h2(t,o,r,i,null)}(c2,null,[t]),r||i2,i2,e.namespaceURI,r?null:e.firstChild?q1.call(e.childNodes):null,i,r?r.__e:e.firstChild,false,s),S2(i,t,s)}function R2(t,e,n){var r,i,s,o,a=l2({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)"key"==s?r=e[s]:"ref"==s?i=e[s]:a[s]=void 0===e[s]&&void 0!==o?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?q1.call(arguments,2):n),h2(t.type,a,r||t.key,i||t.ref,null)}function N2(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function P2(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O2(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return N2(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N2(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I2(t){return I2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I2(t)}q1=s2.slice,$1={__e:function(t,e,n,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&null!=s.getDerivedStateFromError&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(e){t=e}throw t}},X1=0,Y1=function(t){return null!=t&&null==t.constructor},d2.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=l2({},this.state),"function"==typeof t&&(t=t(l2({},n),this.props)),t&&l2(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),m2(this))},d2.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),m2(this))},d2.prototype.render=c2,K1=[],J1="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Q1=function(t,e){return t.__v.__b-e.__v.__b},g2.__r=0,t2=/(PointerCapture)$|Capture$/i,e2=0,n2=w2(!1),r2=w2(!0);var D2=function(t){if("object"!==I2(t))return t;var e,n=R2(t);n.props&&(n.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k2(Object(n),!0).forEach((function(e){P2(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n.props),null!=n&&null!==(e=n.props)&&void 0!==e&&e.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(D2):D2(n.props.children)));return n};!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var L2=jO({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,r=void 0===n?{}:n,i=function(t){return"string"==typeof t?new W1([[document.querySelector(t)]],[document.documentElement]):new W1([[t]],H1)}(!!t&&"object"===I2(t)&&!!t.node&&"function"==typeof t.node?t.node():t);"static"===i.style("position")&&i.style("position","relative"),e.tooltipEl=i.append("div").attr("class","float-tooltip-kap"),Object.entries(r).forEach((function(t){var n=O2(t,2),r=n[0],i=n[1];return e.tooltipEl.style(r,i)})),e.tooltipEl.style("left","-10000px").style("display","none");var s="tooltip-".concat(Math.round(1e12*Math.random()));e.mouseInside=!1,i.on("mousemove.".concat(s),(function(t){e.mouseInside=!0;var n=function(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}(t),r=i.node(),s=r.offsetWidth,o=r.offsetHeight,a=[null===e.offsetX||void 0===e.offsetX?"-".concat(n[0]/s*100,"%"):"number"==typeof e.offsetX?"calc(-50% + ".concat(e.offsetX,"px)"):e.offsetX,null===e.offsetY||void 0===e.offsetY?o>130&&o-n[1]<100?"calc(-100% - 6px)":"21px":"number"==typeof e.offsetY?e.offsetY<0?"calc(-100% - ".concat(Math.abs(e.offsetY),"px)"):"".concat(e.offsetY,"px"):e.offsetY];e.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(a.join(","),")")),e.content&&e.tooltipEl.style("display","inline")})),i.on("mouseover.".concat(s),(function(){e.mouseInside=!0,e.content&&e.tooltipEl.style("display","inline")})),i.on("mouseout.".concat(s),(function(){e.mouseInside=!1,e.tooltipEl.style("display","none")}))},update:function(t){var e,n;t.tooltipEl.style("display",t.content&&t.mouseInside?"inline":"none"),t.content?t.content instanceof HTMLElement?(t.tooltipEl.text(""),t.tooltipEl.append((function(){return t.content}))):"string"==typeof t.content?t.tooltipEl.html(t.content):!function(t){return Y1(R2(t))}(t.content)?(t.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",t.content,t.content.toString())):(t.tooltipEl.text(""),e=t.content,delete(n=t.tooltipEl.node()).__k,C2(D2(e),n)):t.tooltipEl.text("")}});function U2(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function F2(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z2(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||j2(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B2(t){return function(t){if(Array.isArray(t))return U2(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||j2(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j2(t,e){if(t){if("string"==typeof t)return U2(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U2(t,e):void 0}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var V2=window.THREE?window.THREE:{WebGLRenderer:class{constructor(t={}){const{canvas:e=GM(),context:n=null,depth:r=!0,stencil:i=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:c=!1}=t;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=s;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const y=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=lM,this.toneMapping=0,this.toneMappingExposure=1;const _=this;let b=!1,x=0,w=0,M=null,S=-1,T=null;const E=new sS,A=new sS;let C=null;const R=new OT(0);let N=0,P=e.width,k=e.height,O=1,I=null,D=null;const L=new sS(0,0,P,k),U=new sS(0,0,P,k);let F=!1;const z=new XE;let B=!1,j=!1;this.transmissionResolutionScale=1;const V=new jS,G=new jS,H=new cS,W=new sS,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let $=!1;function X(){return null===M?O:1}let Y,K,Z,J,Q,tt,et,nt,rt,it,st,ot,at,lt,ut,ht,ct,dt,pt,ft,mt,gt,yt,vt,_t=n;function bt(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${lx}`),e.addEventListener("webglcontextlost",Mt,!1),e.addEventListener("webglcontextrestored",St,!1),e.addEventListener("webglcontextcreationerror",Tt,!1),null===_t){const e="webgl2";if(_t=bt(e,t),null===_t)throw bt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function xt(){Y=new ZC(_t),Y.init(),gt=new $N(_t,Y),K=new NC(_t,Y,t,gt),Z=new WN(_t,Y),K.reverseDepthBuffer&&c&&Z.buffers.depth.setReversed(!0),J=new tR(_t),Q=new kN,tt=new qN(_t,Y,Z,Q,K,gt,J),et=new kC(_),nt=new KC(_),rt=new bC(_t),yt=new CC(_t,rt),it=new JC(_t,rt,J,yt),st=new nR(_t,it,rt,J),pt=new eR(_t,K,tt),ht=new PC(Q),ot=new PN(_,et,nt,Y,K,yt,ht),at=new JN(_,Q),lt=new LN,ut=new VN(Y),dt=new AC(_,et,nt,Z,st,d,a),ct=new GN(_,st,K),vt=new QN(_t,J,K,Z),ft=new RC(_t,Y,J),mt=new QC(_t,Y,J),J.programs=ot.programs,_.capabilities=K,_.extensions=Y,_.properties=Q,_.renderLists=lt,_.shadowMap=ct,_.state=Z,_.info=J}xt();const wt=new YN(_,_t);function Mt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=J.autoReset,e=ct.enabled,n=ct.autoUpdate,r=ct.needsUpdate,i=ct.type;xt(),J.autoReset=t,ct.enabled=e,ct.autoUpdate=n,ct.needsUpdate=r,ct.type=i}function Tt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Et(t){const e=t.target;e.removeEventListener("dispose",Et),function(t){(function(t){const e=Q.get(t).programs;void 0!==e&&(e.forEach((function(t){ot.releaseProgram(t)})),t.isShaderMaterial&&ot.releaseShaderCache(t))})(t),Q.remove(t)}(e)}function At(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,Ut(t,e,n),t.side=0,t.needsUpdate=!0,Ut(t,e,n),t.side=2):Ut(t,e,n)}this.xr=wt,this.getContext=function(){return _t},this.getContextAttributes=function(){return _t.getContextAttributes()},this.forceContextLoss=function(){const t=Y.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Y.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(t){void 0!==t&&(O=t,this.setSize(P,k,!1))},this.getSize=function(t){return t.set(P,k)},this.setSize=function(t,n,r=!0){wt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=t,k=n,e.width=Math.floor(t*O),e.height=Math.floor(n*O),!0===r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(P*O,k*O).floor()},this.setDrawingBufferSize=function(t,n,r){P=t,k=n,O=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(L)},this.setViewport=function(t,e,n,r){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,r),Z.viewport(E.copy(L).multiplyScalar(O).round())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,n,r){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,n,r),Z.scissor(A.copy(U).multiplyScalar(O).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(t){Z.setScissorTest(F=t)},this.setOpaqueSort=function(t){I=t},this.setTransparentSort=function(t){D=t},this.getClearColor=function(t){return t.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor.apply(dt,arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha.apply(dt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let r=0;if(t){let t=!1;if(null!==M){const e=M.texture.format;t=e===Cw||e===Aw||e===Tw}if(t){const t=M.texture.type,e=t===sw||t===hw||t===lw||t===mw||t===pw||t===fw,n=dt.getClearColor(),r=dt.getClearAlpha(),i=n.r,s=n.g,o=n.b;e?(p[0]=i,p[1]=s,p[2]=o,p[3]=r,_t.clearBufferuiv(_t.COLOR,0,p)):(f[0]=i,f[1]=s,f[2]=o,f[3]=r,_t.clearBufferiv(_t.COLOR,0,f))}else r|=_t.COLOR_BUFFER_BIT}e&&(r|=_t.DEPTH_BUFFER_BIT),n&&(r|=_t.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),_t.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Mt,!1),e.removeEventListener("webglcontextrestored",St,!1),e.removeEventListener("webglcontextcreationerror",Tt,!1),dt.dispose(),lt.dispose(),ut.dispose(),Q.dispose(),et.dispose(),nt.dispose(),st.dispose(),yt.dispose(),vt.dispose(),ot.dispose(),wt.dispose(),wt.removeEventListener("sessionstart",Rt),wt.removeEventListener("sessionend",Nt),Pt.stop()},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=q);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=function(t,e,n,r,i){!0!==e.isScene&&(e=q);tt.resetTextureUnits();const s=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===M?_.outputColorSpace:!0===M.isXRRenderTarget?M.texture.colorSpace:uM,l=(r.isMeshStandardMaterial?nt:et).get(r.envMap||o),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),c=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;r.toneMapped&&(null!==M&&!0!==M.isXRRenderTarget||(f=_.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==m?m.length:0,v=Q.get(r),b=g.state.lights;if(!0===B&&(!0===j||t!==T)){const e=t===T&&r.id===S;ht.setState(r,t,e)}let x=!1;r.version===v.__version?v.needsLights&&v.lightsStateVersion!==b.state.version||v.outputColorSpace!==a||i.isBatchedMesh&&!1===v.batching?x=!0:i.isBatchedMesh||!0!==v.batching?i.isBatchedMesh&&!0===v.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===v.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===v.instancing?x=!0:i.isInstancedMesh||!0!==v.instancing?i.isSkinnedMesh&&!1===v.skinning?x=!0:i.isSkinnedMesh||!0!==v.skinning?i.isInstancedMesh&&!0===v.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===v.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===v.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===v.instancingMorph&&null!==i.morphTexture||v.envMap!==l||!0===r.fog&&v.fog!==s?x=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ht.numPlanes&&v.numIntersection===ht.numIntersection?(v.vertexAlphas!==u||v.vertexTangents!==h||v.morphTargets!==c||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==y)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,v.__version=r.version);let w=v.currentProgram;!0===x&&(w=Ut(r,e,i));let E=!1,A=!1,C=!1;const R=w.getUniforms(),N=v.uniforms;Z.useProgram(w.program)&&(E=!0,A=!0,C=!0);r.id!==S&&(S=r.id,A=!0);if(E||T!==t){Z.buffers.depth.getReversed()?(V.copy(t.projectionMatrix),function(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}(V),function(t){const e=t.elements;-1===e[11]?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=1-e[14])}(V),R.setValue(_t,"projectionMatrix",V)):R.setValue(_t,"projectionMatrix",t.projectionMatrix),R.setValue(_t,"viewMatrix",t.matrixWorldInverse);const e=R.map.cameraPosition;void 0!==e&&e.setValue(_t,H.setFromMatrixPosition(t.matrixWorld)),K.logarithmicDepthBuffer&&R.setValue(_t,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&R.setValue(_t,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,A=!0,C=!0)}if(i.isSkinnedMesh){R.setOptional(_t,i,"bindMatrix"),R.setOptional(_t,i,"bindMatrixInverse");const t=i.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),R.setValue(_t,"boneTexture",t.boneTexture,tt))}i.isBatchedMesh&&(R.setOptional(_t,i,"batchingTexture"),R.setValue(_t,"batchingTexture",i._matricesTexture,tt),R.setOptional(_t,i,"batchingIdTexture"),R.setValue(_t,"batchingIdTexture",i._indirectTexture,tt),R.setOptional(_t,i,"batchingColorTexture"),null!==i._colorsTexture&&R.setValue(_t,"batchingColorTexture",i._colorsTexture,tt));const P=n.morphAttributes;void 0===P.position&&void 0===P.normal&&void 0===P.color||pt.update(i,n,w);(A||v.receiveShadow!==i.receiveShadow)&&(v.receiveShadow=i.receiveShadow,R.setValue(_t,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(N.envMap.value=l,N.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==e.environment&&(N.envMapIntensity.value=e.environmentIntensity);A&&(R.setValue(_t,"toneMappingExposure",_.toneMappingExposure),v.needsLights&&(D=C,(I=N).ambientLightColor.needsUpdate=D,I.lightProbe.needsUpdate=D,I.directionalLights.needsUpdate=D,I.directionalLightShadows.needsUpdate=D,I.pointLights.needsUpdate=D,I.pointLightShadows.needsUpdate=D,I.spotLights.needsUpdate=D,I.spotLightShadows.needsUpdate=D,I.rectAreaLights.needsUpdate=D,I.hemisphereLights.needsUpdate=D),s&&!0===r.fog&&at.refreshFogUniforms(N,s),at.refreshMaterialUniforms(N,r,O,k,g.state.transmissionRenderTarget[t.id]),aN.upload(_t,Ft(v),N,tt));var I,D;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(aN.upload(_t,Ft(v),N,tt),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&R.setValue(_t,"center",i.center);if(R.setValue(_t,"modelViewMatrix",i.modelViewMatrix),R.setValue(_t,"normalMatrix",i.normalMatrix),R.setValue(_t,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const t=r.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];vt.update(n,w),vt.bind(n,w)}}return w}(t,e,n,r,i);Z.setMaterial(r,o);let l=n.index,u=1;if(!0===r.wireframe){if(l=it.getWireframeAttribute(n),void 0===l)return;u=2}const h=n.drawRange,c=n.attributes.position;let d=h.start*u,p=(h.start+h.count)*u;null!==s&&(d=Math.max(d,s.start*u),p=Math.min(p,(s.start+s.count)*u)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=c&&(d=Math.max(d,0),p=Math.min(p,c.count));const f=p-d;if(f<0||f===1/0)return;let m;yt.setup(i,r,a,n,l);let y=ft;if(null!==l&&(m=rt.get(l),y=mt,y.setIndex(m)),i.isMesh)!0===r.wireframe?(Z.setLineWidth(r.wireframeLinewidth*X()),y.setMode(_t.LINES)):y.setMode(_t.TRIANGLES);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*X()),i.isLineSegments?y.setMode(_t.LINES):i.isLineLoop?y.setMode(_t.LINE_LOOP):y.setMode(_t.LINE_STRIP)}else i.isPoints?y.setMode(_t.POINTS):i.isSprite&&y.setMode(_t.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)y.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))y.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const t=i._multiDrawStarts,e=i._multiDrawCounts,n=i._multiDrawCount,s=l?rt.get(l).bytesPerElement:1,o=Q.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(_t,"_gl_DrawID",r),y.render(t[r]/s,e[r])}else if(i.isInstancedMesh)y.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);y.renderInstances(d,f,e)}else y.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),g=ut.get(n),g.init(e),v.push(g),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))})),g.setupLights();const r=new Set;return t.traverse((function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=e[i];At(s,n,t),r.add(s)}else At(e,n,t),r.add(e)})),v.pop(),g=null,r},this.compileAsync=function(t,e,n=null){const r=this.compile(t,e,n);return new Promise((e=>{function n(){r.forEach((function(t){Q.get(t).currentProgram.isReady()&&r.delete(t)})),0!==r.size?setTimeout(n,10):e(t)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ct=null;function Rt(){Pt.stop()}function Nt(){Pt.start()}const Pt=new _C;function kt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||z.intersectsSprite(t)){r&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=st.update(t),i=t.material;i.visible&&m.push(t,e,i,n,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||z.intersectsObject(t))){const e=st.update(t),i=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)),W.applyMatrix4(t.matrixWorld).applyMatrix4(G)),Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&m.push(t,e,a,n,W.z,o)}}else i.visible&&m.push(t,e,i,n,W.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)kt(i[t],e,n,r)}function Ot(t,e,n,r){const i=t.opaque,s=t.transmissive,o=t.transparent;g.setupLightsView(n),!0===B&&ht.setGlobalState(_.clippingPlanes,n),r&&Z.viewport(E.copy(r)),i.length>0&&Dt(i,e,n),s.length>0&&Dt(s,e,n),o.length>0&&Dt(o,e,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function It(t,e,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[r.id]&&(g.state.transmissionRenderTarget[r.id]=new aS(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?dw:sw,minFilter:iw,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:YM.workingColorSpace}));const s=g.state.transmissionRenderTarget[r.id],o=r.viewport||E;s.setSize(o.z*_.transmissionResolutionScale,o.w*_.transmissionResolutionScale);const a=_.getRenderTarget();_.setRenderTarget(s),_.getClearColor(R),N=_.getClearAlpha(),N<1&&_.setClearColor(16777215,.5),_.clear(),$&&dt.render(n);const l=_.toneMapping;_.toneMapping=0;const u=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),g.setupLightsView(r),!0===B&&ht.setGlobalState(_.clippingPlanes,r),Dt(t,n,r),tt.updateMultisampleRenderTarget(s),tt.updateRenderTargetMipmap(s),!1===Y.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let i=0,s=e.length;i<s;i++){const s=e[i],o=s.object,a=s.geometry,l=s.material,u=s.group;if(2===l.side&&o.layers.test(r.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,Lt(o,n,r,a,l,u),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(tt.updateMultisampleRenderTarget(s),tt.updateRenderTargetMipmap(s))}_.setRenderTarget(a),_.setClearColor(R,N),void 0!==u&&(r.viewport=u),_.toneMapping=l}function Dt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,u=s.group;o.layers.test(n.layers)&&Lt(o,e,n,a,l,u)}}function Lt(t,e,n,r,i,s){t.onBeforeRender(_,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(_,e,n,r,t,s),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,_.renderBufferDirect(n,e,r,i,t,s),i.side=0,i.needsUpdate=!0,_.renderBufferDirect(n,e,r,i,t,s),i.side=2):_.renderBufferDirect(n,e,r,i,t,s),t.onAfterRender(_,e,n,r,i,s)}function Ut(t,e,n){!0!==e.isScene&&(e=q);const r=Q.get(t),i=g.state.lights,s=g.state.shadowsArray,o=i.state.version,a=ot.getParameters(t,i.state,s,e,n),l=ot.getProgramCacheKey(a);let u=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?nt:et).get(t.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===u&&(t.addEventListener("dispose",Et),u=new Map,r.programs=u);let h=u.get(l);if(void 0!==h){if(r.currentProgram===h&&r.lightsStateVersion===o)return zt(t,a),h}else a.uniforms=ot.getUniforms(t),t.onBeforeCompile(a,_),h=ot.acquireProgram(a,l),u.set(l,h),r.uniforms=a.uniforms;const c=r.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(c.clippingPlanes=ht.uniform),zt(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(c.ambientLightColor.value=i.state.ambient,c.lightProbe.value=i.state.probe,c.directionalLights.value=i.state.directional,c.directionalLightShadows.value=i.state.directionalShadow,c.spotLights.value=i.state.spot,c.spotLightShadows.value=i.state.spotShadow,c.rectAreaLights.value=i.state.rectArea,c.ltc_1.value=i.state.rectAreaLTC1,c.ltc_2.value=i.state.rectAreaLTC2,c.pointLights.value=i.state.point,c.pointLightShadows.value=i.state.pointShadow,c.hemisphereLights.value=i.state.hemi,c.directionalShadowMap.value=i.state.directionalShadowMap,c.directionalShadowMatrix.value=i.state.directionalShadowMatrix,c.spotShadowMap.value=i.state.spotShadowMap,c.spotLightMatrix.value=i.state.spotLightMatrix,c.spotLightMap.value=i.state.spotLightMap,c.pointShadowMap.value=i.state.pointShadowMap,c.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=h,r.uniformsList=null,h}function Ft(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=aN.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function zt(t,e){const n=Q.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Pt.setAnimationLoop((function(t){Ct&&Ct(t)})),"undefined"!=typeof self&&Pt.setContext(self),this.setAnimationLoop=function(t){Ct=t,wt.setAnimationLoop(t),null===t?Pt.stop():Pt.start()},wt.addEventListener("sessionstart",Rt),wt.addEventListener("sessionend",Nt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===wt.enabled&&!0===wt.isPresenting&&(!0===wt.cameraAutoUpdate&&wt.updateCamera(e),e=wt.getCamera()),!0===t.isScene&&t.onBeforeRender(_,t,e,M),g=ut.get(t,v.length),g.init(e),v.push(g),G.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),z.setFromProjectionMatrix(G),j=this.localClippingEnabled,B=ht.init(this.clippingPlanes,j),m=lt.get(t,y.length),m.init(),y.push(m),!0===wt.enabled&&!0===wt.isPresenting){const t=_.xr.getDepthSensingMesh();null!==t&&kt(t,e,-1/0,_.sortObjects)}kt(t,e,0,_.sortObjects),m.finish(),!0===_.sortObjects&&m.sort(I,D),$=!1===wt.enabled||!1===wt.isPresenting||!1===wt.hasDepthSensing(),$&&dt.addToRenderList(m,t),this.info.render.frame++,!0===B&&ht.beginShadows();const n=g.state.shadowsArray;ct.render(n,t,e),!0===B&&ht.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=m.opaque,i=m.transmissive;if(g.setupLights(),e.isArrayCamera){const n=e.cameras;if(i.length>0)for(let e=0,s=n.length;e<s;e++){It(r,i,t,n[e])}$&&dt.render(t);for(let e=0,r=n.length;e<r;e++){const r=n[e];Ot(m,t,r,r.viewport)}}else i.length>0&&It(r,i,t,e),$&&dt.render(t),Ot(m,t,e);null!==M&&0===w&&(tt.updateMultisampleRenderTarget(M),tt.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(_,t,e),yt.resetDefaultState(),S=-1,T=null,v.pop(),v.length>0?(g=v[v.length-1],!0===B&&ht.setGlobalState(_.clippingPlanes,g.state.camera)):g=null,y.pop(),m=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,n){Q.get(t.texture).__webglTexture=e,Q.get(t.depthTexture).__webglTexture=n;const r=Q.get(t);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=Q.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e};const Bt=_t.createFramebuffer();this.setRenderTarget=function(t,e=0,n=0){M=t,x=e,w=n;let r=!0,i=null,s=!1,o=!1;if(t){const a=Q.get(t);if(void 0!==a.__useDefaultFramebuffer)Z.bindFramebuffer(_t.FRAMEBUFFER,null),r=!1;else if(void 0===a.__webglFramebuffer)tt.setupRenderTarget(t);else if(a.__hasExternalTextures)tt.rebindTextures(t,Q.get(t.texture).__webglTexture,Q.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(a.__boundDepthTexture!==e){if(null!==e&&Q.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");tt.setupDepthRenderbuffer(t)}}const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const u=Q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=Array.isArray(u[e])?u[e][n]:u[e],s=!0):i=t.samples>0&&!1===tt.useMultisampledRTT(t)?Q.get(t).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,E.copy(t.viewport),A.copy(t.scissor),C=t.scissorTest}else E.copy(L).multiplyScalar(O).floor(),A.copy(U).multiplyScalar(O).floor(),C=F;0!==n&&(i=Bt);if(Z.bindFramebuffer(_t.FRAMEBUFFER,i)&&r&&Z.drawBuffers(t,i),Z.viewport(E),Z.scissor(A),Z.setScissorTest(C),s){const r=Q.get(t.texture);_t.framebufferTexture2D(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,n)}else if(o){const r=Q.get(t.texture),i=e;_t.framebufferTextureLayer(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,r.__webglTexture,n,i)}else if(null!==t&&0!==n){const e=Q.get(t.texture);_t.framebufferTexture2D(_t.FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_2D,e.__webglTexture,n)}S=-1},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Z.bindFramebuffer(_t.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(!K.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&_t.readPixels(e,n,r,i,gt.convert(a),gt.convert(l),s)}finally{const t=null!==M?Q.get(M).__webglFramebuffer:null;Z.bindFramebuffer(_t.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){const o=t.texture,l=o.format,u=o.type;if(!K.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i){Z.bindFramebuffer(_t.FRAMEBUFFER,a);const t=_t.createBuffer();_t.bindBuffer(_t.PIXEL_PACK_BUFFER,t),_t.bufferData(_t.PIXEL_PACK_BUFFER,s.byteLength,_t.STREAM_READ),_t.readPixels(e,n,r,i,gt.convert(l),gt.convert(u),0);const o=null!==M?Q.get(M).__webglFramebuffer:null;Z.bindFramebuffer(_t.FRAMEBUFFER,o);const h=_t.fenceSync(_t.SYNC_GPU_COMMANDS_COMPLETE,0);return _t.flush(),await function(t,e,n){return new Promise((function(r,i){setTimeout((function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}),n)}))}(_t,h,4),_t.bindBuffer(_t.PIXEL_PACK_BUFFER,t),_t.getBufferSubData(_t.PIXEL_PACK_BUFFER,0,s),_t.deleteBuffer(t),_t.deleteSync(h),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t,e=null,n=0){!0!==t.isTexture&&(WM("WebGLRenderer: copyFramebufferToTexture function signature has changed."),e=arguments[0]||null,t=arguments[1]);const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),s=Math.floor(t.image.height*r),o=null!==e?e.x:0,a=null!==e?e.y:0;tt.setTexture2D(t,0),_t.copyTexSubImage2D(_t.TEXTURE_2D,n,0,0,o,a,i,s),Z.unbindTexture()};const jt=_t.createFramebuffer(),Vt=_t.createFramebuffer();this.copyTextureToTexture=function(t,e,n=null,r=null,i=0,s=null){let o,a,l,u,h,c,d,p,f;!0!==t.isTexture&&(WM("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,t=arguments[1],e=arguments[2],s=arguments[3]||0,n=null),null===s&&(0!==i?(WM("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),s=i,i=0):s=0);const m=t.isCompressedTexture?t.mipmaps[s]:t.image;if(null!==n)o=n.max.x-n.min.x,a=n.max.y-n.min.y,l=n.isBox3?n.max.z-n.min.z:1,u=n.min.x,h=n.min.y,c=n.isBox3?n.min.z:0;else{const e=Math.pow(2,-i);o=Math.floor(m.width*e),a=Math.floor(m.height*e),l=t.isDataArrayTexture?m.depth:t.isData3DTexture?Math.floor(m.depth*e):1,u=0,h=0,c=0}null!==r?(d=r.x,p=r.y,f=r.z):(d=0,p=0,f=0);const g=gt.convert(e.format),y=gt.convert(e.type);let v;e.isData3DTexture?(tt.setTexture3D(e,0),v=_t.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(tt.setTexture2DArray(e,0),v=_t.TEXTURE_2D_ARRAY):(tt.setTexture2D(e,0),v=_t.TEXTURE_2D),_t.pixelStorei(_t.UNPACK_FLIP_Y_WEBGL,e.flipY),_t.pixelStorei(_t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),_t.pixelStorei(_t.UNPACK_ALIGNMENT,e.unpackAlignment);const _=_t.getParameter(_t.UNPACK_ROW_LENGTH),b=_t.getParameter(_t.UNPACK_IMAGE_HEIGHT),x=_t.getParameter(_t.UNPACK_SKIP_PIXELS),w=_t.getParameter(_t.UNPACK_SKIP_ROWS),M=_t.getParameter(_t.UNPACK_SKIP_IMAGES);_t.pixelStorei(_t.UNPACK_ROW_LENGTH,m.width),_t.pixelStorei(_t.UNPACK_IMAGE_HEIGHT,m.height),_t.pixelStorei(_t.UNPACK_SKIP_PIXELS,u),_t.pixelStorei(_t.UNPACK_SKIP_ROWS,h),_t.pixelStorei(_t.UNPACK_SKIP_IMAGES,c);const S=t.isDataArrayTexture||t.isData3DTexture,T=e.isDataArrayTexture||e.isData3DTexture;if(t.isDepthTexture){const n=Q.get(t),r=Q.get(e),m=Q.get(n.__renderTarget),g=Q.get(r.__renderTarget);Z.bindFramebuffer(_t.READ_FRAMEBUFFER,m.__webglFramebuffer),Z.bindFramebuffer(_t.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let n=0;n<l;n++)S&&(_t.framebufferTextureLayer(_t.READ_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,Q.get(t).__webglTexture,i,c+n),_t.framebufferTextureLayer(_t.DRAW_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,Q.get(e).__webglTexture,s,f+n)),_t.blitFramebuffer(u,h,o,a,d,p,o,a,_t.DEPTH_BUFFER_BIT,_t.NEAREST);Z.bindFramebuffer(_t.READ_FRAMEBUFFER,null),Z.bindFramebuffer(_t.DRAW_FRAMEBUFFER,null)}else if(0!==i||t.isRenderTargetTexture||Q.has(t)){const n=Q.get(t),r=Q.get(e);Z.bindFramebuffer(_t.READ_FRAMEBUFFER,jt),Z.bindFramebuffer(_t.DRAW_FRAMEBUFFER,Vt);for(let t=0;t<l;t++)S?_t.framebufferTextureLayer(_t.READ_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,n.__webglTexture,i,c+t):_t.framebufferTexture2D(_t.READ_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_2D,n.__webglTexture,i),T?_t.framebufferTextureLayer(_t.DRAW_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,r.__webglTexture,s,f+t):_t.framebufferTexture2D(_t.DRAW_FRAMEBUFFER,_t.COLOR_ATTACHMENT0,_t.TEXTURE_2D,r.__webglTexture,s),0!==i?_t.blitFramebuffer(u,h,o,a,d,p,o,a,_t.COLOR_BUFFER_BIT,_t.NEAREST):T?_t.copyTexSubImage3D(v,s,d,p,f+t,u,h,o,a):_t.copyTexSubImage2D(v,s,d,p,u,h,o,a);Z.bindFramebuffer(_t.READ_FRAMEBUFFER,null),Z.bindFramebuffer(_t.DRAW_FRAMEBUFFER,null)}else T?t.isDataTexture||t.isData3DTexture?_t.texSubImage3D(v,s,d,p,f,o,a,l,g,y,m.data):e.isCompressedArrayTexture?_t.compressedTexSubImage3D(v,s,d,p,f,o,a,l,g,m.data):_t.texSubImage3D(v,s,d,p,f,o,a,l,g,y,m):t.isDataTexture?_t.texSubImage2D(_t.TEXTURE_2D,s,d,p,o,a,g,y,m.data):t.isCompressedTexture?_t.compressedTexSubImage2D(_t.TEXTURE_2D,s,d,p,m.width,m.height,g,m.data):_t.texSubImage2D(_t.TEXTURE_2D,s,d,p,o,a,g,y,m);_t.pixelStorei(_t.UNPACK_ROW_LENGTH,_),_t.pixelStorei(_t.UNPACK_IMAGE_HEIGHT,b),_t.pixelStorei(_t.UNPACK_SKIP_PIXELS,x),_t.pixelStorei(_t.UNPACK_SKIP_ROWS,w),_t.pixelStorei(_t.UNPACK_SKIP_IMAGES,M),0===s&&e.generateMipmaps&&_t.generateMipmap(v),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n=null,r=null,i=0){return!0!==t.isTexture&&(WM("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,t=arguments[2],e=arguments[3],i=arguments[4]||0),WM('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(t,e,n,r,i)},this.initRenderTarget=function(t){void 0===Q.get(t).__webglFramebuffer&&tt.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?tt.setTextureCube(t,0):t.isData3DTexture?tt.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?tt.setTexture2DArray(t,0):tt.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){x=0,w=0,M=null,Z.reset(),yt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return SM}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=YM._getDrawingBufferColorSpace(t),e.unpackColorSpace=YM._getUnpackColorSpace()}},Scene:DE,PerspectiveCamera:AE,Raycaster:dC,SRGBColorSpace:lM,TextureLoader:class extends zA{constructor(t){super(t)}load(t,e,n,r){const i=new iS,s=new BA(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},Vector2:FM,Vector3:cS,Box3:fS,Color:OT,Mesh:mE,SphereGeometry:MA,MeshBasicMaterial:UT,BackSide:1,Clock:lC},G2=jO({props:{width:{default:window.innerWidth,onChange:function(t,e,n){isNaN(t)&&(e.width=n)}},height:{default:window.innerHeight,onChange:function(t,e,n){isNaN(t)&&(e.height=n)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(t,e){e.hoverObj=null,e.tooltip&&e.tooltip.content(null)},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(t){if(t.initialised){if(t.controls.update&&t.controls.update(Math.min(1,t.clock.getDelta())),t.postProcessingComposer?t.postProcessingComposer.render():t.renderer.render(t.scene,t.camera),t.extraRenderers.forEach((function(e){return e.render(t.scene,t.camera)})),t.enablePointerInteraction){var e=null;if(t.hoverDuringDrag||!t.isPointerDragging){var n=this.intersectingObjects(t.pointerPos.x,t.pointerPos.y);t.hoverOrderComparator&&n.sort((function(e,n){return t.hoverOrderComparator(e.object,n.object)}));var r=n.find((function(e){return t.hoverFilter(e.object)}))||null;e=r?r.object:null,t.intersection=r||null}e!==t.hoverObj&&(t.onHover(e,t.hoverObj,t.intersection),t.tooltip.content(e&&VO(t.tooltipContent)(e,t.intersection)||null),t.hoverObj=e)}t.tweenGroup.update()}return this},getPointerPos:function(t){var e=t.pointerPos;return{x:e.x,y:e.y}},cameraPosition:function(t,e,n,r){var i=t.camera;if(e&&t.initialised){var s=e,o=n||{x:0,y:0,z:0};if(r){var a=Object.assign({},i.position),l=c();t.tweenGroup.add(new L0(a).to(s,r).easing(N0.Quadratic.Out).onUpdate(u).start()),t.tweenGroup.add(new L0(l).to(o,r/3).easing(N0.Quadratic.Out).onUpdate(h).start())}else u(s),h(o);return this}return Object.assign({},i.position,{lookAt:c()});function u(t){var e=t.x,n=t.y,r=t.z;void 0!==e&&(i.position.x=e),void 0!==n&&(i.position.y=n),void 0!==r&&(i.position.z=r)}function h(e){var n=new V2.Vector3(e.x,e.y,e.z);t.controls.target?t.controls.target=n:i.lookAt(n)}function c(){return Object.assign(new V2.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return this.fitToBbox(this.getBbox.apply(this,i),e,n)},fitToBbox:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=t.camera;if(e){var s=new V2.Vector3(0,0,0),o=2*Math.max.apply(Math,B2(Object.entries(e).map((function(t){var e=z2(t,2),n=e[0],r=e[1];return Math.max.apply(Math,B2(r.map((function(t){return Math.abs(s[n]-t)}))))})))),a=(1-2*r/t.height)*i.fov,l=o/Math.atan(a*Math.PI/180),u=l/i.aspect,h=Math.max(l,u);if(h>0){var c=s.clone().sub(i.position).normalize().multiplyScalar(-h);this.cameraPosition(c,s,n)}}return this},getBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new V2.Box3(new V2.Vector3(0,0,0),new V2.Vector3(0,0,0)),r=t.objects.filter(e);return r.length?(r.forEach((function(t){return n.expandByObject(t)})),Object.assign.apply(Object,B2(["x","y","z"].map((function(t){return F2({},t,[n.min[t],n.max[t]])}))))):null},getScreenCoords:function(t,e,n,r){var i=new V2.Vector3(e,n,r);return i.project(this.camera()),{x:(i.x+1)*t.width/2,y:-(i.y-1)*t.height/2}},getSceneCoords:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new V2.Vector2(e/t.width*2-1,-n/t.height*2+1),s=new V2.Raycaster;return s.setFromCamera(i,t.camera),Object.assign({},s.ray.at(r,new V2.Vector3))},intersectingObjects:function(t,e,n){var r=new V2.Vector2(e/t.width*2-1,-n/t.height*2+1),i=new V2.Raycaster;return i.params.Line.threshold=t.lineHoverPrecision,i.params.Points.threshold=t.pointsHoverPrecision,i.setFromCamera(r,t.camera),i.intersectObjects(t.objects,!0)},renderer:function(t){return t.renderer},scene:function(t){return t.scene},camera:function(t){return t.camera},postProcessingComposer:function(t){return t.postProcessingComposer},controls:function(t){return t.controls},tbControls:function(t){return t.controls}},stateInit:function(){return{scene:new V2.Scene,camera:new V2.PerspectiveCamera,clock:new V2.Clock,tweenGroup:new k0}},init:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,i=void 0===r?"trackball":r,s=n.useWebGPU,o=void 0!==s&&s,a=n.rendererConfig,l=void 0===a?{}:a,u=n.extraRenderers,h=void 0===u?[]:u,c=n.waitForLoadComplete,d=void 0===c||c;t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.tooltip=new L2(e.container),e.pointerPos=new V2.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach((function(t){return e.container.addEventListener(t,(function(n){if("pointerdown"===t&&(e.isPointerPressed=!0),!e.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||e.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(t){return Math.abs(t)>1})))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var r=(i=e.container,s=i.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:s.top+a,left:s.left+o});e.pointerPos.x=n.pageX-r.left,e.pointerPos.y=n.pageY-r.top}var i,s,o,a}),{passive:!0})})),e.container.addEventListener("pointerup",(function(t){e.isPointerPressed=!1,e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag)||requestAnimationFrame((function(){0===t.button&&e.onClick(e.hoverObj||null,t,e.intersection),2===t.button&&e.onRightClick&&e.onRightClick(e.hoverObj||null,t,e.intersection)}))}),{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",(function(t){e.onRightClick&&t.preventDefault()})),e.renderer=new(o?fJ:V2.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},l)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=h,e.extraRenderers.forEach((function(t){t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.pointerEvents="none",e.container.appendChild(t.domElement)})),e.postProcessingComposer=new WQ(e.renderer),e.postProcessingComposer.addPass(new qQ(e.scene,e.camera)),e.controls=new{trackball:DJ,orbit:pQ,fly:RQ}[i](e.camera,e.renderer.domElement),"fly"===i&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",(function(){e.controlsEngaged=!0})),e.controls.addEventListener("change",(function(){e.controlsEngaged&&(e.controlsDragging=!0)})),e.controls.addEventListener("end",(function(){e.controlsEngaged=!1,e.controlsDragging=!1}))),[e.renderer,e.postProcessingComposer].concat(B2(e.extraRenderers)).forEach((function(t){return t.setSize(e.width,e.height)})),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new V2.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!d,window.scene=e.scene},update:function(t,e){if(t.width&&t.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(t.container.style.width="".concat(t.width,"px"),t.container.style.height="".concat(t.height,"px"),[t.renderer,t.postProcessingComposer].concat(B2(t.extraRenderers)).forEach((function(e){return e.setSize(t.width,t.height)})),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&t.skyRadius&&(t.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(t.controls.maxDistance=Math.min(t.controls.maxDistance,t.skyRadius)),t.camera.far=2.5*t.skyRadius,t.camera.updateProjectionMatrix(),t.skysphere.geometry=new V2.SphereGeometry(t.skyRadius)),e.hasOwnProperty("backgroundColor")){var n=p0(t.backgroundColor).alpha;void 0===n&&(n=1),t.renderer.setClearColor(new V2.Color(R0(1,t.backgroundColor)),n)}function r(){t.loadComplete=t.scene.visible=!0}e.hasOwnProperty("backgroundImageUrl")&&(t.backgroundImageUrl?(new V2.TextureLoader).load(t.backgroundImageUrl,(function(e){e.colorSpace=V2.SRGBColorSpace,t.skysphere.material=new V2.MeshBasicMaterial({map:e,side:V2.BackSide}),t.skysphere.visible=!0,t.onBackgroundImageLoaded&&setTimeout(t.onBackgroundImageLoaded),!t.loadComplete&&r()})):(t.skysphere.visible=!1,t.skysphere.material.map=null,!t.loadComplete&&r())),e.hasOwnProperty("showNavInfo")&&(t.navInfo.style.display=t.showNavInfo?null:"none"),e.hasOwnProperty("lights")&&((e.lights||[]).forEach((function(e){return t.scene.remove(e)})),t.lights.forEach((function(e){return t.scene.add(e)}))),e.hasOwnProperty("objects")&&((e.objects||[]).forEach((function(e){return t.scene.remove(e)})),t.objects.forEach((function(e){return t.scene.add(e)})))}});function H2(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function W2(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function q2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q2(Object(n),!0).forEach((function(e){W2(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q2(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function X2(t){return function(t){if(Array.isArray(t))return H2(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return H2(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H2(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y2(t,e){var n=new e;return n._destructor&&n._destructor(),{linkProp:function(e){return{default:n[e](),onChange:function(n,r){r[t][e](n)},triggerUpdate:!1}},linkMethod:function(e){return function(n){for(var r=n[t],i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];var a=r[e].apply(r,s);return a===r?this:a}}}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var K2=window.THREE?window.THREE:{AmbientLight:rC,DirectionalLight:nC,REVISION:lx},Z2=Y2("forceGraph",RD),J2=Object.assign.apply(Object,X2(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(t){return W2({},t,Z2.linkProp(t))})))),Q2=Object.assign.apply(Object,X2(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map((function(t){return W2({},t,Z2.linkMethod(t))})))),t3=Y2("renderObjs",G2),e3=Object.assign.apply(Object,X2(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map((function(t){return W2({},t,t3.linkProp(t))})))),n3=Object.assign.apply(Object,X2(["lights","cameraPosition","postProcessingComposer"].map((function(t){return W2({},t,t3.linkMethod(t))}))).concat([{graph2ScreenCoords:t3.linkMethod("getScreenCoords"),screen2GraphCoords:t3.linkMethod("getSceneCoords")}])),r3=jO({props:$2($2({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(t,e){return e.renderObjs.lineHoverPrecision(t)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(t,e){var n=e.renderObjs.controls();n&&(n.enabled=t,t&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},J2),e3),methods:$2($2({zoomToFit:function(t,e,n){for(var r,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return t.renderObjs.fitToBbox((r=t.forceGraph).getGraphBbox.apply(r,s),e,n),this},pauseAnimation:function(t){return null!==t.animationFrameRequestId&&(cancelAnimationFrame(t.animationFrameRequestId),t.animationFrameRequestId=null),this},resumeAnimation:function(t){return null===t.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(t){t.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),t.forceGraph.tickFrame(),t.renderObjs.tick(),t.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(t){return t.renderObjs.scene()},camera:function(t){return t.renderObjs.camera()},renderer:function(t){return t.renderObjs.renderer()},controls:function(t){return t.renderObjs.controls()},tbControls:function(t){return t.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Q2),n3),stateInit:function(t){var e=t.controlType,n=t.rendererConfig,r=t.extraRenderers,i=new RD;return{forceGraph:i,renderObjs:G2({controlType:e,rendererConfig:n,extraRenderers:r}).objects([i]).lights([new K2.AmbientLight(13421772,Math.PI),new K2.DirectionalLight(16777215,.6*Math.PI)])}},init:function(t,e){t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var n=document.createElement("div");e.container.appendChild(n),e.renderObjs(n);var r,i=e.renderObjs.camera(),s=e.renderObjs.renderer(),o=e.renderObjs.controls();o.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=i.position.z,e.container.appendChild(r=document.createElement("div")),r.className="graph-info-msg",r.textContent="",e.forceGraph.onLoading((function(){r.textContent="Loading..."})).onFinishLoading((function(){r.textContent=""})).onUpdate((function(){e.graphData=e.forceGraph.graphData(),0===i.position.x&&0===i.position.y&&i.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(i.lookAt(e.forceGraph.position),e.lastSetCameraZ=i.position.z=170*Math.cbrt(e.graphData.nodes.length))})).onFinishUpdate((function(){if(e._dragControls){var t=e.graphData.nodes.find((function(t){return t.__initialFixedPos&&!t.__disposeControlsAfterDrag}));t?t.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&"d3"===e.forceEngine){var n=e._dragControls=new gP(e.graphData.nodes.map((function(t){return t.__threeObj})).filter((function(t){return t})),i,s.domElement);n.addEventListener("dragstart",(function(t){var e=i3(t.object);if(e){o.enabled=!1,t.object.__initialPos=t.object.position.clone(),t.object.__prevPos=t.object.position.clone();var n=e.__data;!n.__initialFixedPos&&(n.__initialFixedPos={fx:n.fx,fy:n.fy,fz:n.fz}),!n.__initialPos&&(n.__initialPos={x:n.x,y:n.y,z:n.z}),["x","y","z"].forEach((function(t){return n["f".concat(t)]=n[t]})),s.domElement.classList.add("grabbable")}})),n.addEventListener("drag",(function(t){var n=i3(t.object);if(n){if(!t.object.hasOwnProperty("__graphObjType")){var r=t.object.__initialPos,i=t.object.__prevPos,s=t.object.position;n.position.add(s.clone().sub(i)),i.copy(s),s.copy(r)}var o=n.__data,a=n.position,l={x:a.x-o.x,y:a.y-o.y,z:a.z-o.z};["x","y","z"].forEach((function(t){return o["f".concat(t)]=o[t]=a[t]})),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),o.__dragged=!0,e.onNodeDrag(o,l)}})),n.addEventListener("dragend",(function(t){var r=i3(t.object);if(r){delete t.object.__initialPos,delete t.object.__prevPos;var i=r.__data;i.__disposeControlsAfterDrag&&(n.dispose(),delete i.__disposeControlsAfterDrag);var a=i.__initialFixedPos,l=i.__initialPos,u={x:l.x-i.x,y:l.y-i.y,z:l.z-i.z};a&&(["x","y","z"].forEach((function(t){var e="f".concat(t);void 0===a[e]&&delete i[e]})),delete i.__initialFixedPos,delete i.__initialPos,i.__dragged&&(delete i.__dragged,e.onNodeDragEnd(i,u))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")}}))}})),K2.REVISION<155&&(e.renderObjs.renderer().useLegacyLights=!1),e.renderObjs.hoverOrderComparator((function(t,e){var n=i3(t);if(!n)return 1;var r=i3(e);if(!r)return-1;var i=function(t){return"node"===t.__graphObjType};return i(r)-i(n)})).tooltipContent((function(t){var n=i3(t);return n&&VO(e["".concat(n.__graphObjType,"Label")])(n.__data)||""})).hoverDuringDrag(!1).onHover((function(t){var n=i3(t);if(n!==e.hoverObj){var r=e.hoverObj?e.hoverObj.__graphObjType:null,i=e.hoverObj?e.hoverObj.__data:null,o=n?n.__graphObjType:null,a=n?n.__data:null;if(r&&r!==o){var l=e["on".concat("node"===r?"Node":"Link","Hover")];l&&l(null,i)}if(o){var u=e["on".concat("node"===o?"Node":"Link","Hover")];u&&u(a,r===o?i:null)}s.domElement.classList[n&&e["on".concat("node"===o?"Node":"Link","Click")]||!n&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=n}})).clickAfterDrag(!1).onClick((function(t,n){var r=i3(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","Click")];i&&i(r.__data,n)}else e.onBackgroundClick&&e.onBackgroundClick(n)})).onRightClick((function(t,n){var r=i3(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","RightClick")];i&&i(r.__data,n)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(n)})),this._animationCycle()}});function i3(t){for(var e=t;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}const s3=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.wrapperElementType,i=void 0===r?"div":r,s=e.nodeMapper,o=void 0===s?function(t){return t}:s,a=e.methodNames,l=void 0===a?[]:a,u=e.initPropNames,h=void 0===u?[]:u;return n.forwardRef((function(e,r){var s=n.useRef(),a=n.useMemo((function(){var n=Object.fromEntries(h.filter((function(t){return e.hasOwnProperty(t)})).map((function(t){return[t,e[t]]})));return t(n)}),[]);ax((function(){a(o(s.current))}),n.useLayoutEffect),ax((function(){return a._destructor instanceof Function?a._destructor:void 0}));var u,c,d,p=n.useCallback((function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return a[t]instanceof Function?a[t].apply(a,n):void 0}),[a]),f=n.useRef({});return Object.keys((u=e,c=[].concat(sx(l),sx(h)),d=new Set(c),Object.assign.apply(Object,[{}].concat(tx(Object.entries(u).filter((function(t){var e=Qb(t,1)[0];return!d.has(e)})).map((function(t){var e=Qb(t,2);return Jb({},e[0],e[1])}))))))).filter((function(t){return f.current[t]!==e[t]})).forEach((function(t){return p(t,e[t])})),f.current=e,n.useImperativeHandle(r,(function(){return Object.fromEntries(l.map((function(t){return[t,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return p.apply(void 0,[t].concat(n))}]})))}),[p]),n.createElement(i,{ref:s})}))}(r3,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});function o3(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a3(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||u3(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l3(t){return function(t){if(Array.isArray(t))return h3(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u3(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u3(t,e){if(t){if("string"==typeof t)return h3(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h3(t,e):void 0}}function h3(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}s3.displayName="ForceGraph3D",s3.propTypes=fp;function c3(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function d3(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||f3(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p3(t){return function(t){if(Array.isArray(t))return c3(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f3(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f3(t,e){if(t){if("string"==typeof t)return c3(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c3(t,e):void 0}}function m3(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.useEffect,r=n.useRef(),i=n.useRef(!1),s=n.useRef(!1),o=d3(n.useState(0),2);o[0];var a=o[1];i.current&&(s.current=!0),e((function(){return i.current||(r.current=t(),i.current=!0),a((function(t){return t+1})),function(){s.current&&r.current&&r.current()}}),[])}var g3="http://www.w3.org/1999/xhtml",y3={svg:"http://www.w3.org/2000/svg",xhtml:g3,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function v3(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),y3.hasOwnProperty(e)?{space:y3[e],local:t}:t}function _3(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===g3&&e.documentElement.namespaceURI===g3?e.createElement(t):e.createElementNS(n,t)}}function b3(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function x3(t){var e=v3(t);return(e.local?b3:_3)(e)}function w3(){}function M3(t){return null==t?w3:function(){return this.querySelector(t)}}function S3(){return[]}function T3(t){return null==t?S3:function(){return this.querySelectorAll(t)}}function E3(t){return function(){return function(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}(t.apply(this,arguments))}}function A3(t){return function(){return this.matches(t)}}function C3(t){return function(e){return e.matches(t)}}var R3=Array.prototype.find;function N3(){return this.firstElementChild}var P3=Array.prototype.filter;function k3(){return Array.from(this.children)}function O3(t){return new Array(t.length)}function I3(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function D3(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new I3(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function L3(t,e,n,r,i,s,o){var a,l,u,h=new Map,c=e.length,d=s.length,p=new Array(c);for(a=0;a<c;++a)(l=e[a])&&(p[a]=u=o.call(l,l.__data__,a,e)+"",h.has(u)?i[a]=l:h.set(u,l));for(a=0;a<d;++a)u=o.call(t,s[a],a,s)+"",(l=h.get(u))?(r[a]=l,l.__data__=s[a],h.delete(u)):n[a]=new I3(t,s[a]);for(a=0;a<c;++a)(l=e[a])&&h.get(p[a])===l&&(i[a]=l)}function U3(t){return t.__data__}function F3(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function z3(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function B3(t){return function(){this.removeAttribute(t)}}function j3(t){return function(){this.removeAttributeNS(t.space,t.local)}}function V3(t,e){return function(){this.setAttribute(t,e)}}function G3(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function H3(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function W3(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function q3(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function $3(t){return function(){this.style.removeProperty(t)}}function X3(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Y3(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function K3(t,e){return t.style.getPropertyValue(e)||q3(t).getComputedStyle(t,null).getPropertyValue(e)}function Z3(t){return function(){delete this[t]}}function J3(t,e){return function(){this[t]=e}}function Q3(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function t5(t){return t.trim().split(/^|\s+/)}function e5(t){return t.classList||new n5(t)}function n5(t){this._node=t,this._names=t5(t.getAttribute("class")||"")}function r5(t,e){for(var n=e5(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function i5(t,e){for(var n=e5(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function s5(t){return function(){r5(this,t)}}function o5(t){return function(){i5(this,t)}}function a5(t,e){return function(){(e.apply(this,arguments)?r5:i5)(this,t)}}function l5(){this.textContent=""}function u5(t){return function(){this.textContent=t}}function h5(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function c5(){this.innerHTML=""}function d5(t){return function(){this.innerHTML=t}}function p5(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function f5(){this.nextSibling&&this.parentNode.appendChild(this)}function m5(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function g5(){return null}function y5(){var t=this.parentNode;t&&t.removeChild(this)}function v5(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function _5(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function b5(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function x5(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function w5(t,e,n){var r=q3(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function M5(t,e){return function(){return w5(this,t,e)}}function S5(t,e){return function(){return w5(this,t,e.apply(this,arguments))}}I3.prototype={constructor:I3,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},n5.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var T5=[null];function E5(t,e){this._groups=t,this._parents=e}function A5(){return new E5([[document.documentElement]],T5)}function C5(t){return"string"==typeof t?new E5([[document.querySelector(t)]],[document.documentElement]):new E5([[t]],T5)}function R5(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}E5.prototype=A5.prototype={constructor:E5,select:function(t){"function"!=typeof t&&(t=M3(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),h=0;h<l;++h)(s=a[h])&&(o=t.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),u[h]=o);return new E5(r,this._parents)},selectAll:function(t){t="function"==typeof t?E3(t):T3(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,u=0;u<l;++u)(o=a[u])&&(r.push(t.call(o,o.__data__,u,a)),i.push(o));return new E5(r,i)},selectChild:function(t){return this.select(null==t?N3:function(t){return function(){return R3.call(this.children,t)}}("function"==typeof t?t:C3(t)))},selectChildren:function(t){return this.selectAll(null==t?k3:function(t){return function(){return P3.call(this.children,t)}}("function"==typeof t?t:C3(t)))},filter:function(t){"function"!=typeof t&&(t=A3(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new E5(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,U3);var n=e?L3:D3,r=this._parents,i=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var h=r[u],c=i[u],d=c.length,p=F3(t.call(h,h&&h.__data__,u,r)),f=p.length,m=a[u]=new Array(f),g=o[u]=new Array(f);n(h,c,m,g,l[u]=new Array(d),p,e);for(var y,v,_=0,b=0;_<f;++_)if(y=m[_]){for(_>=b&&(b=_+1);!(v=g[b])&&++b<f;);y._next=v||null}}return(o=new E5(o,r))._enter=a,o._exit=l,o},enter:function(){return new E5(this._enter||this._groups.map(O3),this._parents)},exit:function(){return new E5(this._exit||this._groups.map(O3),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u,h=n[l],c=r[l],d=h.length,p=a[l]=new Array(d),f=0;f<d;++f)(u=h[f]||c[f])&&(p[f]=u);for(;l<i;++l)a[l]=n[l];return new E5(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=z3);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),h=0;h<l;++h)(o=a[h])&&(u[h]=o);u.sort(e)}return new E5(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=v3(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?j3:B3:"function"==typeof e?n.local?W3:H3:n.local?G3:V3)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?$3:"function"==typeof e?Y3:X3)(t,e,null==n?"":n)):K3(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Z3:"function"==typeof e?Q3:J3)(t,e)):this.node()[t]},classed:function(t,e){var n=t5(t+"");if(arguments.length<2){for(var r=e5(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?a5:e?s5:o5)(n,e))},text:function(t){return arguments.length?this.each(null==t?l5:("function"==typeof t?h5:u5)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?c5:("function"==typeof t?p5:d5)(t)):this.node().innerHTML},raise:function(){return this.each(f5)},lower:function(){return this.each(m5)},append:function(t){var e="function"==typeof t?t:x3(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:x3(t),r=null==e?g5:"function"==typeof e?e:M3(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(y5)},clone:function(t){return this.select(t?_5:v5)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?x5:b5,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,h=a.length;u<h;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?S5:M5)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};var N5={value:()=>{}};function P5(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new k5(r)}function k5(t){this._=t}function O5(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function I5(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=N5,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}k5.prototype=P5.prototype={constructor:k5,on:function(t,e){var n,r,i=this._,s=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,a=s.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=s[o]).type)i[n]=I5(i[n],t.name,e);else if(null==e)for(n in i)i[n]=I5(i[n],t.name,null);return this}for(;++o<a;)if((n=(t=s[o]).type)&&(n=O5(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new k5(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};const D5={passive:!1},L5={capture:!0,passive:!1};function U5(t){t.stopImmediatePropagation()}function F5(t){t.preventDefault(),t.stopImmediatePropagation()}function z5(t){var e=t.document.documentElement,n=C5(t).on("dragstart.drag",F5,L5);"onselectstart"in e?n.on("selectstart.drag",F5,L5):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function B5(t,e){var n=t.document.documentElement,r=C5(t).on("dragstart.drag",null);e&&(r.on("click.drag",F5,L5),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var j5=t=>()=>t;function V5(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:u,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}function G5(t){return!t.ctrlKey&&!t.button}function H5(){return this.parentNode}function W5(t,e){return null==e?{x:t.x,y:t.y}:e}function q5(){return navigator.maxTouchPoints||"ontouchstart"in this}function $5(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function X5(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Y5(){}V5.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var K5=.7,Z5=1/K5,J5="\\s*([+-]?\\d+)\\s*",Q5="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",t4="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",e4=/^#([0-9a-f]{3,8})$/,n4=new RegExp(`^rgb\\(${J5},${J5},${J5}\\)$`),r4=new RegExp(`^rgb\\(${t4},${t4},${t4}\\)$`),i4=new RegExp(`^rgba\\(${J5},${J5},${J5},${Q5}\\)$`),s4=new RegExp(`^rgba\\(${t4},${t4},${t4},${Q5}\\)$`),o4=new RegExp(`^hsl\\(${Q5},${t4},${t4}\\)$`),a4=new RegExp(`^hsla\\(${Q5},${t4},${t4},${Q5}\\)$`),l4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function u4(){return this.rgb().formatHex()}function h4(){return this.rgb().formatRgb()}function c4(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=e4.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?d4(e):3===n?new m4(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?p4(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?p4(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=n4.exec(t))?new m4(e[1],e[2],e[3],1):(e=r4.exec(t))?new m4(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=i4.exec(t))?p4(e[1],e[2],e[3],e[4]):(e=s4.exec(t))?p4(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=o4.exec(t))?x4(e[1],e[2]/100,e[3]/100,1):(e=a4.exec(t))?x4(e[1],e[2]/100,e[3]/100,e[4]):l4.hasOwnProperty(t)?d4(l4[t]):"transparent"===t?new m4(NaN,NaN,NaN,0):null}function d4(t){return new m4(t>>16&255,t>>8&255,255&t,1)}function p4(t,e,n,r){return r<=0&&(t=e=n=NaN),new m4(t,e,n,r)}function f4(t,e,n,r){return 1===arguments.length?function(t){return t instanceof Y5||(t=c4(t)),t?new m4((t=t.rgb()).r,t.g,t.b,t.opacity):new m4}(t):new m4(t,e,n,null==r?1:r)}function m4(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function g4(){return`#${b4(this.r)}${b4(this.g)}${b4(this.b)}`}function y4(){const t=v4(this.opacity);return`${1===t?"rgb(":"rgba("}${_4(this.r)}, ${_4(this.g)}, ${_4(this.b)}${1===t?")":`, ${t})`}`}function v4(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function _4(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function b4(t){return((t=_4(t))<16?"0":"")+t.toString(16)}function x4(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new M4(t,e,n,r)}function w4(t){if(t instanceof M4)return new M4(t.h,t.s,t.l,t.opacity);if(t instanceof Y5||(t=c4(t)),!t)return new M4;if(t instanceof M4)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new M4(o,a,l,t.opacity)}function M4(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function S4(t){return(t=(t||0)%360)<0?t+360:t}function T4(t){return Math.max(0,Math.min(1,t||0))}function E4(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}$5(Y5,c4,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:u4,formatHex:u4,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return w4(this).formatHsl()},formatRgb:h4,toString:h4}),$5(m4,f4,X5(Y5,{brighter(t){return t=null==t?Z5:Math.pow(Z5,t),new m4(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?K5:Math.pow(K5,t),new m4(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new m4(_4(this.r),_4(this.g),_4(this.b),v4(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:g4,formatHex:g4,formatHex8:function(){return`#${b4(this.r)}${b4(this.g)}${b4(this.b)}${b4(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:y4,toString:y4})),$5(M4,(function(t,e,n,r){return 1===arguments.length?w4(t):new M4(t,e,n,null==r?1:r)}),X5(Y5,{brighter(t){return t=null==t?Z5:Math.pow(Z5,t),new M4(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?K5:Math.pow(K5,t),new M4(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new m4(E4(t>=240?t-240:t+120,i,r),E4(t,i,r),E4(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new M4(S4(this.h),T4(this.s),T4(this.l),v4(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=v4(this.opacity);return`${1===t?"hsl(":"hsla("}${S4(this.h)}, ${100*T4(this.s)}%, ${100*T4(this.l)}%${1===t?")":`, ${t})`}`}}));var A4=t=>()=>t;function C4(t){return 1==(t=+t)?R4:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):A4(isNaN(e)?n:e)}}function R4(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):A4(isNaN(t)?e:t)}var N4=function t(e){var n=C4(e);function r(t,e){var r=n((t=f4(t)).r,(e=f4(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=R4(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function P4(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var k4=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,O4=new RegExp(k4.source,"g");function I4(t,e){var n,r,i,s=k4.lastIndex=O4.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=k4.exec(t))&&(r=O4.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:P4(n,r)})),s=O4.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})}var D4,L4=180/Math.PI,U4={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function F4(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*L4,skewX:Math.atan(l)*L4,scaleX:o,scaleY:a}}function z4(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:P4(t,i)},{i:l-2,x:P4(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:P4(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:P4(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:P4(t,n)},{i:a-2,x:P4(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var B4=z4((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?U4:F4(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),j4=z4((function(t){return null==t?U4:(D4||(D4=document.createElementNS("http://www.w3.org/2000/svg","g")),D4.setAttribute("transform",t),(t=D4.transform.baseVal.consolidate())?F4((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):U4)}),", ",")",")");function V4(t){return((t=Math.exp(t))+1/t)/2}var G4,H4,W4=function t(e,n,r){function i(t,i){var s,o,a=t[0],l=t[1],u=t[2],h=i[0],c=i[1],d=i[2],p=h-a,f=c-l,m=p*p+f*f;if(m<1e-12)o=Math.log(d/u)/e,s=function(t){return[a+t*p,l+t*f,u*Math.exp(e*t*o)]};else{var g=Math.sqrt(m),y=(d*d-u*u+r*m)/(2*u*n*g),v=(d*d-u*u-r*m)/(2*d*n*g),_=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(v*v+1)-v);o=(b-_)/e,s=function(t){var r=t*o,i=V4(_),s=u/(n*g)*(i*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+_)-function(t){return((t=Math.exp(t))-1/t)/2}(_));return[a+s*p,l+s*f,u*i/V4(e*r+_)]}}return s.duration=1e3*o*e/Math.SQRT2,s}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4),q4=0,$4=0,X4=0,Y4=0,K4=0,Z4=0,J4="object"==typeof performance&&performance.now?performance:Date,Q4="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function t6(){return K4||(Q4(e6),K4=J4.now()+Z4)}function e6(){K4=0}function n6(){this._call=this._time=this._next=null}function r6(t,e,n){var r=new n6;return r.restart(t,e,n),r}function i6(){K4=(Y4=J4.now())+Z4,q4=$4=0;try{!function(){t6(),++q4;for(var t,e=G4;e;)(t=K4-e._time)>=0&&e._call.call(void 0,t),e=e._next;--q4}()}finally{q4=0,function(){var t,e,n=G4,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:G4=e);H4=t,o6(r)}(),K4=0}}function s6(){var t=J4.now(),e=t-Y4;e>1e3&&(Z4-=e,Y4=t)}function o6(t){q4||($4&&($4=clearTimeout($4)),t-K4>24?(t<1/0&&($4=setTimeout(i6,t-J4.now()-Z4)),X4&&(X4=clearInterval(X4))):(X4||(Y4=J4.now(),X4=setInterval(s6,1e3)),q4=1,Q4(i6)))}function a6(t,e,n){var r=new n6;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}n6.prototype=r6.prototype={constructor:n6,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?t6():+n)+(null==e?0:+e),this._next||H4===this||(H4?H4._next=this:G4=this,H4=this),this._call=t,this._time=n,o6()},stop:function(){this._call&&(this._call=null,this._time=1/0,o6())}};var l6=P5("start","end","cancel","interrupt"),u6=[];function h6(t,e,n,r,i,s){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function s(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(s){var u,h,c,d;if(1!==n.state)return l();for(u in i)if((d=i[u]).name===n.name){if(3===d.state)return a6(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[u]):+u<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[u])}if(a6((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(s))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(c=n.tween.length),u=0,h=-1;u<c;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=d);r.length=h+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=r6(s,0,n.time)}(t,n,{name:e,index:r,group:i,on:l6,tween:u6,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:0})}function c6(t,e){var n=p6(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function d6(t,e){var n=p6(t,e);if(n.state>3)throw new Error("too late; already running");return n}function p6(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function f6(t,e){var n,r,i,s=t.__transition,o=!0;if(s){for(i in e=null==e?null:e+"",s)(n=s[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[i]):o=!1;o&&delete t.__transition}}function m6(t,e){var n,r;return function(){var i=d6(this,t),s=i.tween;if(s!==n)for(var o=0,a=(r=n=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function g6(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=d6(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function y6(t,e,n){var r=t._id;return t.each((function(){var t=d6(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return p6(t,r).value[e]}}function v6(t,e){var n;return("number"==typeof e?P4:e instanceof c4?N4:(n=c4(e))?(e=n,N4):I4)(t,e)}function _6(t){return function(){this.removeAttribute(t)}}function b6(t){return function(){this.removeAttributeNS(t.space,t.local)}}function x6(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function w6(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function M6(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttribute(t)}}function S6(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function T6(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function E6(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function A6(t,e){return function(){c6(this,t).delay=+e.apply(this,arguments)}}function C6(t,e){return e=+e,function(){c6(this,t).delay=e}}function R6(t,e){return function(){d6(this,t).duration=+e.apply(this,arguments)}}function N6(t,e){return e=+e,function(){d6(this,t).duration=e}}var P6=A5.prototype.constructor;function k6(t){return function(){this.style.removeProperty(t)}}var O6=0;function I6(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function D6(){return++O6}var L6=A5.prototype;I6.prototype={constructor:I6,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=M3(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a,l,u=r[o],h=u.length,c=s[o]=new Array(h),d=0;d<h;++d)(a=u[d])&&(l=t.call(a,a.__data__,d,u))&&("__data__"in a&&(l.__data__=a.__data__),c[d]=l,h6(c[d],e,n,d,c,p6(a,n)));return new I6(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=T3(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,u=r[a],h=u.length,c=0;c<h;++c)if(l=u[c]){for(var d,p=t.call(l,l.__data__,c,u),f=p6(l,n),m=0,g=p.length;m<g;++m)(d=p[m])&&h6(d,e,n,m,p,f);s.push(p),o.push(l)}return new I6(s,o,e,n)},selectChild:L6.selectChild,selectChildren:L6.selectChildren,filter:function(t){"function"!=typeof t&&(t=A3(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new I6(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l,u=e[a],h=n[a],c=u.length,d=o[a]=new Array(c),p=0;p<c;++p)(l=u[p]||h[p])&&(d[p]=l);for(;a<r;++a)o[a]=e[a];return new I6(o,this._parents,this._name,this._id)},selection:function(){return new P6(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=D6(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)if(o=a[u]){var h=p6(o,e);h6(o,t,n,u,a,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new I6(r,this._parents,t,n)},call:L6.call,nodes:L6.nodes,node:L6.node,size:L6.size,empty:L6.empty,each:L6.each,on:function(t,e){var n=this._id;return arguments.length<2?p6(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?c6:d6;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}(n,t,e))},attr:function(t,e){var n=v3(t),r="transform"===n?j4:v6;return this.attrTween(t,"function"==typeof e?(n.local?S6:M6)(n,r,y6(this,"attr."+t,e)):null==e?(n.local?b6:_6)(n):(n.local?w6:x6)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=v3(t);return this.tween(n,(r.local?T6:E6)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?B4:v6;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var s=K3(this,t),o=(this.style.removeProperty(t),K3(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}(t,r)).on("end.style."+t,k6(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,s;return function(){var o=K3(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=K3(this,t)),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}(t,r,y6(this,"style."+t,e))).each(function(t,e){var n,r,i,s,o="style."+e,a="end."+o;return function(){var l=d6(this,t),u=l.on,h=null==l.value[o]?s||(s=k6(e)):void 0;u===n&&i===h||(r=(n=u).copy()).on(a,i=h),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,s=n+"";return function(){var o=K3(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function s(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,s,n)),r}return s._value=e,s}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(y6(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=p6(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===t)return r.value;return null}return this.each((null==e?m6:g6)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?A6:C6)(e,t)):p6(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?R6:N6)(e,t)):p6(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){d6(this,t).ease=e}}(e,t)):p6(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;d6(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0==--i&&s()}};n.each((function(){var n=d6(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})),0===i&&s()}))},[Symbol.iterator]:L6[Symbol.iterator]};var U6={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function F6(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}A5.prototype.interrupt=function(t){return this.each((function(){f6(this,t)}))},A5.prototype.transition=function(t){var e,n;t instanceof I6?(e=t._id,t=t._name):(e=D6(),(n=U6).time=t6(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,u=0;u<l;++u)(o=a[u])&&h6(o,t,e,u,a,n||F6(o,e));return new I6(r,this._parents,t,e)};var z6=t=>()=>t;function B6(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function j6(t,e,n){this.k=t,this.x=e,this.y=n}j6.prototype={constructor:j6,scale:function(t){return 1===t?this:new j6(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new j6(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var V6=new j6(1,0,0);function G6(t){for(;!t.__zoom;)if(!(t=t.parentNode))return V6;return t.__zoom}function H6(t){t.stopImmediatePropagation()}function W6(t){t.preventDefault(),t.stopImmediatePropagation()}function q6(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function $6(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function X6(){return this.__zoom||V6}function Y6(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function K6(){return navigator.maxTouchPoints||"ontouchstart"in this}function Z6(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function J6(){var t,e,n,r=q6,i=$6,s=Z6,o=Y6,a=K6,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],h=250,c=W4,d=P5("start","zoom","end"),p=0,f=10;function m(t){t.property("__zoom",X6).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",S).filter(a).on("touchstart.zoom",T).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new j6(e,t.x,t.y)}function y(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new j6(t.k,r,i)}function v(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,e,n,r){t.on("start.zoom",(function(){b(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){b(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,s=arguments,o=b(t,s).event(r),a=i.apply(t,s),l=null==n?v(a):"function"==typeof n?n.apply(t,s):n,u=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),h=t.__zoom,d="function"==typeof e?e.apply(t,s):e,p=c(h.invert(l).concat(u/h.k),d.invert(l).concat(u/d.k));return function(t){if(1===t)t=d;else{var e=p(t),n=u/e[2];t=new j6(n,l[0]-e[0]*n,l[1]-e[1]*n)}o.zoom(null,t)}}))}function b(t,e,n){return!n&&t.__zooming||new x(t,e)}function x(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function w(t,...e){if(r.apply(this,arguments)){var n=b(this,e).event(t),i=this.__zoom,a=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,o.apply(this,arguments)))),h=R5(t);if(n.wheel)n.mouse[0][0]===h[0]&&n.mouse[0][1]===h[1]||(n.mouse[1]=i.invert(n.mouse[0]=h)),clearTimeout(n.wheel);else{if(i.k===a)return;n.mouse=[h,i.invert(h)],f6(this),n.start()}W6(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),150),n.zoom("mouse",s(y(g(i,a),n.mouse[0],n.mouse[1]),n.extent,u))}}function M(t,...e){if(!n&&r.apply(this,arguments)){var i=t.currentTarget,o=b(this,e,!0).event(t),a=C5(t.view).on("mousemove.zoom",(function(t){if(W6(t),!o.moved){var e=t.clientX-h,n=t.clientY-c;o.moved=e*e+n*n>p}o.event(t).zoom("mouse",s(y(o.that.__zoom,o.mouse[0]=R5(t,i),o.mouse[1]),o.extent,u))}),!0).on("mouseup.zoom",(function(t){a.on("mousemove.zoom mouseup.zoom",null),B5(t.view,o.moved),W6(t),o.event(t).end()}),!0),l=R5(t,i),h=t.clientX,c=t.clientY;z5(t.view),H6(t),o.mouse=[l,this.__zoom.invert(l)],f6(this),o.start()}}function S(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,o=R5(t.changedTouches?t.changedTouches[0]:t,this),a=n.invert(o),l=n.k*(t.shiftKey?.5:2),c=s(y(g(n,l),o,a),i.apply(this,e),u);W6(t),h>0?C5(this).transition().duration(h).call(_,c,o,t):C5(this).call(m.transform,c,o,t)}}function T(n,...i){if(r.apply(this,arguments)){var s,o,a,l,u=n.touches,h=u.length,c=b(this,i,n.changedTouches.length===h).event(n);for(H6(n),o=0;o<h;++o)l=[l=R5(a=u[o],this),this.__zoom.invert(l),a.identifier],c.touch0?c.touch1||c.touch0[2]===l[2]||(c.touch1=l,c.taps=0):(c.touch0=l,s=!0,c.taps=1+!!t);t&&(t=clearTimeout(t)),s&&(c.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),500)),f6(this),c.start())}}function E(t,...e){if(this.__zooming){var n,r,i,o,a=b(this,e).event(t),l=t.changedTouches,h=l.length;for(W6(t),n=0;n<h;++n)i=R5(r=l[n],this),a.touch0&&a.touch0[2]===r.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===r.identifier&&(a.touch1[0]=i);if(r=a.that.__zoom,a.touch1){var c=a.touch0[0],d=a.touch0[1],p=a.touch1[0],f=a.touch1[1],m=(m=p[0]-c[0])*m+(m=p[1]-c[1])*m,v=(v=f[0]-d[0])*v+(v=f[1]-d[1])*v;r=g(r,Math.sqrt(m/v)),i=[(c[0]+p[0])/2,(c[1]+p[1])/2],o=[(d[0]+f[0])/2,(d[1]+f[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],o=a.touch0[1]}a.zoom("touch",s(y(r,i,o),a.extent,u))}}function A(t,...r){if(this.__zooming){var i,s,o=b(this,r).event(t),a=t.changedTouches,l=a.length;for(H6(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),i=0;i<l;++i)s=a[i],o.touch0&&o.touch0[2]===s.identifier?delete o.touch0:o.touch1&&o.touch1[2]===s.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(s=R5(s,this),Math.hypot(e[0]-s[0],e[1]-s[1])<f)){var u=C5(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",X6),t!==i?_(t,e,n,r):i.interrupt().each((function(){b(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,r){m.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},m.scaleTo=function(t,e,n,r){m.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,o=null==n?v(t):"function"==typeof n?n.apply(this,arguments):n,a=r.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return s(y(g(r,l),o,a),t,u)}),n,r)},m.translateBy=function(t,e,n,r){m.transform(t,(function(){return s(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),u)}),null,r)},m.translateTo=function(t,e,n,r,o){m.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,a=null==r?v(t):"function"==typeof r?r.apply(this,arguments):r;return s(V6.translate(a[0],a[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,u)}),r,o)},x.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=C5(this.that).datum();d.call(t,this.that,new B6(t,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:d}),e)}},m.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:z6(+t),m):o},m.filter=function(t){return arguments.length?(r="function"==typeof t?t:z6(!!t),m):r},m.touchable=function(t){return arguments.length?(a="function"==typeof t?t:z6(!!t),m):a},m.extent=function(t){return arguments.length?(i="function"==typeof t?t:z6([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):i},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(u[0][0]=+t[0][0],u[1][0]=+t[1][0],u[0][1]=+t[0][1],u[1][1]=+t[1][1],m):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},m.constrain=function(t){return arguments.length?(s=t,m):s},m.duration=function(t){return arguments.length?(h=+t,m):h},m.interpolate=function(t){return arguments.length?(c=t,m):c},m.on=function(){var t=d.on.apply(d,arguments);return t===d?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(f=+t,m):f},m}G6.prototype=j6.prototype;class Q6 extends Map{constructor(t,e=e8){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(t8(this,t))}has(t){return super.has(t8(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);t.has(r)&&(n=t.get(r),t.delete(r));return n}(this,t))}}function t8({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function e8(t){return null!==t&&"object"==typeof t?t.valueOf():t}function n8(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function r8(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}var i8="object"==typeof global&&global&&global.Object===Object&&global,s8="object"==typeof self&&self&&self.Object===Object&&self,o8=i8||s8||Function("return this")(),a8=o8.Symbol,l8=Object.prototype,u8=l8.hasOwnProperty,h8=l8.toString,c8=a8?a8.toStringTag:void 0;var d8=Object.prototype.toString;var p8=a8?a8.toStringTag:void 0;function f8(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":p8&&p8 in Object(t)?function(t){var e=u8.call(t,c8),n=t[c8];try{t[c8]=void 0;var r=!0}catch(t){}var i=h8.call(t);return r&&(e?t[c8]=n:delete t[c8]),i}(t):function(t){return d8.call(t)}(t)}var m8=/\s/;var g8=/^\s+/;function y8(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&m8.test(t.charAt(e)););return e}(t)+1).replace(g8,""):t}function v8(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var _8=/^[-+]0x[0-9a-f]+$/i,b8=/^0b[01]+$/i,x8=/^0o[0-7]+$/i,w8=parseInt;function M8(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==f8(t)}(t))return NaN;if(v8(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=v8(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=y8(t);var n=b8.test(t);return n||x8.test(t)?w8(t.slice(2),n?2:8):_8.test(t)?NaN:+t}var S8=function(){return o8.Date.now()},T8=Math.max,E8=Math.min;function A8(t,e,n){var r,i,s,o,a,l,u=0,h=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||c&&t-u>=s}function m(){var t=S8();if(f(t))return g(t);a=setTimeout(m,function(t){var n=e-(t-l);return c?E8(n,s-(t-u)):n}(t))}function g(t){return a=void 0,d&&r?p(t):(r=i=void 0,o)}function y(){var t=S8(),n=f(t);if(r=arguments,i=this,l=t,n){if(void 0===a)return function(t){return u=t,a=setTimeout(m,e),h?p(t):o}(l);if(c)return clearTimeout(a),a=setTimeout(m,e),p(l)}return void 0===a&&(a=setTimeout(m,e)),o}return e=M8(e)||0,v8(n)&&(h=!!n.leading,s=(c="maxWait"in n)?T8(M8(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=l=i=a=void 0},y.flush=function(){return void 0===a?o:g(S8())},y}var C8=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return t},Out:function(t){return t},InOut:function(t){return t}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(t){var e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-C8.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*C8.Bounce.In(2*t):.5*C8.Bounce.Out(2*t-1)+.5}}),generatePow:function(t){return void 0===t&&(t=4),t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(2*e,t)/2:(1-Math.pow(2-2*e,t))/2+.5}}}}),R8=function(){return performance.now()},N8=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,t)}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var s=i[r];null===(t=s._group)||void 0===t||t.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var i=r[n];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},t.prototype.allStopped=function(){return this.getAll().every((function(t){return!t.isPlaying()}))},t.prototype.update=function(t,e){void 0===t&&(t=R8()),void 0===e&&(e=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],s=!e;i&&!1===i.update(t,s)&&!e&&this.remove(i)}n=Object.keys(this._tweensAddedDuringUpdate)}},t}(),P8={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),s=P8.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t}}},k8=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),O8=new N8,I8=function(){function t(t,e){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=C8.Linear.None,this._interpolationFunction=P8.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=k8.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=t,"object"==typeof e?(this._group=e,e.add(this)):!0===e&&(this._group=O8,O8.add(this))}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.getDuration=function(){return this._duration},t.prototype.to=function(t,e){if(void 0===e&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e<0?0:e,this},t.prototype.duration=function(t){return void 0===t&&(t=1e3),this._duration=t<0?0:t,this},t.prototype.dynamic=function(t){return void 0===t&&(t=!1),this._isDynamic=t,this},t.prototype.start=function(t,e){if(void 0===t&&(t=R8()),void 0===e&&(e=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},t.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},t.prototype._setupProperties=function(t,e,n,r,i){for(var s in n){var o=t[s],a=Array.isArray(o),l=a?"array":typeof o,u=!a&&Array.isArray(n[s]);if("undefined"!==l&&"function"!==l){if(u){if(0===(g=n[s]).length)continue;for(var h=[o],c=0,d=g.length;c<d;c+=1){var p=this._handleRelativeValue(o,g[c]);if(isNaN(p)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(p)}u&&(n[s]=h)}if("object"!==l&&!a||!o||u)(void 0===e[s]||i)&&(e[s]=o),a||(e[s]*=1),r[s]=u?n[s].slice().reverse():e[s]||0;else{e[s]=a?[]:{};var f=o;for(var m in f)e[s][m]=f[m];r[s]=a?[]:{};var g=n[s];if(!this._isDynamic){var y={};for(var m in g)y[m]=g[m];n[s]=g=y}this._setupProperties(f,e[s],g,r[s],i)}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},t.prototype.pause=function(t){return void 0===t&&(t=R8()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t),this},t.prototype.resume=function(t){return void 0===t&&(t=R8()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},t.prototype.remove=function(){var t;return null===(t=this._group)||void 0===t||t.remove(this),this},t.prototype.delay=function(t){return void 0===t&&(t=0),this._delayTime=t,this},t.prototype.repeat=function(t){return void 0===t&&(t=0),this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return void 0===t&&(t=!1),this._yoyo=t,this},t.prototype.easing=function(t){return void 0===t&&(t=C8.Linear.None),this._easingFunction=t,this},t.prototype.interpolation=function(t){return void 0===t&&(t=P8.Linear),this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(e,n){var r,i,s=this;if(void 0===e&&(e=R8()),void 0===n&&(n=t.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),l=this._duration+this._repeat*a,u=function(){if(0===s._duration)return 1;if(o>l)return 1;var t=Math.trunc(o/a),e=o-t*a,n=Math.min(e/s._duration,1);return 0===n&&o===s._duration?1:n}(),h=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),0===this._duration||o>=this._duration){if(this._repeat>0){var c=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=c),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*c,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var d=0,p=this._chainedTweens.length;d<p;d++)this._chainedTweens[d].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var s=e[i]||0,o=n[i],a=Array.isArray(t[i]),l=Array.isArray(o);!a&&l?t[i]=this._interpolationFunction(o,r):"object"==typeof o&&o?this._updateProperties(t[i],s,o,r):"number"==typeof(o=this._handleRelativeValue(s,o))&&(t[i]=s+(o-s)*r)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t.autoStartOnUpdate=!1,t}();k8.nextId;var D8=O8;function L8(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function U8(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function F8(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return L8(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L8(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}D8.getAll.bind(D8),D8.removeAll.bind(D8),D8.add.bind(D8),D8.remove.bind(D8),D8.update.bind(D8);var z8=U8((function t(e,n){var r=n.default,i=void 0===r?null:r,s=n.triggerUpdate,o=void 0===s||s,a=n.onChange,l=void 0===a?function(t,e){}:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l}));function B8(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,r=t.props,i=void 0===r?{}:r,s=t.methods,o=void 0===s?{}:s,a=t.aliases,l=void 0===a?{}:a,u=t.init,h=void 0===u?function(){}:u,c=t.update,d=void 0===c?function(){}:c,p=Object.keys(i).map((function(t){return new z8(t,i[t])}));return function t(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var s=!!(this instanceof t?this.constructor:void 0),a=s?r.shift():void 0,u=r[0],c=void 0===u?{}:u,f=Object.assign({},n instanceof Function?n(c):n,{initialised:!1}),m={};function g(t){return y(t,c),v(),g}var y=function(t,e){h.call(g,t,f,e),f.initialised=!0},v=A8((function(){f.initialised&&(d.call(g,f,m),m={})}),1);return p.forEach((function(t){g[t.name]=function(t){var e=t.name,n=t.triggerUpdate,r=void 0!==n&&n,i=t.onChange,s=void 0===i?function(t,e){}:i,o=t.defaultVal,a=void 0===o?null:o;return function(t){var n=f[e];if(!arguments.length)return n;var i=void 0===t?a:t;return f[e]=i,s.call(g,i,f,n),!m.hasOwnProperty(e)&&(m[e]=n),r&&v(),g}}(t)})),Object.keys(o).forEach((function(t){g[t]=function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=o[t]).call.apply(e,[g,f].concat(r))}})),Object.entries(l).forEach((function(t){var e=F8(t,2),n=e[0],r=e[1];return g[n]=g[r]})),g.resetProps=function(){return p.forEach((function(t){g[t.name](t.defaultVal)})),g},g.resetProps(),f._rerender=v,s&&a&&g(a),g}}var j8=function(t){return"function"==typeof t?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}};function V8(t){return V8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V8(t)}var G8=/^\s+/,H8=/\s+$/;function W8(t,e){if(e=e||{},(t=t||"")instanceof W8)return t;if(!(this instanceof W8))return new W8(t,e);var n=function(t){var e={r:0,g:0,b:0},n=1,r=null,i=null,s=null,o=!1,a=!1;"string"==typeof t&&(t=function(t){t=t.replace(G8,"").replace(H8,"").toLowerCase();var e,n=!1;if(l9[t])t=l9[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=v9.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=v9.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=v9.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=v9.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=v9.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=v9.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=v9.hex8.exec(t))return{r:p9(e[1]),g:p9(e[2]),b:p9(e[3]),a:y9(e[4]),format:n?"name":"hex8"};if(e=v9.hex6.exec(t))return{r:p9(e[1]),g:p9(e[2]),b:p9(e[3]),format:n?"name":"hex"};if(e=v9.hex4.exec(t))return{r:p9(e[1]+""+e[1]),g:p9(e[2]+""+e[2]),b:p9(e[3]+""+e[3]),a:y9(e[4]+""+e[4]),format:n?"name":"hex8"};if(e=v9.hex3.exec(t))return{r:p9(e[1]+""+e[1]),g:p9(e[2]+""+e[2]),b:p9(e[3]+""+e[3]),format:n?"name":"hex"};return!1}(t));"object"==V8(t)&&(_9(t.r)&&_9(t.g)&&_9(t.b)?(e=function(t,e,n){return{r:255*c9(t,255),g:255*c9(e,255),b:255*c9(n,255)}}(t.r,t.g,t.b),o=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):_9(t.h)&&_9(t.s)&&_9(t.v)?(r=m9(t.s),i=m9(t.v),e=function(t,e,n){t=6*c9(t,360),e=c9(e,100),n=c9(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6,u=[n,o,s,s,a,n][l],h=[a,n,n,o,s,s][l],c=[s,s,a,n,n,o][l];return{r:255*u,g:255*h,b:255*c}}(t.h,r,i),o=!0,a="hsv"):_9(t.h)&&_9(t.s)&&_9(t.l)&&(r=m9(t.s),s=m9(t.l),e=function(t,e,n){var r,i,s;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=c9(t,360),e=c9(e,100),n=c9(n,100),0===e)r=i=s=n;else{var a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,r,s),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a));return n=h9(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function q8(t,e,n){t=c9(t,255),e=c9(e,255),n=c9(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=(s+o)/2;if(s==o)r=i=0;else{var l=s-o;switch(i=a>.5?l/(2-s-o):l/(s+o),s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,l:a}}function $8(t,e,n){t=c9(t,255),e=c9(e,255),n=c9(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=s,l=s-o;if(i=0===s?0:l/s,s==o)r=0;else{switch(s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,v:a}}function X8(t,e,n,r){var i=[f9(Math.round(t).toString(16)),f9(Math.round(e).toString(16)),f9(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Y8(t,e,n,r){return[f9(g9(r)),f9(Math.round(t).toString(16)),f9(Math.round(e).toString(16)),f9(Math.round(n).toString(16))].join("")}function K8(t,e){e=0===e?0:e||10;var n=W8(t).toHsl();return n.s-=e/100,n.s=d9(n.s),W8(n)}function Z8(t,e){e=0===e?0:e||10;var n=W8(t).toHsl();return n.s+=e/100,n.s=d9(n.s),W8(n)}function J8(t){return W8(t).desaturate(100)}function Q8(t,e){e=0===e?0:e||10;var n=W8(t).toHsl();return n.l+=e/100,n.l=d9(n.l),W8(n)}function t9(t,e){e=0===e?0:e||10;var n=W8(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),W8(n)}function e9(t,e){e=0===e?0:e||10;var n=W8(t).toHsl();return n.l-=e/100,n.l=d9(n.l),W8(n)}function n9(t,e){var n=W8(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,W8(n)}function r9(t){var e=W8(t).toHsl();return e.h=(e.h+180)%360,W8(e)}function i9(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=W8(t).toHsl(),r=[W8(t)],i=360/e,s=1;s<e;s++)r.push(W8({h:(n.h+s*i)%360,s:n.s,l:n.l}));return r}function s9(t){var e=W8(t).toHsl(),n=e.h;return[W8(t),W8({h:(n+72)%360,s:e.s,l:e.l}),W8({h:(n+216)%360,s:e.s,l:e.l})]}function o9(t,e,n){e=e||6,n=n||30;var r=W8(t).toHsl(),i=360/n,s=[W8(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(W8(r));return s}function a9(t,e){e=e||6;for(var n=W8(t).toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/e;e--;)o.push(W8({h:r,s:i,v:s})),s=(s+a)%1;return o}W8.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=h9(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=$8(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=$8(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=q8(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=q8(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return X8(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var s=[f9(Math.round(t).toString(16)),f9(Math.round(e).toString(16)),f9(Math.round(n).toString(16)),f9(g9(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*c9(this._r,255))+"%",g:Math.round(100*c9(this._g,255))+"%",b:Math.round(100*c9(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*c9(this._r,255))+"%, "+Math.round(100*c9(this._g,255))+"%, "+Math.round(100*c9(this._b,255))+"%)":"rgba("+Math.round(100*c9(this._r,255))+"%, "+Math.round(100*c9(this._g,255))+"%, "+Math.round(100*c9(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(u9[X8(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+Y8(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=W8(t);n="#"+Y8(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return W8(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(Q8,arguments)},brighten:function(){return this._applyModification(t9,arguments)},darken:function(){return this._applyModification(e9,arguments)},desaturate:function(){return this._applyModification(K8,arguments)},saturate:function(){return this._applyModification(Z8,arguments)},greyscale:function(){return this._applyModification(J8,arguments)},spin:function(){return this._applyModification(n9,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(o9,arguments)},complement:function(){return this._applyCombination(r9,arguments)},monochromatic:function(){return this._applyCombination(a9,arguments)},splitcomplement:function(){return this._applyCombination(s9,arguments)},triad:function(){return this._applyCombination(i9,[3])},tetrad:function(){return this._applyCombination(i9,[4])}},W8.fromRatio=function(t,e){if("object"==V8(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:m9(t[r]));t=n}return W8(t,e)},W8.equals=function(t,e){return!(!t||!e)&&W8(t).toRgbString()==W8(e).toRgbString()},W8.random=function(){return W8.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},W8.mix=function(t,e,n){n=0===n?0:n||50;var r=W8(t).toRgb(),i=W8(e).toRgb(),s=n/100;return W8({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},
// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)
// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)
W8.readability=function(t,e){var n=W8(t),r=W8(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},W8.isReadable=function(t,e,n){var r,i,s=W8.readability(t,e);switch(i=!1,(r=function(t){var e,n;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==n&&"large"!==n&&(n="small");return{level:e,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},W8.mostReadable=function(t,e,n){var r,i,s,o,a=null,l=0;i=(n=n||{}).includeFallbackColors,s=n.level,o=n.size;for(var u=0;u<e.length;u++)(r=W8.readability(t,e[u]))>l&&(l=r,a=W8(e[u]));return W8.isReadable(t,a,{level:s,size:o})||!i?a:(n.includeFallbackColors=!1,W8.mostReadable(t,["#fff","#000"],n))};var l9=W8.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},u9=W8.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(l9);function h9(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function c9(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function d9(t){return Math.min(1,Math.max(0,t))}function p9(t){return parseInt(t,16)}function f9(t){return 1==t.length?"0"+t:""+t}function m9(t){return t<=1&&(t=100*t+"%"),t}function g9(t){return Math.round(255*parseFloat(t)).toString(16)}function y9(t){return p9(t)/255}var v9=function(){var t="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",e="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+e),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+e),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+e),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function _9(t){return!!v9.CSS_UNIT.exec(t)}function b9(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function x9(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function w9(t,e){return t.get(x9(t,e))}function M9(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function S9(t,e,n){return t.set(x9(t,e),n),n}function T9(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,A9(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function E9(t){return function(t){if(Array.isArray(t))return b9(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return b9(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b9(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A9(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}var C9,R9,N9,P9,k9,O9,I9,D9,L9,U9,F9,z9,B9=function(t,e,n){return(t<<16)+(e<<8)+n},j9=function(t,e){return 123*t%Math.pow(2,e)},V9=new WeakMap,G9=new WeakMap,H9=function(){return T9((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),M9(this,V9,void 0),M9(this,G9,void 0),S9(G9,this,e),this.reset()}),[{key:"reset",value:function(){S9(V9,this,["__reserved for background__"])}},{key:"register",value:function(t){if(w9(V9,this).length>=Math.pow(2,24-w9(G9,this)))return null;var e,n=w9(V9,this).length,r=j9(n,w9(G9,this)),i=(e=n+(r<<24-w9(G9,this)),"#".concat(Math.min(e,Math.pow(2,24)).toString(16).padStart(6,"0")));return w9(V9,this).push(t),i}},{key:"lookup",value:function(t){if(!t)return null;var e="string"==typeof t?function(t){var e=W8(t).toRgb(),n=e.r,r=e.g,i=e.b;return B9(n,r,i)}(t):B9.apply(void 0,E9(t));if(!e)return null;var n=e&Math.pow(2,24-w9(G9,this))-1,r=e>>24-w9(G9,this)&Math.pow(2,w9(G9,this))-1;return j9(n,w9(G9,this))!==r||n>=w9(V9,this).length?null:w9(V9,this)[n]}}])}(),W9={},q9=[],$9=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,X9=Array.isArray;function Y9(t,e){for(var n in e)t[n]=e[n];return t}function K9(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Z9(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==i?++N9:i,__i:-1,__u:0};return null==i&&null!=R9.vnode&&R9.vnode(s),s}function J9(t){return t.children}function Q9(t,e){this.props=t,this.context=e}function t7(t,e){if(null==e)return t.__?t7(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?t7(t):null}function e7(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return e7(t)}}function n7(t){(!t.__d&&(t.__d=!0)&&k9.push(t)&&!r7.__r++||O9!==R9.debounceRendering)&&((O9=R9.debounceRendering)||I9)(r7)}function r7(){var t,e,n,r,i,s,o,a;for(k9.sort(D9);t=k9.shift();)t.__d&&(e=k9.length,r=void 0,s=(i=(n=t).__v).__e,o=[],a=[],n.__P&&((r=Y9({},i)).__v=i.__v+1,R9.vnode&&R9.vnode(r),c7(n.__P,r,i,n.__n,n.__P.namespaceURI,32&i.__u?[s]:null,o,null==s?t7(i):s,!!(32&i.__u),a),r.__v=i.__v,r.__.__k[r.__i]=r,d7(o,r,a),r.__e!=s&&e7(r)),k9.length>e&&k9.sort(D9));r7.__r=0}function i7(t,e,n,r,i,s,o,a,l,u,h){var c,d,p,f,m,g,y=r&&r.__k||q9,v=e.length;for(l=s7(n,e,y,l,v),c=0;c<v;c++)null!=(p=n.__k[c])&&(d=-1===p.__i?W9:y[p.__i]||W9,p.__i=c,g=c7(t,p,d,i,s,o,a,l,u,h),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&f7(d.ref,null,p),h.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),4&p.__u||d.__k===p.__k?l=o7(p,l,t):"function"==typeof p.type&&void 0!==g?l=g:f&&(l=f.nextSibling),p.__u&=-7);return n.__e=m,l}function s7(t,e,n,r,i){var s,o,a,l,u,h=n.length,c=h,d=0;for(t.__k=new Array(i),s=0;s<i;s++)null!=(o=e[s])&&"boolean"!=typeof o&&"function"!=typeof o?(l=s+d,(o=t.__k[s]="string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?Z9(null,o,null,null,null):X9(o)?Z9(J9,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?Z9(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,a=null,-1!==(u=o.__i=a7(o,n,l,c))&&(c--,(a=n[u])&&(a.__u|=2)),null==a||null===a.__v?(-1==u&&d--,"function"!=typeof o.type&&(o.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,o.__u|=4))):t.__k[s]=null;if(c)for(s=0;s<h;s++)null!=(a=n[s])&&!(2&a.__u)&&(a.__e==r&&(r=t7(a)),m7(a,a));return r}function o7(t,e,n){var r,i;if("function"==typeof t.type){for(r=t.__k,i=0;r&&i<r.length;i++)r[i]&&(r[i].__=t,e=o7(r[i],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=t7(t)),n.insertBefore(t.__e,e||null),e=t.__e);do{e=e&&e.nextSibling}while(null!=e&&8==e.nodeType);return e}function a7(t,e,n,r){var i,s,o=t.key,a=t.type,l=e[n];if(null===l||l&&o==l.key&&a===l.type&&!(2&l.__u))return n;if(r>(null==l||2&l.__u?0:1))for(i=n-1,s=n+1;i>=0||s<e.length;){if(i>=0){if((l=e[i])&&!(2&l.__u)&&o==l.key&&a===l.type)return i;i--}if(s<e.length){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s++}}return-1}function l7(t,e,n){"-"==e[0]?t.setProperty(e,null==n?"":n):t[e]=null==n?"":"number"!=typeof n||$9.test(e)?n:n+"px"}function u7(t,e,n,r,i){var s;t:if("style"==e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof r&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||l7(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||l7(t.style,e,n[e])}else if("o"==e[0]&&"n"==e[1])s=e!=(e=e.replace(L9,"$1")),e=e.toLowerCase()in t||"onFocusOut"==e||"onFocusIn"==e?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=U9,t.addEventListener(e,s?z9:F9,s)):t.removeEventListener(e,s?z9:F9,s);else{if("http://www.w3.org/2000/svg"==i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=e&&"height"!=e&&"href"!=e&&"list"!=e&&"form"!=e&&"tabIndex"!=e&&"download"!=e&&"rowSpan"!=e&&"colSpan"!=e&&"role"!=e&&"popover"!=e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&"-"!=e[4]?t.removeAttribute(e):t.setAttribute(e,"popover"==e&&1==n?"":n))}}function h7(t){return function(e){if(this.l){var n=this.l[e.type+t];if(null==e.t)e.t=U9++;else if(e.t<n.u)return;return n(R9.event?R9.event(e):e)}}}function c7(t,e,n,r,i,s,o,a,l,u){var h,c,d,p,f,m,g,y,v,_,b,x,w,M,S,T,E,A=e.type;if(void 0!==e.constructor)return null;128&n.__u&&(l=!!(32&n.__u),s=[a=e.__e=n.__e]),(h=R9.__b)&&h(e);t:if("function"==typeof A)try{if(y=e.props,v="prototype"in A&&A.prototype.render,_=(h=A.contextType)&&r[h.__c],b=h?_?_.props.value:h.__:r,n.__c?g=(c=e.__c=n.__c).__=c.__E:(v?e.__c=c=new A(y,b):(e.__c=c=new Q9(y,b),c.constructor=A,c.render=g7),_&&_.sub(c),c.props=y,c.state||(c.state={}),c.context=b,c.__n=r,d=c.__d=!0,c.__h=[],c._sb=[]),v&&null==c.__s&&(c.__s=c.state),v&&null!=A.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=Y9({},c.__s)),Y9(c.__s,A.getDerivedStateFromProps(y,c.__s))),p=c.props,f=c.state,c.__v=e,d)v&&null==A.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),v&&null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(v&&null==A.getDerivedStateFromProps&&y!==p&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(y,b),!c.__e&&(null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(y,c.__s,b)||e.__v==n.__v)){for(e.__v!=n.__v&&(c.props=y,c.state=c.__s,c.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some((function(t){t&&(t.__=e)})),x=0;x<c._sb.length;x++)c.__h.push(c._sb[x]);c._sb=[],c.__h.length&&o.push(c);break t}null!=c.componentWillUpdate&&c.componentWillUpdate(y,c.__s,b),v&&null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(p,f,m)}))}if(c.context=b,c.props=y,c.__P=t,c.__e=!1,w=R9.__r,M=0,v){for(c.state=c.__s,c.__d=!1,w&&w(e),h=c.render(c.props,c.state,c.context),S=0;S<c._sb.length;S++)c.__h.push(c._sb[S]);c._sb=[]}else do{c.__d=!1,w&&w(e),h=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++M<25);c.state=c.__s,null!=c.getChildContext&&(r=Y9(Y9({},r),c.getChildContext())),v&&!d&&null!=c.getSnapshotBeforeUpdate&&(m=c.getSnapshotBeforeUpdate(p,f)),a=i7(t,X9(T=null!=h&&h.type===J9&&null==h.key?h.props.children:h)?T:[T],e,n,r,i,s,o,a,l,u),c.base=e.__e,e.__u&=-161,c.__h.length&&o.push(c),g&&(c.__E=c.__=null)}catch(t){if(e.__v=null,l||null!=s)if(t.then){for(e.__u|=l?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else for(E=s.length;E--;)K9(s[E]);else e.__e=n.__e,e.__k=n.__k;R9.__e(t,e,n)}else null==s&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=p7(n.__e,e,n,r,i,s,o,l,u);return(h=R9.diffed)&&h(e),128&e.__u?void 0:a}function d7(t,e,n){for(var r=0;r<n.length;r++)f7(n[r],n[++r],n[++r]);R9.__c&&R9.__c(e,t),t.some((function(e){try{t=e.__h,e.__h=[],t.some((function(t){t.call(e)}))}catch(t){R9.__e(t,e.__v)}}))}function p7(t,e,n,r,i,s,o,a,l){var u,h,c,d,p,f,m,g=n.props,y=e.props,v=e.type;if("svg"==v?i="http://www.w3.org/2000/svg":"math"==v?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),null!=s)for(u=0;u<s.length;u++)if((p=s[u])&&"setAttribute"in p==!!v&&(v?p.localName==v:3==p.nodeType)){t=p,s[u]=null;break}if(null==t){if(null==v)return document.createTextNode(y);t=document.createElementNS(i,v,y.is&&y),a&&(R9.__m&&R9.__m(e,s),a=!1),s=null}if(null===v)g===y||a&&t.data===y||(t.data=y);else{if(s=s&&C9.call(t.childNodes),g=n.props||W9,!a&&null!=s)for(g={},u=0;u<t.attributes.length;u++)g[(p=t.attributes[u]).name]=p.value;for(u in g)if(p=g[u],"children"==u);else if("dangerouslySetInnerHTML"==u)c=p;else if(!(u in y)){if("value"==u&&"defaultValue"in y||"checked"==u&&"defaultChecked"in y)continue;u7(t,u,null,p,i)}for(u in y)p=y[u],"children"==u?d=p:"dangerouslySetInnerHTML"==u?h=p:"value"==u?f=p:"checked"==u?m=p:a&&"function"!=typeof p||g[u]===p||u7(t,u,p,g[u],i);if(h)a||c&&(h.__html===c.__html||h.__html===t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(c&&(t.innerHTML=""),i7(t,X9(d)?d:[d],e,n,r,"foreignObject"==v?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&t7(n,0),a,l),null!=s)for(u=s.length;u--;)K9(s[u]);a||(u="value","progress"==v&&null==f?t.removeAttribute("value"):void 0!==f&&(f!==t[u]||"progress"==v&&!f||"option"==v&&f!==g[u])&&u7(t,u,f,g[u],i),u="checked",void 0!==m&&m!==t[u]&&u7(t,u,m,g[u],i))}return t}function f7(t,e,n){try{if("function"==typeof t){var r="function"==typeof t.__u;r&&t.__u(),r&&null==e||(t.__u=t(e))}else t.current=e}catch(t){R9.__e(t,n)}}function m7(t,e,n){var r,i;if(R9.unmount&&R9.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||f7(r,null,e)),null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){R9.__e(t,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&m7(r[i],e,n||"function"!=typeof t.type);n||K9(t.__e),t.__c=t.__=t.__e=void 0}function g7(t,e,n){return this.constructor(t,n)}function y7(t,e,n){var r,i,s;e==document&&(e=document.documentElement),R9.__&&R9.__(t,e),r=!1?null:e.__k,i=[],s=[],c7(e,t=e.__k=function(t,e,n){var r,i,s,o={};for(s in e)"key"==s?r=e[s]:"ref"==s?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?C9.call(arguments,2):n),"function"==typeof t&&null!=t.defaultProps)for(s in t.defaultProps)void 0===o[s]&&(o[s]=t.defaultProps[s]);return Z9(t,o,r,i,null)}(J9,null,[t]),r||W9,W9,e.namespaceURI,r?null:e.firstChild?C9.call(e.childNodes):null,i,r?r.__e:e.firstChild,false,s),d7(i,t,s)}function v7(t,e,n){var r,i,s,o,a=Y9({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)"key"==s?r=e[s]:"ref"==s?i=e[s]:a[s]=void 0===e[s]&&void 0!==o?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?C9.call(arguments,2):n),Z9(t.type,a,r||t.key,i||t.ref,null)}function _7(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function b7(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x7(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w7(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _7(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_7(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M7(t){return M7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M7(t)}C9=q9.slice,R9={__e:function(t,e,n,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&null!=s.getDerivedStateFromError&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(e){t=e}throw t}},N9=0,P9=function(t){return null!=t&&null==t.constructor},Q9.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Y9({},this.state),"function"==typeof t&&(t=t(Y9({},n),this.props)),t&&Y9(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),n7(this))},Q9.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),n7(this))},Q9.prototype.render=J9,k9=[],I9="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,D9=function(t,e){return t.__v.__b-e.__v.__b},r7.__r=0,L9=/(PointerCapture)$|Capture$/i,U9=0,F9=h7(!1),z9=h7(!0);var S7=function(t){if("object"!==M7(t))return t;var e,n=v7(t);n.props&&(n.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x7(Object(n),!0).forEach((function(e){b7(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x7(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n.props),null!=n&&null!==(e=n.props)&&void 0!==e&&e.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(S7):S7(n.props.children)));return n};!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var T7=B8({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,r=void 0===n?{}:n,i=C5(!!t&&"object"===M7(t)&&!!t.node&&"function"==typeof t.node?t.node():t);"static"===i.style("position")&&i.style("position","relative"),e.tooltipEl=i.append("div").attr("class","float-tooltip-kap"),Object.entries(r).forEach((function(t){var n=w7(t,2),r=n[0],i=n[1];return e.tooltipEl.style(r,i)})),e.tooltipEl.style("left","-10000px").style("display","none");var s="tooltip-".concat(Math.round(1e12*Math.random()));e.mouseInside=!1,i.on("mousemove.".concat(s),(function(t){e.mouseInside=!0;var n=R5(t),r=i.node(),s=r.offsetWidth,o=r.offsetHeight,a=[null===e.offsetX||void 0===e.offsetX?"-".concat(n[0]/s*100,"%"):"number"==typeof e.offsetX?"calc(-50% + ".concat(e.offsetX,"px)"):e.offsetX,null===e.offsetY||void 0===e.offsetY?o>130&&o-n[1]<100?"calc(-100% - 6px)":"21px":"number"==typeof e.offsetY?e.offsetY<0?"calc(-100% - ".concat(Math.abs(e.offsetY),"px)"):"".concat(e.offsetY,"px"):e.offsetY];e.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(a.join(","),")")),e.content&&e.tooltipEl.style("display","inline")})),i.on("mouseover.".concat(s),(function(){e.mouseInside=!0,e.content&&e.tooltipEl.style("display","inline")})),i.on("mouseout.".concat(s),(function(){e.mouseInside=!1,e.tooltipEl.style("display","none")}))},update:function(t){var e,n;t.tooltipEl.style("display",t.content&&t.mouseInside?"inline":"none"),t.content?t.content instanceof HTMLElement?(t.tooltipEl.text(""),t.tooltipEl.append((function(){return t.content}))):"string"==typeof t.content?t.tooltipEl.html(t.content):!function(t){return P9(v7(t))}(t.content)?(t.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",t.content,t.content.toString())):(t.tooltipEl.text(""),e=t.content,delete(n=t.tooltipEl.node()).__k,y7(S7(e),n)):t.tooltipEl.text("")}});function E7(t,e,n){var r,i=1;function s(){var s,o,a=r.length,l=0,u=0,h=0;for(s=0;s<a;++s)l+=(o=r[s]).x||0,u+=o.y||0,h+=o.z||0;for(l=(l/a-t)*i,u=(u/a-e)*i,h=(h/a-n)*i,s=0;s<a;++s)o=r[s],l&&(o.x-=l),u&&(o.y-=u),h&&(o.z-=h)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t},s.x=function(e){return arguments.length?(t=+e,s):t},s.y=function(t){return arguments.length?(e=+t,s):e},s.z=function(t){return arguments.length?(n=+t,s):n},s.strength=function(t){return arguments.length?(i=+t,s):i},s}function A7(t,e,n){if(isNaN(e))return t;var r,i,s,o,a,l,u=t._root,h={data:n},c=t._x0,d=t._x1;if(!u)return t._root=h,t;for(;u.length;)if((o=e>=(i=(c+d)/2))?c=i:d=i,r=u,!(u=u[a=+o]))return r[a]=h,t;if(e===(s=+t._x.call(null,u.data)))return h.next=u,r?r[a]=h:t._root=h,t;do{r=r?r[a]=new Array(2):t._root=new Array(2),(o=e>=(i=(c+d)/2))?c=i:d=i}while((a=+o)==(l=+(s>=i)));return r[l]=u,r[a]=h,t}function C7(t,e,n){this.node=t,this.x0=e,this.x1=n}function R7(t){return t[0]}function N7(t,e){var n=new P7(null==e?R7:e,NaN,NaN);return null==t?n:n.addAll(t)}function P7(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function k7(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var O7=N7.prototype=P7.prototype;function I7(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,h,c,d,p=t._root,f={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o,i=p,!(p=p[c=h<<1|u]))return i[c]=f,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&n===l)return f.next=p,i?i[c]=f:t._root=f,t;do{i=i?i[c]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+y)/2))?m=s:y=s,(h=n>=(o=(g+v)/2))?g=o:v=o}while((c=h<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=p,i[c]=f,t}function D7(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function L7(t){return t[0]}function U7(t){return t[1]}function F7(t,e,n){var r=new z7(null==e?L7:e,null==n?U7:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function z7(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function B7(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}O7.copy=function(){var t,e,n=new P7(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=k7(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=k7(e));return n},O7.add=function(t){const e=+this._x.call(null,t);return A7(this.cover(e),e,t)},O7.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let r=1/0,i=-1/0;for(let s,o=0;o<e;++o)isNaN(s=+this._x.call(null,t[o]))||(n[o]=s,s<r&&(r=s),s>i&&(i=s));if(r>i)return this;this.cover(r).cover(i);for(let r=0;r<e;++r)A7(this,n[r],t[r]);return this},O7.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,s=n-e||1,o=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=o,o=r,s*=2,i){case 0:n=e+s;break;case 1:e=n-s}this._root&&this._root.length&&(this._root=o)}return this._x0=e,this._x1=n,this},O7.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},O7.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},O7.find=function(t,e){var n,r,i,s,o,a=this._x0,l=this._x1,u=[],h=this._root;for(h&&u.push(new C7(h,a,l)),null==e?e=1/0:(a=t-e,l=t+e);s=u.pop();)if(!(!(h=s.node)||(r=s.x0)>l||(i=s.x1)<a))if(h.length){var c=(r+i)/2;u.push(new C7(h[1],c,i),new C7(h[0],r,c)),(o=+(t>=c))&&(s=u[u.length-1],u[u.length-1]=u[u.length-1-o],u[u.length-1-o]=s)}else{var d=Math.abs(t-+this._x.call(null,h.data));d<e&&(e=d,a=t-d,l=t+d,n=h.data)}return n},O7.remove=function(t){if(isNaN(s=+this._x.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h=this._root,c=this._x0,d=this._x1;if(!h)return this;if(h.length)for(;;){if((a=s>=(o=(c+d)/2))?c=o:d=o,e=h,!(h=h[l=+a]))return this;if(!h.length)break;e[l+1&1]&&(n=e,u=l)}for(;h.data!==t;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(h=e[0]||e[1])&&h===(e[1]||e[0])&&!h.length&&(n?n[u]=h:this._root=h),this):(this._root=i,this)},O7.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},O7.root=function(){return this._root},O7.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},O7.visit=function(t){var e,n,r,i,s=[],o=this._root;for(o&&s.push(new C7(o,this._x0,this._x1));e=s.pop();)if(!t(o=e.node,r=e.x0,i=e.x1)&&o.length){var a=(r+i)/2;(n=o[1])&&s.push(new C7(n,a,i)),(n=o[0])&&s.push(new C7(n,r,a))}return this},O7.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new C7(this._root,this._x0,this._x1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.x1,l=(o+a)/2;(s=i[0])&&n.push(new C7(s,o,l)),(s=i[1])&&n.push(new C7(s,l,a))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},O7.x=function(t){return arguments.length?(this._x=t,this):this._x};var j7=F7.prototype=z7.prototype;function V7(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var s,o,a,l,u,h,c,d,p,f,m,g,y=t._root,v={data:i},_=t._x0,b=t._y0,x=t._z0,w=t._x1,M=t._y1,S=t._z1;if(!y)return t._root=v,t;for(;y.length;)if((d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l,s=y,!(y=y[m=f<<2|p<<1|d]))return s[m]=v,t;if(u=+t._x.call(null,y.data),h=+t._y.call(null,y.data),c=+t._z.call(null,y.data),e===u&&n===h&&r===c)return v.next=y,s?s[m]=v:t._root=v,t;do{s=s?s[m]=new Array(8):t._root=new Array(8),(d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(b+M)/2))?b=a:M=a,(f=r>=(l=(x+S)/2))?x=l:S=l}while((m=f<<2|p<<1|d)==(g=(c>=l)<<2|(h>=a)<<1|u>=o));return s[g]=y,s[m]=v,t}function G7(t,e,n,r,i,s,o){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=s,this.z1=o}j7.copy=function(){var t,e,n=new z7(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=B7(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=B7(e));return n},j7.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return I7(this.cover(e,n),e,n,t)},j7.addAll=function(t){var e,n,r,i,s=t.length,o=new Array(s),a=new Array(s),l=1/0,u=1/0,h=-1/0,c=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,a[n]=i,r<l&&(l=r),r>h&&(h=r),i<u&&(u=i),i>c&&(c=i));if(l>h||u>c)return this;for(this.cover(l,u).cover(h,c),n=0;n<s;++n)I7(this,o[n],a[n],t[n]);return this},j7.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},j7.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},j7.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},j7.find=function(t,e,n){var r,i,s,o,a,l,u,h=this._x0,c=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new D7(m,h,c,d,p)),null==n?n=1/0:(h=t-n,c=e-n,d=t+n,p=e+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(s=l.y0)>p||(o=l.x1)<h||(a=l.y1)<c))if(m.length){var g=(i+o)/2,y=(s+a)/2;f.push(new D7(m[3],g,y,o,a),new D7(m[2],i,y,g,a),new D7(m[1],g,s,o,y),new D7(m[0],i,s,g,y)),(u=(e>=y)<<1|t>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-u],f[f.length-1-u]=l)}else{var v=t-+this._x.call(null,m.data),_=e-+this._y.call(null,m.data),b=v*v+_*_;if(b<n){var x=Math.sqrt(n=b);h=t-x,c=e-x,d=t+x,p=e+x,r=m.data}}return r},j7.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!p)return this;if(p.length)for(;;){if((u=s>=(a=(f+g)/2))?f=a:g=a,(h=o>=(l=(m+y)/2))?m=l:y=l,e=p,!(p=p[c=h<<1|u]))return this;if(!p.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(n=e,d=c)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[c]=i:delete e[c],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},j7.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},j7.root=function(){return this._root},j7.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},j7.visit=function(t){var e,n,r,i,s,o,a=[],l=this._root;for(l&&a.push(new D7(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,s=e.x1,o=e.y1)&&l.length){var u=(r+s)/2,h=(i+o)/2;(n=l[3])&&a.push(new D7(n,u,h,s,o)),(n=l[2])&&a.push(new D7(n,r,h,u,o)),(n=l[1])&&a.push(new D7(n,u,i,s,h)),(n=l[0])&&a.push(new D7(n,r,i,u,h))}return this},j7.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new D7(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.x1,u=e.y1,h=(o+l)/2,c=(a+u)/2;(s=i[0])&&n.push(new D7(s,o,a,h,c)),(s=i[1])&&n.push(new D7(s,h,a,l,c)),(s=i[2])&&n.push(new D7(s,o,c,h,u)),(s=i[3])&&n.push(new D7(s,h,c,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},j7.x=function(t){return arguments.length?(this._x=t,this):this._x},j7.y=function(t){return arguments.length?(this._y=t,this):this._y};const H7=(t,e,n,r,i,s)=>Math.sqrt((t-r)**2+(e-i)**2+(n-s)**2);function W7(t){return t[0]}function q7(t){return t[1]}function $7(t){return t[2]}function X7(t,e,n,r){var i=new Y7(null==e?W7:e,null==n?q7:n,null==r?$7:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function Y7(t,e,n,r,i,s,o,a,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function K7(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Z7=X7.prototype=Y7.prototype;function J7(t){return function(){return t}}function Q7(t){return 1e-6*(t()-.5)}function ttt(t){return t.index}function ett(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function ntt(t){var e,n,r,i,s,o,a,l=ttt,u=function(t){return 1/Math.min(s[t.source.index],s[t.target.index])},h=J7(30),c=1;function d(r){for(var s=0,l=t.length;s<c;++s)for(var u,h,d,p,f,m=0,g=0,y=0,v=0;m<l;++m)h=(u=t[m]).source,g=(d=u.target).x+d.vx-h.x-h.vx||Q7(a),i>1&&(y=d.y+d.vy-h.y-h.vy||Q7(a)),i>2&&(v=d.z+d.vz-h.z-h.vz||Q7(a)),g*=p=((p=Math.sqrt(g*g+y*y+v*v))-n[m])/p*r*e[m],y*=p,v*=p,d.vx-=g*(f=o[m]),i>1&&(d.vy-=y*f),i>2&&(d.vz-=v*f),h.vx+=g*(f=1-f),i>1&&(h.vy+=y*f),i>2&&(h.vz+=v*f)}function p(){if(r){var i,a,u=r.length,h=t.length,c=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(i=0,s=new Array(u);i<h;++i)(a=t[i]).index=i,"object"!=typeof a.source&&(a.source=ett(c,a.source)),"object"!=typeof a.target&&(a.target=ett(c,a.target)),s[a.source.index]=(s[a.source.index]||0)+1,s[a.target.index]=(s[a.target.index]||0)+1;for(i=0,o=new Array(h);i<h;++i)a=t[i],o[i]=s[a.source.index]/(s[a.source.index]+s[a.target.index]);e=new Array(h),f(),n=new Array(h),m()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function m(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}return null==t&&(t=[]),d.initialize=function(t,...e){r=t,a=e.find((t=>"function"==typeof t))||Math.random,i=e.find((t=>[1,2,3].includes(t)))||2,p()},d.links=function(e){return arguments.length?(t=e,p(),d):t},d.id=function(t){return arguments.length?(l=t,d):l},d.iterations=function(t){return arguments.length?(c=+t,d):c},d.strength=function(t){return arguments.length?(u="function"==typeof t?t:J7(+t),f(),d):u},d.distance=function(t){return arguments.length?(h="function"==typeof t?t:J7(+t),m(),d):h},d}Z7.copy=function(){var t,e,n=new Y7(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=K7(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=K7(e));return n},Z7.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),r=+this._z.call(null,t);return V7(this.cover(e,n,r),e,n,r,t)},Z7.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c,d,p,f,m=0;m<e;++m)isNaN(d=+this._x.call(null,c=t[m]))||isNaN(p=+this._y.call(null,c))||isNaN(f=+this._z.call(null,c))||(n[m]=d,r[m]=p,i[m]=f,d<s&&(s=d),d>l&&(l=d),p<o&&(o=p),p>u&&(u=p),f<a&&(a=f),f>h&&(h=f));if(s>l||o>u||a>h)return this;this.cover(s,o,a).cover(l,u,h);for(let s=0;s<e;++s)V7(this,n[s],r[s],i[s],t[s]);return this},Z7.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(t))+1,a=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var u,h,c=o-r||1,d=this._root;r>t||t>=o||i>e||e>=a||s>n||n>=l;)switch(h=(n<s)<<2|(e<i)<<1|t<r,(u=new Array(8))[h]=d,d=u,c*=2,h){case 0:o=r+c,a=i+c,l=s+c;break;case 1:r=o-c,a=i+c,l=s+c;break;case 2:o=r+c,i=a-c,l=s+c;break;case 3:r=o-c,i=a-c,l=s+c;break;case 4:o=r+c,a=i+c,s=l-c;break;case 5:r=o-c,a=i+c,s=l-c;break;case 6:o=r+c,i=a-c,s=l-c;break;case 7:r=o-c,i=a-c,s=l-c}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this},Z7.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Z7.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},Z7.find=function(t,e,n,r){var i,s,o,a,l,u,h,c,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,y=this._y1,v=this._z1,_=[],b=this._root;for(b&&_.push(new G7(b,p,f,m,g,y,v)),null==r?r=1/0:(p=t-r,f=e-r,m=n-r,g=t+r,y=e+r,v=n+r,r*=r);c=_.pop();)if(!(!(b=c.node)||(s=c.x0)>g||(o=c.y0)>y||(a=c.z0)>v||(l=c.x1)<p||(u=c.y1)<f||(h=c.z1)<m))if(b.length){var x=(s+l)/2,w=(o+u)/2,M=(a+h)/2;_.push(new G7(b[7],x,w,M,l,u,h),new G7(b[6],s,w,M,x,u,h),new G7(b[5],x,o,M,l,w,h),new G7(b[4],s,o,M,x,w,h),new G7(b[3],x,w,a,l,u,M),new G7(b[2],s,w,a,x,u,M),new G7(b[1],x,o,a,l,w,M),new G7(b[0],s,o,a,x,w,M)),(d=(n>=M)<<2|(e>=w)<<1|t>=x)&&(c=_[_.length-1],_[_.length-1]=_[_.length-1-d],_[_.length-1-d]=c)}else{var S=t-+this._x.call(null,b.data),T=e-+this._y.call(null,b.data),E=n-+this._z.call(null,b.data),A=S*S+T*T+E*E;if(A<r){var C=Math.sqrt(r=A);p=t-C,f=e-C,m=n-C,g=t+C,y=e+C,v=n+C,i=b.data}}return i},Z7.findAllWithinRadius=function(t,e,n,r){const i=[],s=t-r,o=e-r,a=n-r,l=t+r,u=e+r,h=n+r;return this.visit(((c,d,p,f,m,g,y)=>{if(!c.length)do{const s=c.data;H7(t,e,n,this._x(s),this._y(s),this._z(s))<=r&&i.push(s)}while(c=c.next);return d>l||p>u||f>h||m<s||g<o||y<a})),i},Z7.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(a=+this._z.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,h,c,d,p,f,m,g=this._root,y=this._x0,v=this._y0,_=this._z0,b=this._x1,x=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((c=s>=(l=(y+b)/2))?y=l:b=l,(d=o>=(u=(v+x)/2))?v=u:x=u,(p=a>=(h=(_+w)/2))?_=h:w=h,e=g,!(g=g[f=p<<2|d<<1|c]))return this;if(!g.length)break;(e[f+1&7]||e[f+2&7]||e[f+3&7]||e[f+4&7]||e[f+5&7]||e[f+6&7]||e[f+7&7])&&(n=e,m=f)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},Z7.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Z7.root=function(){return this._root},Z7.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Z7.visit=function(t){var e,n,r,i,s,o,a,l,u=[],h=this._root;for(h&&u.push(new G7(h,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=u.pop();)if(!t(h=e.node,r=e.x0,i=e.y0,s=e.z0,o=e.x1,a=e.y1,l=e.z1)&&h.length){var c=(r+o)/2,d=(i+a)/2,p=(s+l)/2;(n=h[7])&&u.push(new G7(n,c,d,p,o,a,l)),(n=h[6])&&u.push(new G7(n,r,d,p,c,a,l)),(n=h[5])&&u.push(new G7(n,c,i,p,o,d,l)),(n=h[4])&&u.push(new G7(n,r,i,p,c,d,l)),(n=h[3])&&u.push(new G7(n,c,d,s,o,a,p)),(n=h[2])&&u.push(new G7(n,r,d,s,c,a,p)),(n=h[1])&&u.push(new G7(n,c,i,s,o,d,p)),(n=h[0])&&u.push(new G7(n,r,i,s,c,d,p))}return this},Z7.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new G7(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.z0,u=e.x1,h=e.y1,c=e.z1,d=(o+u)/2,p=(a+h)/2,f=(l+c)/2;(s=i[0])&&n.push(new G7(s,o,a,l,d,p,f)),(s=i[1])&&n.push(new G7(s,d,a,l,u,p,f)),(s=i[2])&&n.push(new G7(s,o,p,l,d,h,f)),(s=i[3])&&n.push(new G7(s,d,p,l,u,h,f)),(s=i[4])&&n.push(new G7(s,o,a,f,d,p,c)),(s=i[5])&&n.push(new G7(s,d,a,f,u,p,c)),(s=i[6])&&n.push(new G7(s,o,p,f,d,h,c)),(s=i[7])&&n.push(new G7(s,d,p,f,u,h,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},Z7.x=function(t){return arguments.length?(this._x=t,this):this._x},Z7.y=function(t){return arguments.length?(this._y=t,this):this._y},Z7.z=function(t){return arguments.length?(this._z=t,this):this._z};const rtt=4294967296;function itt(t){return t.x}function stt(t){return t.y}function ott(t){return t.z}var att=Math.PI*(3-Math.sqrt(5)),ltt=20*Math.PI/(9+Math.sqrt(221));function utt(t,e){e=e||2;var n,r=Math.min(3,Math.max(1,Math.round(e))),i=1,s=.001,o=1-Math.pow(s,1/300),a=0,l=.6,u=new Map,h=r6(p),c=P5("tick","end"),d=function(){let t=1;return()=>(t=(1664525*t+1013904223)%rtt)/rtt}();function p(){f(),c.call("tick",n),i<s&&(h.stop(),c.call("end",n))}function f(e){var s,h,c=t.length;void 0===e&&(e=1);for(var d=0;d<e;++d)for(i+=(a-i)*o,u.forEach((function(t){t(i)})),s=0;s<c;++s)null==(h=t[s]).fx?h.x+=h.vx*=l:(h.x=h.fx,h.vx=0),r>1&&(null==h.fy?h.y+=h.vy*=l:(h.y=h.fy,h.vy=0)),r>2&&(null==h.fz?h.z+=h.vz*=l:(h.z=h.fz,h.vz=0));return n}function m(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||r>1&&isNaN(e.y)||r>2&&isNaN(e.z)){var s=10*(r>2?Math.cbrt(.5+n):r>1?Math.sqrt(.5+n):n),o=n*att,a=n*ltt;1===r?e.x=s:2===r?(e.x=s*Math.cos(o),e.y=s*Math.sin(o)):(e.x=s*Math.sin(o)*Math.cos(a),e.y=s*Math.cos(o),e.z=s*Math.sin(o)*Math.sin(a))}(isNaN(e.vx)||r>1&&isNaN(e.vy)||r>2&&isNaN(e.vz))&&(e.vx=0,r>1&&(e.vy=0),r>2&&(e.vz=0))}}function g(e){return e.initialize&&e.initialize(t,d,r),e}return null==t&&(t=[]),m(),n={tick:f,restart:function(){return h.restart(p),n},stop:function(){return h.stop(),n},numDimensions:function(t){return arguments.length?(r=Math.min(3,Math.max(1,Math.round(t))),u.forEach(g),n):r},nodes:function(e){return arguments.length?(t=e,m(),u.forEach(g),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(s=+t,n):s},alphaDecay:function(t){return arguments.length?(o=+t,n):+o},alphaTarget:function(t){return arguments.length?(a=+t,n):a},velocityDecay:function(t){return arguments.length?(l=1-t,n):1-l},randomSource:function(t){return arguments.length?(d=t,u.forEach(g),n):d},force:function(t,e){return arguments.length>1?(null==e?u.delete(t):u.set(t,g(e)),n):u.get(t)},find:function(){var e,n,i,s,o,a,l=Array.prototype.slice.call(arguments),u=l.shift()||0,h=(r>1?l.shift():null)||0,c=(r>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=t.length;for(d*=d,p=0;p<f;++p)(s=(e=u-(o=t[p]).x)*e+(n=h-(o.y||0))*n+(i=c-(o.z||0))*i)<d&&(a=o,d=s);return a},on:function(t,e){return arguments.length>1?(c.on(t,e),n):c.on(t)}}}function htt(){var t,e,n,r,i,s,o=J7(-30),a=1,l=1/0,u=.81;function h(r){var s,o=t.length,a=(1===e?N7(t,itt):2===e?F7(t,itt,stt):3===e?X7(t,itt,stt,ott):null).visitAfter(d);for(i=r,s=0;s<o;++s)n=t[s],a.visit(p)}function c(){if(t){var e,n,r=t.length;for(s=new Array(r),e=0;e<r;++e)n=t[e],s[n.index]=+o(n,e,t)}}function d(t){var n,r,i,o,a,l,u=0,h=0,c=t.length;if(c){for(i=o=a=l=0;l<c;++l)(n=t[l])&&(r=Math.abs(n.value))&&(u+=n.value,h+=r,i+=r*(n.x||0),o+=r*(n.y||0),a+=r*(n.z||0));u*=Math.sqrt(4/c),t.x=i/h,e>1&&(t.y=o/h),e>2&&(t.z=a/h)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{u+=s[n.data.index]}while(n=n.next)}t.value=u}function p(t,o,h,c,d){if(!t.value)return!0;var p=[h,c,d][e-1],f=t.x-n.x,m=e>1?t.y-n.y:0,g=e>2?t.z-n.z:0,y=p-o,v=f*f+m*m+g*g;if(y*y/u<v)return v<l&&(0===f&&(v+=(f=Q7(r))*f),e>1&&0===m&&(v+=(m=Q7(r))*m),e>2&&0===g&&(v+=(g=Q7(r))*g),v<a&&(v=Math.sqrt(a*v)),n.vx+=f*t.value*i/v,e>1&&(n.vy+=m*t.value*i/v),e>2&&(n.vz+=g*t.value*i/v)),!0;if(!(t.length||v>=l)){(t.data!==n||t.next)&&(0===f&&(v+=(f=Q7(r))*f),e>1&&0===m&&(v+=(m=Q7(r))*m),e>2&&0===g&&(v+=(g=Q7(r))*g),v<a&&(v=Math.sqrt(a*v)));do{t.data!==n&&(y=s[t.data.index]*i/v,n.vx+=f*y,e>1&&(n.vy+=m*y),e>2&&(n.vz+=g*y))}while(t=t.next)}}return h.initialize=function(n,...i){t=n,r=i.find((t=>"function"==typeof t))||Math.random,e=i.find((t=>[1,2,3].includes(t)))||2,c()},h.strength=function(t){return arguments.length?(o="function"==typeof t?t:J7(+t),c(),h):o},h.distanceMin=function(t){return arguments.length?(a=t*t,h):Math.sqrt(a)},h.distanceMax=function(t){return arguments.length?(l=t*t,h):Math.sqrt(l)},h.theta=function(t){return arguments.length?(u=t*t,h):Math.sqrt(u)},h}const{abs:ctt,cos:dtt,sin:ptt,acos:ftt,atan2:mtt,sqrt:gtt,pow:ytt}=Math;function vtt(t){return t<0?-ytt(-t,1/3):ytt(t,1/3)}const _tt=Math.PI,btt=2*_tt,xtt=_tt/2,wtt=Number.MAX_SAFE_INTEGER||9007199254740991,Mtt=Number.MIN_SAFE_INTEGER||-9007199254740991,Stt={x:0,y:0,z:0},Ttt={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),gtt(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const i=1-t;let s=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:i*s[0].x+t*s[1].x,y:i*s[0].y+t*s[1].y,t:t};return n&&(e.z=i*s[0].z+t*s[1].z),e}if(r<4){let e,o,a,l=i*i,u=t*t,h=0;2===r?(s=[s[0],s[1],s[2],Stt],e=l,o=i*t*2,a=u):3===r&&(e=l*i,o=l*t*3,a=i*u*3,h=t*u);const c={x:e*s[0].x+o*s[1].x+a*s[2].x+h*s[3].x,y:e*s[0].y+o*s[1].y+a*s[2].y+h*s[3].y,t:t};return n&&(c.z=e*s[0].z+o*s[1].z+a*s[2].z+h*s[3].z),c}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e].z=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,n,r){const i=1-t,s=n,o=e;let a,l=s[0],u=s[1],h=s[2],c=s[3];return l*=i,u*=t,2===o.length?(a=l+u,{x:(l*o[0].x+u*o[1].x)/a,y:(l*o[0].y+u*o[1].y)/a,z:!!r&&(l*o[0].z+u*o[1].z)/a,t:t}):(l*=i,u*=2*i,h*=t*t,3===o.length?(a=l+u+h,{x:(l*o[0].x+u*o[1].x+h*o[2].x)/a,y:(l*o[0].y+u*o[1].y+h*o[2].y)/a,z:!!r&&(l*o[0].z+u*o[1].z+h*o[2].z)/a,t:t}):(l*=i,u*=1.5*i,h*=3*i,c*=t*t*t,4===o.length?(a=l+u+h+c,{x:(l*o[0].x+u*o[1].x+h*o[2].x+c*o[3].x)/a,y:(l*o[0].y+u*o[1].y+h*o[2].y+c*o[3].y)/a,z:!!r&&(l*o[0].z+u*o[1].z+h*o[2].z+c*o[3].z)/a,t:t}):void 0))},derive:function(t,e){const n=[];for(let r=t,i=r.length,s=i-1;i>1;i--,s--){const t=[];for(let n,i=0;i<s;i++)n={x:s*(r[i+1].x-r[i].x),y:s*(r[i+1].y-r[i].y)},e&&(n.z=s*(r[i+1].z-r[i].z)),t.push(n);n.push(t),r=t}return n},between:function(t,e,n){return e<=t&&t<=n||Ttt.approximately(t,e)||Ttt.approximately(t,n)},approximately:function(t,e,n){return ctt(t-e)<=(n||1e-6)},length:function(t){const e=Ttt.Tvalues.length;let n=0;for(let r,i=0;i<e;i++)r=.5*Ttt.Tvalues[i]+.5,n+=Ttt.Cvalues[i]*Ttt.arcfn(r,t);return.5*n},map:function(t,e,n,r,i){return r+(i-r)*((t-e)/(n-e))},lerp:function(t,e,n){const r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(Ttt.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,s=n.x-t.x,o=n.y-t.y;return mtt(r*o-i*s,r*s+i*o)},round:function(t,e){const n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){const n=t.x-e.x,r=t.y-e.y;return gtt(n*n+r*r)},closest:function(t,e){let n,r,i=ytt(2,63);return t.forEach((function(t,s){r=Ttt.dist(e,t),r<i&&(i=r,n=s)})),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=ytt(t,e)+ytt(1-t,e);return ctt((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=ytt(1-t,e);return n/(ytt(t,e)+n)},lli8:function(t,e,n,r,i,s,o,a){const l=(t-n)*(s-a)-(e-r)*(i-o);return 0!=l&&{x:((t*r-e*n)*(i-o)-(t-n)*(i*a-s*o))/l,y:((t*r-e*n)*(s-a)-(e-r)*(i*a-s*o))/l}},lli4:function(t,e,n,r){const i=t.x,s=t.y,o=e.x,a=e.y,l=n.x,u=n.y,h=r.x,c=r.y;return Ttt.lli8(i,s,o,a,l,u,h,c)},lli:function(t,e){return Ttt.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new Dtt(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=wtt,n=wtt,r=Mtt,i=Mtt;return t.forEach((function(t){const s=t.bbox();e>s.x.min&&(e=s.x.min),n>s.y.min&&(n=s.y.min),r<s.x.max&&(r=s.x.max),i<s.y.max&&(i=s.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!Ttt.bboxoverlap(e,r))return[];const s=[],o=[t.startcap,t.forward,t.back,t.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return o.forEach((function(e){e.virtual||a.forEach((function(r){if(r.virtual)return;const o=e.intersects(r,i);o.length>0&&(o.c1=e,o.c2=r,o.s1=t,o.s2=n,s.push(o))}))})),s},makeshape:function(t,e,n){const r=e.points.length,i=t.points.length,s=Ttt.makeline(e.points[r-1],t.points[0]),o=Ttt.makeline(t.points[i-1],e.points[0]),a={startcap:s,forward:t,back:e,endcap:o,bbox:Ttt.findbbox([s,t,e,o]),intersections:function(t){return Ttt.shapeintersections(a,a.bbox,t,t.bbox,n)}};return a},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let r,i,s=wtt,o=Mtt;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let a=0,l=n.length;a<l;a++)r=n[a],i=t.get(r),i[e]<s&&(s=i[e]),i[e]>o&&(o=i[e]);return{min:s,mid:(s+o)/2,max:o,size:o-s}},align:function(t,e){const n=e.p1.x,r=e.p1.y,i=-mtt(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*dtt(i)-(t.y-r)*ptt(i),y:(t.x-n)*ptt(i)+(t.y-r)*dtt(i)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,r=Ttt.align(t,e),i=function(t){return 0<=t&&t<=1};if(2===n){const t=r[0].y,e=r[1].y,n=r[2].y,s=t-2*e+n;if(0!==s){const r=-gtt(e*e-t*n),o=-t+e;return[-(r+o)/s,-(-r+o)/s].filter(i)}return e!==n&&0===s?[(2*e-n)/(2*e-2*n)].filter(i):[]}const s=r[0].y,o=r[1].y,a=r[2].y;let l=3*o-s-3*a+r[3].y,u=3*s-6*o+3*a,h=-3*s+3*o,c=s;if(Ttt.approximately(l,0)){if(Ttt.approximately(u,0))return Ttt.approximately(h,0)?[]:[-c/h].filter(i);const t=gtt(h*h-4*u*c),e=2*u;return[(t-h)/e,(-h-t)/e].filter(i)}u/=l,h/=l,c/=l;const d=(3*h-u*u)/3,p=d/3,f=(2*u*u*u-9*u*h+27*c)/27,m=f/2,g=m*m+p*p*p;let y,v,_,b,x;if(g<0){const t=-d/3,e=gtt(t*t*t),n=-f/(2*e),r=ftt(n<-1?-1:n>1?1:n),s=2*vtt(e);return _=s*dtt(r/3)-u/3,b=s*dtt((r+btt)/3)-u/3,x=s*dtt((r+2*btt)/3)-u/3,[_,b,x].filter(i)}if(0===g)return y=m<0?vtt(-m):-vtt(m),_=2*y-u/3,b=-y-u/3,[_,b].filter(i);{const t=gtt(g);return y=vtt(-m+t),v=vtt(m+t),[y-v-u/3].filter(i)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){const t=-gtt(n*n-e*r),s=-e+n;return[-(t+s)/i,-(-t+s)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,n,r,i){let s,o,a,l,u=0,h=0;const c=Ttt.compute(t,e),d=Ttt.compute(t,n),p=c.x*c.x+c.y*c.y;if(r?(s=gtt(ytt(c.y*d.z-d.y*c.z,2)+ytt(c.z*d.x-d.z*c.x,2)+ytt(c.x*d.y-d.x*c.y,2)),o=ytt(p+c.z*c.z,1.5)):(s=c.x*d.y-c.y*d.x,o=ytt(p,1.5)),0===s||0===o)return{k:0,r:0};if(u=s/o,h=o/s,!i){const i=Ttt.curvature(t-.001,e,n,r,!0).k,s=Ttt.curvature(t+.001,e,n,r,!0).k;l=(s-u+(u-i))/2,a=(ctt(s-u)+ctt(u-i))/2}return{k:u,r:h,dk:l,adk:a}},inflections:function(t){if(t.length<4)return[];const e=Ttt.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,s=18*(-3*n+2*r+3*i-e[3].x*e[2].y),o=18*(3*n-r-3*i),a=18*(i-n);if(Ttt.approximately(s,0)){if(!Ttt.approximately(o,0)){let t=-a/o;if(0<=t&&t<=1)return[t]}return[]}const l=2*s;if(Ttt.approximately(l,0))return[];const u=o*o-4*s*a;if(u<0)return[];const h=Math.sqrt(u);return[(h-o)/l,-(o+h)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const n=["x","y"],r=n.length;for(let i,s,o,a,l=0;l<r;l++)if(i=n[l],s=t[i].mid,o=e[i].mid,a=(t[i].size+e[i].size)/2,ctt(s-o)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const r=t.bbox(),i=e.bbox(),s=1e5,o=n||.5;if(r.x.size+r.y.size<o&&i.x.size+i.y.size<o)return[(s*(t._t1+t._t2)/2|0)/s+"/"+(s*(e._t1+e._t2)/2|0)/s];let a=t.split(.5),l=e.split(.5),u=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];u=u.filter((function(t){return Ttt.bboxoverlap(t.left.bbox(),t.right.bbox())}));let h=[];return 0===u.length||(u.forEach((function(t){h=h.concat(Ttt.pairiteration(t.left,t.right,o))})),h=h.filter((function(t,e){return h.indexOf(t)===e}))),h},getccenter:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,s=n.x-e.x,o=n.y-e.y,a=r*dtt(xtt)-i*ptt(xtt),l=r*ptt(xtt)+i*dtt(xtt),u=s*dtt(xtt)-o*ptt(xtt),h=s*ptt(xtt)+o*dtt(xtt),c=(t.x+e.x)/2,d=(t.y+e.y)/2,p=(e.x+n.x)/2,f=(e.y+n.y)/2,m=c+a,g=d+l,y=p+u,v=f+h,_=Ttt.lli8(c,d,m,g,p,f,y,v),b=Ttt.dist(_,t);let x,w=mtt(t.y-_.y,t.x-_.x),M=mtt(e.y-_.y,e.x-_.x),S=mtt(n.y-_.y,n.x-_.x);return w<S?((w>M||M>S)&&(w+=btt),w>S&&(x=S,S=w,w=x)):S<M&&M<w?(x=S,S=w,w=x):S+=btt,_.s=w,_.e=S,_.r=b,_},numberSort:function(t,e){return t-e}};class Ett{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return Ttt.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)Ttt.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new Ett(e)}}const{abs:Att,min:Ctt,max:Rtt,cos:Ntt,sin:Ptt,acos:ktt,sqrt:Ott}=Math,Itt=Math.PI;class Dtt{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let r=!1;const i=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==i&&8!==i&&9!==i&&12!==i&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const s=this._3d=!r&&(9===i||12===i)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let t=0,n=s?3:2;t<i;t+=n){var a={x:e[t],y:e[t+1]};s&&(a.z=e[t+2]),o.push(a)}const l=this.order=o.length-1,u=this.dims=["x","y"];s&&u.push("z"),this.dimlen=u.length;const h=Ttt.align(o,{p1:o[0],p2:o[l]}),c=Ttt.dist(o[0],o[l]);this._linear=h.reduce(((t,e)=>t+Att(e.y)),0)<c/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new Dtt(e,e,n);if(1===r)return new Dtt(t,e,e);const i=Dtt.getABC(2,t,e,n,r);return new Dtt(t,i.A,n)}static cubicFromPoints(t,e,n,r,i){void 0===r&&(r=.5);const s=Dtt.getABC(3,t,e,n,r);void 0===i&&(i=Ttt.dist(e,s.C));const o=i*(1-r)/r,a=Ttt.dist(t,n),l=(n.x-t.x)/a,u=(n.y-t.y)/a,h=i*l,c=i*u,d=o*l,p=o*u,f=e.x-h,m=e.y-c,g=e.x+d,y=e.y+p,v=s.A,_=v.x+(f-v.x)/(1-r),b=v.y+(m-v.y)/(1-r),x=v.x+(g-v.x)/r,w=v.y+(y-v.y)/r,M={x:t.x+(_-t.x)/r,y:t.y+(b-t.y)/r},S={x:n.x+(x-n.x)/(1-r),y:n.y+(w-n.y)/(1-r)};return new Dtt(t,M,S,n)}static getUtils(){return Ttt}getUtils(){return Dtt.getUtils()}static get PolyBezier(){return Ett}valueOf(){return this.toString()}toString(){return Ttt.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=Ttt.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=Ttt.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return Ttt.length(this.derivative.bind(this))}static getABC(t=2,e,n,r,i=.5){const s=Ttt.projectionratio(i,t),o=1-s,a={x:s*e.x+o*r.x,y:s*e.y+o*r.y},l=Ttt.abcratio(i,t);return{A:{x:n.x+(n.x-a.x)/l,y:n.y+(n.y-a.y)/l},B:n,C:a,S:e,E:r}}getABC(t,e){e=e||this.get(t);let n=this.points[0],r=this.points[this.order];return Dtt.getABC(this.order,n,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t+1)return this._lut;this._lut=[],t++,this._lut=[];for(let e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const r=this.getLUT(),i=[];for(let t,s=0,o=0;s<r.length;s++)t=r[s],Ttt.dist(t,e)<n&&(i.push(t),o+=s/r.length);return!!i.length&&(t/=i.length)}project(t){const e=this.getLUT(),n=e.length-1,r=Ttt.closest(e,t),i=r.mpos,s=(i-1)/n,o=(i+1)/n,a=.1/n;let l,u=r.mdist,h=s,c=h;u+=1;for(let e;h<o+a;h+=a)l=this.compute(h),e=Ttt.dist(t,l),e<u&&(u=e,c=h);return c=c<0?0:c>1?1:c,l=this.compute(c),l.t=c,l.d=u,l}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?Ttt.computeWithRatios(t,this.points,this.ratios,this._3d):Ttt.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let r,i,s=1;s<n;s++)r=t[s],i=t[s-1],e[s]={x:(n-s)/n*r.x+s/n*i.x,y:(n-s)/n*r.y+s/n*i.y};return e[n]=t[n-1],new Dtt(e)}derivative(t){return Ttt.compute(t,this.dpoints[0],this._3d)}dderivative(t){return Ttt.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new Dtt(Ttt.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return Ttt.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Ttt.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=Ott(e.x*e.x+e.y*e.y);return{t:t,x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),r=Ott(e.x*e.x+e.y*e.y+e.z*e.z),i=Ott(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;const s={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},o=Ott(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=o,s.y/=o,s.z/=o;const a=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{t:t,x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,n=[],r=[],i=0;for(r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],3===this.order&&(r[i++]=e[3]);e.length>1;){n=[];for(let s,o=0,a=e.length-1;o<a;o++)s=Ttt.lerp(t,e[o],e[o+1]),r[i++]=s,n.push(s);e=n}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),r={left:2===this.order?new Dtt([n[0],n[3],n[5]]):new Dtt([n[0],n[4],n[7],n[9]]),right:2===this.order?new Dtt([n[5],n[4],n[2]]):new Dtt([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=Ttt.map(0,0,1,this._t1,this._t2),r.left._t2=Ttt.map(t,0,1,this._t1,this._t2),r.right._t1=Ttt.map(t,0,1,this._t1,this._t2),r.right._t2=Ttt.map(1,0,1,this._t1,this._t2),e?(e=Ttt.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let r=function(t){return t[n]},i=this.dpoints[0].map(r);t[n]=Ttt.droots(i),3===this.order&&(i=this.dpoints[1].map(r),t[n]=t[n].concat(Ttt.droots(i))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(Ttt.numberSort))}.bind(this)),t.values=e.sort(Ttt.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=Ttt.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return Ttt.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const r={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(r.z=n.z+t*e.z),r}));return[new Dtt(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=Ttt.angle(this.points[0],this.points[3],this.points[1]),e=Ttt.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),Att(ktt(n))<Itt/3}reduce(){let t,e,n=0,r=0,i=.01,s=[],o=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),n=a[0],t=1;t<a.length;t++)r=a[t],e=this.split(n,r),e._t1=n,e._t2=r,s.push(e),n=r;return s.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+i;r<=1.01;r+=i)if(e=t.split(n,r),!e.simple()){if(r-=i,Att(n-r)<i)return[];e=t.split(n,r),e._t1=Ttt.map(n,0,1,t._t1,t._t2),e._t2=Ttt.map(r,0,1,t._t1,t._t2),o.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=Ttt.map(n,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}translate(t,e,n){n="number"==typeof n?n:e;const r=this.order;let i=this.points.map(((t,i)=>(1-i/r)*e+i/r*n));return new Dtt(this.points.map(((e,n)=>({x:e.x+t.x*i[n],y:e.y+t.y*i[n]}))))}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const r=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):t,n?n(1):t);const s=n?n(0):t,o=n?n(1):t,a=[this.offset(0,10),this.offset(1,10)],l=[],u=Ttt.lli4(a[0],a[0].c,a[1],a[1].c);if(!u)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=l[t*e]=Ttt.copy(i[t*e]);n.x+=(t?o:s)*a[t].n.x,n.y+=(t?o:s)*a[t].n.y})),n?([0,1].forEach((function(s){if(2!==e||!s){var o=i[s+1],a={x:o.x-u.x,y:o.y-u.y},h=n?n((s+1)/e):t;n&&!r&&(h=-h);var c=Ott(a.x*a.x+a.y*a.y);a.x/=c,a.y/=c,l[s+1]={x:o.x+h*a.x,y:o.y+h*a.y}}})),new Dtt(l)):([0,1].forEach((t=>{if(2===e&&t)return;const n=l[t*e],r=this.derivative(t),s={x:n.x+r.x,y:n.y+r.y};l[t+1]=Ttt.lli4(n,s,u,i[t+1])})),new Dtt(l))}outline(t,e,n,r){if(e=void 0===e?t:e,this._linear){const i=this.normal(0),s=this.points[0],o=this.points[this.points.length-1];let a,l,u;void 0===n&&(n=t,r=e),a={x:s.x+i.x*t,y:s.y+i.y*t},u={x:o.x+i.x*n,y:o.y+i.y*n},l={x:(a.x+u.x)/2,y:(a.y+u.y)/2};const h=[a,l,u];a={x:s.x-i.x*e,y:s.y-i.y*e},u={x:o.x-i.x*r,y:o.y-i.y*r},l={x:(a.x+u.x)/2,y:(a.y+u.y)/2};const c=[u,l,a],d=Ttt.makeline(c[2],h[0]),p=Ttt.makeline(h[2],c[0]),f=[d,new Dtt(h),p,new Dtt(c)];return new Ett(f)}const i=this.reduce(),s=i.length,o=[];let a,l=[],u=0,h=this.length();const c=void 0!==n&&void 0!==r;function d(t,e,n,r,i){return function(s){const o=r/n,a=(r+i)/n,l=e-t;return Ttt.map(s,0,1,t+o*l,t+a*l)}}i.forEach((function(i){const s=i.length();c?(o.push(i.scale(d(t,n,h,u,s))),l.push(i.scale(d(-e,-r,h,u,s)))):(o.push(i.scale(t)),l.push(i.scale(-e))),u+=s})),l=l.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const p=o[0].points[0],f=o[s-1].points[o[s-1].points.length-1],m=l[s-1].points[l[s-1].points.length-1],g=l[0].points[0],y=Ttt.makeline(m,p),v=Ttt.makeline(f,g),_=[y].concat(o).concat([v]).concat(l);return new Ett(_)}outlineshapes(t,e,n){e=e||t;const r=this.outline(t,e).curves,i=[];for(let t=1,e=r.length;t<e/2;t++){const s=Ttt.makeshape(r[t],r[e-t],n);s.startcap.virtual=t>1,s.endcap.virtual=t<e/2-1,i.push(s)}return i}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof Dtt&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=Ctt(t.p1.x,t.p2.x),n=Ctt(t.p1.y,t.p2.y),r=Rtt(t.p1.x,t.p2.x),i=Rtt(t.p1.y,t.p2.y);return Ttt.roots(this.points,t).filter((t=>{var s=this.get(t);return Ttt.between(s.x,e,r)&&Ttt.between(s.y,n,i)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,r=[];for(let i,s,o,a=0;a<n;a++)s=e.slice(a,a+1),o=e.slice(a+2),i=this.curveintersects(s,o,t),r.push(...i);return r}curveintersects(t,e,n){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let i=[];return r.forEach((function(t){const e=Ttt.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,r){const i=(r-n)/4,s=this.get(n+i),o=this.get(r-i),a=Ttt.dist(t,e),l=Ttt.dist(t,s),u=Ttt.dist(t,o);return Att(l-a)+Att(u-a)}_iterate(t,e){let n,r=0,i=1;do{n=0,i=1;let s,o,a,l,u,h=this.get(r),c=!1,d=!1,p=i,f=1;do{if(d=c,l=a,p=(r+i)/2,s=this.get(p),o=this.get(i),a=Ttt.getccenter(h,s,o),a.interval={start:r,end:i},c=this._error(a,h,r,i)<=t,u=d&&!c,u||(f=i),c){if(i>=1){if(a.interval.end=f=1,l=a,i>1){let t={x:a.x+a.r*Ntt(a.e),y:a.y+a.r*Ptt(a.e)};a.e+=Ttt.angle({x:a.x,y:a.y},t,this.get(1))}break}i+=(i-r)/2}else i=p}while(!u&&n++<100);if(n>=100)break;l=l||a,e.push(l),r=f}while(i<1);return e}}function Ltt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Utt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||Btt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ftt(t){return function(t){if(Array.isArray(t))return Ltt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Btt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ztt(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Btt(t,e){if(t){if("string"==typeof t)return Ltt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ltt(t,e):void 0}}var jtt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(e instanceof Array?e.length?e:[void 0]:[e]).map((function(t){return{keyAccessor:t,isProp:!(t instanceof Function)}})),s=t.reduce((function(t,e){var r=t,s=e;return i.forEach((function(t,e){var o,a=t.keyAccessor;if(t.isProp){var l=s,u=l[a],h=function(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}(l,[a].map(ztt));o=u,s=h}else o=a(s,e);e+1<i.length?(r.hasOwnProperty(o)||(r[o]={}),r=r[o]):n?(r.hasOwnProperty(o)||(r[o]=[]),r[o].push(s)):r[o]=s})),t}),{});n instanceof Function&&function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r===i.length?Object.keys(e).forEach((function(t){return e[t]=n(e[t])})):Object.values(e).forEach((function(e){return t(e,r+1)}))}(s);var o=s;return r&&(o=[],function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===i.length?o.push({keys:n,vals:e}):Object.entries(e).forEach((function(e){var r=Utt(e,2),i=r[0],s=r[1];return t(s,[].concat(Ftt(n),[i]))}))}(s),e instanceof Array&&0===e.length&&1===o.length&&(o[0].keys=[])),o};function Vtt(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}const Gtt=Symbol("implicit");var Htt=function(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Wtt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function qtt(t,e,n){if(Xtt())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}function $tt(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Xtt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Xtt=function(){return!!t})()}function Ytt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ktt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ytt(Object(n),!0).forEach((function(e){$tt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ytt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ztt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||tet(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jtt(t){return function(t){if(Array.isArray(t))return Wtt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||tet(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qtt(t){return Qtt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qtt(t)}function tet(t,e){if(t){if("string"==typeof t)return Wtt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wtt(t,e):void 0}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".force-graph-container canvas {\n  display: block;\n  user-select: none;\n  outline: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.force-graph-container .clickable {\n  cursor: pointer;\n}\n\n.force-graph-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.force-graph-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}\n");var eet=function t(){var e=new Q6,n=[],r=[],i=Gtt;function s(t){let s=e.get(t);if(void 0===s){if(i!==Gtt)return i;e.set(t,s=n.push(t)-1)}return r[s%r.length]}return s.domain=function(t){if(!arguments.length)return n.slice();n=[],e=new Q6;for(const r of t)e.has(r)||e.set(r,n.push(r)-1);return s},s.range=function(t){return arguments.length?(r=Array.from(t),s):r.slice()},s.unknown=function(t){return arguments.length?(i=t,s):i},s.copy=function(){return t(n,r).unknown(i)},Vtt.apply(s,arguments),s}(Htt);function net(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=eet(e(t))}))}var ret=function(t,e){return e.onNeedsRedraw&&e.onNeedsRedraw()},iet=function(t,e){if(!e.isShadow){var n=j8(e.linkDirectionalParticles);e.graphData.links.forEach((function(t){var e=Math.round(Math.abs(n(t)));e?t.__photons=Jtt(Array(e)).map((function(){return{}})):delete t.__photons}))}},set=B8({props:{graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1,iet(0,e)}},dagMode:{onChange:function(t,e){!t&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:ret},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:ret},nodeColor:{default:"color",triggerUpdate:!1,onChange:ret},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:ret},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:ret},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:ret},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:ret},linkColor:{default:"color",triggerUpdate:!1,onChange:ret},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:ret},linkWidth:{default:1,triggerUpdate:!1,onChange:ret},linkCurvature:{default:0,triggerUpdate:!1,onChange:ret},linkCanvasObject:{triggerUpdate:!1,onChange:ret},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:ret},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:ret},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:ret},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:ret},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:iet},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.velocityDecay(t)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(t,e,n){return void 0===n?t.forceLayout.force(e):(t.forceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},isEngineRunning:function(t){return!!t.engineRunning},tickFrame:function(t){var e,n,r,i,s,o;return!t.isShadow&&t.engineRunning&&(++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||t.d3AlphaMin>0&&t.forceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.forceLayout.tick(),t.onEngineTick())),function(){var e=j8(t.linkVisibility),n=j8(t.linkColor),r=j8(t.linkWidth),i=j8(t.linkLineDash),s=j8(t.linkCurvature),o=j8(t.linkCanvasObjectMode),a=t.ctx,l=2*t.isShadow,u=t.graphData.links.filter(e);u.forEach((function(t){var e=s(t);if(!e)return void(t.__controlPoints=null);var n=t.source,r=t.target;if(!(n&&r&&n.hasOwnProperty("x")&&r.hasOwnProperty("x")))return;var i=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2));if(i>0){var o=Math.atan2(r.y-n.y,r.x-n.x),a=i*e,l={x:(n.x+r.x)/2+a*Math.cos(o-Math.PI/2),y:(n.y+r.y)/2+a*Math.sin(o-Math.PI/2)};t.__controlPoints=[l.x,l.y]}else{var u=70*e;t.__controlPoints=[r.x,r.y-u,r.x+u,r.y]}}));var h=[],c=[],d=u;if(t.linkCanvasObject){var p=[],f=[];u.forEach((function(t){return({before:h,after:c,replace:p}[o(t)]||f).push(t)})),d=[].concat(Jtt(h),c,f),h=h.concat(p)}a.save(),h.forEach((function(e){return t.linkCanvasObject(e,a,t.globalScale)})),a.restore();var m=jtt(d,[n,r,i]);a.save(),Object.entries(m).forEach((function(e){var n=Ztt(e,2),r=n[0],s=n[1],o=r&&"undefined"!==r?r:"rgba(0,0,0,0.15)";Object.entries(s).forEach((function(e){var n=Ztt(e,2),r=n[0],s=n[1],u=(r||1)/t.globalScale+l;Object.entries(s).forEach((function(t){var e=Ztt(t,2);e[0];var n=e[1],r=i(n[0]);a.beginPath(),n.forEach((function(t){var e=t.source,n=t.target;if(e&&n&&e.hasOwnProperty("x")&&n.hasOwnProperty("x")){a.moveTo(e.x,e.y);var r=t.__controlPoints;r?a[2===r.length?"quadraticCurveTo":"bezierCurveTo"].apply(a,Jtt(r).concat([n.x,n.y])):a.lineTo(n.x,n.y)}})),a.strokeStyle=o,a.lineWidth=u,a.setLineDash(r||[]),a.stroke()}))}))})),a.restore(),a.save(),c.forEach((function(e){return t.linkCanvasObject(e,a,t.globalScale)})),a.restore()}(),!t.isShadow&&(e=j8(t.linkDirectionalArrowLength),n=j8(t.linkDirectionalArrowRelPos),r=j8(t.linkVisibility),i=j8(t.linkDirectionalArrowColor||t.linkColor),s=j8(t.nodeVal),(o=t.ctx).save(),t.graphData.links.filter(r).forEach((function(r){var a=e(r);if(a&&!(a<0)){var l=r.source,u=r.target;if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var h=Math.sqrt(Math.max(0,s(l)||1))*t.nodeRelSize,c=Math.sqrt(Math.max(0,s(u)||1))*t.nodeRelSize,d=Math.min(1,Math.max(0,n(r))),p=i(r)||"rgba(0,0,0,0.28)",f=a/1.6/2,m=r.__controlPoints&&qtt(Dtt,[l.x,l.y].concat(Jtt(r.__controlPoints),[u.x,u.y])),g=m?function(t){return m.get(t)}:function(t){return{x:l.x+(u.x-l.x)*t||0,y:l.y+(u.y-l.y)*t||0}},y=m?m.length():Math.sqrt(Math.pow(u.x-l.x,2)+Math.pow(u.y-l.y,2)),v=h+a+(y-h-c-a)*d,_=g(v/y),b=g((v-a)/y),x=g((v-.8*a)/y),w=Math.atan2(_.y-b.y,_.x-b.x)-Math.PI/2;o.beginPath(),o.moveTo(_.x,_.y),o.lineTo(b.x+f*Math.cos(w),b.y+f*Math.sin(w)),o.lineTo(x.x,x.y),o.lineTo(b.x-f*Math.cos(w),b.y-f*Math.sin(w)),o.fillStyle=p,o.fill()}}})),o.restore()),!t.isShadow&&function(){var e=j8(t.linkDirectionalParticles),n=j8(t.linkDirectionalParticleSpeed),r=j8(t.linkDirectionalParticleWidth),i=j8(t.linkVisibility),s=j8(t.linkDirectionalParticleColor||t.linkColor),o=t.ctx;o.save(),t.graphData.links.filter(i).forEach((function(i){var a=e(i);if(i.hasOwnProperty("__photons")&&i.__photons.length){var l=i.source,u=i.target;if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var h=n(i),c=i.__photons||[],d=Math.max(0,r(i)/2)/Math.sqrt(t.globalScale),p=s(i)||"rgba(0,0,0,0.28)";o.fillStyle=p;var f=i.__controlPoints?qtt(Dtt,[l.x,l.y].concat(Jtt(i.__controlPoints),[u.x,u.y])):null,m=0,g=!1;c.forEach((function(t){var e=!!t.__singleHop;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=e?0:m/a),!e&&m++,t.__progressRatio+=h,t.__progressRatio>=1){if(e)return void(g=!0);t.__progressRatio=t.__progressRatio%1}var n=t.__progressRatio,r=f?f.get(n):{x:l.x+(u.x-l.x)*n||0,y:l.y+(u.y-l.y)*n||0};o.beginPath(),o.arc(r.x,r.y,d,0,2*Math.PI,!1),o.fill()})),g&&(i.__photons=i.__photons.filter((function(t){return!t.__singleHop||t.__progressRatio<=1})))}}})),o.restore()}(),function(){var e=j8(t.nodeVisibility),n=j8(t.nodeVal),r=j8(t.nodeColor),i=j8(t.nodeCanvasObjectMode),s=t.ctx,o=t.isShadow/t.globalScale,a=t.graphData.nodes.filter(e);s.save(),a.forEach((function(e){var a=i(e);if(!t.nodeCanvasObject||"before"!==a&&"replace"!==a||(t.nodeCanvasObject(e,s,t.globalScale),"replace"!==a)){var l=Math.sqrt(Math.max(0,n(e)||1))*t.nodeRelSize+o;s.beginPath(),s.arc(e.x,e.y,l,0,2*Math.PI,!1),s.fillStyle=r(e)||"rgba(31, 120, 180, 0.92)",s.fill(),t.nodeCanvasObject&&"after"===a&&t.nodeCanvasObject(e,t.ctx,t.globalScale)}else s.restore()})),s.restore()}(),this},emitParticle:function(t,e){return e&&(!e.__photons&&(e.__photons=[]),e.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:utt().force("link",ntt()).force("charge",htt()).force("center",E7()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.ctx=t},update:function(t,e){t.engineRunning=!1,t.onUpdate(),null!==t.nodeAutoColorBy&&net(t.graphData.nodes,j8(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&net(t.graphData.links,j8(t.linkAutoColorBy),t.linkColor),t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]})),t.forceLayout.stop().alpha(1).nodes(t.graphData.nodes);var n=t.forceLayout.force("link");n&&n.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var r=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===Qtt(t)?e(t):t}o.out.push(a)}));var h=[];return function t(n){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=function(){var s=n[o];if(-1!==r.indexOf(s)){var a=[].concat(Jtt(r.slice(r.indexOf(s))),[s]).map((function(t){return e(t.data)}));return h.some((function(t){return t.length===a.length&&t.every((function(t,e){return t===a[e]}))}))||(h.push(a),l(a)),1}i>s.depth&&(s.depth=i,t(s.out,[].concat(Jtt(r),[s]),i+(s.skip?0:1)))},o=0,a=n.length;o<a;o++)s()}(Object.values(u)),Object.assign.apply(Object,[{}].concat(Jtt(Object.entries(u).filter((function(t){return!Ztt(t,2)[1].skip})).map((function(t){var e=Ztt(t,2);return $tt({},e[0],e[1].depth)})))))}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),i=Math.max.apply(Math,Jtt(Object.values(r||[]))),s=t.dagLevelDistance||t.graphData.nodes.length/(i||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu"].includes(e.dagMode)){var o=["lr","rl"].includes(e.dagMode)?"fx":"fy";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[o]}))}if(["lr","rl","td","bu"].includes(t.dagMode)){var a=["rl","bu"].includes(t.dagMode),l=["lr","rl"].includes(t.dagMode)?"fx":"fy";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[l]=function(e){return(r[e[t.nodeId]]-i/2)*s*(a?-1:1)}(e)}))}t.forceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?function(t,e,n,r){var i,s,o,a,l=J7(.1);function u(t){for(var l=0,u=i.length;l<u;++l){var h=i[l],c=h.x-e||1e-6,d=(h.y||0)-n||1e-6,p=(h.z||0)-r||1e-6,f=Math.sqrt(c*c+d*d+p*p),m=(a[l]-f)*o[l]*t/f;h.vx+=c*m,s>1&&(h.vy+=d*m),s>2&&(h.vz+=p*m)}}function h(){if(i){var e,n=i.length;for(o=new Array(n),a=new Array(n),e=0;e<n;++e)a[e]=+t(i[e],e,i),o[e]=isNaN(a[e])?0:+l(i[e],e,i)}}return"function"!=typeof t&&(t=J7(+t)),null==e&&(e=0),null==n&&(n=0),null==r&&(r=0),u.initialize=function(t,...e){i=t,s=e.find((t=>[1,2,3].includes(t)))||2,h()},u.strength=function(t){return arguments.length?(l="function"==typeof t?t:J7(+t),h(),u):l},u.radius=function(e){return arguments.length?(t="function"==typeof e?e:J7(+e),h(),u):t},u.x=function(t){return arguments.length?(e=+t,u):e},u.y=function(t){return arguments.length?(n=+t,u):n},u.z=function(t){return arguments.length?(r=+t,u):r},u}((function(e){var n=r[e[t.nodeId]]||-1;return("radialin"===t.dagMode?i-n:n)*s})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null);for(var u=0;u<t.warmupTicks&&!(t.d3AlphaMin>0&&t.forceLayout.alpha()<t.d3AlphaMin);u++)t.forceLayout.tick();this.resetCountdown(),t.onFinishUpdate()}});function oet(t,e){var n=t instanceof Array?t:[t],r=new e;return r._destructor&&r._destructor(),{linkProp:function(t){return{default:r[t](),onChange:function(e,r){n.forEach((function(n){return r[n][t](e)}))},triggerUpdate:!1}},linkMethod:function(t){return function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=[];return n.forEach((function(n){var r=e[n],s=r[t].apply(r,i);s!==r&&o.push(s)})),o.length?o[0]:this}}}}var aet=oet("forceGraph",set),uet=oet(["forceGraph","shadowGraph"],set),het=Object.assign.apply(Object,Jtt(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(t){return $tt({},t,aet.linkProp(t))}))).concat(Jtt(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map((function(t){return $tt({},t,uet.linkProp(t))}))))),cet=Object.assign.apply(Object,Jtt(["d3Force","d3ReheatSimulation","emitParticle"].map((function(t){return $tt({},t,aet.linkMethod(t))}))));function det(t){if(t.canvas){var e=t.canvas.width,n=t.canvas.height;300===e&&150===n&&(e=n=0);var r=window.devicePixelRatio;e/=r,n/=r,[t.canvas,t.shadowCanvas].forEach((function(i){i.style.width="".concat(t.width,"px"),i.style.height="".concat(t.height,"px"),i.width=t.width*r,i.height=t.height*r,e||n||i.getContext("2d").scale(r,r)}));var i=G6(t.canvas).k;t.zoom.translateBy(t.zoom.__baseElem,(t.width-e)/2/i,(t.height-n)/2/i),t.needsRedraw=!0}}function pet(t){var e=window.devicePixelRatio;t.setTransform(e,0,0,e,0,0)}function fet(t,e,n){t.save(),pet(t),t.clearRect(0,0,e,n),t.restore()}var met=B8({props:Ktt({width:{default:window.innerWidth,onChange:function(t,e){return det(e)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(t,e){return det(e)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){[t.nodes,t.links].every((function(t){return(t||[]).every((function(t){return!t.hasOwnProperty("__indexColor")}))}))&&e.colorTracker.reset(),[{type:"Node",objs:t.nodes},{type:"Link",objs:t.links}].forEach((function(t){var n=t.type;t.objs.filter((function(t){if(!t.hasOwnProperty("__indexColor"))return!0;var n=e.colorTracker.lookup(t.__indexColor);return!n||!n.hasOwnProperty("d")||n.d!==t})).forEach((function(t){t.__indexColor=e.colorTracker.register({type:n,d:t})}))})),e.forceGraph.graphData(t),e.shadowGraph.graphData(t)},triggerUpdate:!1},backgroundColor:{onChange:function(t,e){e.canvas&&t&&(e.canvas.style.background=t)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(t,e){e.shadowGraph.nodeCanvasObject(t?function(e,n,r){return t(e,e.__indexColor,n,r)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(t,e){e.shadowGraph.linkCanvasObject(t?function(e,n,r){return t(e,e.__indexColor,n,r)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(t,e){e.zoom.scaleExtent([t,e.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(t,e){e.zoom.scaleExtent([e.zoom.scaleExtent()[0],t])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(t,e){e.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},het),aliases:{stopAnimation:"pauseAnimation"},methods:Ktt({graph2ScreenCoords:function(t,e,n){var r=G6(t.canvas);return{x:e*r.k+r.x,y:n*r.k+r.y}},screen2GraphCoords:function(t,e,n){var r=G6(t.canvas);return{x:(e-r.x)/r.k,y:(n-r.y)/r.k}},centerAt:function(t,e,n,r){if(!t.canvas)return null;if(void 0!==e||void 0!==n){var i=Object.assign({},void 0!==e?{x:e}:{},void 0!==n?{y:n}:{});return r?t.tweenGroup.add(new I8(s()).to(i,r).easing(C8.Quadratic.Out).onUpdate(o).start()):o(i),this}return s();function s(){var e=G6(t.canvas);return{x:(t.width/2-e.x)/e.k,y:(t.height/2-e.y)/e.k}}function o(e){var n=e.x,r=e.y;t.zoom.translateTo(t.zoom.__baseElem,void 0===n?s().x:n,void 0===r?s().y:r),t.needsRedraw=!0}},zoom:function(t,e,n){return t.canvas?void 0!==e?(n?t.tweenGroup.add(new I8({k:r()}).to({k:e},n).easing(C8.Quadratic.Out).onUpdate((function(t){return i(t.k)})).start()):i(e),this):r():null;function r(){return G6(t.canvas).k}function i(e){t.zoom.scaleTo(t.zoom.__baseElem,e),t.needsRedraw=!0}},zoomToFit:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];var o=this.getGraphBbox.apply(this,i);if(o){var a={x:(o.x[0]+o.x[1])/2,y:(o.y[0]+o.y[1])/2},l=Math.max(1e-12,Math.min(1e12,(t.width-2*n)/(o.x[1]-o.x[0]),(t.height-2*n)/(o.y[1]-o.y[0])));this.centerAt(a.x,a.y,e),this.zoom(l,e)}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=j8(t.nodeVal),r=function(e){return Math.sqrt(Math.max(0,n(e)||1))*t.nodeRelSize},i=t.graphData.nodes.filter(e).map((function(t){return{x:t.x,y:t.y,r:r(t)}}));return i.length?{x:[r8(i,(function(t){return t.x-t.r})),n8(i,(function(t){return t.x+t.r}))],y:[r8(i,(function(t){return t.y-t.r})),n8(i,(function(t){return t.y+t.r}))]}:null},pauseAnimation:function(t){return t.animationFrameRequestId&&(cancelAnimationFrame(t.animationFrameRequestId),t.animationFrameRequestId=null),this},resumeAnimation:function(t){return t.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},cet),stateInit:function(){return{lastSetZoom:1,zoom:J6(),forceGraph:new set,shadowGraph:(new set).cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new H9,tweenGroup:new N8}},init:function(t,e){var n=this;t.innerHTML="";var r=document.createElement("div");r.classList.add("force-graph-container"),r.style.position="relative",t.appendChild(r),e.canvas=document.createElement("canvas"),e.backgroundColor&&(e.canvas.style.background=e.backgroundColor),r.appendChild(e.canvas),e.shadowCanvas=document.createElement("canvas");var i=e.canvas.getContext("2d"),s=e.shadowCanvas.getContext("2d",{willReadFrequently:!0}),o={x:-1e12,y:-1e12},a=function(){var t=null,n=window.devicePixelRatio,r=o.x>0&&o.y>0?s.getImageData(o.x*n,o.y*n,1,1):null;return r&&(t=e.colorTracker.lookup(r.data)),t};C5(e.canvas).call(function(){var t,e,n,r,i=G5,s=H5,o=W5,a=q5,l={},u=P5("start","drag","end"),h=0,c=0;function d(t){t.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",y,D5).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(o,a){if(!r&&i.call(this,o,a)){var l=_(this,s.call(this,o,a),o,a,"mouse");l&&(C5(o.view).on("mousemove.drag",f,L5).on("mouseup.drag",m,L5),z5(o.view),U5(o),n=!1,t=o.clientX,e=o.clientY,l("start",o))}}function f(r){if(F5(r),!n){var i=r.clientX-t,s=r.clientY-e;n=i*i+s*s>c}l.mouse("drag",r)}function m(t){C5(t.view).on("mousemove.drag mouseup.drag",null),B5(t.view,n),F5(t),l.mouse("end",t)}function g(t,e){if(i.call(this,t,e)){var n,r,o=t.changedTouches,a=s.call(this,t,e),l=o.length;for(n=0;n<l;++n)(r=_(this,a,t,e,o[n].identifier,o[n]))&&(U5(t),r("start",t,o[n]))}}function y(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=l[r[e].identifier])&&(F5(t),n("drag",t,r[e]))}function v(t){var e,n,i=t.changedTouches,s=i.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<s;++e)(n=l[i[e].identifier])&&(U5(t),n("end",t,i[e]))}function _(t,e,n,r,i,s){var a,c,p,f=u.copy(),m=R5(s||n,e);if(null!=(p=o.call(t,new V5("beforestart",{sourceEvent:n,target:d,identifier:i,active:h,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),r)))return a=p.x-m[0]||0,c=p.y-m[1]||0,function n(s,o,u){var g,y=m;switch(s){case"start":l[i]=n,g=h++;break;case"end":delete l[i],--h;case"drag":m=R5(u||o,e),g=h}f.call(s,t,new V5(s,{sourceEvent:o,subject:p,target:d,identifier:i,active:g,x:m[0]+a,y:m[1]+c,dx:m[0]-y[0],dy:m[1]-y[1],dispatch:f}),r)}}return d.filter=function(t){return arguments.length?(i="function"==typeof t?t:j5(!!t),d):i},d.container=function(t){return arguments.length?(s="function"==typeof t?t:j5(t),d):s},d.subject=function(t){return arguments.length?(o="function"==typeof t?t:j5(t),d):o},d.touchable=function(t){return arguments.length?(a="function"==typeof t?t:j5(!!t),d):a},d.on=function(){var t=u.on.apply(u,arguments);return t===u?d:t},d.clickDistance=function(t){return arguments.length?(c=(t=+t)*t,d):Math.sqrt(c)},d}().subject((function(){if(!e.enableNodeDrag)return null;var t=a();return t&&"Node"===t.type?t.d:null})).on("start",(function(t){var n=t.subject;n.__initialDragPos={x:n.x,y:n.y,fx:n.fx,fy:n.fy},t.active||(n.fx=n.x,n.fy=n.y),e.canvas.classList.add("grabbable")})).on("drag",(function(t){var n=t.subject,r=n.__initialDragPos,i=t,s=G6(e.canvas).k,o={x:r.x+(i.x-r.x)/s-n.x,y:r.y+(i.y-r.y)/s-n.y};["x","y"].forEach((function(t){return n["f".concat(t)]=n[t]=r[t]+(i[t]-r[t])/s})),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),e.isPointerDragging=!0,n.__dragged=!0,e.onNodeDrag(n,o)})).on("end",(function(t){var n=t.subject,r=n.__initialDragPos,i={x:n.x-r.x,y:n.y-r.y};void 0===r.fx&&(n.fx=void 0),void 0===r.fy&&(n.fy=void 0),delete n.__initialDragPos,e.forceGraph.d3AlphaTarget()&&e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.canvas.classList.remove("grabbable"),e.isPointerDragging=!1,n.__dragged&&(delete n.__dragged,e.onNodeDragEnd(n,i))}))),e.zoom(e.zoom.__baseElem=C5(e.canvas)),e.zoom.__baseElem.on("dblclick.zoom",null),e.zoom.filter((function(t){return!t.button&&e.enableZoomPanInteraction&&("wheel"!==t.type||j8(e.enableZoomInteraction)(t))&&("wheel"===t.type||j8(e.enablePanInteraction)(t))})).on("zoom",(function(t){var r=t.transform;[i,s].forEach((function(t){pet(t),t.translate(r.x,r.y),t.scale(r.k,r.k)})),e.onZoom&&e.onZoom(Ktt(Ktt({},r),n.centerAt())),e.needsRedraw=!0})).on("end",(function(t){return e.onZoomEnd&&e.onZoomEnd(Ktt(Ktt({},t.transform),n.centerAt()))})),det(e),e.forceGraph.onNeedsRedraw((function(){return e.needsRedraw=!0})).onFinishUpdate((function(){G6(e.canvas).k===e.lastSetZoom&&e.graphData.nodes.length&&(e.zoom.scaleTo(e.zoom.__baseElem,e.lastSetZoom=4/Math.cbrt(e.graphData.nodes.length)),e.needsRedraw=!0)})),e.tooltip=new T7(r),["pointermove","pointerdown"].forEach((function(t){return r.addEventListener(t,(function(n){"pointerdown"===t&&(e.isPointerPressed=!0,e.pointerDownEvent=n),!e.isPointerDragging&&"pointermove"===n.type&&e.onBackgroundClick&&(n.pressure>0||e.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(t){return Math.abs(t)>1})))&&(e.isPointerDragging=!0);var i,s,a,l=(i=r.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:i.top+a,left:i.left+s});o.x=n.pageX-l.left,o.y=n.pageY-l.top}),{passive:!0})})),r.addEventListener("pointerup",(function(t){if(e.isPointerPressed=!1,e.isPointerDragging)e.isPointerDragging=!1;else{var n=[t,e.pointerDownEvent];requestAnimationFrame((function(){if(0===t.button)if(e.hoverObj){var r=e["on".concat(e.hoverObj.type,"Click")];r&&r.apply(void 0,[e.hoverObj.d].concat(n))}else e.onBackgroundClick&&e.onBackgroundClick.apply(e,n);if(2===t.button)if(e.hoverObj){var i=e["on".concat(e.hoverObj.type,"RightClick")];i&&i.apply(void 0,[e.hoverObj.d].concat(n))}else e.onBackgroundRightClick&&e.onBackgroundRightClick.apply(e,n)}))}}),{passive:!0}),r.addEventListener("contextmenu",(function(t){return!(e.onBackgroundRightClick||e.onNodeRightClick||e.onLinkRightClick)||(t.preventDefault(),!1)})),e.forceGraph(i),e.shadowGraph(s);var l=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return v8(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),A8(t,e,{leading:r,maxWait:e,trailing:i})}((function(){fet(s,e.width,e.height),e.shadowGraph.linkWidth((function(t){return j8(e.linkWidth)(t)+e.linkHoverPrecision}));var t=G6(e.canvas);e.shadowGraph.globalScale(t.k).tickFrame()}),800);e.flushShadowCanvas=l.flush,(this._animationCycle=function t(){var n=!e.autoPauseRedraw||!!e.needsRedraw||e.forceGraph.isEngineRunning()||e.graphData.links.some((function(t){return t.__photons&&t.__photons.length}));if(e.needsRedraw=!1,e.enablePointerInteraction){var r=e.isPointerDragging?null:a();if(r!==e.hoverObj){var s=e.hoverObj,o=s?s.type:null,u=r?r.type:null;if(o&&o!==u){var h=e["on".concat(o,"Hover")];h&&h(null,s.d)}if(u){var c=e["on".concat(u,"Hover")];c&&c(r.d,o===u?s.d:null)}e.tooltip.content(r&&j8(e["".concat(r.type.toLowerCase(),"Label")])(r.d)||null),e.canvas.classList[r&&e["on".concat(u,"Click")]||!r&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=r}n&&l()}if(n){fet(i,e.width,e.height);var d=G6(e.canvas).k;e.onRenderFramePre&&e.onRenderFramePre(i,d),e.forceGraph.globalScale(d).tickFrame(),e.onRenderFramePost&&e.onRenderFramePost(i,d)}e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(t)})()},update:function(t){}});const get=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.wrapperElementType,i=void 0===r?"div":r,s=e.nodeMapper,o=void 0===s?function(t){return t}:s,a=e.methodNames,l=void 0===a?[]:a,u=e.initPropNames,h=void 0===u?[]:u;return n.forwardRef((function(e,r){var s=n.useRef(),a=n.useMemo((function(){var n=Object.fromEntries(h.filter((function(t){return e.hasOwnProperty(t)})).map((function(t){return[t,e[t]]})));return t(n)}),[]);m3((function(){a(o(s.current))}),n.useLayoutEffect),m3((function(){return a._destructor instanceof Function?a._destructor:void 0}));var u,c,d,p=n.useCallback((function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return a[t]instanceof Function?a[t].apply(a,n):void 0}),[a]),f=n.useRef({});return Object.keys((u=e,c=[].concat(p3(l),p3(h)),d=new Set(c),Object.assign.apply(Object,[{}].concat(l3(Object.entries(u).filter((function(t){var e=a3(t,1)[0];return!d.has(e)})).map((function(t){var e=a3(t,2);return o3({},e[0],e[1])}))))))).filter((function(t){return f.current[t]!==e[t]})).forEach((function(t){return p(t,e[t])})),f.current=e,n.useImperativeHandle(r,(function(){return Object.fromEntries(l.map((function(t){return[t,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return p.apply(void 0,[t].concat(n))}]})))}),[p]),n.createElement(i,{ref:s})}))}(met,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});get.displayName="ForceGraph2D",get.propTypes=pp,e.ForceGraph2D=get,e.ForceGraph3D=s3,e.ForceGraphAR=Zb,e.ForceGraphVR=yp}));
